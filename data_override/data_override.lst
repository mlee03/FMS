Page 1           Source Listing                  COUNT_NE_1
2021-06-01 08:55                                 /tmp/iforteVON9k.i90

      1 # 1 "data_override.F90"
      2 !***********************************************************************
      3 !*                   GNU Lesser General Public License
      4 !*
      5 !* This file is part of the GFDL Flexible Modeling System (FMS).
      6 !*
      7 !* FMS is free software: you can redistribute it and/or modify it under
      8 !* the terms of the GNU Lesser General Public License as published by
      9 !* the Free Software Foundation, either version 3 of the License, or (at
     10 !* your option) any later version.
     11 !*
     12 !* FMS is distributed in the hope that it will be useful, but WITHOUT
     13 !* ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
     14 !* FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
     15 !* for more details.
     16 !*
     17 !* You should have received a copy of the GNU Lesser General Public
     18 !* License along with FMS.  If not, see <http://www.gnu.org/licenses/>.
     19 !***********************************************************************
     20 
     21 !> @file
     22 !! @brief Given a gridname, fieldname and model time this routine will get data in a file whose
     23 !!   path is described in a user-provided data_table, do spatial and temporal interpolation if
     24 !!   necessary to convert data to model's grid and time.
     25 !! @author Z. Liang, M.J. Harrison, M. Winton
     26 !!
     27 !! Given a gridname, fieldname and model time this routine will get data in a file whose
     28 !! path is described in a user-provided data_table, do spatial and temporal interpolation if
     29 !! necessary to convert data to model's grid and time.
     30 !!
     31 !! Before using data_override a data_table must be created with the following entries:
     32 !! gridname, fieldname_code, fieldname_file, file_name, ongrid, factor.
     33 !!
     34 !! More explainations about data_table entries can be found in the source code (defining data_type)
     35 !!
     36 !! If user wants to override fieldname_code with a const, set fieldname_file in data_table = ""
     37 !! and factor = const
     38 !!
     39 !! If user wants to override fieldname_code with data from a file, set fieldname_file = name in
     40 !! the netCDF data file, factor then will be for unit conversion (=1 if no conversion required)
     41 !!
     42 !! A field can be overriden globally (by default) or users can specify one or two regions in which
     43 !! data_override will take place, field values outside the region will not be affected.
     44 module data_override_mod
     45 use constants_mod, only: PI
     46 use mpp_io_mod, only: axistype, mpp_close, mpp_open, mpp_get_axis_data, MPP_RDONLY
     47 use mpp_mod, only : mpp_error, FATAL, WARNING, stdout, stdlog, mpp_max
     48 use mpp_mod, only : input_nml_file, get_unit
     49 use horiz_interp_mod, only : horiz_interp_init, horiz_interp_new, horiz_interp_type, &
     50                              assignment(=)
     51 use time_interp_external_mod, only:time_interp_external_init_classic=>time_interp_external_init, &
     52                                    time_interp_external_classic=>time_interp_external, &
     53                                    init_external_field_classic=>init_external_field, &
     54                                    get_external_field_size_classic=>get_external_field_size, &
     55                                    set_override_region_classic=>set_override_region, &
     56                                    reset_src_data_region_classic=>reset_src_data_region
     57 use time_interp_external2_mod, only:time_interp_external_init_fms2io=>time_interp_external_init, &

Page 2           Source Listing                  COUNT_NE_1
2021-06-01 08:55                                 data_override.F90

     58                                    time_interp_external_fms2io=>time_interp_external, &
     59                                    init_external_field_fms2io=>init_external_field, &
     60                                    get_external_field_size_fms2io=>get_external_field_size, &
     61                                    set_override_region_fms2io=>set_override_region, &
     62                                    reset_src_data_region_fms2io=>reset_src_data_region, &
     63                                    NO_REGION, INSIDE_REGION, OUTSIDE_REGION,     &
     64                                    get_external_fileobj
     65 use fms_mod, only: write_version_number, field_exist, lowercase, check_nml_error
     66 use axis_utils_mod, only: get_axis_bounds
     67 use axis_utils2_mod,  only : nearest_index, axis_edges
     68 use fms_io_mod, only: fms_io_init, get_mosaic_tile_file_classic=>get_mosaic_tile_file
     69 use mpp_domains_mod, only : domain2d, mpp_get_compute_domain, NULL_DOMAIN2D,operator(.NE.),operator(.EQ.)
     70 use mpp_domains_mod, only : mpp_get_global_domain, mpp_get_data_domain
     71 use mpp_domains_mod, only : domainUG, mpp_pass_SG_to_UG, mpp_get_UG_SG_domain, NULL_DOMAINUG
     72 use time_manager_mod, only: time_type
     73 use fms2_io_mod,     only : FmsNetcdfFile_t, open_file, close_file, &
     74                             read_data, fms2_io_init, variable_exists, &
     75                             get_mosaic_tile_file_fms2_io=>get_mosaic_tile_file
     76 use get_grid_version_mpp_mod, only: get_grid_version_classic_1, get_grid_version_classic_2
     77 use get_grid_version_fms2io_mod, only: get_grid_version_1, get_grid_version_2
     78 
     79 implicit none
     80 private
     81 
     82 ! Include variable "version" to be written to log file.
     83 # 1 "../include/file_version.h" 1 
     84 ! -*-f90-*-
     85 !***********************************************************************
     86 !*                   GNU Lesser General Public License
     87 !*
     88 !* This file is part of the GFDL Flexible Modeling System (FMS).
     89 !*
     90 !* FMS is free software: you can redistribute it and/or modify it under
     91 !* the terms of the GNU Lesser General Public License as published by
     92 !* the Free Software Foundation, either version 3 of the License, or (at
     93 !* your option) any later version.
     94 !*
     95 !* FMS is distributed in the hope that it will be useful, but WITHOUT
     96 !* ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
     97 !* FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
     98 !* for more details.
     99 !*
    100 !* You should have received a copy of the GNU Lesser General Public
    101 !* License along with FMS.  If not, see <http://www.gnu.org/licenses/>.
    102 !***********************************************************************
    103 
    104 # 23
    105 
    106   character(len=*), parameter :: version = 'unknown'
    107 
    108 # 83 "data_override.F90" 2 
    109 
    110 type data_type
    111    character(len=3)   :: gridname
    112    character(len=128) :: fieldname_code !< fieldname used in user's code (model)
    113    character(len=128) :: fieldname_file !< fieldname used in the netcdf data file
    114    character(len=512) :: file_name   !< name of netCDF data file

Page 3           Source Listing                  COUNT_NE_1
2021-06-01 08:55                                 data_override.F90

    115    character(len=128) :: interpol_method   !< interpolation method (default "bilinear")
    116    real               :: factor !< For unit conversion, default=1, see OVERVIEW above
    117    real               :: lon_start, lon_end, lat_start, lat_end
    118    integer            :: region_type
    119 end type data_type
    120 
    121 
    122 type override_type
    123    character(len=3)                 :: gridname
    124    character(len=128)               :: fieldname
    125    integer                          :: t_index                 !< index for time interp
    126    type(horiz_interp_type), allocatable :: horz_interp(:) !< index for horizontal spatial interp
    127    integer                          :: dims(4)                 !< dimensions(x,y,z,t) of the field in filename
    128    integer                          :: comp_domain(4)          !< istart,iend,jstart,jend for compute domain
    129    integer                          :: numthreads
    130    real, allocatable                :: lon_in(:)
    131    real, allocatable                :: lat_in(:)
    132    logical, allocatable             :: need_compute(:)
    133    integer                          :: numwindows
    134    integer                          :: window_size(2)
    135    integer                          :: is_src, ie_src, js_src, je_src
    136 end type override_type
    137 
    138  integer, parameter :: max_table=100, max_array=100
    139  real, parameter    :: deg_to_radian=PI/180.
    140  integer            :: table_size !< actual size of data table
    141  logical            :: module_is_initialized = .FALSE.
    142 
    143 type(domain2D),save :: ocn_domain,atm_domain,lnd_domain, ice_domain
    144 type(domainUG),save :: lnd_domainUG
    145 
    146 real, dimension(:,:), target, allocatable :: lon_local_ocn, lat_local_ocn
    147 real, dimension(:,:), target, allocatable :: lon_local_atm, lat_local_atm
    148 real, dimension(:,:), target, allocatable :: lon_local_ice, lat_local_ice
    149 real, dimension(:,:), target, allocatable :: lon_local_lnd, lat_local_lnd
    150 real                                      :: min_glo_lon_ocn, max_glo_lon_ocn
    151 real                                      :: min_glo_lon_atm, max_glo_lon_atm
    152 real                                      :: min_glo_lon_lnd, max_glo_lon_lnd
    153 real                                      :: min_glo_lon_ice, max_glo_lon_ice
    154 integer:: num_fields = 0 !< number of fields in override_array already processed
    155 type(data_type), dimension(max_table)           :: data_table !< user-provided data table
    156 type(data_type)                                 :: default_table
    157 type(override_type), dimension(max_array), save :: override_array !< to store processed fields
    158 type(override_type), save                       :: default_array
    159 logical                                         :: atm_on, ocn_on, lnd_on, ice_on
    160 logical                                         :: lndUG_on
    161 logical                                         :: debug_data_override
    162 logical                                         :: grid_center_bug = .false.
    163 logical                                         :: use_mpp_bug = .false.
    164 logical                                         :: reproduce_null_char_bug = .false. !> Flag indicating
    165 !! to reproduce the mpp_io bug where lat/lon_bnd were
    166 !! not read correctly if null characters are present in
    167 !! the netcdf file
    168 
    169 namelist /data_override_nml/ debug_data_override, grid_center_bug, use_mpp_bug, reproduce_null_char_bug
    170 
    171 interface data_override

Page 4           Source Listing                  COUNT_NE_1
2021-06-01 08:55                                 data_override.F90

    172      module procedure data_override_0d
    173      module procedure data_override_2d
    174      module procedure data_override_3d
    175 end interface
    176 
    177 interface data_override_UG
    178      module procedure data_override_UG_1d
    179      module procedure data_override_UG_2d
    180 end interface
    181 
    182 public :: data_override_init, data_override, data_override_unset_domains
    183 public :: data_override_UG
    184 
    185 contains
    186 function count_ne_1(in_1, in_2, in_3)
    187   logical, intent(in)  :: in_1, in_2, in_3
    188   logical :: count_ne_1
    189 
    190   count_ne_1 = .not.(in_1.NEQV.in_2.NEQV.in_3) .OR. (in_1.AND.in_2.AND.in_3)
    191 end function count_ne_1


ENTRY POINTS

  Name                                        
                                              
 data_override_mod_mp_count_ne_1_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 COUNT_NE_1                 Func   186      L(4)            4           scalar                    190,454,467                       
 IN_1                       Dummy  186      L(4)            4           scalar   ARG,IN           190                               
 IN_2                       Dummy  186      L(4)            4           scalar   ARG,IN           190                               
 IN_3                       Dummy  186      L(4)            4           scalar   ARG,IN           190                               

Page 5           Source Listing                  COUNT_NE_1
2021-06-01 08:55                                 data_override.F90

    192 !===============================================================================================
    193 ! <SUBROUTINE NAME="data_override_init">
    194 !   <DESCRIPTION>
    195 ! Assign default values for default_table, get domain of component models,
    196 ! get global grids of component models.
    197 ! Users should call data_override_init before calling data_override
    198 !   </DESCRIPTION>
    199 !   <TEMPLATE>
    200 ! call data_override_init
    201 !   </TEMPLATE>
    202 
    203 !> @brief Assign default values for default_table, get domain of component models,
    204 !! get global grids of component models.
    205 !! Users should call data_override_init before calling data_override
    206 !!
    207 !! This subroutine should be called in coupler_init after
    208 !! (ocean/atmos/land/ice)_model_init have been called.
    209 !!
    210 !! data_override_init can be called more than once, in one call the user can pass
    211 !! up to 4 domains of component models, at least one domain must be present in
    212 !! any call
    213 !!
    214 !! Data_table is initialized here with default values. Users should provide "real" values
    215 !! that will override the default values. Real values can be given using data_table, each
    216 !! line of data_table contains one data_entry. Items of data_entry are comma separated.
    217 subroutine data_override_init(Atm_domain_in, Ocean_domain_in, Ice_domain_in, Land_domain_in, Land_domainUG_in)
    218   type (domain2d), intent(in), optional :: Atm_domain_in
    219   type (domain2d), intent(in), optional :: Ocean_domain_in, Ice_domain_in
    220   type (domain2d), intent(in), optional :: Land_domain_in
    221   type(domainUG) , intent(in), optional :: Land_domainUG_in
    222 
    223 ! <NOTE>
    224 ! This subroutine should be called in coupler_init after
    225 ! (ocean/atmos/land/ice)_model_init have been called.
    226 !
    227 ! data_override_init can be called more than once, in one call the user can pass
    228 ! up to 4 domains of component models, at least one domain must be present in
    229 ! any call
    230 !
    231 ! Data_table is initialized here with default values. Users should provide "real" values
    232 ! that will override the default values. Real values can be given using data_table, each
    233 ! line of data_table contains one data_entry. Items of data_entry are comma separated.
    234 !
    235 ! </NOTE>
    236   character(len=128)    :: grid_file = 'INPUT/grid_spec.nc'
    237   integer               :: is,ie,js,je,use_get_grid_version
    238   integer               :: i, iunit, ntable, ntable_lima, ntable_new, unit,io_status, ierr
    239   character(len=256)    :: record
    240   logical               :: file_open
    241   logical               :: ongrid
    242   character(len=128)    :: region, region_type
    243   type(FmsNetcdfFile_t) :: fileobj
    244 
    245   type(data_type)  :: data_entry
    246 
    247   debug_data_override = .false.
    248 

Page 6           Source Listing                  DATA_OVERRIDE_INIT
2021-06-01 08:55                                 data_override.F90

    249   read (input_nml_file, data_override_nml, iostat=io_status)
    250   ierr = check_nml_error(io_status, 'data_override_nml')
    251   unit = stdlog()
    252   write(unit, data_override_nml)
    253 
    254 !  if(module_is_initialized) return
    255 
    256   atm_on = PRESENT(Atm_domain_in)
    257   ocn_on = PRESENT(Ocean_domain_in)
    258   lnd_on = PRESENT(Land_domain_in)
    259   ice_on = PRESENT(Ice_domain_in)
    260   lndUG_on = PRESENT(Land_domainUG_in)
    261   if(.not. module_is_initialized) then
    262     atm_domain = NULL_DOMAIN2D
    263     ocn_domain = NULL_DOMAIN2D
    264     lnd_domain = NULL_DOMAIN2D
    265     ice_domain = NULL_DOMAIN2D
    266     lnd_domainUG = NULL_DOMAINUG
    267   end if
    268   if (atm_on) atm_domain = Atm_domain_in
    269   if (ocn_on) ocn_domain = Ocean_domain_in
    270   if (lnd_on) lnd_domain = Land_domain_in
    271   if (ice_on) ice_domain = Ice_domain_in
    272   if (lndUG_on) lnd_domainUG = Land_domainUG_in
    273 
    274   if(.not. module_is_initialized) then
    275     call horiz_interp_init
    276     call write_version_number("DATA_OVERRIDE_MOD", version)
    277 
    278 !  Initialize user-provided data table
    279     default_table%gridname = 'none'
    280     default_table%fieldname_code = 'none'
    281     default_table%fieldname_file = 'none'
    282     default_table%file_name = 'none'
    283     default_table%factor = 1.
    284     default_table%interpol_method = 'bilinear'
    285     do i = 1,max_table
    286        data_table(i) = default_table
    287     enddo
    288 
    289 !  Read coupler_table
    290     if(use_mpp_bug) then
    291      call mpp_error(WARNING, 'data_override_mod:' &
    292                      //'MPP_IO is no longer supported.  Please remove "use_mpp_bug" from namelist')
    293       call mpp_open(iunit, 'data_table', action=MPP_RDONLY)
    294     else
    295       iunit = get_unit()
    296       open(iunit, file='data_table', action='READ', iostat=io_status)
    297       if(io_status/=0) call mpp_error(FATAL, 'data_override_mod: Error in opening file data_table')
    298     end if
    299 
    300     ntable = 0
    301     ntable_lima = 0
    302     ntable_new = 0
    303 
    304     do while (ntable <= max_table)
    305        read(iunit,'(a)',end=100) record

Page 7           Source Listing                  DATA_OVERRIDE_INIT
2021-06-01 08:55                                 data_override.F90

    306        if (record(1:1) == '#') cycle
    307        if (record(1:10) == '          ') cycle
    308        ntable=ntable+1
    309        if (index(lowercase(record), "inside_region") .ne. 0 .or. index(lowercase(record), "outside_region") .ne. 0) then
    310           if(index(lowercase(record), ".false.") .ne. 0 .or. index(lowercase(record), ".true.") .ne. 0 ) then
    311              ntable_lima = ntable_lima + 1
    312              read(record,*,err=99) data_entry%gridname, data_entry%fieldname_code, data_entry%fieldname_file, &
    313                                    data_entry%file_name, ongrid, data_entry%factor, region, region_type
    314              if(ongrid) then
    315                 data_entry%interpol_method = 'none'
    316              else
    317                 data_entry%interpol_method = 'bilinear'
    318              endif
    319           else
    320              ntable_new=ntable_new+1
    321              read(record,*,err=99) data_entry%gridname, data_entry%fieldname_code, data_entry%fieldname_file, &
    322                                    data_entry%file_name, data_entry%interpol_method, data_entry%factor, region, region_type
    323              if (data_entry%interpol_method == 'default') then
    324                 data_entry%interpol_method = default_table%interpol_method
    325              endif
    326              if (.not.(data_entry%interpol_method == 'default'  .or. &
    327                   data_entry%interpol_method == 'bicubic'  .or. &
    328                   data_entry%interpol_method == 'bilinear' .or. &
    329                   data_entry%interpol_method == 'none')) then
    330                 unit = stdout()
    331                 write(unit,*)" gridname is ", trim(data_entry%gridname)
    332                 write(unit,*)" fieldname_code is ", trim(data_entry%fieldname_code)
    333                 write(unit,*)" fieldname_file is ", trim(data_entry%fieldname_file)
    334                 write(unit,*)" file_name is ", trim(data_entry%file_name)
    335                 write(unit,*)" factor is ", data_entry%factor
    336                 write(unit,*)" interpol_method is ", trim(data_entry%interpol_method)
    337                 call mpp_error(FATAL, 'data_override_mod: invalid last entry in data_override_table, ' &
    338                      //'its value should be "default", "bicubic", "bilinear" or "none" ')
    339              endif
    340           endif
    341           if( trim(region_type) == "inside_region" ) then
    342              data_entry%region_type = INSIDE_REGION
    343           else if( trim(region_type) == "outside_region" ) then
    344              data_entry%region_type = OUTSIDE_REGION
    345           else
    346              call mpp_error(FATAL, 'data_override_mod: region type should be inside_region or outside_region')
    347           endif
    348           if (data_entry%file_name == "") call mpp_error(FATAL, &
    349               "data_override: filename not given in data_table when region_type is not NO_REGION")
    350           if(data_entry%fieldname_file == "") call mpp_error(FATAL, &
    351              "data_override: fieldname_file must be specified in data_table when region_type is not NO_REGION")
    352           if( trim(data_entry%interpol_method) == 'none') call mpp_error(FATAL, &
    353              "data_override(data_override_init): ongrid must be false when region_type is not NO_REGION")
    354           read(region,*) data_entry%lon_start, data_entry%lon_end, data_entry%lat_start, data_entry%lat_end
    355 !--- make sure data_entry%lon_end > data_entry%lon_start and data_entry%lat_end > data_entry%lat_start
    356           if(data_entry%lon_end .LE. data_entry%lon_start) call mpp_error(FATAL, &
    357              "data_override: lon_end should be greater than lon_start")
    358           if(data_entry%lat_end .LE. data_entry%lat_start) call mpp_error(FATAL, &
    359              "data_override: lat_end should be greater than lat_start")
    360        else if (index(lowercase(record), ".false.") .ne. 0 .or. index(lowercase(record), ".true.") .ne. 0 ) then ! old forma
    360 t
    361           ntable_lima = ntable_lima + 1

Page 8           Source Listing                  DATA_OVERRIDE_INIT
2021-06-01 08:55                                 data_override.F90

    362           read(record,*,err=99) data_entry%gridname, data_entry%fieldname_code, data_entry%fieldname_file, &
    363                                    data_entry%file_name, ongrid, data_entry%factor
    364           if(ongrid) then
    365              data_entry%interpol_method = 'none'
    366           else
    367              data_entry%interpol_method = 'bilinear'
    368           endif
    369           data_entry%lon_start = 0.0
    370           data_entry%lon_end   = -1.0
    371           data_entry%lat_start = 0.0
    372           data_entry%lat_end   = -1.0
    373           data_entry%region_type = NO_REGION
    374        else                                      ! new format
    375           ntable_new=ntable_new+1
    376           read(record,*,err=99) data_entry%gridname, data_entry%fieldname_code, data_entry%fieldname_file, &
    377                                 data_entry%file_name, data_entry%interpol_method, data_entry%factor
    378           if (data_entry%interpol_method == 'default') then
    379             data_entry%interpol_method = default_table%interpol_method
    380           endif
    381           if (.not.(data_entry%interpol_method == 'default'  .or. &
    382                     data_entry%interpol_method == 'bicubic'  .or. &
    383                     data_entry%interpol_method == 'bilinear' .or. &
    384                     data_entry%interpol_method == 'none')) then
    385              unit = stdout()
    386              write(unit,*)" gridname is ", trim(data_entry%gridname)
    387              write(unit,*)" fieldname_code is ", trim(data_entry%fieldname_code)
    388              write(unit,*)" fieldname_file is ", trim(data_entry%fieldname_file)
    389              write(unit,*)" file_name is ", trim(data_entry%file_name)
    390              write(unit,*)" factor is ", data_entry%factor
    391              write(unit,*)" interpol_method is ", trim(data_entry%interpol_method)
    392              call mpp_error(FATAL, 'data_override_mod: invalid last entry in data_override_table, ' &
    393                                //'its value should be "default", "bicubic", "bilinear" or "none" ')
    394           endif
    395           data_entry%lon_start = 0.0
    396           data_entry%lon_end   = -1.0
    397           data_entry%lat_start = 0.0
    398           data_entry%lat_end   = -1.0
    399           data_entry%region_type = NO_REGION
    400        endif
    401        data_table(ntable) = data_entry
    402     enddo
    403     call mpp_error(FATAL,'too many enries in data_table')
    404 99  call mpp_error(FATAL,'error in data_table format')
    405 100 continue
    406     table_size = ntable
    407     if(ntable_new*ntable_lima /= 0) call mpp_error(FATAL, &
    408        'data_override_mod: New and old formats together in same data_table not supported')
    409     if(use_mpp_bug) then
    410       call mpp_close(iunit)
    411     else
    412       close(iunit, iostat=io_status)
    413       if(io_status/=0) call mpp_error(FATAL, 'data_override_mod: Error in closing file data_table')
    414     end if
    415 
    416 !  Initialize override array
    417     default_array%gridname = 'NONE'
    418     default_array%fieldname = 'NONE'

Page 9           Source Listing                  DATA_OVERRIDE_INIT
2021-06-01 08:55                                 data_override.F90

    419     default_array%t_index = -1
    420     default_array%dims = -1
    421     default_array%comp_domain = -1
    422     do i = 1, max_array
    423        override_array(i) = default_array
    424     enddo
    425     if(use_mpp_bug) then
    426       call time_interp_external_init_classic
    427     else
    428       call time_interp_external_init_fms2io
    429     end if
    430  end if
    431 
    432  module_is_initialized = .TRUE.
    433 
    434  if ( .NOT. (atm_on .or. ocn_on .or. lnd_on .or. ice_on .or. lndUG_on)) return
    435  call fms_io_init
    436  if (.not. use_mpp_bug) call fms2_io_init
    437 
    438 ! Test if grid_file is already opened
    439  inquire (file=trim(grid_file), opened=file_open)
    440  if(file_open) call mpp_error(FATAL, trim(grid_file)//' already opened')
    441 
    442  if(.not. use_mpp_bug) then
    443    if(.not. open_file(fileobj, grid_file, 'read' )) then
    444      call mpp_error(FATAL, 'data_override_mod: Error in opening file '//trim(grid_file))
    445    endif
    446  endif
    447 
    448  if(use_mpp_bug) then
    449    if(field_exist(grid_file, "x_T" ) .OR. field_exist(grid_file, "geolon_t" ) ) then
    450      use_get_grid_version = 1
    451    else if(field_exist(grid_file, "ocn_mosaic_file" ) .OR. field_exist(grid_file, "gridfiles" ) ) then
    452      use_get_grid_version = 2
    453      if(field_exist(grid_file, "gridfiles" ) ) then
    454        if(count_ne_1((ocn_on .OR. ice_on), lnd_on, atm_on)) call mpp_error(FATAL, 'data_override_mod: the grid file ' // &
    455             'is a solo mosaic, one and only one of atm_on, lnd_on or ice_on/ocn_on should be true')
    456      end if
    457    else
    458      call mpp_error(FATAL, 'data_override_mod: none of x_T, geolon_t, ocn_mosaic_file or gridfiles exist in '//trim(grid_fil
    458 e))
    459    endif
    460  else
    461    if(variable_exists(fileobj, "x_T" ) .OR. variable_exists(fileobj, "geolon_t" ) ) then
    462      use_get_grid_version = 1
    463      call close_file(fileobj)
    464    else if(variable_exists(fileobj, "ocn_mosaic_file" ) .OR. variable_exists(fileobj, "gridfiles" ) ) then
    465      use_get_grid_version = 2
    466      if(variable_exists(fileobj, "gridfiles" ) ) then
    467        if(count_ne_1((ocn_on .OR. ice_on), lnd_on, atm_on)) call mpp_error(FATAL, 'data_override_mod: the grid file ' // &
    468             'is a solo mosaic, one and only one of atm_on, lnd_on or ice_on/ocn_on should be true')
    469      end if
    470    else
    471      call mpp_error(FATAL, 'data_override_mod: none of x_T, geolon_t, ocn_mosaic_file or gridfiles exist in '//trim(grid_fil
    471 e))
    472    endif
    473  endif

Page 10          Source Listing                  DATA_OVERRIDE_INIT
2021-06-01 08:55                                 data_override.F90

    474 
    475  if(use_get_grid_version .EQ. 1) then
    476     if (atm_on .and. .not. allocated(lon_local_atm) ) then
    477        call mpp_get_compute_domain( atm_domain,is,ie,js,je)
    478        allocate(lon_local_atm(is:ie,js:je), lat_local_atm(is:ie,js:je))
    479        if(use_mpp_bug) then
    480          call get_grid_version_classic_1(grid_file, 'atm', atm_domain, is, ie, js, je, lon_local_atm, lat_local_atm, &
    481             min_glo_lon_atm, max_glo_lon_atm, grid_center_bug )
    482        else
    483          call get_grid_version_1(grid_file, 'atm', atm_domain, is, ie, js, je, lon_local_atm, lat_local_atm, &
    484             min_glo_lon_atm, max_glo_lon_atm, grid_center_bug )
    485        endif
    486     endif
    487     if (ocn_on .and. .not. allocated(lon_local_ocn) ) then
    488        call mpp_get_compute_domain( ocn_domain,is,ie,js,je)
    489        allocate(lon_local_ocn(is:ie,js:je), lat_local_ocn(is:ie,js:je))
    490        if(use_mpp_bug) then
    491          call get_grid_version_classic_1(grid_file, 'ocn', ocn_domain, is, ie, js, je, lon_local_ocn, lat_local_ocn, &
    492             min_glo_lon_ocn, max_glo_lon_ocn, grid_center_bug )
    493        else
    494          call get_grid_version_1(grid_file, 'ocn', ocn_domain, is, ie, js, je, lon_local_ocn, lat_local_ocn, &
    495             min_glo_lon_ocn, max_glo_lon_ocn, grid_center_bug )
    496        endif
    497     endif
    498 
    499     if (lnd_on .and. .not. allocated(lon_local_lnd) ) then
    500        call mpp_get_compute_domain( lnd_domain,is,ie,js,je)
    501        allocate(lon_local_lnd(is:ie,js:je), lat_local_lnd(is:ie,js:je))
    502        if(use_mpp_bug) then
    503          call get_grid_version_classic_1(grid_file, 'lnd', lnd_domain, is, ie, js, je, lon_local_lnd, lat_local_lnd, &
    504             min_glo_lon_lnd, max_glo_lon_lnd, grid_center_bug )
    505        else
    506          call get_grid_version_1(grid_file, 'lnd', lnd_domain, is, ie, js, je, lon_local_lnd, lat_local_lnd, &
    507             min_glo_lon_lnd, max_glo_lon_lnd, grid_center_bug )
    508        endif
    509     endif
    510 
    511     if (ice_on .and. .not. allocated(lon_local_ice) ) then
    512        call mpp_get_compute_domain( ice_domain,is,ie,js,je)
    513        allocate(lon_local_ice(is:ie,js:je), lat_local_ice(is:ie,js:je))
    514        if(use_mpp_bug) then
    515          call get_grid_version_classic_1(grid_file, 'ice', ice_domain, is, ie, js, je, lon_local_ice, lat_local_ice, &
    516             min_glo_lon_ice, max_glo_lon_ice, grid_center_bug )
    517        else
    518          call get_grid_version_1(grid_file, 'ice', ice_domain, is, ie, js, je, lon_local_ice, lat_local_ice, &
    519             min_glo_lon_ice, max_glo_lon_ice, grid_center_bug )
    520        endif
    521     endif
    522  else
    523    if (atm_on .and. .not. allocated(lon_local_atm) ) then
    524        call mpp_get_compute_domain(atm_domain,is,ie,js,je)
    525        allocate(lon_local_atm(is:ie,js:je), lat_local_atm(is:ie,js:je))
    526        if(use_mpp_bug) then
    527          call get_grid_version_classic_2(grid_file, 'atm', atm_domain, is, ie, js, je, lon_local_atm, lat_local_atm, &
    528                                  min_glo_lon_atm, max_glo_lon_atm )
    529        else
    530          call get_grid_version_2(fileobj, 'atm', atm_domain, is, ie, js, je, lon_local_atm, lat_local_atm, &

Page 11          Source Listing                  DATA_OVERRIDE_INIT
2021-06-01 08:55                                 data_override.F90

    531                                  min_glo_lon_atm, max_glo_lon_atm )
    532        end if
    533    endif
    534 
    535    if (ocn_on .and. .not. allocated(lon_local_ocn) ) then
    536        call mpp_get_compute_domain( ocn_domain,is,ie,js,je)
    537        allocate(lon_local_ocn(is:ie,js:je), lat_local_ocn(is:ie,js:je))
    538        if(use_mpp_bug) then
    539          call get_grid_version_classic_2(grid_file, 'ocn', ocn_domain, is, ie, js, je, lon_local_ocn, lat_local_ocn, &
    540                                  min_glo_lon_ocn, max_glo_lon_ocn )
    541        else
    542          call get_grid_version_2(fileobj, 'ocn', ocn_domain, is, ie, js, je, lon_local_ocn, lat_local_ocn, &
    543                                  min_glo_lon_ocn, max_glo_lon_ocn )
    544        end if
    545    endif
    546 
    547    if (lnd_on .and. .not. allocated(lon_local_lnd) ) then
    548        call mpp_get_compute_domain( lnd_domain,is,ie,js,je)
    549        allocate(lon_local_lnd(is:ie,js:je), lat_local_lnd(is:ie,js:je))
    550        if(use_mpp_bug) then
    551          call get_grid_version_classic_2(grid_file, 'lnd', lnd_domain, is, ie, js, je, lon_local_lnd, lat_local_lnd, &
    552                                  min_glo_lon_lnd, max_glo_lon_lnd )
    553        else
    554          call get_grid_version_2(fileobj, 'lnd', lnd_domain, is, ie, js, je, lon_local_lnd, lat_local_lnd, &
    555                                  min_glo_lon_lnd, max_glo_lon_lnd )
    556        end if
    557    endif
    558 
    559    if (ice_on .and. .not. allocated(lon_local_ice) ) then
    560        call mpp_get_compute_domain( ice_domain,is,ie,js,je)
    561        allocate(lon_local_ice(is:ie,js:je), lat_local_ice(is:ie,js:je))
    562        if(use_mpp_bug) then
    563          call get_grid_version_classic_2(grid_file, 'ocn', ice_domain, is, ie, js, je, lon_local_ice, lat_local_ice, &
    564                                  min_glo_lon_ice, max_glo_lon_ice )
    565        else
    566          call get_grid_version_2(fileobj, 'ocn', ice_domain, is, ie, js, je, lon_local_ice, lat_local_ice, &
    567                                  min_glo_lon_ice, max_glo_lon_ice )
    568        end if
    569    endif
    570  end if
    571  if(.not. use_mpp_bug .AND. use_get_grid_version .EQ. 2) then
    572    call close_file(fileobj)
    573  end if
    574 
    575 end subroutine data_override_init

Page 12          Source Listing                  DATA_OVERRIDE_INIT
2021-06-01 08:55 Entry Points                    data_override.F90



ENTRY POINTS

  Name                                                
                                                      
 data_override_mod_mp_data_override_init_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 100                        Label  405                                                            305                               
 99                         Label  404                                                            312,321,362,376                   
 ALLOCATED                  Func   476                                  scalar                    476,487,499,511,523,535,547,559   
 ATM_DOMAIN                 Local  262      DOMAIN2D        752         scalar   SAVE             262,268,477,480,483,524,527,530,60
                                                                                                  9,657                             
 ATM_DOMAIN_IN              Dummy  217      DOMAIN2D        752         scalar   ARG,IN           256,268                           
 ATM_ON                     Local  256      L(4)            4           scalar                    256,268,434,454,467,476,523,607,61
                                                                                                  0                                 
 CHECK_NML_ERROR            Func   250      I(4)            4           scalar   PRIV             65,250                            
 CLOSE_FILE                 Local  463                                  scalar   PRIV             73,463,572                        
 DATA_ENTRY                 Local  245      DATA_TYPE       952         scalar                    312,313,315,317,321,322,323,324,32
                                                                                                  6,327,328,329,331,332,333,334,335,
                                                                                                  336,342,344,348,350,352,354,356,35
                                                                                                  8,362,363,365,367,369,370,371,372,
                                                                                                  373,376,377,378,379,381,382,383,38
                                                                                                  4,386,387,388,389,390,391,395,396,
                                                                                                  397,398,399,401                   
 DATA_OVERRIDE_INIT         Subr   217                                                                                              
 DATA_OVERRIDE_NML          Local  249                                  scalar                    249,252                           
 DATA_TABLE                 Local  286      RECORD          952   1     100                       286,401,714,715,817,818,829,830,83
                                                                                                  7,841,902,1007,1026,1037,1039,1041
                                                                                                  ,1043,1045,1046,1047,1048,1055,105
                                                                                                  7,1131,1206,1245,1336,1337,1348,13
                                                                                                  49,1356,1421,1422,1457,1458       
 DATA_TYPE                  Type   245                      952         scalar                    119,155,156,245                   
 DEBUG_DATA_OVERRIDE        Local  247      L(4)            4           scalar                    169,247,823,1342                  
 DEFAULT_ARRAY              Local  417      OVERRIDE_TYPE   496         scalar   SAVE             417,418,419,420,421,423           
 DEFAULT_TABLE              Local  279      DATA_TYPE       952         scalar                    279,280,281,282,283,284,286,324,37
                                                                                                  9                                 
 DOMAIN2D                   Type   218                                  scalar                    69,143,218,219,220,649,676,785    
 DOMAINUG                   Type   221                                  scalar                    71,144,221,674,1412,1448          
 FATAL                      Param  297      I(4)            4           scalar   PRIV             47,297,337,346,348,350,352,356,358
                                                                                                  ,392,403,404,407,413,440,444,454,4
                                                                                                  58,467,471,603,607,615,623,631,663
                                                                                                  ,665,683,808,838,887,895,903,928,9
                                                                                                  43,965,986,1038,1040,1042,1044,107
                                                                                                  7,1086,1128,1151,1327,1357,1383   
 FIELD_EXIST                Func   449      L(4)            4           scalar   PRIV             65,449,451,453                    
 FILEOBJ                    Local  243      FMSNETCDFFILE_T 872         scalar                    443,461,463,464,466,530,542,554,56
                                                                                                  6,572                             
 FILE_OPEN                  Local  240      L(4)            4           scalar                    439,440                           
 FMS2_IO_INIT               Subr   436                                           PRIV             74,436                            
 FMSNETCDFFILE_T            Type   243                                  scalar                    73,243,798                        
 FMS_IO_INIT                Subr   435                                           PRIV             68,435                            

Page 13          Source Listing                  DATA_OVERRIDE_INIT
2021-06-01 08:55 Symbol Table                    data_override.F90

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 GET_GRID_VERSION_1         Subr   483                                           PRIV             77,483,494,506,518                
 GET_GRID_VERSION_2         Subr   530                                           PRIV             77,530,542,554,566                
 GET_GRID_VERSION_CLASSIC_1 Subr   480                                           PRIV             76,480,491,503,515                
 GET_GRID_VERSION_CLASSIC_2 Subr   527                                           PRIV             76,527,539,551,563                
 GET_UNIT                   Func   295      I(4)            4           scalar   PRIV             48,295                            
 GRID_CENTER_BUG            Local  481      L(4)            4           scalar                    162,169,481,484,492,495,504,507,51
                                                                                                  6,519                             
 GRID_FILE                  Local  236      CHAR            128         scalar                    236,439,440,443,444,449,451,453,45
                                                                                                  8,471,480,483,491,494,503,506,515,
                                                                                                  518,527,539,551,563               
 HORIZ_INTERP_INIT          Subr   275                                           PRIV             49,275                            
 I                          Local  238      I(4)            4           scalar                    285,286,422,423                   
 ICE_DOMAIN                 Local  265      DOMAIN2D        752         scalar   SAVE             265,271,512,515,518,560,563,566,63
                                                                                                  3,661                             
 ICE_DOMAIN_IN              Dummy  217      DOMAIN2D        752         scalar   ARG,IN           259,271                           
 ICE_ON                     Local  259      L(4)            4           scalar                    259,271,434,454,467,511,559,631,63
                                                                                                  4                                 
 IE                         Local  237      I(4)            4           scalar                    477,478,480,483,488,489,491,494,50
                                                                                                  0,501,503,506,512,513,515,518,524,
                                                                                                  525,527,530,536,537,539,542,548,54
                                                                                                  9,551,554,560,561,563,566         
 IERR                       Local  238      I(4)            4           scalar                    250                               
 INDEX                      Func   309                                  scalar                    309,310,360                       
 INPUT_NML_FILE             Local  249      CHAR                  1     1        ALC,TGT,PRIV     48,249                            
 INSIDE_REGION              Param  342      I(4)            4           scalar   PRIV             63,342                            
 IO_STATUS                  Local  238      I(4)            4           scalar                    249,250,296,297,412,413           
 IS                         Local  237      I(4)            4           scalar                    477,478,480,483,488,489,491,494,50
                                                                                                  0,501,503,506,512,513,515,518,524,
                                                                                                  525,527,530,536,537,539,542,548,54
                                                                                                  9,551,554,560,561,563,566         
 IUNIT                      Local  238      I(4)            4           scalar                    293,295,296,305,410,412           
 JE                         Local  237      I(4)            4           scalar                    477,478,480,483,488,489,491,494,50
                                                                                                  0,501,503,506,512,513,515,518,524,
                                                                                                  525,527,530,536,537,539,542,548,54
                                                                                                  9,551,554,560,561,563,566         
 JS                         Local  237      I(4)            4           scalar                    477,478,480,483,488,489,491,494,50
                                                                                                  0,501,503,506,512,513,515,518,524,
                                                                                                  525,527,530,536,537,539,542,548,54
                                                                                                  9,551,554,560,561,563,566         
 LAND_DOMAINUG_IN           Dummy  217      DOMAINUG        544         scalar   ARG,IN           260,272                           
 LAND_DOMAIN_IN             Dummy  217      DOMAIN2D        752         scalar   ARG,IN           258,270                           
 LAT_LOCAL_ATM              Local  478      R(8)            8     2     1        ALC,TGT          478,480,483,525,527,530,612,982,11
                                                                                                  24                                
 LAT_LOCAL_ICE              Local  513      R(8)            8     2     1        ALC,TGT          513,515,518,561,563,566,636,980,11
                                                                                                  22                                
 LAT_LOCAL_LND              Local  501      R(8)            8     2     1        ALC,TGT          501,503,506,549,551,554,628,984,11
                                                                                                  26                                
 LAT_LOCAL_OCN              Local  489      R(8)            8     2     1        ALC,TGT          489,491,494,537,539,542,620,978,11
                                                                                                  20                                
 LNDUG_ON                   Local  260      L(4)            4           scalar                    260,272,434                       
 LND_DOMAIN                 Local  264      DOMAIN2D        752         scalar   SAVE             264,270,500,503,506,548,551,554,62
                                                                                                  5,659                             
 LND_DOMAINUG               Local  266      DOMAINUG        544         scalar   SAVE             266,272,681                       
 LND_ON                     Local  258      L(4)            4           scalar                    258,270,434,454,467,499,547,623,62
                                                                                                  6                                 

Page 14          Source Listing                  DATA_OVERRIDE_INIT
2021-06-01 08:55 Symbol Table                    data_override.F90

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 LON_LOCAL_ATM              Local  476      R(8)            8     2     1        ALC,TGT          476,478,480,483,523,525,527,530,61
                                                                                                  1,982,1124                        
 LON_LOCAL_ICE              Local  511      R(8)            8     2     1        ALC,TGT          511,513,515,518,559,561,563,566,63
                                                                                                  5,980,1122                        
 LON_LOCAL_LND              Local  499      R(8)            8     2     1        ALC,TGT          499,501,503,506,547,549,551,554,62
                                                                                                  7,984,1126                        
 LON_LOCAL_OCN              Local  487      R(8)            8     2     1        ALC,TGT          487,489,491,494,535,537,539,542,61
                                                                                                  9,978,1120                        
 LOWERCASE                  Func   309      CHAR                        scalar   TGT,PRIV         65,309,310,360                    
 MAX_ARRAY                  Param  422      I(4)            4           scalar                    157,422                           
 MAX_GLO_LON_ATM            Local  481      R(8)            8           scalar                    481,484,528,531                   
 MAX_GLO_LON_ICE            Local  516      R(8)            8           scalar                    516,519,564,567                   
 MAX_GLO_LON_LND            Local  504      R(8)            8           scalar                    504,507,552,555                   
 MAX_GLO_LON_OCN            Local  492      R(8)            8           scalar                    492,495,540,543                   
 MAX_TABLE                  Param  285      I(4)            4           scalar                    155,285,304                       
 MIN_GLO_LON_ATM            Local  481      R(8)            8           scalar                    481,484,528,531                   
 MIN_GLO_LON_ICE            Local  516      R(8)            8           scalar                    516,519,564,567                   
 MIN_GLO_LON_LND            Local  504      R(8)            8           scalar                    504,507,552,555                   
 MIN_GLO_LON_OCN            Local  492      R(8)            8           scalar                    492,495,540,543                   
 MODULE_IS_INITIALIZED      Local  261      L(4)            4           scalar                    141,261,274,432,603,807,1326      
 MPP_CLOSE                  Subr   410                                           PRIV             46,410                            
 MPP_ERROR                  Local  291                                  scalar   PRIV             47,291,297,337,346,348,350,352,356
                                                                                                  ,358,392,403,404,407,413,440,444,4
                                                                                                  54,458,467,471,603,607,615,623,631
                                                                                                  ,663,665,683,808,824,838,887,895,9
                                                                                                  03,928,943,965,986,1038,1040,1042,
                                                                                                  1044,1077,1086,1128,1151,1327,1343
                                                                                                  ,1357,1383                        
 MPP_ERROR_BASIC            Subr   291                                           PRIV             291,297,337,346,348,350,352,356,35
                                                                                                  8,392,403,404,407,413,440,444,454,
                                                                                                  458,467,471,603,607,615,623,631,66
                                                                                                  3,665,683,808,824,838,887,895,903,
                                                                                                  928,943,965,986,1038,1040,1042,104
                                                                                                  4,1077,1086,1128,1151,1327,1343,13
                                                                                                  57,1383                           
 MPP_GET_COMPUTE_DOMAIN     Local  477                                  scalar   PRIV             69,477,488,500,512,524,536,548,560
                                                                                                  ,667,688                          
 MPP_GET_COMPUTE_DOMAIN2D   Subr   477                                           PRIV             477,488,500,512,524,536,548,560,66
                                                                                                  7,688                             
 MPP_OPEN                   Subr   293                                           PRIV             46,293                            
 MPP_RDONLY                 Param  293      I(4)            4           scalar   PRIV             46,293                            
 NETCDF_FILE_CLOSE_WRAP     Subr   463                                           PRIV             463,572                           
 NETCDF_FILE_OPEN_WRAP      Func   443      L(4)            4           scalar   PRIV             443                               
 NO_REGION                  Param  373      I(4)            4           scalar   PRIV             63,373,399,902,1026,1206,1245     
 NTABLE                     Local  238      I(4)            4           scalar                    300,304,308,401,406               
 NTABLE_LIMA                Local  238      I(4)            4           scalar                    301,311,361,407                   
 NTABLE_NEW                 Local  238      I(4)            4           scalar                    302,320,375,407                   
 NULL_DOMAIN2D              Local  262      DOMAIN2D        752         scalar   PRIV,SAVE        69,262,263,264,265,609,617,625,633
                                                                                                  ,652,665                          
 NULL_DOMAINUG              Local  266      DOMAINUG        544         scalar   PRIV,SAVE        71,266,678                        
 OCEAN_DOMAIN_IN            Dummy  217      DOMAIN2D        752         scalar   ARG,IN           257,269                           
 OCN_DOMAIN                 Local  263      DOMAIN2D        752         scalar   SAVE             263,269,488,491,494,536,539,542,61
                                                                                                  7,655                             
 OCN_ON                     Local  257      L(4)            4           scalar                    257,269,434,454,467,487,535,615,61
                                                                                                  8                                 

Page 15          Source Listing                  DATA_OVERRIDE_INIT
2021-06-01 08:55 Symbol Table                    data_override.F90

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 ONGRID                     Local  241      L(4)            4           scalar                    313,314,363,364                   
 OPEN_FILE                  Local  443                                  scalar   PRIV             73,443                            
 OUTSIDE_REGION             Param  344      I(4)            4           scalar   PRIV             63,344                            
 OVERRIDE_ARRAY             Local  423      RECORD          496   1     100      SAVE             423,848,849,866,867,868,870,872,88
                                                                                                  9,890,892,893,894,897,898,927,929,
                                                                                                  942,944,949,950,951,956,957,960,96
                                                                                                  2,969,970,996,1001,1015,1016,1017,
                                                                                                  1018,1064,1065,1070,1071,1072,1073
                                                                                                  ,1074,1080,1084,1095,1112,1133,113
                                                                                                  4,1135,1138,1139,1140,1143,1209,12
                                                                                                  13,1225,1230,1248,1252,1261,1266,1
                                                                                                  365,1366,1376,1377,1384,1387      
 PRESENT                    Func   256                                  scalar                    256,257,258,259,260               
 RECORD                     Local  239      CHAR            256         scalar                    305,306,307,309,310,312,321,360,36
                                                                                                  2,376                             
 REGION                     Local  242      CHAR            128         scalar                    313,322,354                       
 REGION_TYPE                Local  242      CHAR            128         scalar                    313,322,341,343                   
 STDLOG                     Func   251      I(4)            4           scalar   PRIV             47,251                            
 STDOUT                     Func   330      I(4)            4           scalar   PRIV             47,330,385                        
 TABLE_SIZE                 Local  406      I(4)            4           scalar                    406,713,816,1335,1420,1456        
 TIME_INTERP_EXTERNAL_INIT_                                                                                                         
 CLASSIC                    Subr   426                                           PRIV             426                               
 TIME_INTERP_EXTERNAL_INIT_                                                                                                         
 FMS2IO                     Subr   428                                           PRIV             428                               
 TRIM                       Func   331                                  scalar                    331,332,333,334,336,341,343,352,38
                                                                                                  6,387,388,389,391,439,440,444,458,
                                                                                                  471                               
 UNIT                       Local  238      I(4)            4           scalar                    251,252,330,331,332,333,334,335,33
                                                                                                  6,385,386,387,388,389,390,391     
 USE_GET_GRID_VERSION       Local  237      I(4)            4           scalar                    450,452,462,465,475,571           
 USE_MPP_BUG                Local  290      L(4)            4           scalar                    163,169,290,409,425,436,442,448,47
                                                                                                  9,490,502,514,526,538,550,562,571,
                                                                                                  909,918,931,952,1019,1028,1054,106
                                                                                                  6,1154,1168,1187,1207,1223,1246,12
                                                                                                  59,1378,1391                      
 VARIABLE_EXISTS            Func   461      L(4)            4           scalar   PRIV             74,461,464,466                    
 VERSION                    Param  276      CHAR            7           scalar                    276                               
 WARNING                    Param  291      I(4)            4           scalar   PRIV             47,291,824,1343                   
 WRITE_VERSION_NUMBER       Subr   276                                           PRIV             65,276                            


TYPE COMPONENTS/COMMON VARIABLES

 Name                       Type            Bytes Offset   Dimen Elements Attributes       References                         
                                                                                                                              
 DATA_TYPE.FACTOR           R(8)            8     904            scalar                    283,313,322,335,363,377,390,830,13 
                                                                                           49                                 
 DATA_TYPE.FIELDNAME_CODE   CHAR            128   3              scalar                    280,312,321,332,362,376,387,715,81 
                                                                                           8,1337,1422,1458                   
 DATA_TYPE.FIELDNAME_FILE   CHAR            128   131            scalar                    281,312,321,333,350,362,376,388,82 
                                                                                           9,1348                             
 DATA_TYPE.FILE_NAME        CHAR            512   259            scalar                    282,313,322,334,348,363,377,389,83 
                                                                                           7,1356                             
 DATA_TYPE.GRIDNAME         CHAR            3     0              scalar                    279,312,321,331,362,376,386,714,81 
                                                                                           7,1336,1421,1457                   

Page 16          Source Listing                  DATA_OVERRIDE_INIT
2021-06-01 08:55 Symbol Table                    data_override.F90

 Name                       Type            Bytes Offset   Dimen Elements Attributes       References                         
                                                                                                                              
 DATA_TYPE.INTERPOL_METHOD  CHAR            128   771            scalar                    284,315,317,322,323,324,326,327,32 
                                                                                           8,329,336,352,365,367,377,378,379, 
                                                                                           381,382,383,384,391,841,1007,1131  
 DATA_TYPE.LAT_END          R(8)            8     936            scalar                    354,358,372,398,1043,1048          
 DATA_TYPE.LAT_START        R(8)            8     928            scalar                    354,358,371,397,1041,1047          
 DATA_TYPE.LON_END          R(8)            8     920            scalar                    354,356,370,396,1039,1046          
 DATA_TYPE.LON_START        R(8)            8     912            scalar                    354,356,369,395,1037,1045          
 DATA_TYPE.REGION_TYPE      I(4)            4     944            scalar                    342,344,373,399,902,1026,1055,1057 
                                                                                           ,1206,1245                         
 OVERRIDE_TYPE.COMP_DOMAIN  I(4)            4     224      1     4                         421,868,1065                       
 OVERRIDE_TYPE.DIMS         I(4)            4     208      1     4                         420,927,942,1064                   
 OVERRIDE_TYPE.FIELDNAME    CHAR            128   3              scalar                    418,849,866,1366,1376              
 OVERRIDE_TYPE.GRIDNAME     CHAR            3     0              scalar                    417,848,867,1365,1377              
 OVERRIDE_TYPE.T_INDEX      I(4)            4     132            scalar                    419,929,944,1080,1384,1387         

Page 17          Source Listing                  DATA_OVERRIDE_INIT
2021-06-01 08:55                                 data_override.F90

    576 ! </SUBROUTINE>
    577 !===============================================================================================
    578 
    579 !===============================================================================================
    580 ! <SUBROUTINE NAME="data_override_unset_domain">
    581 !   <DESCRIPTION>
    582 ! Unset domains that had previously been set for use by data_override.
    583 !   </DESCRIPTION>
    584 !   <TEMPLATE>
    585 ! call data_override_unset_domain
    586 !   </TEMPLATE>
    587 
    588 !> @brief Unset domains that had previously been set for use by data_override.
    589 !!
    590 !! This subroutine deallocates any data override domains that have been set.
    591 subroutine data_override_unset_domains(unset_Atm, unset_Ocean, &
    592                                       unset_Ice, unset_Land, must_be_set)
    593   logical, intent(in), optional :: unset_Atm, unset_Ocean, unset_Ice, unset_Land
    594   logical, intent(in), optional :: must_be_set
    595 
    596 ! <NOTE>
    597 ! This subroutine deallocates any data override domains that have been set.
    598 ! </NOTE>
    599   logical :: fail_if_not_set
    600 
    601   fail_if_not_set = .true. ; if (present(must_be_set)) fail_if_not_set = must_be_set
    602 
    603   if (.not.module_is_initialized) call mpp_error(FATAL, &
    604      "data_override_unset_domains called with an unititialized data_override module.")
    605 
    606   if (PRESENT(unset_Atm)) then ; if (unset_Atm) then
    607     if (fail_if_not_set .and. .not.atm_on) call mpp_error(FATAL, &
    608       "data_override_unset_domains attempted to work on an Atm_domain that had not been set.")
    609     atm_domain = NULL_DOMAIN2D
    610     atm_on = .false.
    611     if (allocated(lon_local_atm)) deallocate(lon_local_atm)
    612     if (allocated(lat_local_atm)) deallocate(lat_local_atm)
    613   endif ; endif
    614   if (PRESENT(unset_Ocean)) then ; if (unset_Ocean) then
    615     if (fail_if_not_set .and. .not.ocn_on) call mpp_error(FATAL, &
    616       "data_override_unset_domains attempted to work on an Ocn_domain that had not been set.")
    617     ocn_domain = NULL_DOMAIN2D
    618     ocn_on = .false.
    619     if (allocated(lon_local_ocn)) deallocate(lon_local_ocn)
    620     if (allocated(lat_local_ocn)) deallocate(lat_local_ocn)
    621   endif ; endif
    622   if (PRESENT(unset_Land)) then ; if (unset_Land) then
    623     if (fail_if_not_set .and. .not.lnd_on) call mpp_error(FATAL, &
    624       "data_override_unset_domains attempted to work on a Land_domain that had not been set.")
    625     lnd_domain = NULL_DOMAIN2D
    626     lnd_on = .false.
    627     if (allocated(lon_local_lnd)) deallocate(lon_local_lnd)
    628     if (allocated(lat_local_lnd)) deallocate(lat_local_lnd)
    629   endif ; endif
    630   if (PRESENT(unset_Ice)) then ; if (unset_Ice) then
    631     if (fail_if_not_set .and. .not.ice_on) call mpp_error(FATAL, &
    632       "data_override_unset_domains attempted to work on an Ice_domain that had not been set.")

Page 18          Source Listing                  DATA_OVERRIDE_UNSET_DOMAINS
2021-06-01 08:55                                 data_override.F90

    633     ice_domain = NULL_DOMAIN2D
    634     ice_on = .false.
    635     if (allocated(lon_local_ice)) deallocate(lon_local_ice)
    636     if (allocated(lat_local_ice)) deallocate(lat_local_ice)
    637   endif ; endif
    638 
    639 end subroutine data_override_unset_domains


ENTRY POINTS

  Name                                                         
                                                               
 data_override_mod_mp_data_override_unset_domains_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 ALLOCATED                  Func   611                                  scalar                    611,612,619,620,627,628,635,636   
 DATA_OVERRIDE_UNSET_DOMAIN                                                                                                         
 S                          Subr   591                                                                                              
 FAIL_IF_NOT_SET            Local  599      L(4)            4           scalar                    601,607,615,623,631               
 MUST_BE_SET                Dummy  592      L(4)            4           scalar   ARG,IN           601                               
 PRESENT                    Func   601                                  scalar                    601,606,614,622,630               
 UNSET_ATM                  Dummy  591      L(4)            4           scalar   ARG,IN           606                               
 UNSET_ICE                  Dummy  592      L(4)            4           scalar   ARG,IN           630                               
 UNSET_LAND                 Dummy  592      L(4)            4           scalar   ARG,IN           622                               
 UNSET_OCEAN                Dummy  591      L(4)            4           scalar   ARG,IN           614                               

Page 19          Source Listing                  DATA_OVERRIDE_UNSET_DOMAINS
2021-06-01 08:55                                 data_override.F90

    640 ! </SUBROUTINE>
    641 !===============================================================================================
    642 
    643 !===============================================================================================
    644 
    645 !> @brief Given a gridname, this routine returns the working domain associated with this gridname
    646 subroutine get_domain(gridname, domain, comp_domain)
    647 ! Given a gridname, this routine returns the working domain associated with this gridname
    648   character(len=3), intent(in) :: gridname
    649   type(domain2D), intent(inout) :: domain
    650   integer, intent(out), optional :: comp_domain(4) !< istart,iend,jstart,jend for compute domain
    651 
    652   domain = NULL_DOMAIN2D
    653   select case (gridname)
    654      case('OCN')
    655         domain = ocn_domain
    656      case('ATM')
    657         domain = atm_domain
    658      case('LND')
    659         domain = lnd_domain
    660      case('ICE')
    661         domain = ice_domain
    662      case default
    663         call mpp_error(FATAL,'error in data_override get_domain')
    664   end select
    665   if(domain .EQ. NULL_DOMAIN2D) call mpp_error(FATAL,'data_override: failure in get_domain')
    666   if(present(comp_domain)) &
    667      call mpp_get_compute_domain(domain,comp_domain(1),comp_domain(2),comp_domain(3),comp_domain(4))
    668 end subroutine get_domain

Page 20          Source Listing                  GET_DOMAIN
2021-06-01 08:55 Entry Points                    data_override.F90



ENTRY POINTS

  Name                                        
                                              
 data_override_mod_mp_get_domain_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 COMP_DOMAIN                Dummy  646      I(4)            4     1     4        ARG,OUT          666,667                           
 DOMAIN                     Dummy  646      DOMAIN2D        752         scalar   ARG,INOUT        652,655,657,659,661,665,667       
 GET_DOMAIN                 Subr   646                                                            860                               
 GRIDNAME                   Dummy  646      CHAR            3           scalar   ARG,IN           653                               
 MPP_DOMAIN2D_EQ            Func   665      L(4)            4           scalar   PRIV             665                               
 PRESENT                    Func   666                                  scalar                    666                               

Page 21          Source Listing                  GET_DOMAIN
2021-06-01 08:55                                 data_override.F90

    669 
    670 !> @brief Given a gridname, this routine returns the working domain associated with this gridname
    671 subroutine get_domainUG(gridname, UGdomain, comp_domain)
    672 ! Given a gridname, this routine returns the working domain associated with this gridname
    673   character(len=3), intent(in) :: gridname
    674   type(domainUG), intent(inout) :: UGdomain
    675   integer, intent(out), optional :: comp_domain(4) !< istart,iend,jstart,jend for compute domain
    676   type(domain2D), pointer :: SGdomain => NULL()
    677 
    678   UGdomain = NULL_DOMAINUG
    679   select case (gridname)
    680      case('LND')
    681         UGdomain = lnd_domainUG
    682      case default
    683         call mpp_error(FATAL,'error in data_override get_domain')
    684   end select
    685 !  if(UGdomain .EQ. NULL_DOMAINUG) call mpp_error(FATAL,'data_override: failure in get_domain')
    686   if(present(comp_domain)) &
    687      call mpp_get_UG_SG_domain(UGdomain,SGdomain)
    688      call mpp_get_compute_domain(SGdomain,comp_domain(1),comp_domain(2),comp_domain(3),comp_domain(4))
    689 end subroutine get_domainUG


ENTRY POINTS

  Name                                          
                                                
 data_override_mod_mp_get_domainug_             

Page 22          Source Listing                  GET_DOMAINUG
2021-06-01 08:55 Symbol Table                    data_override.F90



SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 COMP_DOMAIN                Dummy  671      I(4)            4     1     4        ARG,OUT          686,688                           
 GET_DOMAINUG               Subr   671                                                            1428,1468                         
 GRIDNAME                   Dummy  671      CHAR            3           scalar   ARG,IN           679                               
 MPP_GET_UG_SG_DOMAIN       Subr   687                                           PRIV             71,687                            
 NULL                       Func   676                                  scalar   PTR              676                               
 PRESENT                    Func   686                                  scalar                    686                               
 SGDOMAIN                   Local  676      DOMAIN2D        752         scalar   PTR              676,687,688                       
 UGDOMAIN                   Dummy  671      DOMAINUG        544         scalar   ARG,INOUT        678,681,687                       

Page 23          Source Listing                  GET_DOMAINUG
2021-06-01 08:55                                 data_override.F90

    690 !===============================================================================================
    691 
    692 ! <SUBROUTINE NAME="data_override_2d">
    693 !   <DESCRIPTION>
    694 ! This routine performs data override for 2D fields; for usage, see data_override_3d.
    695 !   </DESCRIPTION>
    696 
    697 !> @brief This routine performs data override for 2D fields; for usage, see data_override_3d.
    698 subroutine data_override_2d(gridname,fieldname,data_2D,time,override, is_in, ie_in, js_in, je_in)
    699   character(len=3), intent(in) :: gridname !< model grid ID
    700   character(len=*), intent(in) :: fieldname !< field to override
    701   logical, intent(out), optional :: override !< true if the field has been overriden succesfully
    702   type(time_type), intent(in) :: time !<  model time
    703   real, dimension(:,:), intent(inout) :: data_2D !< data returned by this call
    704   integer,           optional,  intent(in) :: is_in, ie_in, js_in, je_in
    705 !  real, dimension(size(data_2D,1),size(data_2D,2),1) :: data_3D
    706   real, dimension(:,:,:), allocatable ::  data_3D
    707   integer       :: index1
    708   integer       :: i
    709 
    710 !1  Look  for the data file in data_table
    711   if(PRESENT(override)) override = .false.
    712   index1 = -1
    713   do i = 1, table_size
    714      if( trim(gridname) /= trim(data_table(i)%gridname)) cycle
    715      if( trim(fieldname) /= trim(data_table(i)%fieldname_code)) cycle
    716      index1 = i                               ! field found
    717      exit
    718   enddo
    719   if(index1 .eq. -1) return  ! NO override was performed
    720 
    721   allocate(data_3D(size(data_2D,1),size(data_2D,2),1))
    722   data_3D(:,:,1) = data_2D
    723   call data_override_3d(gridname,fieldname,data_3D,time,override,data_index=index1,&
    724                        is_in=is_in,ie_in=ie_in,js_in=js_in,je_in=je_in)
    725 
    726   data_2D(:,:) = data_3D(:,:,1)
    727   deallocate(data_3D)
    728 end subroutine data_override_2d

Page 24          Source Listing                  DATA_OVERRIDE_2D
2021-06-01 08:55 Entry Points                    data_override.F90



ENTRY POINTS

  Name                                              
                                                    
 data_override_mod_mp_data_override_2d_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 DATA_2D                    Dummy  698      R(8)            8     2     1        ARG,INOUT        721,722,726                       
 DATA_3D                    Local  706      R(8)            8     3     1        ALC              721,722,723,726,727               
 DATA_OVERRIDE_2D           Subr   698                                           PRIV             1431                              
 FIELDNAME                  Dummy  698      CHAR                        scalar   ARG,IN           715,723                           
 GRIDNAME                   Dummy  698      CHAR            3           scalar   ARG,IN           714,723                           
 I                          Local  708      I(4)            4           scalar                    713,714,715,716                   
 IE_IN                      Dummy  698      I(4)            4           scalar   ARG,IN           724                               
 INDEX1                     Local  707      I(4)            4           scalar                    712,716,719,723                   
 IS_IN                      Dummy  698      I(4)            4           scalar   ARG,IN           724                               
 JE_IN                      Dummy  698      I(4)            4           scalar   ARG,IN           724                               
 JS_IN                      Dummy  698      I(4)            4           scalar   ARG,IN           724                               
 OVERRIDE                   Dummy  698      L(4)            4           scalar   ARG,OUT          711,723                           
 PRESENT                    Func   711                                  scalar                    711                               
 SIZE                       Func   721                                  scalar                    721                               
 TIME                       Dummy  698      TIME_TYPE       16          scalar   ARG,IN           723                               
 TIME_TYPE                  Type   702                                  scalar   PRIV             72,702,763,1314,1408,1443         
 TRIM                       Func   714                                  scalar                    714,715                           

Page 25          Source Listing                  DATA_OVERRIDE_2D
2021-06-01 08:55                                 data_override.F90

    729 ! </SUBROUTINE>
    730 !===============================================================================================
    731 
    732 ! <SUBROUTINE NAME="data_override_3d">
    733 !   <DESCRIPTION>
    734 ! This routine performs data override for 3D fields
    735 !   <TEMPLATE>
    736 ! call data_override(gridname,fieldname,data,time,override)
    737 !   </TEMPLATE>
    738 !   </DESCRIPTION>
    739 
    740 !   <IN NAME="gridname"  TYPE="character" DIM="(*)">
    741 ! Grid name (Ocean, Ice, Atmosphere, Land)
    742 !   </IN>
    743 !   <IN NAME="fieldname_code" TYPE="character" DIM="(*)">
    744 !    Field name as used in the code (may be different from the name in NetCDF data file)
    745 !   </IN>
    746 !   <OUT NAME="data" TYPE="real" DIM="(:,:,:)">
    747 !    array containing output data
    748 !   </OUT>
    749 !   <IN NAME="time" TYPE="time_type">
    750 !    model time
    751 !   </IN>
    752 !   <OUT NAME="override" TYPE="logical">
    753 !    TRUE if the field is overriden, FALSE otherwise
    754 !   </OUT>
    755 !   <IN NAME="data_index" TYPE="integer">
    756 !   </IN>
    757 
    758 !> @brief This routine performs data override for 3D fields
    759 subroutine data_override_3d(gridname,fieldname_code,data,time,override,data_index, is_in, ie_in, js_in, je_in)
    760   character(len=3),             intent(in) :: gridname !< model grid ID
    761   character(len=*),             intent(in) :: fieldname_code !< field name as used in the model
    762   logical,           optional, intent(out) :: override !< true if the field has been overriden succesfully
    763   type(time_type),              intent(in) :: time !< (target) model time
    764   integer,           optional,  intent(in) :: data_index
    765   real, dimension(:,:,:),    intent(inout) :: data !< data returned by this call
    766   integer,           optional,  intent(in) :: is_in, ie_in, js_in, je_in
    767   logical, dimension(:,:,:),   allocatable :: mask_out
    768 
    769   character(len=512) :: filename !< file containing source data
    770   character(len=512) :: filename2 !< file containing source data
    771   character(len=128) :: fieldname !< fieldname used in the data file
    772   integer            :: i,j
    773   integer            :: dims(4)
    774   integer            :: index1 !< field index in data_table
    775   integer            :: id_time !< index for time interp in override array
    776   integer            :: axis_sizes(4)
    777   character(len=32)  :: axis_names(4)
    778   type(axistype)     :: axis_centers(4), axis_bounds(4)
    779   real, dimension(:,:), pointer :: lon_local =>NULL() !< of output (target) grid cells
    780   real, dimension(:,:), pointer :: lat_local =>NULL() !< of output (target) grid cells
    781   real, dimension(:), allocatable :: lon_tmp, lat_tmp
    782 
    783   logical :: data_file_is_2D = .false.  !< data in netCDF file is 2D
    784   logical :: ongrid, use_comp_domain
    785   type(domain2D) :: domain

Page 26          Source Listing                  DATA_OVERRIDE_3D
2021-06-01 08:55                                 data_override.F90

    786   integer :: curr_position !< position of the field currently processed in override_array
    787   real :: factor
    788   integer, dimension(4) :: comp_domain = 0  !< istart,iend,jstart,jend for compute domain
    789   integer :: nxd, nyd, nxc, nyc, nwindows
    790   integer :: nwindows_x, ipos, jpos, window_size(2)
    791   integer :: istart, iend, jstart, jend
    792   integer :: isw, iew, jsw, jew, n
    793   integer :: omp_get_num_threads, omp_get_thread_num, thread_id, window_id
    794   logical :: need_compute
    795   real    :: lat_min, lat_max
    796   integer :: is_src, ie_src, js_src, je_src
    797   logical :: exists
    798   type(FmsNetcdfFile_t) :: fileobj
    799   integer :: startingi !< Starting x index for the compute domain relative to the input buffer
    800   integer :: endingi !< Ending x index for the compute domain relative to the input buffer
    801   integer :: startingj !< Starting y index for the compute domain relative to the input buffer
    802   integer :: endingj !< Ending y index for the compute domain relative to the input buffer
    803   integer :: nhalox !< Number of halos in the x direction
    804   integer :: nhaloy !< Number of halos in the y direction
    805 
    806   use_comp_domain = .false.
    807   if(.not.module_is_initialized) &
    808        call mpp_error(FATAL,'Error: need to call data_override_init first')
    809 
    810 !1  Look  for the data file in data_table
    811   if(PRESENT(override)) override = .false.
    812   if (present(data_index)) then
    813     index1 = data_index
    814   else
    815     index1 = -1
    816     do i = 1, table_size
    817        if( trim(gridname) /= trim(data_table(i)%gridname)) cycle
    818        if( trim(fieldname_code) /= trim(data_table(i)%fieldname_code)) cycle
    819        index1 = i                               ! field found
    820        exit
    821     enddo
    822     if(index1 .eq. -1) then
    823        if(debug_data_override) &
    824          call mpp_error(WARNING,'this field is NOT found in data_table: '//trim(fieldname_code))
    825        return  ! NO override was performed
    826     endif
    827   endif
    828 
    829   fieldname = data_table(index1)%fieldname_file ! fieldname in netCDF data file
    830   factor = data_table(index1)%factor
    831 
    832   if(fieldname == "") then
    833      data = factor
    834      if(PRESENT(override)) override = .true.
    835      return
    836   else
    837      filename = data_table(index1)%file_name
    838      if (filename == "") call mpp_error(FATAL,'data_override: filename not given in data_table')
    839   endif
    840 
    841   ongrid = (data_table(index1)%interpol_method == 'none')
    842 

Page 27          Source Listing                  DATA_OVERRIDE_3D
2021-06-01 08:55                                 data_override.F90

    843 !3 Check if fieldname has been previously processed
    844 !$OMP CRITICAL
    845   curr_position = -1
    846   if(num_fields > 0 ) then
    847      do i = 1, num_fields
    848         if(trim(override_array(i)%gridname) /= trim(gridname))   cycle
    849         if(trim(override_array(i)%fieldname) /= trim(fieldname_code)) cycle
    850         curr_position = i
    851         exit
    852      enddo
    853   endif
    854 
    855   if(curr_position < 0) then ! the field has not been processed previously
    856      num_fields = num_fields + 1
    857      curr_position = num_fields
    858 
    859 ! Get working domain from model's gridname
    860      call get_domain(gridname,domain,comp_domain)
    861      call mpp_get_data_domain(domain, xsize=nxd, ysize=nyd)
    862      nxc = comp_domain(2)-comp_domain(1) + 1
    863      nyc = comp_domain(4)-comp_domain(3) + 1
    864 
    865 ! record fieldname, gridname in override_array
    866      override_array(curr_position)%fieldname = fieldname_code
    867      override_array(curr_position)%gridname = gridname
    868      override_array(curr_position)%comp_domain = comp_domain
    869 ! get number of threads
    870      override_array(curr_position)%numthreads = 1
    871 
    872      override_array(curr_position)%numthreads = omp_get_num_threads()
    873 
    874 !--- data_override may be called from physics windows. The following are possible situations
    875 !--- 1. size(data,1) == nxd and size(data,2) == nyd   ( on data domain and there is only one window).
    876 !--- 2. nxc is divisible by size(data,1), nyc is divisible by size(data,2),
    877 !---    nwindow = (nxc/size(data(1))*(nyc/size(data,2)), also we require nwindows is divisible by nthreads.
    878 !---    The another restrition is that size(data,1) == ie_in - is_in + 1,
    879 !---                                   size(data,2) == je_in - js_in + 1
    880      nwindows = 1
    881      if( nxd == size(data,1) .AND. nyd == size(data,2) ) then  !
    882         use_comp_domain = .false.
    883      else if ( mod(nxc, size(data,1)) ==0 .AND. mod(nyc, size(data,2)) ==0 ) then
    884         use_comp_domain = .true.
    885         nwindows = (nxc/size(data,1))*(nyc/size(data,2))
    886      else
    887         call mpp_error(FATAL, "data_override: data is not on data domain and compute domain is not divisible by size(data)")
    888      endif
    889      override_array(curr_position)%window_size(1) = size(data,1)
    890      override_array(curr_position)%window_size(2) = size(data,2)
    891 
    892      window_size = override_array(curr_position)%window_size
    893      override_array(curr_position)%numwindows = nwindows
    894      if( mod(nwindows, override_array(curr_position)%numthreads) .NE. 0 ) then
    895         call mpp_error(FATAL, "data_override: nwindow is not divisible by nthreads")
    896      endif
    897      allocate(override_array(curr_position)%need_compute(nwindows))
    898      override_array(curr_position)%need_compute = .true.
    899 

Page 28          Source Listing                  DATA_OVERRIDE_3D
2021-06-01 08:55                                 data_override.F90

    900 !4 get index for time interp
    901      if(ongrid) then
    902         if( data_table(index1)%region_type .NE. NO_REGION ) then
    903            call mpp_error(FATAL,'data_override: ongrid must be false when region_type .NE. NO_REGION')
    904         endif
    905 
    906 !  Allow on-grid data_overrides on cubed sphere grid
    907         inquire(file=trim(filename),EXIST=exists)
    908         if (.not. exists) then
    909            if (use_mpp_bug) then
    910              call get_mosaic_tile_file_classic(filename,filename2,.false.,domain)
    911            else
    912              call get_mosaic_tile_file_fms2_io(filename,filename2,.false.,domain)
    913            endif
    914            filename = filename2
    915         endif
    916 
    917 !--- we always only pass data on compute domain
    918         if (use_mpp_bug) then
    919           id_time = init_external_field_classic(filename,fieldname,domain=domain,verbose=.false., &
    920                                       use_comp_domain=use_comp_domain, nwindows=nwindows)
    921           dims = get_external_field_size_classic(id_time)
    922         else
    923           id_time = init_external_field_fms2io(filename,fieldname,domain=domain,verbose=.false., &
    924                                       use_comp_domain=use_comp_domain, nwindows=nwindows, ongrid=ongrid)
    925           dims = get_external_field_size_fms2io(id_time)
    926         end if
    927         override_array(curr_position)%dims = dims
    928         if(id_time<0) call mpp_error(FATAL,'data_override:field not found in init_external_field 1')
    929         override_array(curr_position)%t_index = id_time
    930      else !ongrid=false
    931         if (use_mpp_bug) then
    932           id_time = init_external_field_classic(filename,fieldname,domain=domain, axis_centers=axis_centers,&
    933               axis_sizes=axis_sizes, verbose=.false.,override=.true.,use_comp_domain=use_comp_domain, &
    934               nwindows = nwindows)
    935           dims = get_external_field_size_classic(id_time)
    936         else
    937           id_time = init_external_field_fms2io(filename,fieldname,domain=domain, axis_names=axis_names,&
    938               axis_sizes=axis_sizes, verbose=.false.,override=.true.,use_comp_domain=use_comp_domain, &
    939               nwindows = nwindows)
    940           dims = get_external_field_size_fms2io(id_time)
    941         end if
    942         override_array(curr_position)%dims = dims
    943         if(id_time<0) call mpp_error(FATAL,'data_override:field not found in init_external_field 2')
    944         override_array(curr_position)%t_index = id_time
    945 
    946 !  get lon and lat of the input (source) grid, assuming that axis%data contains
    947 !  lat and lon of the input grid (in degrees)
    948 
    949         allocate(override_array(curr_position)%horz_interp(nwindows))
    950         allocate(override_array(curr_position)%lon_in(axis_sizes(1)+1))
    951         allocate(override_array(curr_position)%lat_in(axis_sizes(2)+1))
    952         if (use_mpp_bug) then
    953           call get_axis_bounds(axis_centers(1),axis_bounds(1), axis_centers)
    954           call get_axis_bounds(axis_centers(2),axis_bounds(2), axis_centers)
    955 
    956           call mpp_get_axis_data(axis_bounds(1),override_array(curr_position)%lon_in)

Page 29          Source Listing                  DATA_OVERRIDE_3D
2021-06-01 08:55                                 data_override.F90

    957           call mpp_get_axis_data(axis_bounds(2),override_array(curr_position)%lat_in)
    958         else
    959           if(get_external_fileobj(filename, fileobj)) then
    960              call axis_edges(fileobj, axis_names(1), override_array(curr_position)%lon_in, &
    961                 reproduce_null_char_bug_flag=reproduce_null_char_bug)
    962              call axis_edges(fileobj, axis_names(2), override_array(curr_position)%lat_in, &
    963                 reproduce_null_char_bug_flag=reproduce_null_char_bug)
    964           else
    965              call mpp_error(FATAL,'data_override: file '//trim(filename)//' is not opened in time_interp_external')
    966           end if
    967         end if
    968 ! convert lon_in and lat_in from deg to radian
    969         override_array(curr_position)%lon_in = override_array(curr_position)%lon_in * deg_to_radian
    970         override_array(curr_position)%lat_in = override_array(curr_position)%lat_in * deg_to_radian
    971 
    972 !--- find the region of the source grid that cover the local model grid.
    973 !--- currently we only find the index range for j-direction because
    974 !--- of the cyclic condition in i-direction. The purpose of this is to
    975 !--- decrease the memory usage and increase the IO performance.
    976         select case(gridname)
    977         case('OCN')
    978            lon_local => lon_local_ocn; lat_local => lat_local_ocn
    979         case('ICE')
    980            lon_local => lon_local_ice; lat_local => lat_local_ice
    981         case('ATM')
    982            lon_local => lon_local_atm; lat_local => lat_local_atm
    983         case('LND')
    984            lon_local => lon_local_lnd; lat_local => lat_local_lnd
    985         case default
    986            call mpp_error(FATAL,'error: gridname not recognized in data_override')
    987         end select
    988 
    989         lat_min = minval(lat_local)
    990         lat_max = maxval(lat_local)
    991         is_src = 1
    992         ie_src = axis_sizes(1)
    993         js_src = 1
    994         je_src = axis_sizes(2)
    995         do j = 1, axis_sizes(2)+1
    996            if( override_array(curr_position)%lat_in(j) > lat_min ) exit
    997            js_src = j
    998         enddo
    999         do j = 1, axis_sizes(2)+1
   1000            je_src = j
   1001            if( override_array(curr_position)%lat_in(j) > lat_max ) exit
   1002         enddo
   1003 
   1004 !--- bicubic interpolation need one extra point in each direction. Also add
   1005 !--- one more point for because lat_in is in the corner but the interpolation
   1006 !--- use center points.
   1007         select case (data_table(index1)%interpol_method)
   1008         case ('bilinear')
   1009            js_src = max(1, js_src-1)
   1010            je_src = min(axis_sizes(2), je_src+1)
   1011         case ('bicubic')
   1012            js_src = max(1, js_src-2)
   1013            je_src = min(axis_sizes(2), je_src+2)

Page 30          Source Listing                  DATA_OVERRIDE_3D
2021-06-01 08:55                                 data_override.F90

   1014         end select
   1015         override_array(curr_position)%is_src = is_src
   1016         override_array(curr_position)%ie_src = ie_src
   1017         override_array(curr_position)%js_src = js_src
   1018         override_array(curr_position)%je_src = je_src
   1019         if (use_mpp_bug) then
   1020           call reset_src_data_region_classic(id_time, is_src, ie_src, js_src, je_src)
   1021         else
   1022           call reset_src_data_region_fms2io(id_time, is_src, ie_src, js_src, je_src)
   1023         end if
   1024 
   1025 !       Find the index of lon_start, lon_end, lat_start and lat_end in the input grid (nearest points)
   1026         if( data_table(index1)%region_type .NE. NO_REGION ) then
   1027            allocate( lon_tmp(axis_sizes(1)), lat_tmp(axis_sizes(2)) )
   1028            if (use_mpp_bug) then
   1029              call mpp_get_axis_data(axis_centers(1), lon_tmp)
   1030              call mpp_get_axis_data(axis_centers(2), lat_tmp)
   1031            else
   1032              call read_data(fileobj, axis_names(1), lon_tmp)
   1033              call read_data(fileobj, axis_names(2), lat_tmp)
   1034            end if
   1035 ! limit lon_start, lon_end are inside lon_in
   1036 !       lat_start, lat_end are inside lat_in
   1037            if( data_table(index1)%lon_start < lon_tmp(1) .OR. data_table(index1)%lon_start .GT. lon_tmp(axis_sizes(1))) &
   1038               call mpp_error(FATAL, "data_override: lon_start is outside lon_T")
   1039            if( data_table(index1)%lon_end < lon_tmp(1) .OR. data_table(index1)%lon_end .GT. lon_tmp(axis_sizes(1))) &
   1040               call mpp_error(FATAL, "data_override: lon_end is outside lon_T")
   1041            if( data_table(index1)%lat_start < lat_tmp(1) .OR. data_table(index1)%lat_start .GT. lat_tmp(axis_sizes(2))) &
   1042               call mpp_error(FATAL, "data_override: lat_start is outside lat_T")
   1043            if( data_table(index1)%lat_end < lat_tmp(1) .OR. data_table(index1)%lat_end .GT. lat_tmp(axis_sizes(2))) &
   1044               call mpp_error(FATAL, "data_override: lat_end is outside lat_T")
   1045            istart = nearest_index(data_table(index1)%lon_start, lon_tmp)
   1046            iend   = nearest_index(data_table(index1)%lon_end,   lon_tmp)
   1047            jstart = nearest_index(data_table(index1)%lat_start, lat_tmp)
   1048            jend   = nearest_index(data_table(index1)%lat_end,   lat_tmp)
   1049 ! adjust the index according to is_src and js_src
   1050            istart = istart - is_src + 1
   1051            iend   = iend   - is_src + 1
   1052            jstart = jstart - js_src + 1
   1053            jend   = jend   - js_src + 1
   1054            if (use_mpp_bug) then
   1055              call set_override_region_classic(id_time, data_table(index1)%region_type, istart, iend, jstart, jend)
   1056            else
   1057              call set_override_region_fms2io(id_time, data_table(index1)%region_type, istart, iend, jstart, jend)
   1058            end if
   1059            deallocate(lon_tmp, lat_tmp)
   1060         endif
   1061 
   1062      endif
   1063   else !curr_position >0
   1064      dims = override_array(curr_position)%dims
   1065      comp_domain = override_array(curr_position)%comp_domain
   1066      if (.not. use_mpp_bug) then
   1067        nxc = comp_domain(2)-comp_domain(1) + 1
   1068        nyc = comp_domain(4)-comp_domain(3) + 1
   1069      end if
   1070      is_src      = override_array(curr_position)%is_src

Page 31          Source Listing                  DATA_OVERRIDE_3D
2021-06-01 08:55                                 data_override.F90

   1071      ie_src      = override_array(curr_position)%ie_src
   1072      js_src      = override_array(curr_position)%js_src
   1073      je_src      = override_array(curr_position)%je_src
   1074      window_size = override_array(curr_position)%window_size
   1075 !---make sure data size match window_size
   1076      if( window_size(1) .NE. size(data,1) .OR. window_size(2) .NE. size(data,2) ) then
   1077         call mpp_error(FATAL, "data_override: window_size does not match size(data)")
   1078      endif
   1079 !9 Get id_time  previously stored in override_array
   1080      id_time = override_array(curr_position)%t_index
   1081   endif
   1082 !$OMP END CRITICAL
   1083 
   1084   if( override_array(curr_position)%numwindows > 1 ) then
   1085       if( .NOT. PRESENT(is_in) .OR. .NOT. PRESENT(is_in) .OR. .NOT. PRESENT(is_in) .OR. .NOT. PRESENT(is_in) ) then
   1086           call mpp_error(FATAL, "data_override: is_in, ie_in, js_in, je_in must be present when nwindows > 1")
   1087       endif
   1088   endif
   1089 
   1090   isw = comp_domain(1)
   1091   iew = comp_domain(2)
   1092   jsw = comp_domain(3)
   1093   jew = comp_domain(4)
   1094   window_id = 1
   1095   if( override_array(curr_position)%numwindows > 1 ) then
   1096      nxc = comp_domain(2) - comp_domain(1) + 1
   1097      nwindows_x = nxc/window_size(1)
   1098      ipos = (is_in-1)/window_size(1) + 1
   1099      jpos = (js_in-1)/window_size(2)
   1100 
   1101      window_id = jpos*nwindows_x + ipos
   1102      isw = isw + is_in - 1
   1103      iew = isw + ie_in - is_in
   1104      jsw = jsw + js_in - 1
   1105      jew = jsw + je_in - js_in
   1106   endif
   1107 
   1108   if( ongrid ) then
   1109      need_compute = .false.
   1110   else
   1111 !--- find the index for windows.
   1112      need_compute=override_array(curr_position)%need_compute(window_id)
   1113   endif
   1114 
   1115 !--- call horiz_interp_new is not initialized
   1116 
   1117   if( need_compute ) then
   1118      select case(gridname)
   1119      case('OCN')
   1120         lon_local => lon_local_ocn; lat_local => lat_local_ocn
   1121      case('ICE')
   1122         lon_local => lon_local_ice; lat_local => lat_local_ice
   1123      case('ATM')
   1124         lon_local => lon_local_atm; lat_local => lat_local_atm
   1125      case('LND')
   1126         lon_local => lon_local_lnd; lat_local => lat_local_lnd
   1127      case default

Page 32          Source Listing                  DATA_OVERRIDE_3D
2021-06-01 08:55                                 data_override.F90

   1128         call mpp_error(FATAL,'error: gridname not recognized in data_override')
   1129      end select
   1130 
   1131      select case (data_table(index1)%interpol_method)
   1132      case ('bilinear')
   1133         call horiz_interp_new (override_array(curr_position)%horz_interp(window_id), &
   1134              override_array(curr_position)%lon_in(is_src:ie_src+1),                  &
   1135              override_array(curr_position)%lat_in(js_src:je_src+1),                  &
   1136              lon_local(isw:iew,jsw:jew), lat_local(isw:iew,jsw:jew), interp_method="bilinear")
   1137      case ('bicubic')
   1138         call horiz_interp_new (override_array(curr_position)%horz_interp(window_id), &
   1139              override_array(curr_position)%lon_in(is_src:ie_src+1),                  &
   1140              override_array(curr_position)%lat_in(js_src:je_src+1),                  &
   1141              lon_local(isw:iew,jsw:jew), lat_local(isw:iew,jsw:jew), interp_method="bicubic")
   1142      end select
   1143      override_array(curr_position)%need_compute(window_id) = .false.
   1144   endif
   1145 
   1146 ! Determine if  data in netCDF file is 2D or not
   1147   data_file_is_2D = .false.
   1148   if((dims(3) == 1) .and. (size(data,3)>1)) data_file_is_2D = .true.
   1149 
   1150   if(dims(3) .NE. 1 .and. (size(data,3) .NE. dims(3))) &
   1151       call mpp_error(FATAL, "data_override: dims(3) .NE. 1 and size(data,3) .NE. dims(3)")
   1152 
   1153   if(ongrid) then
   1154     if (.not. use_mpp_bug) then
   1155       if (.not. use_comp_domain) then
   1156 !< Determine the size of the halox and the part of `data` that is in the compute domain
   1157           nhalox = (size(data,1) - nxc)/2
   1158           nhaloy = (size(data,2) - nyc)/2
   1159           startingi = lbound(data,1) + nhalox
   1160           startingj = lbound(data,2) + nhaloy
   1161           endingi   = ubound(data,1) - nhalox
   1162           endingj   = ubound(data,2) - nhaloy
   1163       end if
   1164     end if
   1165 
   1166 !10 do time interp to get data in compute_domain
   1167     if(data_file_is_2D) then
   1168       if (use_mpp_bug) then
   1169         call time_interp_external_classic(id_time,time,data(:,:,1),verbose=.false., &
   1170                                   is_in=is_in,ie_in=ie_in,js_in=js_in,je_in=je_in,window_id=window_id)
   1171       else
   1172         if (use_comp_domain) then
   1173         call time_interp_external_fms2io(id_time,time,data(:,:,1),verbose=.false., &
   1174                                   is_in=is_in,ie_in=ie_in,js_in=js_in,je_in=je_in,window_id=window_id)
   1175         else
   1176 !> If this in an ongrid case and you are not in the compute domain, send in `data` to be the correct
   1177 !! size
   1178            call time_interp_external_fms2io(id_time,time,data(startingi:endingi,startingj:endingj,1),verbose=.false., &
   1179                                   is_in=is_in,ie_in=ie_in,js_in=js_in,je_in=je_in,window_id=window_id)
   1180         end if
   1181       end if
   1182       data(:,:,1) = data(:,:,1)*factor
   1183       do i = 2, size(data,3)
   1184         data(:,:,i) = data(:,:,1)

Page 33          Source Listing                  DATA_OVERRIDE_3D
2021-06-01 08:55                                 data_override.F90

   1185       end do
   1186     else
   1187       if (use_mpp_bug) then
   1188         call time_interp_external_classic(id_time,time,data,verbose=.false., &
   1189                                   is_in=is_in,ie_in=ie_in,js_in=js_in,je_in=je_in,window_id=window_id)
   1190       else
   1191         if (use_comp_domain) then
   1192         call time_interp_external_fms2io(id_time,time,data,verbose=.false., &
   1193                                   is_in=is_in,ie_in=ie_in,js_in=js_in,je_in=je_in,window_id=window_id)
   1194         else
   1195 !> If this in an ongrid case and you are not in the compute domain, send in `data` to be the correct
   1196 !! size
   1197            call time_interp_external_fms2io(id_time,time,data(startingi:endingi,startingj:endingj,:),verbose=.false., &
   1198                                   is_in=is_in,ie_in=ie_in,js_in=js_in,je_in=je_in,window_id=window_id)
   1199         endif
   1200       end if
   1201       data = data*factor
   1202     endif
   1203   else  ! off grid case
   1204 ! do time interp to get global data
   1205      if(data_file_is_2D) then
   1206         if( data_table(index1)%region_type == NO_REGION ) then
   1207            if (use_mpp_bug) then
   1208              call time_interp_external_classic(id_time,time,data(:,:,1),verbose=.false., &
   1209                    horz_interp=override_array(curr_position)%horz_interp(window_id), &
   1210                    is_in=is_in,ie_in=ie_in,js_in=js_in,je_in=je_in,window_id=window_id)
   1211            else
   1212              call time_interp_external_fms2io(id_time,time,data(:,:,1),verbose=.false., &
   1213                    horz_interp=override_array(curr_position)%horz_interp(window_id), &
   1214                    is_in=is_in,ie_in=ie_in,js_in=js_in,je_in=je_in,window_id=window_id)
   1215            end if
   1216            data(:,:,1) = data(:,:,1)*factor
   1217            do i = 2, size(data,3)
   1218              data(:,:,i) = data(:,:,1)
   1219            enddo
   1220         else
   1221            allocate(mask_out(size(data,1), size(data,2),1))
   1222            mask_out = .false.
   1223            if (use_mpp_bug) then
   1224              call time_interp_external_classic(id_time,time,data(:,:,1),verbose=.false., &
   1225                    horz_interp=override_array(curr_position)%horz_interp(window_id),      &
   1226                    mask_out   =mask_out(:,:,1), &
   1227                    is_in=is_in,ie_in=ie_in,js_in=js_in,je_in=je_in,window_id=window_id)
   1228            else
   1229              call time_interp_external_fms2io(id_time,time,data(:,:,1),verbose=.false., &
   1230                    horz_interp=override_array(curr_position)%horz_interp(window_id),      &
   1231                    mask_out   =mask_out(:,:,1), &
   1232                    is_in=is_in,ie_in=ie_in,js_in=js_in,je_in=je_in,window_id=window_id)
   1233            end if
   1234            where(mask_out(:,:,1))
   1235               data(:,:,1) = data(:,:,1)*factor
   1236            end where
   1237            do i = 2, size(data,3)
   1238               where(mask_out(:,:,1))
   1239                 data(:,:,i) = data(:,:,1)
   1240               end where
   1241            enddo

Page 34          Source Listing                  DATA_OVERRIDE_3D
2021-06-01 08:55                                 data_override.F90

   1242            deallocate(mask_out)
   1243         endif
   1244      else
   1245         if( data_table(index1)%region_type == NO_REGION ) then
   1246            if (use_mpp_bug) then
   1247              call time_interp_external_classic(id_time,time,data,verbose=.false.,      &
   1248                 horz_interp=override_array(curr_position)%horz_interp(window_id), &
   1249                 is_in=is_in,ie_in=ie_in,js_in=js_in,je_in=je_in,window_id=window_id)
   1250            else
   1251              call time_interp_external_fms2io(id_time,time,data,verbose=.false.,      &
   1252                 horz_interp=override_array(curr_position)%horz_interp(window_id), &
   1253                 is_in=is_in,ie_in=ie_in,js_in=js_in,je_in=je_in,window_id=window_id)
   1254            end if
   1255            data = data*factor
   1256         else
   1257            allocate(mask_out(size(data,1), size(data,2), size(data,3)) )
   1258            mask_out = .false.
   1259            if (use_mpp_bug) then
   1260              call time_interp_external_classic(id_time,time,data,verbose=.false.,      &
   1261                 horz_interp=override_array(curr_position)%horz_interp(window_id),    &
   1262                 mask_out   =mask_out, &
   1263                 is_in=is_in,ie_in=ie_in,js_in=js_in,je_in=je_in,window_id=window_id)
   1264            else
   1265              call time_interp_external_fms2io(id_time,time,data,verbose=.false.,      &
   1266                 horz_interp=override_array(curr_position)%horz_interp(window_id),    &
   1267                 mask_out   =mask_out, &
   1268                 is_in=is_in,ie_in=ie_in,js_in=js_in,je_in=je_in,window_id=window_id)
   1269            end if
   1270            where(mask_out)
   1271               data = data*factor
   1272            end where
   1273            deallocate(mask_out)
   1274         endif
   1275      endif
   1276 
   1277   endif
   1278 
   1279   if(PRESENT(override)) override = .true.
   1280 
   1281 end subroutine data_override_3d

Page 35          Source Listing                  DATA_OVERRIDE_3D
2021-06-01 08:55 Entry Points                    data_override.F90



ENTRY POINTS

  Name                                              
                                                    
 data_override_mod_mp_data_override_3d_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 AXISTYPE                   Type   778                                  scalar   PRIV             46,778                            
 AXIS_BOUNDS                Local  778      RECORD          1424  1     4                         953,954,956,957                   
 AXIS_CENTERS               Local  778      RECORD          1424  1     4        TGT              932,953,954,1029,1030             
 AXIS_EDGES                 Subr   960                                           PRIV             67,960,962                        
 AXIS_NAMES                 Local  777      CHAR            32    1     4                         937,960,962,1032,1033             
 AXIS_SIZES                 Local  776      I(4)            4     1     4                         933,938,950,951,992,994,995,999,10
                                                                                                  10,1013,1027,1037,1039,1041,1043  
 COMPRESSED_READ_1D         Subr   1032                                          PRIV             1032,1033                         
 COMP_DOMAIN                Local  788      I(4)            4     1     4                         788,860,862,863,868,1065,1067,1068
                                                                                                  ,1090,1091,1092,1093,1096         
 CURR_POSITION              Local  786      I(4)            4           scalar                    845,850,855,857,866,867,868,870,87
                                                                                                  2,889,890,892,893,894,897,898,927,
                                                                                                  929,942,944,949,950,951,956,957,96
                                                                                                  0,962,969,970,996,1001,1015,1016,1
                                                                                                  017,1018,1064,1065,1070,1071,1072,
                                                                                                  1073,1074,1080,1084,1095,1112,1133
                                                                                                  ,1134,1135,1138,1139,1140,1143,120
                                                                                                  9,1213,1225,1230,1248,1252,1261,12
                                                                                                  66                                
 DATA                       Dummy  759      R(8)            8     3     1        ARG,INOUT        833,881,883,885,889,890,1076,1148,
                                                                                                  1150,1157,1158,1159,1160,1161,1162
                                                                                                  ,1169,1173,1178,1182,1183,1184,118
                                                                                                  8,1192,1197,1201,1208,1212,1216,12
                                                                                                  17,1218,1221,1224,1229,1235,1237,1
                                                                                                  239,1247,1251,1255,1257,1260,1265,
                                                                                                  1271                              
 DATA_FILE_IS_2D            Local  783      L(4)            4           scalar                    783,1147,1148,1167,1205           
 DATA_INDEX                 Dummy  759      I(4)            4           scalar   ARG,IN           812,813                           
 DATA_OVERRIDE_3D           Subr   759                                           PRIV             723,1472                          
 DEG_TO_RADIAN              Param  969      R(8)            8           scalar                    969,970                           
 DIMS                       Local  773      I(4)            4     1     4                         921,925,927,935,940,942,1064,1148,
                                                                                                  1150                              
 DOMAIN                     Local  785      DOMAIN2D        752         scalar                    860,861,910,912,919,923,932,937   
 ENDINGI                    Local  800      I(4)            4           scalar                    1161,1178,1197                    
 ENDINGJ                    Local  802      I(4)            4           scalar                    1162,1178,1197                    
 EXISTS                     Local  797      L(4)            4           scalar                    907,908                           
 FACTOR                     Local  787      R(8)            8           scalar                    830,833,1182,1201,1216,1235,1255,1
                                                                                                  271                               
 FIELDNAME                  Local  771      CHAR            128         scalar                    829,832,919,923,932,937           
 FIELDNAME_CODE             Dummy  759      CHAR                        scalar   ARG,IN           818,824,849,866                   
 FILENAME                   Local  769      CHAR            512         scalar                    837,838,907,910,912,914,919,923,93
                                                                                                  2,937,959,965                     
 FILENAME2                  Local  770      CHAR            512         scalar                    910,912,914                       
 FILEOBJ                    Local  798      FMSNETCDFFILE_T 872         scalar                    959,960,962,1032,1033             

Page 36          Source Listing                  DATA_OVERRIDE_3D
2021-06-01 08:55 Symbol Table                    data_override.F90

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 GET_AXIS_BOUNDS            Subr   953                                           PRIV             66,953,954                        
 GET_EXTERNAL_FIELD_SIZE_CL                                                                                                         
 ASSIC                      Func   921      I(4)            4     1     4        PRIV             921,935                           
 GET_EXTERNAL_FIELD_SIZE_FM                                                                                                         
 S2IO                       Func   925      I(4)            4     1     4        PRIV             925,940                           
 GET_EXTERNAL_FILEOBJ       Func   959      L(4)            4           scalar   PRIV             64,959                            
 GET_MOSAIC_TILE_FILE_CLASS                                                                                                         
 IC                         Local  910                                  scalar   PRIV             910                               
 GET_MOSAIC_TILE_FILE_FMS2_                                                                                                         
 IO                         Local  912                                  scalar   PRIV             912                               
 GET_MOSAIC_TILE_FILE_SG    Subr   910                                           PRIV             910                               
 GET_MOSAIC_TILE_FILE_SG    Subr   912                                           PRIV             912                               
 GRIDNAME                   Dummy  759      CHAR            3           scalar   ARG,IN           817,848,860,867,976,1118          
 HORIZ_INTERP_NEW           Local  1133                                 scalar   PRIV             49,1133,1138                      
 HORIZ_INTERP_NEW_1D_SRC    Subr   1133                                          PRIV             1133,1138                         
 I                          Local  772      I(4)            4           scalar                    816,817,818,819,847,848,849,850,11
                                                                                                  83,1184,1217,1218,1237,1239       
 ID_TIME                    Local  775      I(4)            4           scalar                    919,921,923,925,928,929,932,935,93
                                                                                                  7,940,943,944,1020,1022,1055,1057,
                                                                                                  1080,1169,1173,1178,1188,1192,1197
                                                                                                  ,1208,1212,1224,1229,1247,1251,126
                                                                                                  0,1265                            
 IEND                       Local  791      I(4)            4           scalar                    1046,1051,1055,1057               
 IEW                        Local  792      I(4)            4           scalar                    1091,1103,1136,1141               
 IE_IN                      Dummy  759      I(4)            4           scalar   ARG,IN           1103,1170,1174,1179,1189,1193,1198
                                                                                                  ,1210,1214,1227,1232,1249,1253,126
                                                                                                  3,1268                            
 IE_SRC                     Local  796      I(4)            4           scalar                    992,1016,1020,1022,1071,1134,1139 
 INDEX1                     Local  774      I(4)            4           scalar                    813,815,819,822,829,830,837,841,90
                                                                                                  2,1007,1026,1037,1039,1041,1043,10
                                                                                                  45,1046,1047,1048,1055,1057,1131,1
                                                                                                  206,1245                          
 INIT_EXTERNAL_FIELD_CLASSI                                                                                                         
 C                          Func   919      I(4)            4           scalar   PRIV             919,932,1379                      
 INIT_EXTERNAL_FIELD_FMS2IO Func   923      I(4)            4           scalar   PRIV             923,937,1381                      
 IPOS                       Local  790      I(4)            4           scalar                    1098,1101                         
 ISTART                     Local  791      I(4)            4           scalar                    1045,1050,1055,1057               
 ISW                        Local  792      I(4)            4           scalar                    1090,1102,1103,1136,1141          
 IS_IN                      Dummy  759      I(4)            4           scalar   ARG,IN           1085,1098,1102,1103,1170,1174,1179
                                                                                                  ,1189,1193,1198,1210,1214,1227,123
                                                                                                  2,1249,1253,1263,1268             
 IS_SRC                     Local  796      I(4)            4           scalar                    991,1015,1020,1022,1050,1051,1070,
                                                                                                  1134,1139                         
 J                          Local  772      I(4)            4           scalar                    995,996,997,999,1000,1001         
 JEND                       Local  791      I(4)            4           scalar                    1048,1053,1055,1057               
 JEW                        Local  792      I(4)            4           scalar                    1093,1105,1136,1141               
 JE_IN                      Dummy  759      I(4)            4           scalar   ARG,IN           1105,1170,1174,1179,1189,1193,1198
                                                                                                  ,1210,1214,1227,1232,1249,1253,126
                                                                                                  3,1268                            
 JE_SRC                     Local  796      I(4)            4           scalar                    994,1000,1010,1013,1018,1020,1022,
                                                                                                  1073,1135,1140                    
 JPOS                       Local  790      I(4)            4           scalar                    1099,1101                         
 JSTART                     Local  791      I(4)            4           scalar                    1047,1052,1055,1057               
 JSW                        Local  792      I(4)            4           scalar                    1092,1104,1105,1136,1141          
 JS_IN                      Dummy  759      I(4)            4           scalar   ARG,IN           1099,1104,1105,1170,1174,1179,1189

Page 37          Source Listing                  DATA_OVERRIDE_3D
2021-06-01 08:55 Symbol Table                    data_override.F90

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
                                                                                                  ,1193,1198,1210,1214,1227,1232,124
                                                                                                  9,1253,1263,1268                  
 JS_SRC                     Local  796      I(4)            4           scalar                    993,997,1009,1012,1017,1020,1022,1
                                                                                                  052,1053,1072,1135,1140           
 LAT_LOCAL                  Local  780      R(8)            8     2     1        PTR              780,978,980,982,984,989,990,1120,1
                                                                                                  122,1124,1126,1136,1141           
 LAT_MAX                    Local  795      R(8)            8           scalar                    990,1001                          
 LAT_MIN                    Local  795      R(8)            8           scalar                    989,996                           
 LAT_TMP                    Local  781      R(8)            8     1     1        ALC              1027,1030,1033,1041,1043,1047,1048
                                                                                                  ,1059                             
 LBOUND                     Func   1159                                 scalar                    1159,1160                         
 LON_LOCAL                  Local  779      R(8)            8     2     1        PTR              779,978,980,982,984,1120,1122,1124
                                                                                                  ,1126,1136,1141                   
 LON_TMP                    Local  781      R(8)            8     1     1        ALC              1027,1029,1032,1037,1039,1045,1046
                                                                                                  ,1059                             
 MASK_OUT                   Local  767      L(4)            4     3     1        ALC              1221,1222,1226,1231,1234,1238,1242
                                                                                                  ,1257,1258,1262,1267,1270,1273    
 MAX                        Func   1009                                 scalar                    1009,1012                         
 MAXVAL                     Func   990                                  scalar                    990                               
 MIN                        Func   1010                                 scalar                    1010,1013                         
 MINVAL                     Func   989                                  scalar                    989                               
 MOD                        Func   883                                  scalar                    883,894                           
 MPP_GET_AXIS_DATA          Subr   956                                           PRIV             46,956,957,1029,1030              
 MPP_GET_DATA_DOMAIN        Local  861                                  scalar   PRIV             70,861                            
 MPP_GET_DATA_DOMAIN2D      Subr   861                                           PRIV             861                               
 N                          Local  792      I(4)            4           scalar                                                      
 NEAREST_INDEX              Func   1045     I(4)            4           scalar   PRIV             67,1045,1046,1047,1048            
 NEED_COMPUTE               Local  794      L(4)            4           scalar                    1109,1112,1117                    
 NHALOX                     Local  803      I(4)            4           scalar                    1157,1159,1161                    
 NHALOY                     Local  804      I(4)            4           scalar                    1158,1160,1162                    
 NULL                       Func   779                                  scalar   PTR              779,780                           
 NUM_FIELDS                 Local  846      I(4)            4           scalar                    154,846,847,856,857,1363,1364,1373
                                                                                                  ,1374                             
 NWINDOWS                   Local  789      I(4)            4           scalar                    880,885,893,894,897,920,924,934,93
                                                                                                  9,949                             
 NWINDOWS_X                 Local  790      I(4)            4           scalar                    1097,1101                         
 NXC                        Local  789      I(4)            4           scalar                    862,883,885,1067,1096,1097,1157   
 NXD                        Local  789      I(4)            4           scalar                    861,881                           
 NYC                        Local  789      I(4)            4           scalar                    863,883,885,1068,1158             
 NYD                        Local  789      I(4)            4           scalar                    861,881                           
 OMP_GET_NUM_THREADS        Func   793      I(4)            4           scalar                    872                               
 OMP_GET_THREAD_NUM         Local  793      I(4)            4           scalar                                                      
 ONGRID                     Local  784      L(4)            4           scalar                    841,901,924,1108,1153             
 OVERRIDE                   Dummy  759      L(4)            4           scalar   ARG,OUT          811,834,1279                      
 PRESENT                    Func   811                                  scalar                    811,812,834,1085,1279             
 READ_DATA                  Local  1032                                 scalar   PRIV             74,1032,1033                      
 REPRODUCE_NULL_CHAR_BUG    Local  961      L(4)            4           scalar                    164,169,961,963                   
 RESET_SRC_DATA_REGION_CLAS                                                                                                         
 SIC                        Subr   1020                                          PRIV             1020                              
 RESET_SRC_DATA_REGION_FMS2                                                                                                         
 IO                         Subr   1022                                          PRIV             1022                              
 SET_OVERRIDE_REGION_CLASSI                                                                                                         
 C                          Subr   1055                                          PRIV             1055                              
 SET_OVERRIDE_REGION_FMS2IO Subr   1057                                          PRIV             1057                              
 SIZE                       Func   881                                  scalar                    881,883,885,889,890,1076,1148,1150

Page 38          Source Listing                  DATA_OVERRIDE_3D
2021-06-01 08:55 Symbol Table                    data_override.F90

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
                                                                                                  ,1157,1158,1183,1217,1221,1237,125
                                                                                                  7                                 
 STARTINGI                  Local  799      I(4)            4           scalar                    1159,1178,1197                    
 STARTINGJ                  Local  801      I(4)            4           scalar                    1160,1178,1197                    
 THREAD_ID                  Local  793      I(4)            4           scalar                                                      
 TIME                       Dummy  759      TIME_TYPE       16          scalar   ARG,IN           1169,1173,1178,1188,1192,1197,1208
                                                                                                  ,1212,1224,1229,1247,1251,1260,126
                                                                                                  5                                 
 TIME_INTERP_EXTERNAL_2D    Subr   1169                                          PRIV             1169,1208,1224                    
 TIME_INTERP_EXTERNAL_2D    Subr   1173                                          PRIV             1173,1178,1212,1229               
 TIME_INTERP_EXTERNAL_3D    Subr   1188                                          PRIV             1188,1247,1260                    
 TIME_INTERP_EXTERNAL_3D    Subr   1192                                          PRIV             1192,1197,1251,1265               
 TIME_INTERP_EXTERNAL_CLASS                                                                                                         
 IC                         Local  1169                                 scalar   PRIV             1169,1188,1208,1224,1247,1260,1392
 TIME_INTERP_EXTERNAL_FMS2I                                                                                                         
 O                          Local  1173                                 scalar   PRIV             1173,1178,1192,1197,1212,1229,1251
                                                                                                  ,1265,1394                        
 TRIM                       Func   817                                  scalar                    817,818,824,848,849,907,965       
 UBOUND                     Func   1161                                 scalar                    1161,1162                         
 USE_COMP_DOMAIN            Local  784      L(4)            4           scalar                    806,882,884,920,924,933,938,1155,1
                                                                                                  172,1191                          
 WINDOW_ID                  Local  793      I(4)            4           scalar                    1094,1101,1112,1133,1138,1143,1170
                                                                                                  ,1174,1179,1189,1193,1198,1209,121
                                                                                                  0,1213,1214,1225,1227,1230,1232,12
                                                                                                  48,1249,1252,1253,1261,1263,1266,1
                                                                                                  268                               
 WINDOW_SIZE                Local  790      I(4)            4     1     2                         892,1074,1076,1097,1098,1099      


TYPE COMPONENTS/COMMON VARIABLES

 Name                       Type            Bytes Offset   Dimen Elements Attributes       References                         
                                                                                                                              
 OVERRIDE_TYPE.HORZ_INTERP  RECORD          2208  136      1     1        ALC              949,1133,1138,1209,1213,1225,1230, 
                                                                                           1248,1252,1261,1266                
 OVERRIDE_TYPE.IE_SRC       I(4)            4     480            scalar                    1016,1071                          
 OVERRIDE_TYPE.IS_SRC       I(4)            4     476            scalar                    1015,1070                          
 OVERRIDE_TYPE.JE_SRC       I(4)            4     488            scalar                    1018,1073                          
 OVERRIDE_TYPE.JS_SRC       I(4)            4     484            scalar                    1017,1072                          
 OVERRIDE_TYPE.LAT_IN       R(8)            8     320      1     1        ALC              951,957,962,970,996,1001,1135,1140 
 OVERRIDE_TYPE.LON_IN       R(8)            8     248      1     1        ALC              950,956,960,969,1134,1139          
 OVERRIDE_TYPE.NEED_COMPUTE L(4)            4     392      1     1        ALC              897,898,1112,1143                  
 OVERRIDE_TYPE.NUMTHREADS   I(4)            4     240            scalar                    870,872,894                        
 OVERRIDE_TYPE.NUMWINDOWS   I(4)            4     464            scalar                    893,1084,1095                      
 OVERRIDE_TYPE.WINDOW_SIZE  I(4)            4     468      1     2                         889,890,892,1074                   

Page 39          Source Listing                  DATA_OVERRIDE_3D
2021-06-01 08:55                                 data_override.F90

   1282 ! </SUBROUTINE>
   1283 
   1284 ! <SUBROUTINE NAME="data_override_0d">
   1285 !   <DESCRIPTION>
   1286 ! This routine performs data override for scalar fields
   1287 !   <TEMPLATE>
   1288 ! call data_override(fieldname,data,time,override)
   1289 !   </TEMPLATE>
   1290 !   </DESCRIPTION>
   1291 !   <IN NAME="gridname"  TYPE="character" DIM="(*)">
   1292 ! Grid name (Ocean, Ice, Atmosphere, Land)
   1293 !   </IN>
   1294 !   <IN NAME="fieldname_code" TYPE="character" DIM="(*)">
   1295 !    Field name as used in the code (may be different from the name in NetCDF data file)
   1296 !   </IN>
   1297 !   <OUT NAME="data" TYPE="real" DIM="(:,:,:)">
   1298 !    array containing output data
   1299 !   </OUT>
   1300 !   <IN NAME="time" TYPE="time_type">
   1301 !    model time
   1302 !   </IN>
   1303 !   <OUT NAME="override" TYPE="logical">
   1304 !    TRUE if the field is overriden, FALSE otherwise
   1305 !   </OUT>
   1306 !   <IN NAME="data_index" TYPE="integer">
   1307 !   </IN>
   1308 
   1309 !> @brief This routine performs data override for scalar fields
   1310 subroutine data_override_0d(gridname,fieldname_code,data,time,override,data_index)
   1311   character(len=3), intent(in) :: gridname !< model grid ID
   1312   character(len=*), intent(in) :: fieldname_code !< field name as used in the model
   1313   logical, intent(out), optional :: override !< true if the field has been overriden succesfully
   1314   type(time_type), intent(in) :: time !< (target) model time
   1315   real,             intent(out) :: data !< data returned by this call
   1316   integer, intent(in), optional :: data_index
   1317 
   1318   character(len=512) :: filename !< file containing source data
   1319   character(len=128) :: fieldname !< fieldname used in the data file
   1320   integer :: index1 !< field index in data_table
   1321   integer :: id_time !< index for time interp in override array
   1322   integer :: curr_position !< position of the field currently processed in override_array
   1323   integer :: i
   1324   real :: factor
   1325 
   1326   if(.not.module_is_initialized) &
   1327        call mpp_error(FATAL,'Error: need to call data_override_init first')
   1328 
   1329 !1  Look  for the data file in data_table
   1330   if(PRESENT(override)) override = .false.
   1331   if (present(data_index)) then
   1332     index1 = data_index
   1333   else
   1334     index1 = -1
   1335     do i = 1, table_size
   1336        if( trim(gridname) /= trim(data_table(i)%gridname)) cycle
   1337        if( trim(fieldname_code) /= trim(data_table(i)%fieldname_code)) cycle
   1338        index1 = i                               ! field found

Page 40          Source Listing                  DATA_OVERRIDE_0D
2021-06-01 08:55                                 data_override.F90

   1339        exit
   1340     enddo
   1341     if(index1 .eq. -1) then
   1342        if(debug_data_override) &
   1343          call mpp_error(WARNING,'this field is NOT found in data_table: '//trim(fieldname_code))
   1344        return  ! NO override was performed
   1345     endif
   1346   endif
   1347 
   1348   fieldname = data_table(index1)%fieldname_file ! fieldname in netCDF data file
   1349   factor = data_table(index1)%factor
   1350 
   1351   if(fieldname == "") then
   1352      data = factor
   1353      if(PRESENT(override)) override = .true.
   1354      return
   1355   else
   1356      filename = data_table(index1)%file_name
   1357      if (filename == "") call mpp_error(FATAL,'data_override: filename not given in data_table')
   1358   endif
   1359 
   1360 !3 Check if fieldname has been previously processed
   1361 !$OMP SINGLE
   1362   curr_position = -1
   1363   if(num_fields > 0 ) then
   1364      do i = 1, num_fields
   1365         if(trim(override_array(i)%gridname) /= trim(gridname))   cycle
   1366         if(trim(override_array(i)%fieldname) /= trim(fieldname_code)) cycle
   1367         curr_position = i
   1368         exit
   1369      enddo
   1370   endif
   1371 
   1372   if(curr_position < 0) then ! the field has not been processed previously
   1373      num_fields = num_fields + 1
   1374      curr_position = num_fields
   1375 ! record fieldname, gridname in override_array
   1376      override_array(curr_position)%fieldname = fieldname_code
   1377      override_array(curr_position)%gridname = gridname
   1378      if (use_mpp_bug) then
   1379        id_time = init_external_field_classic(filename,fieldname,verbose=.false.)
   1380      else
   1381        id_time = init_external_field_fms2io(filename,fieldname,verbose=.false.)
   1382      end if
   1383      if(id_time<0) call mpp_error(FATAL,'data_override:field not found in init_external_field 1')
   1384      override_array(curr_position)%t_index = id_time
   1385   else !curr_position >0
   1386 !9 Get id_time  previously stored in override_array
   1387      id_time = override_array(curr_position)%t_index
   1388   endif !if curr_position < 0
   1389 
   1390 !10 do time interp to get data in compute_domain
   1391   if (use_mpp_bug) then
   1392     call time_interp_external_classic(id_time, time, data, verbose=.false.)
   1393   else
   1394     call time_interp_external_fms2io(id_time, time, data, verbose=.false.)
   1395   end if

Page 41          Source Listing                  DATA_OVERRIDE_0D
2021-06-01 08:55                                 data_override.F90

   1396   data = data*factor
   1397 !$OMP END SINGLE
   1398 
   1399   if(PRESENT(override)) override = .true.
   1400 
   1401 end subroutine data_override_0d


ENTRY POINTS

  Name                                              
                                                    
 data_override_mod_mp_data_override_0d_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 CURR_POSITION              Local  1322     I(4)            4           scalar                    1362,1367,1372,1374,1376,1377,1384
                                                                                                  ,1387                             
 DATA                       Dummy  1310     R(8)            8           scalar   ARG,OUT          1352,1392,1394,1396               
 DATA_INDEX                 Dummy  1310     I(4)            4           scalar   ARG,IN           1331,1332                         
 DATA_OVERRIDE_0D           Subr   1310                                          PRIV                                               
 FACTOR                     Local  1324     R(8)            8           scalar                    1349,1352,1396                    
 FIELDNAME                  Local  1319     CHAR            128         scalar                    1348,1351,1379,1381               
 FIELDNAME_CODE             Dummy  1310     CHAR                        scalar   ARG,IN           1337,1343,1366,1376               
 FILENAME                   Local  1318     CHAR            512         scalar                    1356,1357,1379,1381               
 GRIDNAME                   Dummy  1310     CHAR            3           scalar   ARG,IN           1336,1365,1377                    
 I                          Local  1323     I(4)            4           scalar                    1335,1336,1337,1338,1364,1365,1366
                                                                                                  ,1367                             
 ID_TIME                    Local  1321     I(4)            4           scalar                    1379,1381,1383,1384,1387,1392,1394
 INDEX1                     Local  1320     I(4)            4           scalar                    1332,1334,1338,1341,1348,1349,1356
 OVERRIDE                   Dummy  1310     L(4)            4           scalar   ARG,OUT          1330,1353,1399                    
 PRESENT                    Func   1330                                 scalar                    1330,1331,1353,1399               
 TIME                       Dummy  1310     TIME_TYPE       16          scalar   ARG,IN           1392,1394                         
 TIME_INTERP_EXTERNAL_0D    Subr   1392                                          PRIV             1392                              
 TIME_INTERP_EXTERNAL_0D    Subr   1394                                          PRIV             1394                              
 TRIM                       Func   1336                                 scalar                    1336,1337,1343,1365,1366          

Page 42          Source Listing                  DATA_OVERRIDE_0D
2021-06-01 08:55                                 data_override.F90

   1402 ! </SUBROUTINE>
   1403 
   1404 subroutine data_override_UG_1d(gridname,fieldname,data,time,override)
   1405   character(len=3),   intent(in) :: gridname !< model grid ID
   1406   character(len=*),   intent(in) :: fieldname !< field to override
   1407   real, dimension(:), intent(inout) :: data !< data returned by this call
   1408   type(time_type),    intent(in) :: time !<  model time
   1409   logical, intent(out), optional :: override !< true if the field has been overriden succesfully
   1410 !local vars
   1411   real, dimension(:,:), allocatable ::  data_SG
   1412   type(domainUG) :: UG_domain
   1413   integer       :: index1
   1414   integer       :: i
   1415   integer, dimension(4) :: comp_domain = 0  !< istart,iend,jstart,jend for compute domain
   1416 
   1417 !1  Look  for the data file in data_table
   1418   if(PRESENT(override)) override = .false.
   1419   index1 = -1
   1420   do i = 1, table_size
   1421      if( trim(gridname) /= trim(data_table(i)%gridname)) cycle
   1422      if( trim(fieldname) /= trim(data_table(i)%fieldname_code)) cycle
   1423      index1 = i                               ! field found
   1424      exit
   1425   enddo
   1426   if(index1 .eq. -1) return  ! NO override was performed
   1427 
   1428   call get_domainUG(gridname,UG_domain,comp_domain)
   1429   allocate(data_SG(comp_domain(1):comp_domain(2),comp_domain(3):comp_domain(4)))
   1430 
   1431   call data_override_2d(gridname,fieldname,data_SG,time,override)
   1432 
   1433   call mpp_pass_SG_to_UG(UG_domain, data_SG(:,:), data(:))
   1434 
   1435   deallocate(data_SG)
   1436 
   1437 end subroutine data_override_UG_1d

Page 43          Source Listing                  DATA_OVERRIDE_UG_1D
2021-06-01 08:55 Entry Points                    data_override.F90



ENTRY POINTS

  Name                                                 
                                                       
 data_override_mod_mp_data_override_ug_1d_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 COMP_DOMAIN                Local  1415     I(4)            4     1     4                         1415,1428,1429                    
 DATA                       Dummy  1404     R(8)            8     1     1        ARG,INOUT        1433                              
 DATA_OVERRIDE_UG_1D        Subr   1404                                          PRIV                                               
 DATA_SG                    Local  1411     R(8)            8     2     1        ALC              1429,1431,1433,1435               
 FIELDNAME                  Dummy  1404     CHAR                        scalar   ARG,IN           1422,1431                         
 GRIDNAME                   Dummy  1404     CHAR            3           scalar   ARG,IN           1421,1428,1431                    
 I                          Local  1414     I(4)            4           scalar                    1420,1421,1422,1423               
 INDEX1                     Local  1413     I(4)            4           scalar                    1419,1423,1426                    
 MPP_PASS_SG_TO_UG          Local  1433                                 scalar   PRIV             71,1433,1474                      
 MPP_PASS_SG_TO_UG_R8_2D    Subr   1433                                          PRIV             1433                              
 OVERRIDE                   Dummy  1404     L(4)            4           scalar   ARG,OUT          1418,1431                         
 PRESENT                    Func   1418                                 scalar                    1418                              
 TIME                       Dummy  1404     TIME_TYPE       16          scalar   ARG,IN           1431                              
 TRIM                       Func   1421                                 scalar                    1421,1422                         
 UG_DOMAIN                  Local  1412     DOMAINUG        544         scalar                    1428,1433                         

Page 44          Source Listing                  DATA_OVERRIDE_UG_1D
2021-06-01 08:55                                 data_override.F90

   1438 
   1439 subroutine data_override_UG_2d(gridname,fieldname,data,time,override)
   1440   character(len=3),     intent(in) :: gridname !< model grid ID
   1441   character(len=*),     intent(in) :: fieldname !< field to override
   1442   real, dimension(:,:), intent(inout) :: data !< data returned by this call
   1443   type(time_type),      intent(in) :: time !<  model time
   1444   logical, intent(out), optional :: override !< true if the field has been overriden succesfully
   1445 !local vars
   1446   real, dimension(:,:,:), allocatable ::  data_SG
   1447   real, dimension(:,:),   allocatable ::  data_UG
   1448   type(domainUG) :: UG_domain
   1449   integer       :: index1
   1450   integer       :: i, nlevel, nlevel_max
   1451   integer, dimension(4) :: comp_domain = 0  !< istart,iend,jstart,jend for compute domain
   1452 
   1453 !1  Look  for the data file in data_table
   1454   if(PRESENT(override)) override = .false.
   1455   index1 = -1
   1456   do i = 1, table_size
   1457      if( trim(gridname) /= trim(data_table(i)%gridname)) cycle
   1458      if( trim(fieldname) /= trim(data_table(i)%fieldname_code)) cycle
   1459      index1 = i                               ! field found
   1460      exit
   1461   enddo
   1462   if(index1 .eq. -1) return  ! NO override was performed
   1463 
   1464   nlevel = size(data,2)
   1465   nlevel_max = nlevel
   1466   call mpp_max(nlevel_max)
   1467 
   1468   call get_domainUG(gridname,UG_domain,comp_domain)
   1469   allocate(data_SG(comp_domain(1):comp_domain(2),comp_domain(3):comp_domain(4),nlevel_max))
   1470   allocate(data_UG(size(data,1), nlevel_max))
   1471   data_SG = 0.0
   1472   call data_override_3d(gridname,fieldname,data_SG,time,override)
   1473 
   1474   call mpp_pass_SG_to_UG(UG_domain, data_SG(:,:,:), data_UG(:,:))
   1475   data(:,1:nlevel) = data_UG(:,1:nlevel)
   1476 
   1477   deallocate(data_SG, data_UG)
   1478 
   1479 end subroutine data_override_UG_2d

Page 45          Source Listing                  DATA_OVERRIDE_UG_2D
2021-06-01 08:55 Entry Points                    data_override.F90



ENTRY POINTS

  Name                                                 
                                                       
 data_override_mod_mp_data_override_ug_2d_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 COMP_DOMAIN                Local  1451     I(4)            4     1     4                         1451,1468,1469                    
 DATA                       Dummy  1439     R(8)            8     2     1        ARG,INOUT        1464,1470,1475                    
 DATA_OVERRIDE_UG_2D        Subr   1439                                          PRIV                                               
 DATA_SG                    Local  1446     R(8)            8     3     1        ALC              1469,1471,1472,1474,1477          
 DATA_UG                    Local  1447     R(8)            8     2     1        ALC              1470,1474,1475,1477               
 FIELDNAME                  Dummy  1439     CHAR                        scalar   ARG,IN           1458,1472                         
 GRIDNAME                   Dummy  1439     CHAR            3           scalar   ARG,IN           1457,1468,1472                    
 I                          Local  1450     I(4)            4           scalar                    1456,1457,1458,1459               
 INDEX1                     Local  1449     I(4)            4           scalar                    1455,1459,1462                    
 MPP_MAX                    Local  1466                                 scalar   PRIV             47,1466                           
 MPP_MAX_INT4_0D            Subr   1466                                          PRIV             1466                              
 MPP_PASS_SG_TO_UG_R8_3D    Subr   1474                                          PRIV             1474                              
 NLEVEL                     Local  1450     I(4)            4           scalar                    1464,1465,1475                    
 NLEVEL_MAX                 Local  1450     I(4)            4           scalar                    1465,1466,1469,1470               
 OVERRIDE                   Dummy  1439     L(4)            4           scalar   ARG,OUT          1454,1472                         
 PRESENT                    Func   1454                                 scalar                    1454                              
 SIZE                       Func   1464                                 scalar                    1464,1470                         
 TIME                       Dummy  1439     TIME_TYPE       16          scalar   ARG,IN           1472                              
 TRIM                       Func   1457                                 scalar                    1457,1458                         
 UG_DOMAIN                  Local  1448     DOMAINUG        544         scalar                    1468,1474                         

Page 46          Source Listing                  DATA_OVERRIDE_UG_2D
2021-06-01 08:55                                 data_override.F90

   1480 
   1481 end module data_override_mod


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 AXIS_UTILS2_MOD            Module 67                                                             67                                
 AXIS_UTILS_MOD             Module 66                                                             66                                
 Assignment (=)                    50                                                                                               
 CONSTANTS_MOD              Module 45                                                             45                                
 COUNT_NE_1@0               Local  186      L(4)            4           scalar                                                      
 DATA_OVERRIDE              Local  171                                  scalar                    182                               
 DATA_OVERRIDE_INIT         Subr   182                                                            182                               
 DATA_OVERRIDE_MOD          Module 44                                                                                               
 DATA_OVERRIDE_UG           Local  177                                  scalar                    183                               
 DATA_OVERRIDE_UNSET_DOMAIN                                                                                                         
 S                          Subr   182                                                            182                               
 FMS2_IO_MOD                Module 73                                                             73                                
 FMS_IO_MOD                 Module 68                                                             68                                
 FMS_MOD                    Module 65                                                             65                                
 GET_GRID_VERSION_FMS2IO_MO                                                                                                         
 D                          Module 77                                                             77                                
 GET_GRID_VERSION_MPP_MOD   Module 76                                                             76                                
 HORIZ_INTERP_MOD           Module 49                                                             49                                
 HORIZ_INTERP_TYPE          Type   49                                   scalar   PRIV             49,126                            
 MPP_DOMAINS_MOD            Module 69                                                             69,70,71                          
 MPP_GET_GLOBAL_DOMAIN      Local  70                                   scalar   PRIV             70                                
 MPP_IO_MOD                 Module 46                                                             46                                
 MPP_MOD                    Module 47                                                             47,48                             
 OVERRIDE_TYPE              Type   122                      496         scalar                    136,157,158                       
 PI                         Param  45       R(8)            8           scalar   PRIV             45,139                            
 TIME_INTERP_EXTERNAL2_MOD  Module 57                                                             57                                
 TIME_INTERP_EXTERNAL_MOD   Module 51                                                             51                                
 TIME_MANAGER_MOD           Module 72                                                             72                                

Page 47          Source Listing                  DATA_OVERRIDE_UG_2D
2021-06-01 08:55 Subprograms/Common Blocks       data_override.F90



SUBPROGRAMS/COMMON BLOCKS

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 COUNT_NE_1                 Func   186      L(4)            4           scalar                    190,454,467                       
 DATA_OVERRIDE_0D           Subr   1310                                          PRIV                                               
 DATA_OVERRIDE_2D           Subr   698                                           PRIV             1431                              
 DATA_OVERRIDE_3D           Subr   759                                           PRIV             723,1472                          
 DATA_OVERRIDE_INIT         Subr   217                                                                                              
 DATA_OVERRIDE_MOD          Module 44                                                                                               
 DATA_OVERRIDE_UG_1D        Subr   1404                                          PRIV                                               
 DATA_OVERRIDE_UG_2D        Subr   1439                                          PRIV                                               
 DATA_OVERRIDE_UNSET_DOMAIN                                                                                                         
 S                          Subr   591                                                                                              
 GET_DOMAIN                 Subr   646                                                            860                               
 GET_DOMAINUG               Subr   671                                                            1428,1468                         

COMPILER OPTIONS BEING USED

       -align noall                          -align nonone
       -align nocommons                      -align nodcommons
       -align noqcommons                     -align nozcommons
       -align records                        -align nosequence
       -align norec1byte                     -align norec2byte
       -align norec4byte                     -align norec8byte
       -align norec16byte                    -align norec32byte
       -align norec64byte                    -align noarray8byte
       -align noarray16byte                  -align noarray32byte
       -align noarray64byte                  -align noarray128byte
       -align noarray256byte                 -altparam
       -assume accuracy_sensitive            -assume nobscc
       -assume nobuffered_io                 -assume nobuffered_stdout
       -assume byterecl                      -assume nocontiguous_assumed_shape
       -assume nocontiguous_pointer          -assume cc_omp
       -assume nocstring                     -assume nodummy_aliases
       -assume nofpe_summary                 -assume noieee_fpe_flags
       -assume nominus0                      -assume noold_boz
       -assume old_complex_align             -assume old_unit_star
       -assume old_inquire_recl              -assume old_ldout_format
       -assume old_ldout_zero                -assume noold_logical_assign
       -assume noold_logical_ldio            -assume old_maxminloc
       -assume old_xor                       -assume noprotect_allocates
       -assume protect_constants             -assume noprotect_parens
       -assume split_common                  -assume source_include
       -assume nostd_intent_in               -assume std_minus0_rounding
       -assume nostd_mod_proc_name           -assume std_value
       -assume realloc_lhs                   -assume underscore
       -assume no2underscores                -assume norecursion
       -auto                            no   -auto_scalar
  no   -bintext                              -ccdefault default
       -check noarg_temp_created             -check noassume
       -check nobounds                       -check nocontiguous
       -check noformat                       -check nooutput_conversion
       -check nooverflow                     -check nopointers
       -check noshape                        -check nostack

Page 48          Source Listing                  DATA_OVERRIDE_UG_2D
2021-06-01 08:55                                 data_override.F90

       -check nouninitialized                -check noudio_iostat
       -coarray-num-procs 0             no   -coarray-config-file
       -convert native                       -cross_reference
       -D __INTEL_COMPILER=1910              -D __INTEL_COMPILER_UPDATE=0
       -D __unix__                           -D __unix
       -D __linux__                          -D __linux
       -D __gnu_linux__                      -D unix
       -D linux                              -D __ELF__
       -D __x86_64                           -D __x86_64__
       -D __amd64                            -D __amd64__
       -D __INTEL_COMPILER_BUILD_DATE=20191121       -D _OPENMP=201611
       -D __INTEL_OFFLOAD                    -D __MMX__
       -D __SSE__                            -D __SSE_MATH__
       -D __SSE2__                           -D __SSE2_MATH__
       -D __pentium4                         -D __pentium4__
       -D __tune_pentium4__                  -D PACKAGE_NAME='"GFDL FMS Library"'
       -D PACKAGE_TARNAME='"FMS"'            -D PACKAGE_VERSION='"2021.02.0"'
       -D PACKAGE_STRING='"GFDL FMS Library 2021.02.0"'       -D PACKAGE_BUGREPORT='"gfdl.climate.model.info@noaa.gov"'
       -D PACKAGE_URL='"https://www.gfdl.noaa.gov/fms"'       -D PACKAGE='"FMS"'
       -D VERSION='"2021.02.0"'              -D STDC_HEADERS=1
       -D HAVE_SYS_TYPES_H=1                 -D HAVE_SYS_STAT_H=1
       -D HAVE_STDLIB_H=1                    -D HAVE_STRING_H=1
       -D HAVE_MEMORY_H=1                    -D HAVE_STRINGS_H=1
       -D HAVE_INTTYPES_H=1                  -D HAVE_STDINT_H=1
       -D HAVE_UNISTD_H=1                    -D HAVE_DLFCN_H=1
       -D LT_OBJDIR='".libs/"'               -D HAVE_MPI_H=1
       -D HAVE_NETCDF_H=1                    -D HAVE_SCHED_GETAFFINITY=1
       -D HAVE_MOD_MPI=1                     -D HAVE_MOD_NETCDF=1
       -D HAVE_CRAY_POINTER=1                -D HAVE_QUAD_PRECISION=1
       -D HAVE_INTERNAL_NML=1                -D use_netCDF=1
       -D use_libMPI=1                       -D INTERNAL_FILE_NML
       -double_size 64                  no   -d_lines
  no   -Qdyncom                              -error_limit 30
  no   -f66                             no   -f77rtl
  no   -fast                                 -fpscomp nofilesfromcmd
       -fpscomp nogeneral                    -fpscomp noioformat
       -fpscomp noldio_spacing               -fpscomp nologicals
  no   -fpconstant                           -fpe3
       -fprm nearest                         -ftz
       -fp_model noprecise                   -fp_model fast
       -fp_model nostrict                    -fp_model nosource
       -fp_model nodouble                    -fp_model noextended
       -fp_model novery_fast                 -fp_model noexcept
       -fp_model nono_except                 -fp_modbits nofp_contract
       -fp_modbits nono_fp_contract          -fp_modbits nofenv_access
       -fp_modbits nono_fenv_access          -fp_modbits nocx_limited_range
       -fp_modbits nono_cx_limited_range       -fp_modbits noprec_div
       -fp_modbits nono_prec_div             -fp_modbits noprec_sqrt
       -fp_modbits nono_prec_sqrt            -fp_modbits ftz
       -fp_modbits nono_ftz                  -fp_modbits nointrin_limited_range
       -fp_modbits nono_intrin_limited_range       -fp_modbits notrunc_compares
       -fp_modbits nono_trunc_compares       -fp_modbits noieee_nan_compares
       -fp_modbits nono_ieee_nan_compares       -fp_modbits honor_f32_conversion
       -fp_modbits nono_honor_f32_conversion       -fp_modbits honor_f64_conversion
       -fp_modbits nono_honor_f64_conversion       -fp_modbits nono_x87_copy
       -fp_modbits nono_no_x87_copy          -fp_modbits noexception_semantics
       -fp_modbits nono_exception_semantics       -fp_modbits noprecise_libm_functions

Page 49          Source Listing                  DATA_OVERRIDE_UG_2D
2021-06-01 08:55                                 data_override.F90

       -fp_modbits nono_precise_libm_functions       -heap_arrays 0
  no   -threadprivate_compat                 -free
       -g2                                   -iface nomixed_str_len_arg
       -iface nono_mixed_str_len_arg         -init noarrays
       -init nohuge                          -init noinfinity
       -init nominus_huge                    -init nominus_infinity
       -init nominus_tiny                    -init nonan
       -init nosnan                          -init notiny
       -init nozero                     no   -intconstant
       -integer_size 32                 no   -mixed_str_len_arg
       -module ../.mods                      -names lowercase
  no   -noinclude                       no   -o
       -offload-build=host                   -openmp
       -openmp-simd                          -openmp-offload
       -O0                              no   -pad_source
       -real_size 64                    no   -recursive
       -reentrancy threaded                  -vec=simd
       -show nofullpath                      -show noinclude
       -show map                             -show options
  no   -syntax_only                     no   -threadcom
  no   -U                               no   -vms
       -w noall                              -w nonone
       -w noalignments                       -w nodeclarations
       -w noexternals                        -w nogeneral
       -w noignore_bounds                    -w noignore_loc
       -w nointerfaces                       -w noshape
       -w notruncated_source                 -w nouncalled
       -w nouninitialized                    -w nounused
       -w nousage                       no   -wrap-margins

       -includepath : /opt/netcdf/4.6.1/INTEL/include/,/opt/intel/2020/compilers_and_libraries/linux/pstl/include/,
           /opt/intel/2020/compilers_and_libraries_2020.0.166/linux/compiler/include/,.f90,./.f90,./.f90,../include/.f90,
           ./.f90,/opt/netcdf/4.6.1/INTEL/include/.f90,/opt/intel/2020/compilers_and_libraries/linux/mpi/intel64/include/.f90,
           /opt/intel/2020/compilers_and_libraries/linux/mpi/intel64/include/.f90,/opt/intel/2020/compilers_and_libraries/linux/ipp/include/.f90,
           /opt/intel/2020/compilers_and_libraries/linux/mkl/include/.f90,/opt/intel/2020/compilers_and_libraries/linux/pstl/include/.f90,
           /opt/intel/2020/compilers_and_libraries/linux/tbb/include/.f90,/opt/intel/2020/compilers_and_libraries/linux/daal/include/.f90,
           /opt/intel/2020/compilers_and_libraries_2020.0.166/linux/compiler/include/intel64/.f90,/opt/intel/2020/compilers_and_libraries_2020.0.166/linux/compiler/include/icc/.f90,
           /opt/intel/2020/compilers_and_libraries_2020.0.166/linux/compiler/include/.f90,/usr/local/include/.f90,
           /usr/lib/gcc/x86_64-redhat-linux/4.8.5/include/.f90,/usr/include/.f90,/usr/include/.f90,/usr/include/.f90
       -list filename : data_override.lst
  no   -o

COMPILER: Intel(R) Fortran 19.1-1555
