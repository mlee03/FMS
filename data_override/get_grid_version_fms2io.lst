Page 1           Source Listing                  CHECK_GRID_SIZES
2021-06-01 08:55                                 /tmp/ifortKGCS5P.i90

      1 # 1 "get_grid_version_fms2io.F90"
      2 !***********************************************************************
      3 !*                   GNU Lesser General Public License
      4 !*
      5 !* This file is part of the GFDL Flexible Modeling System (FMS).
      6 !*
      7 !* FMS is free software: you can redistribute it and/or modify it under
      8 !* the terms of the GNU Lesser General Public License as published by
      9 !* the Free Software Foundation, either version 3 of the License, or (at
     10 !* your option) any later version.
     11 !*
     12 !* FMS is distributed in the hope that it will be useful, but WITHOUT
     13 !* ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
     14 !* FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
     15 !* for more details.
     16 !*
     17 !* You should have received a copy of the GNU Lesser General Public
     18 !* License along with FMS.  If not, see <http://www.gnu.org/licenses/>.
     19 !***********************************************************************
     20 !> @file
     21 !! @brief fms2_io implementations of grid routines
     22 module get_grid_version_fms2io_mod
     23 use constants_mod, only: PI
     24 use mpp_mod, only : mpp_error,FATAL,NOTE, mpp_min, mpp_max
     25 use mpp_domains_mod, only : domain2d, operator(.NE.),operator(.EQ.)
     26 use mpp_domains_mod, only : mpp_get_global_domain, mpp_get_data_domain
     27 use fms2_io_mod,     only : FmsNetcdfDomainFile_t, FmsNetcdfFile_t, open_file, close_file, &
     28                             variable_exists, read_data, get_variable_size, get_variable_num_dimensions
     29 use mosaic2_mod,      only : get_mosaic_tile_grid
     30 
     31 implicit none
     32 
     33 real, parameter    :: deg_to_radian=PI/180.
     34 contains
     35 ! Get lon and lat of three model (target) grids from grid_spec.nc
     36 subroutine check_grid_sizes(domain_name, Domain, nlon, nlat)
     37 character(len=12), intent(in) :: domain_name
     38 type (domain2d),   intent(in) :: Domain
     39 integer,           intent(in) :: nlon, nlat
     40 
     41 character(len=184) :: error_message
     42 integer            :: xsize, ysize
     43 
     44 call mpp_get_global_domain(Domain, xsize=xsize, ysize=ysize)
     45 if(nlon .NE. xsize .OR. nlat .NE. ysize) then
     46   error_message = 'Error in data_override_init. Size of grid as specified by '// &
     47                   '             does not conform to that specified by grid_spec.nc.'// &
     48                   '  From             :     by      From grid_spec.nc:     by    '
     49   error_message( 59: 70) = domain_name
     50   error_message(130:141) = domain_name
     51   write(error_message(143:146),'(i4)') xsize
     52   write(error_message(150:153),'(i4)') ysize
     53   write(error_message(174:177),'(i4)') nlon
     54   write(error_message(181:184),'(i4)') nlat
     55   call mpp_error(FATAL,error_message)
     56 endif
     57 end subroutine check_grid_sizes

Page 2           Source Listing                  CHECK_GRID_SIZES
2021-06-01 08:55 Entry Points                    get_grid_version_fms2io.F90



ENTRY POINTS

  Name                                                        
                                                              
 get_grid_version_fms2io_mod_mp_check_grid_sizes_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 CHECK_GRID_SIZES           Subr   36                                                             104,127,173,261                   
 DOMAIN                     Dummy  36       DOMAIN2D        752         scalar   ARG,IN           44                                
 DOMAIN2D                   Type   38                                   scalar                    25,38,62,207,220                  
 DOMAIN_NAME                Dummy  36       CHAR            12          scalar   ARG,IN           49,50                             
 ERROR_MESSAGE              Local  41       CHAR            184         scalar                    46,49,50,51,52,53,54,55           
 FATAL                      Param  55       I(4)            4           scalar                    24,55,83,97,186,226,239,250,255,25
                                                                                                  7                                 
 MPP_ERROR                  Local  55                                   scalar                    24,55,83,97,121,186,226,239,250,25
                                                                                                  5,257                             
 MPP_ERROR_BASIC            Subr   55                                            PRIV             55,83,97,121,186,226,239,250,255,2
                                                                                                  57                                
 MPP_GET_GLOBAL_DOMAIN      Local  44                                   scalar                    26,44,87,230                      
 MPP_GET_GLOBAL_DOMAIN2D    Subr   44                                            PRIV             44,87,230                         
 NLAT                       Dummy  36       I(4)            4           scalar   ARG,IN           45,54                             
 NLON                       Dummy  36       I(4)            4           scalar   ARG,IN           45,53                             
 XSIZE                      Local  42       I(4)            4           scalar                    44,45,51                          
 YSIZE                      Local  42       I(4)            4           scalar                    44,45,52                          

Page 3           Source Listing                  CHECK_GRID_SIZES
2021-06-01 08:55                                 get_grid_version_fms2io.F90

     58 
     59 subroutine get_grid_version_1(grid_file, mod_name, domain, isc, iec, jsc, jec, lon, lat, min_lon, max_lon, grid_center_bug)
     60   character(len=*),            intent(in) :: grid_file
     61   character(len=*),            intent(in) :: mod_name
     62   type(domain2d),              intent(in) :: domain
     63   integer,                     intent(in) :: isc, iec, jsc, jec
     64   real, dimension(isc:,jsc:), intent(out) :: lon, lat
     65   real,                       intent(out) :: min_lon, max_lon
     66   logical,           intent(in), optional :: grid_center_bug
     67 
     68   integer                                      :: i, j, siz(4)
     69   integer                                      :: nlon, nlat         ! size of global lon and lat
     70   real,          dimension(:,:,:), allocatable :: lon_vert, lat_vert !of OCN grid vertices
     71   real,          dimension(:),     allocatable :: glon, glat         ! lon and lat of 1-D grid of atm/lnd
     72   logical                                      :: is_new_grid
     73   integer                                      :: is, ie, js, je
     74   integer                                      :: isd, ied, jsd, jed
     75   integer                                      :: isg, ieg, jsg, jeg
     76   character(len=3)                             :: xname, yname
     77   integer                                      :: start(2), nread(2)
     78   type(FmsNetcdfDomainFile_t)                  :: fileobj
     79   integer                                      :: ndims  !> Number of dimensions
     80   logical                                      :: gc_bug !> local grid_center_bug variable, default is .false.
     81 
     82   if(.not. open_file(fileobj, grid_file, 'read', domain )) then
     83      call mpp_error(FATAL, 'data_override_mod(get_grid_version_1): Error in opening file '//trim(grid_file))
     84   endif
     85 
     86   call mpp_get_data_domain(domain, isd, ied, jsd, jed)
     87   call mpp_get_global_domain(domain, isg, ieg, jsg, jeg)
     88 
     89   select case(mod_name)
     90   case('ocn', 'ice')
     91     is_new_grid = .FALSE.
     92     if(variable_exists(fileobj, 'x_T')) then
     93        is_new_grid = .true.
     94     else if(variable_exists(fileobj, 'geolon_t')) then
     95        is_new_grid = .FALSE.
     96     else
     97        call mpp_error(FATAL,'data_override: both x_T and geolon_t is not in the grid file '//trim(grid_file) )
     98     endif
     99 
    100     if(is_new_grid) then
    101       ndims = get_variable_num_dimensions(fileobj, 'x_T')
    102       call get_variable_size(fileobj, 'x_T', siz(1:ndims))
    103       nlon = siz(1); nlat = siz(2)
    104       call check_grid_sizes(trim(mod_name)//'_domain  ', domain, nlon, nlat)
    105       allocate(lon_vert(isc:iec,jsc:jec,4), lat_vert(isc:iec,jsc:jec,4) )
    106 
    107       call read_data(fileobj, 'x_vert_T', lon_vert)
    108       call read_data(fileobj, 'y_vert_T', lat_vert)
    109 
    110 !2 Global lon and lat of ocean grid cell centers are determined from adjacent vertices
    111       lon(:,:) = (lon_vert(:,:,1) + lon_vert(:,:,2) + lon_vert(:,:,3) + lon_vert(:,:,4))*0.25
    112       lat(:,:) = (lat_vert(:,:,1) + lat_vert(:,:,2) + lat_vert(:,:,3) + lat_vert(:,:,4))*0.25
    113     else
    114 

Page 4           Source Listing                  GET_GRID_VERSION_1
2021-06-01 08:55                                 get_grid_version_fms2io.F90

    115       if (present(grid_center_bug)) then
    116           gc_bug = grid_center_bug
    117       else
    118           gc_bug = .false.
    119       endif
    120 
    121       if(gc_bug) call mpp_error(NOTE, &
    122            'data_override: grid_center_bug is set to true, the grid center location may be incorrect')
    123 
    124       ndims = get_variable_num_dimensions(fileobj, 'geolon_vert_t')
    125       call get_variable_size(fileobj, 'geolon_vert_t', siz(1:ndims))
    126       nlon = siz(1) - 1; nlat = siz(2) - 1;
    127       call check_grid_sizes(trim(mod_name)//'_domain  ', domain, nlon, nlat)
    128 
    129       start(1) = isc; nread(1) = iec-isc+2
    130       start(2) = jsc; nread(2) = jec-jsc+2
    131 
    132       allocate(lon_vert(isc:iec+1,jsc:jec+1,1))
    133       allocate(lat_vert(isc:iec+1,jsc:jec+1,1))
    134 
    135       call read_data(fileobj, 'geolon_vert_t', lon_vert(:,:,1), corner=start, edge_lengths=nread)
    136       call read_data(fileobj, 'geolat_vert_t', lat_vert(:,:,1), corner=start, edge_lengths=nread)
    137 
    138       if(gc_bug) then
    139          do j = jsc, jec
    140             do i = isc, iec
    141                lon(i,j) = (lon_vert(i,j,1) + lon_vert(i+1,j,1))/2.
    142                lat(i,j) = (lat_vert(i,j,1) + lat_vert(i,j+1,1))/2.
    143             enddo
    144          enddo
    145       else
    146          do j = jsc, jec
    147             do i = isc, iec
    148                lon(i,j) = (lon_vert(i,j,1) + lon_vert(i+1,j,1) + &
    149                     lon_vert(i+1,j+1,1) + lon_vert(i,j+1,1))*0.25
    150                lat(i,j) = (lat_vert(i,j,1) + lat_vert(i+1,j,1) + &
    151                     lat_vert(i+1,j+1,1) + lat_vert(i,j+1,1))*0.25
    152             enddo
    153          enddo
    154       end if
    155     endif
    156     deallocate(lon_vert)
    157     deallocate(lat_vert)
    158   case('atm', 'lnd')
    159      if(trim(mod_name) == 'atm') then
    160         xname = 'xta'; yname = 'yta'
    161      else
    162         xname = 'xtl'; yname = 'ytl'
    163      endif
    164      ndims = get_variable_num_dimensions(fileobj, xname)
    165      call get_variable_size(fileobj, xname, siz(1:ndims))
    166      nlon = siz(1); allocate(glon(nlon))
    167      call read_data(fileobj, xname, glon)
    168 
    169      ndims = get_variable_num_dimensions(fileobj, xname)
    170      call get_variable_size(fileobj, yname, siz(1:ndims))
    171      nlat = siz(1); allocate(glat(nlat))

Page 5           Source Listing                  GET_GRID_VERSION_1
2021-06-01 08:55                                 get_grid_version_fms2io.F90

    172      call read_data(fileobj, yname, glat)
    173      call check_grid_sizes(trim(mod_name)//'_domain  ', domain, nlon, nlat)
    174 
    175      is = isc - isg + 1; ie = iec - isg + 1
    176      js = jsc - jsg + 1; je = jec - jsg + 1
    177      do j = js, jec
    178         do i = is, ie
    179            lon(i,j) = glon(i)
    180            lat(i,j) = glat(j)
    181         enddo
    182      enddo
    183      deallocate(glon)
    184      deallocate(glat)
    185   case default
    186      call mpp_error(FATAL, "data_override_mod: mod_name should be 'atm', 'ocn', 'ice' or 'lnd' ")
    187   end select
    188 
    189   call close_file(fileobj)
    190 
    191 ! convert from degree to radian
    192   lon = lon * deg_to_radian
    193   lat = lat* deg_to_radian
    194   min_lon = minval(lon)
    195   max_lon = maxval(lon)
    196   call mpp_min(min_lon)
    197   call mpp_max(max_lon)
    198 
    199 
    200 end subroutine get_grid_version_1

Page 6           Source Listing                  GET_GRID_VERSION_1
2021-06-01 08:55 Entry Points                    get_grid_version_fms2io.F90



ENTRY POINTS

  Name                                                          
                                                                
 get_grid_version_fms2io_mod_mp_get_grid_version_1_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 CLOSE_DOMAIN_FILE          Subr   189                                           PRIV             189                               
 CLOSE_FILE                 Local  189                                  scalar                    27,189,300,301                    
 DEG_TO_RADIAN              Param  192      R(8)            8           scalar                    192,193,291,292                   
 DOMAIN                     Dummy  59       DOMAIN2D        752         scalar   ARG,IN           82,86,87,104,127,173              
 DOMAIN_READ_1D             Subr   167                                           PRIV             167,172                           
 DOMAIN_READ_2D             Subr   135                                           PRIV             135,136                           
 DOMAIN_READ_3D             Subr   107                                           PRIV             107,108                           
 FILEOBJ                    Local  78       FMSNETCDFDOMAINFILE_T                                                                   
                                                            2040        scalar                    82,92,94,101,102,107,108,124,125,1
                                                                                                  35,136,164,165,167,169,170,172,189
 FMSNETCDFDOMAINFILE_T      Type   78                                   scalar                    27,78                             
 GC_BUG                     Local  80       L(4)            4           scalar                    116,118,121,138                   
 GET_GRID_VERSION_1         Subr   59                                                                                               
 GET_VARIABLE_NUM_DIMENSION                                                                                                         
 S                          Func   101      I(4)            4           scalar                    28,101,124,164,169                
 GET_VARIABLE_SIZE          Subr   102                                                            28,102,125,165,170,253            
 GLAT                       Local  71       R(8)            8     1     1        ALC              171,172,180,184                   
 GLON                       Local  71       R(8)            8     1     1        ALC              166,167,179,183                   
 GRID_CENTER_BUG            Dummy  59       L(4)            4           scalar   ARG,IN           115,116                           
 GRID_FILE                  Dummy  59       CHAR                        scalar   ARG,IN           82,83,97                          
 I                          Local  68       I(4)            4           scalar                    140,141,142,147,148,149,150,151,17
                                                                                                  8,179,180                         
 IE                         Local  73       I(4)            4           scalar                    175,178                           
 IEC                        Dummy  59       I(4)            4           scalar   ARG,IN           105,129,132,133,140,147,175       
 IED                        Local  74       I(4)            4           scalar                    86                                
 IEG                        Local  75       I(4)            4           scalar                    87                                
 IS                         Local  73       I(4)            4           scalar                    175,178                           
 ISC                        Dummy  59       I(4)            4           scalar   ARG,IN           64,105,129,132,133,140,147,175    
 ISD                        Local  74       I(4)            4           scalar                    86                                
 ISG                        Local  75       I(4)            4           scalar                    87,175                            
 IS_NEW_GRID                Local  72       L(4)            4           scalar                    91,93,95,100                      
 J                          Local  68       I(4)            4           scalar                    139,141,142,146,148,149,150,151,17
                                                                                                  7,179,180                         
 JE                         Local  73       I(4)            4           scalar                    176                               
 JEC                        Dummy  59       I(4)            4           scalar   ARG,IN           105,130,132,133,139,146,176,177   
 JED                        Local  74       I(4)            4           scalar                    86                                
 JEG                        Local  75       I(4)            4           scalar                    87                                
 JS                         Local  73       I(4)            4           scalar                    176,177                           
 JSC                        Dummy  59       I(4)            4           scalar   ARG,IN           64,105,130,132,133,139,146,176    
 JSD                        Local  74       I(4)            4           scalar                    86                                
 JSG                        Local  75       I(4)            4           scalar                    87,176                            
 LAT                        Dummy  59       R(8)            8     2     1        ARG,OUT          112,142,150,180,193               
 LAT_VERT                   Local  70       R(8)            8     3     1        ALC              105,108,112,133,136,142,150,151,15
                                                                                                  7                                 

Page 7           Source Listing                  GET_GRID_VERSION_1
2021-06-01 08:55 Symbol Table                    get_grid_version_fms2io.F90

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 LON                        Dummy  59       R(8)            8     2     1        ARG,OUT          111,141,148,179,192,194,195       
 LON_VERT                   Local  70       R(8)            8     3     1        ALC              105,107,111,132,135,141,148,149,15
                                                                                                  6                                 
 MAXVAL                     Func   195                                  scalar                    195                               
 MAX_LON                    Dummy  59       R(8)            8           scalar   ARG,OUT          195,197                           
 MINVAL                     Func   194                                  scalar                    194                               
 MIN_LON                    Dummy  59       R(8)            8           scalar   ARG,OUT          194,196                           
 MOD_NAME                   Dummy  59       CHAR                        scalar   ARG,IN           89,104,127,159,173                
 MPP_GET_DATA_DOMAIN        Local  86                                   scalar                    26,86,229                         
 MPP_GET_DATA_DOMAIN2D      Subr   86                                            PRIV             86,229                            
 MPP_MAX                    Local  197                                  scalar                    24,197,298                        
 MPP_MAX_REAL8_0D           Subr   197                                           PRIV             197,298                           
 MPP_MIN                    Local  196                                  scalar                    24,196,297                        
 MPP_MIN_REAL8_0D           Subr   196                                           PRIV             196,297                           
 NDIMS                      Local  79       I(4)            4           scalar                    101,102,124,125,164,165,169,170   
 NLAT                       Local  69       I(4)            4           scalar                    103,104,126,127,171,173           
 NLON                       Local  69       I(4)            4           scalar                    103,104,126,127,166,173           
 NOTE                       Param  121      I(4)            4           scalar                    24,121                            
 NREAD                      Local  77       I(4)            4     1     2                         129,130,135,136                   
 OPEN_DOMAIN_FILE           Func   82       L(4)            4           scalar   PRIV             82                                
 OPEN_FILE                  Local  82                                   scalar                    27,82,238,249                     
 PRESENT                    Func   115                                  scalar                    115                               
 READ_DATA                  Local  107                                  scalar                    28,107,108,135,136,167,172,235,270
                                                                                                  ,271                              
 SIZ                        Local  68       I(4)            4     1     4        TGT              102,103,125,126,165,166,170,171   
 START                      Local  77       I(4)            4     1     2                         129,130,135,136                   
 TRIM                       Func   83                                   scalar                    83,97,104,127,159,173             
 VARIABLE_EXISTS            Func   92       L(4)            4           scalar                    28,92,94,234                      
 XNAME                      Local  76       CHAR            3           scalar                    160,162,164,165,167,169           
 YNAME                      Local  76       CHAR            3           scalar                    160,162,170,172                   

Page 8           Source Listing                  GET_GRID_VERSION_1
2021-06-01 08:55                                 get_grid_version_fms2io.F90

    201 
    202 ! Get global lon and lat of three model (target) grids from mosaic.nc
    203 ! z1l: currently we assume the refinement ratio is 2 and there is one tile on each pe.
    204 subroutine get_grid_version_2(fileobj, mod_name, domain, isc, iec, jsc, jec, lon, lat, min_lon, max_lon)
    205   type(FmsNetcdfFile_t),       intent(in) :: fileobj
    206   character(len=*),            intent(in) :: mod_name
    207   type(domain2d),              intent(in) :: domain
    208   integer,                     intent(in) :: isc, iec, jsc, jec
    209   real, dimension(isc:,jsc:), intent(out) :: lon, lat
    210   real,                       intent(out) :: min_lon, max_lon
    211 
    212   integer            :: i, j, siz(2)
    213   integer            :: nlon, nlat             ! size of global grid
    214   integer            :: nlon_super, nlat_super ! size of global supergrid.
    215   integer            :: isd, ied, jsd, jed
    216   integer            :: isg, ieg, jsg, jeg
    217   integer            :: isc2, iec2, jsc2, jec2
    218   character(len=256) :: solo_mosaic_file, grid_file
    219   real, allocatable  :: tmpx(:,:), tmpy(:,:)
    220   type(domain2d)     :: domain2
    221   logical            :: open_solo_mosaic
    222   type(FmsNetcdfFile_t) :: mosaicfileobj, tilefileobj
    223   integer            :: start(2), nread(2)
    224 
    225   if(trim(mod_name) .NE. 'atm' .AND. trim(mod_name) .NE. 'ocn' .AND. &
    226      trim(mod_name) .NE. 'ice' .AND. trim(mod_name) .NE. 'lnd' ) call mpp_error(FATAL, &
    227         "data_override_mod: mod_name should be 'atm', 'ocn', 'ice' or 'lnd' ")
    228 
    229   call mpp_get_data_domain(domain, isd, ied, jsd, jed)
    230   call mpp_get_global_domain(domain, isg, ieg, jsg, jeg)
    231 
    232 ! get the grid file to read
    233 
    234   if(variable_exists(fileobj, trim(mod_name)//'_mosaic_file' )) then
    235      call read_data(fileobj, trim(mod_name)//'_mosaic_file', solo_mosaic_file)
    236 
    237      solo_mosaic_file = 'INPUT/'//trim(solo_mosaic_file)
    238      if(.not. open_file(mosaicfileobj, solo_mosaic_file, 'read')) then
    239         call mpp_error(FATAL, 'data_override_mod(get_grid_version_2: Error in opening solo mosaic file '//trim(solo_mosaic_f
    239 ile))
    240      endif
    241      open_solo_mosaic=.true.
    242   else
    243      mosaicfileobj = fileobj
    244      open_solo_mosaic = .false.
    245   end if
    246 
    247   call get_mosaic_tile_grid(grid_file, mosaicfileobj, domain)
    248 
    249   if(.not. open_file(tilefileobj, grid_file, 'read')) then
    250      call mpp_error(FATAL, 'data_override_mod(get_grid_version_2: Error in opening tile file '//trim(grid_file))
    251   endif
    252 
    253   call get_variable_size(tilefileobj, 'area', siz)
    254   nlon_super = siz(1); nlat_super = siz(2)
    255   if( mod(nlon_super,2) .NE. 0) call mpp_error(FATAL,  &
    256        'data_override_mod: '//trim(mod_name)//' supergrid longitude size can not be divided by 2')

Page 9           Source Listing                  GET_GRID_VERSION_2
2021-06-01 08:55                                 get_grid_version_fms2io.F90

    257   if( mod(nlat_super,2) .NE. 0) call mpp_error(FATAL,  &
    258        'data_override_mod: '//trim(mod_name)//' supergrid latitude size can not be divided by 2')
    259   nlon = nlon_super/2;
    260   nlat = nlat_super/2;
    261   call check_grid_sizes(trim(mod_name)//'_domain  ', domain, nlon, nlat)
    262   isc2 = 2*isc-1; iec2 = 2*iec+1
    263   jsc2 = 2*jsc-1; jec2 = 2*jec+1
    264 
    265   start(1) = isc2; nread(1) = iec2-isc2+1
    266   start(2) = jsc2; nread(2) = jec2-jsc2+1
    267 
    268   allocate(tmpx(isc2:iec2, jsc2:jec2), tmpy(isc2:iec2, jsc2:jec2) )
    269 
    270   call read_data( tilefileobj, 'x', tmpx, corner=start,edge_lengths=nread)
    271   call read_data( tilefileobj, 'y', tmpy, corner=start,edge_lengths=nread)
    272 
    273 ! copy data onto model grid
    274   if(trim(mod_name) == 'ocn' .OR. trim(mod_name) == 'ice') then
    275      do j = jsc, jec
    276         do i = isc, iec
    277            lon(i,j) = (tmpx(i*2-1,j*2-1)+tmpx(i*2+1,j*2-1)+tmpx(i*2+1,j*2+1)+tmpx(i*2-1,j*2+1))*0.25
    278            lat(i,j) = (tmpy(i*2-1,j*2-1)+tmpy(i*2+1,j*2-1)+tmpy(i*2+1,j*2+1)+tmpy(i*2-1,j*2+1))*0.25
    279         end do
    280      end do
    281   else
    282      do j = jsc, jec
    283         do i = isc, iec
    284            lon(i,j) = tmpx(i*2,j*2)
    285            lat(i,j) = tmpy(i*2,j*2)
    286         end do
    287      end do
    288   endif
    289 
    290 ! convert to radian
    291   lon = lon * deg_to_radian
    292   lat = lat * deg_to_radian
    293 
    294   deallocate(tmpx, tmpy)
    295   min_lon = minval(lon)
    296   max_lon = maxval(lon)
    297   call mpp_min(min_lon)
    298   call mpp_max(max_lon)
    299 
    300   call close_file(tilefileobj)
    301   if(open_solo_mosaic)  call close_file(mosaicfileobj)
    302 
    303 end subroutine get_grid_version_2

Page 10          Source Listing                  GET_GRID_VERSION_2
2021-06-01 08:55 Entry Points                    get_grid_version_fms2io.F90



ENTRY POINTS

  Name                                                          
                                                                
 get_grid_version_fms2io_mod_mp_get_grid_version_2_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 COMPRESSED_READ_0D         Subr   235                                           PRIV             235                               
 COMPRESSED_READ_2D         Subr   270                                           PRIV             270,271                           
 DOMAIN                     Dummy  204      DOMAIN2D        752         scalar   ARG,IN           229,230,247,261                   
 DOMAIN2                    Local  220      DOMAIN2D        752         scalar                                                      
 FILEOBJ                    Dummy  204      FMSNETCDFFILE_T 872         scalar   ARG,IN           234,235,243                       
 FMSNETCDFFILE_T            Type   205                                  scalar                    27,205,222                        
 GET_GRID_VERSION_2         Subr   204                                                                                              
 GET_MOSAIC_TILE_GRID       Subr   247                                                            29,247                            
 GRID_FILE                  Local  218      CHAR            256         scalar                    247,249,250                       
 I                          Local  212      I(4)            4           scalar                    276,277,278,283,284,285           
 IEC                        Dummy  204      I(4)            4           scalar   ARG,IN           262,276,283                       
 IEC2                       Local  217      I(4)            4           scalar                    262,265,268                       
 IED                        Local  215      I(4)            4           scalar                    229                               
 IEG                        Local  216      I(4)            4           scalar                    230                               
 ISC                        Dummy  204      I(4)            4           scalar   ARG,IN           209,262,276,283                   
 ISC2                       Local  217      I(4)            4           scalar                    262,265,268                       
 ISD                        Local  215      I(4)            4           scalar                    229                               
 ISG                        Local  216      I(4)            4           scalar                    230                               
 J                          Local  212      I(4)            4           scalar                    275,277,278,282,284,285           
 JEC                        Dummy  204      I(4)            4           scalar   ARG,IN           263,275,282                       
 JEC2                       Local  217      I(4)            4           scalar                    263,266,268                       
 JED                        Local  215      I(4)            4           scalar                    229                               
 JEG                        Local  216      I(4)            4           scalar                    230                               
 JSC                        Dummy  204      I(4)            4           scalar   ARG,IN           209,263,275,282                   
 JSC2                       Local  217      I(4)            4           scalar                    263,266,268                       
 JSD                        Local  215      I(4)            4           scalar                    229                               
 JSG                        Local  216      I(4)            4           scalar                    230                               
 LAT                        Dummy  204      R(8)            8     2     1        ARG,OUT          278,285,292                       
 LON                        Dummy  204      R(8)            8     2     1        ARG,OUT          277,284,291,295,296               
 MAXVAL                     Func   296                                  scalar                    296                               
 MAX_LON                    Dummy  204      R(8)            8           scalar   ARG,OUT          296,298                           
 MINVAL                     Func   295                                  scalar                    295                               
 MIN_LON                    Dummy  204      R(8)            8           scalar   ARG,OUT          295,297                           
 MOD                        Func   255                                  scalar                    255,257                           
 MOD_NAME                   Dummy  204      CHAR                        scalar   ARG,IN           225,226,234,235,256,258,261,274   
 MOSAICFILEOBJ              Local  222      FMSNETCDFFILE_T 872         scalar                    238,243,247,301                   
 NETCDF_FILE_CLOSE_WRAP     Subr   300                                           PRIV             300,301                           
 NETCDF_FILE_OPEN_WRAP      Func   238      L(4)            4           scalar   PRIV             238,249                           
 NLAT                       Local  213      I(4)            4           scalar                    260,261                           
 NLAT_SUPER                 Local  214      I(4)            4           scalar                    254,257,260                       
 NLON                       Local  213      I(4)            4           scalar                    259,261                           
 NLON_SUPER                 Local  214      I(4)            4           scalar                    254,255,259                       
 NREAD                      Local  223      I(4)            4     1     2        TGT              265,266,270,271                   
 OPEN_SOLO_MOSAIC           Local  221      L(4)            4           scalar                    241,244,301                       

Page 11          Source Listing                  GET_GRID_VERSION_2
2021-06-01 08:55 Symbol Table                    get_grid_version_fms2io.F90

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 SIZ                        Local  212      I(4)            4     1     2        TGT              253,254                           
 SOLO_MOSAIC_FILE           Local  218      CHAR            256         scalar                    235,237,238,239                   
 START                      Local  223      I(4)            4     1     2        TGT              265,266,270,271                   
 TILEFILEOBJ                Local  222      FMSNETCDFFILE_T 872         scalar                    249,253,270,271,300               
 TMPX                       Local  219      R(8)            8     2     1        ALC              268,270,277,284,294               
 TMPY                       Local  219      R(8)            8     2     1        ALC              268,271,278,285,294               
 TRIM                       Func   225                                  scalar                    225,226,234,235,237,239,250,256,25
                                                                                                  8,261,274                         

Page 12          Source Listing                  GET_GRID_VERSION_2
2021-06-01 08:55                                 get_grid_version_fms2io.F90

    304 
    305 end module get_grid_version_fms2io_mod


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 CONSTANTS_MOD              Module 23                                                             23                                
 FMS2_IO_MOD                Module 27                                                             27                                
 GET_GRID_VERSION_FMS2IO_MO                                                                                                         
 D                          Module 22                                                                                               
 MOSAIC2_MOD                Module 29                                                             29                                
 MPP_DOMAINS_MOD            Module 25                                                             25,26                             
 MPP_MOD                    Module 24                                                             24                                
 Operator (/=)                     25                                                                                               
 PI                         Param  23       R(8)            8           scalar                    23,33                             

Page 13          Source Listing                  GET_GRID_VERSION_2
2021-06-01 08:55                                 get_grid_version_fms2io.F90

    306 

Page 14          Source Listing                  GET_GRID_VERSION_2
2021-06-01 08:55 Subprograms/Common Blocks       get_grid_version_fms2io.F90



SUBPROGRAMS/COMMON BLOCKS

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 CHECK_GRID_SIZES           Subr   36                                                             104,127,173,261                   
 GET_GRID_VERSION_1         Subr   59                                                                                               
 GET_GRID_VERSION_2         Subr   204                                                                                              
 GET_GRID_VERSION_FMS2IO_MO                                                                                                         
 D                          Module 22                                                                                               

COMPILER OPTIONS BEING USED

       -align noall                          -align nonone
       -align nocommons                      -align nodcommons
       -align noqcommons                     -align nozcommons
       -align records                        -align nosequence
       -align norec1byte                     -align norec2byte
       -align norec4byte                     -align norec8byte
       -align norec16byte                    -align norec32byte
       -align norec64byte                    -align noarray8byte
       -align noarray16byte                  -align noarray32byte
       -align noarray64byte                  -align noarray128byte
       -align noarray256byte                 -altparam
       -assume accuracy_sensitive            -assume nobscc
       -assume nobuffered_io                 -assume nobuffered_stdout
       -assume byterecl                      -assume nocontiguous_assumed_shape
       -assume nocontiguous_pointer          -assume cc_omp
       -assume nocstring                     -assume nodummy_aliases
       -assume nofpe_summary                 -assume noieee_fpe_flags
       -assume nominus0                      -assume noold_boz
       -assume old_complex_align             -assume old_unit_star
       -assume old_inquire_recl              -assume old_ldout_format
       -assume old_ldout_zero                -assume noold_logical_assign
       -assume noold_logical_ldio            -assume old_maxminloc
       -assume old_xor                       -assume noprotect_allocates
       -assume protect_constants             -assume noprotect_parens
       -assume split_common                  -assume source_include
       -assume nostd_intent_in               -assume std_minus0_rounding
       -assume nostd_mod_proc_name           -assume std_value
       -assume realloc_lhs                   -assume underscore
       -assume no2underscores                -assume norecursion
       -auto                            no   -auto_scalar
  no   -bintext                              -ccdefault default
       -check noarg_temp_created             -check noassume
       -check nobounds                       -check nocontiguous
       -check noformat                       -check nooutput_conversion
       -check nooverflow                     -check nopointers
       -check noshape                        -check nostack
       -check nouninitialized                -check noudio_iostat
       -coarray-num-procs 0             no   -coarray-config-file
       -convert native                       -cross_reference
       -D __INTEL_COMPILER=1910              -D __INTEL_COMPILER_UPDATE=0
       -D __unix__                           -D __unix
       -D __linux__                          -D __linux
       -D __gnu_linux__                      -D unix

Page 15          Source Listing                  GET_GRID_VERSION_2
2021-06-01 08:55                                 get_grid_version_fms2io.F90

       -D linux                              -D __ELF__
       -D __x86_64                           -D __x86_64__
       -D __amd64                            -D __amd64__
       -D __INTEL_COMPILER_BUILD_DATE=20191121       -D _OPENMP=201611
       -D __INTEL_OFFLOAD                    -D __MMX__
       -D __SSE__                            -D __SSE_MATH__
       -D __SSE2__                           -D __SSE2_MATH__
       -D __pentium4                         -D __pentium4__
       -D __tune_pentium4__                  -D PACKAGE_NAME='"GFDL FMS Library"'
       -D PACKAGE_TARNAME='"FMS"'            -D PACKAGE_VERSION='"2021.02.0"'
       -D PACKAGE_STRING='"GFDL FMS Library 2021.02.0"'       -D PACKAGE_BUGREPORT='"gfdl.climate.model.info@noaa.gov"'
       -D PACKAGE_URL='"https://www.gfdl.noaa.gov/fms"'       -D PACKAGE='"FMS"'
       -D VERSION='"2021.02.0"'              -D STDC_HEADERS=1
       -D HAVE_SYS_TYPES_H=1                 -D HAVE_SYS_STAT_H=1
       -D HAVE_STDLIB_H=1                    -D HAVE_STRING_H=1
       -D HAVE_MEMORY_H=1                    -D HAVE_STRINGS_H=1
       -D HAVE_INTTYPES_H=1                  -D HAVE_STDINT_H=1
       -D HAVE_UNISTD_H=1                    -D HAVE_DLFCN_H=1
       -D LT_OBJDIR='".libs/"'               -D HAVE_MPI_H=1
       -D HAVE_NETCDF_H=1                    -D HAVE_SCHED_GETAFFINITY=1
       -D HAVE_MOD_MPI=1                     -D HAVE_MOD_NETCDF=1
       -D HAVE_CRAY_POINTER=1                -D HAVE_QUAD_PRECISION=1
       -D HAVE_INTERNAL_NML=1                -D use_netCDF=1
       -D use_libMPI=1                       -D INTERNAL_FILE_NML
       -double_size 64                  no   -d_lines
  no   -Qdyncom                              -error_limit 30
  no   -f66                             no   -f77rtl
  no   -fast                                 -fpscomp nofilesfromcmd
       -fpscomp nogeneral                    -fpscomp noioformat
       -fpscomp noldio_spacing               -fpscomp nologicals
  no   -fpconstant                           -fpe3
       -fprm nearest                         -ftz
       -fp_model noprecise                   -fp_model fast
       -fp_model nostrict                    -fp_model nosource
       -fp_model nodouble                    -fp_model noextended
       -fp_model novery_fast                 -fp_model noexcept
       -fp_model nono_except                 -fp_modbits nofp_contract
       -fp_modbits nono_fp_contract          -fp_modbits nofenv_access
       -fp_modbits nono_fenv_access          -fp_modbits nocx_limited_range
       -fp_modbits nono_cx_limited_range       -fp_modbits noprec_div
       -fp_modbits nono_prec_div             -fp_modbits noprec_sqrt
       -fp_modbits nono_prec_sqrt            -fp_modbits ftz
       -fp_modbits nono_ftz                  -fp_modbits nointrin_limited_range
       -fp_modbits nono_intrin_limited_range       -fp_modbits notrunc_compares
       -fp_modbits nono_trunc_compares       -fp_modbits noieee_nan_compares
       -fp_modbits nono_ieee_nan_compares       -fp_modbits honor_f32_conversion
       -fp_modbits nono_honor_f32_conversion       -fp_modbits honor_f64_conversion
       -fp_modbits nono_honor_f64_conversion       -fp_modbits nono_x87_copy
       -fp_modbits nono_no_x87_copy          -fp_modbits noexception_semantics
       -fp_modbits nono_exception_semantics       -fp_modbits noprecise_libm_functions
       -fp_modbits nono_precise_libm_functions       -heap_arrays 0
  no   -threadprivate_compat                 -free
       -g2                                   -iface nomixed_str_len_arg
       -iface nono_mixed_str_len_arg         -init noarrays
       -init nohuge                          -init noinfinity
       -init nominus_huge                    -init nominus_infinity
       -init nominus_tiny                    -init nonan

Page 16          Source Listing                  GET_GRID_VERSION_2
2021-06-01 08:55                                 get_grid_version_fms2io.F90

       -init nosnan                          -init notiny
       -init nozero                     no   -intconstant
       -integer_size 32                 no   -mixed_str_len_arg
       -module ../.mods                      -names lowercase
  no   -noinclude                       no   -o
       -offload-build=host                   -openmp
       -openmp-simd                          -openmp-offload
       -O0                              no   -pad_source
       -real_size 64                    no   -recursive
       -reentrancy threaded                  -vec=simd
       -show nofullpath                      -show noinclude
       -show map                             -show options
  no   -syntax_only                     no   -threadcom
  no   -U                               no   -vms
       -w noall                              -w nonone
       -w noalignments                       -w nodeclarations
       -w noexternals                        -w nogeneral
       -w noignore_bounds                    -w noignore_loc
       -w nointerfaces                       -w noshape
       -w notruncated_source                 -w nouncalled
       -w nouninitialized                    -w nounused
       -w nousage                       no   -wrap-margins

       -includepath : /opt/netcdf/4.6.1/INTEL/include/,/opt/intel/2020/compilers_and_libraries/linux/pstl/include/,
           /opt/intel/2020/compilers_and_libraries_2020.0.166/linux/compiler/include/,.f90,./.f90,./.f90,../include/.f90,
           ./.f90,/opt/netcdf/4.6.1/INTEL/include/.f90,/opt/intel/2020/compilers_and_libraries/linux/mpi/intel64/include/.f90,
           /opt/intel/2020/compilers_and_libraries/linux/mpi/intel64/include/.f90,/opt/intel/2020/compilers_and_libraries/linux/ipp/include/.f90,
           /opt/intel/2020/compilers_and_libraries/linux/mkl/include/.f90,/opt/intel/2020/compilers_and_libraries/linux/pstl/include/.f90,
           /opt/intel/2020/compilers_and_libraries/linux/tbb/include/.f90,/opt/intel/2020/compilers_and_libraries/linux/daal/include/.f90,
           /opt/intel/2020/compilers_and_libraries_2020.0.166/linux/compiler/include/intel64/.f90,/opt/intel/2020/compilers_and_libraries_2020.0.166/linux/compiler/include/icc/.f90,
           /opt/intel/2020/compilers_and_libraries_2020.0.166/linux/compiler/include/.f90,/usr/local/include/.f90,
           /usr/lib/gcc/x86_64-redhat-linux/4.8.5/include/.f90,/usr/include/.f90,/usr/include/.f90,/usr/include/.f90
       -list filename : get_grid_version_fms2io.lst
  no   -o

COMPILER: Intel(R) Fortran 19.1-1555
