Page 1           Source Listing                  MPP_ARRAY_GLOBAL_MIN_MAX
2021-06-01 08:51                                 /tmp/ifortTJcvmT.i90

      1 # 1 "mpp_utilities.F90"
      2 !***********************************************************************
      3 !*                   GNU Lesser General Public License
      4 !*
      5 !* This file is part of the GFDL Flexible Modeling System (FMS).
      6 !*
      7 !* FMS is free software: you can redistribute it and/or modify it under
      8 !* the terms of the GNU Lesser General Public License as published by
      9 !* the Free Software Foundation, either version 3 of the License, or (at
     10 !* your option) any later version.
     11 !*
     12 !* FMS is distributed in the hope that it will be useful, but WITHOUT
     13 !* ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
     14 !* FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
     15 !* for more details.
     16 !*
     17 !* You should have received a copy of the GNU Lesser General Public
     18 !* License along with FMS.  If not, see <http://www.gnu.org/licenses/>.
     19 !***********************************************************************
     20 module mpp_utilities_mod
     21 
     22 !-----------------------------------------------------------------------
     23 ! Include variable "version" to be written to log file.
     24 # 1 "../include/file_version.h" 1 
     25 ! -*-f90-*-
     26 !***********************************************************************
     27 !*                   GNU Lesser General Public License
     28 !*
     29 !* This file is part of the GFDL Flexible Modeling System (FMS).
     30 !*
     31 !* FMS is free software: you can redistribute it and/or modify it under
     32 !* the terms of the GNU Lesser General Public License as published by
     33 !* the Free Software Foundation, either version 3 of the License, or (at
     34 !* your option) any later version.
     35 !*
     36 !* FMS is distributed in the hope that it will be useful, but WITHOUT
     37 !* ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
     38 !* FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
     39 !* for more details.
     40 !*
     41 !* You should have received a copy of the GNU Lesser General Public
     42 !* License along with FMS.  If not, see <http://www.gnu.org/licenses/>.
     43 !***********************************************************************
     44 
     45 # 23
     46 
     47   character(len=*), parameter :: version = 'unknown'
     48 
     49 # 24 "mpp_utilities.F90" 2 
     50 !-----------------------------------------------------------------------
     51 
     52   public :: mpp_array_global_min_max
     53 
     54 contains
     55 
     56 !#######################################################################
     57 ! <SUBROUTINE NAME="mpp_array_global_min_max">

Page 2           Source Listing                  MPP_ARRAY_GLOBAL_MIN_MAX
2021-06-01 08:51                                 mpp_utilities.F90

     58 !
     59 ! <DESCRIPTION>
     60 ! Compute and return the global min and max of an array
     61 ! and the corresponding lat-lon-depth locations .
     62 !
     63 ! NOTES:
     64 ! This algorithm works only for an input array that has a unique global
     65 ! max and min location. This is assured by introducing a factor that distinguishes
     66 ! the values of extrema at each processor.
     67 !
     68 ! Vectorized using maxloc() and minloc() intrinsic functions by
     69 ! Russell.Fiedler@csiro.au (May 2005).
     70 !
     71 ! Modified by Zhi.Liang@noaa.gov (July 2005)
     72 !
     73 ! Modified by Niki.Zadeh@noaa.gov (Feb. 2009)
     74 !
     75 ! </DESCRIPTION>
     76 !
     77 subroutine mpp_array_global_min_max(in_array, tmask,isd,jsd,isc,iec,jsc,jec,nk, g_min, g_max, &
     78                                     geo_x,geo_y,geo_z, xgmin, ygmin, zgmin, xgmax, ygmax, zgmax)
     79 
     80   use mpp_mod,           only: mpp_min, mpp_max, mpp_pe, mpp_sum
     81 
     82   real, dimension(isd:,jsd:,:), intent(in) :: in_array
     83   real, dimension(isd:,jsd:,:), intent(in) :: tmask
     84   integer,                      intent(in) :: isd,jsd,isc,iec,jsc,jec,nk
     85   real,                         intent(out):: g_min, g_max
     86   real, dimension(isd:,jsd:),   intent(in) :: geo_x,geo_y
     87   real, dimension(:),           intent(in) :: geo_z
     88   real,                         intent(out):: xgmin, ygmin, zgmin, xgmax, ygmax, zgmax
     89 
     90 
     91 
     92   real    :: tmax, tmin, tmax0, tmin0
     93   integer :: itmax, jtmax, ktmax, itmin, jtmin, ktmin
     94   integer :: igmax, jgmax, kgmax, igmin, jgmin, kgmin
     95   real    :: fudge
     96 
     97 ! arrays to enable vectorization
     98   integer :: iminarr(3),imaxarr(3)
     99 
    100   g_min=-88888888888.0 ; g_max=-999999999.0
    101 
    102   tmax=-1.e10;tmin=1.e10
    103   itmax=0;jtmax=0;ktmax=0
    104   itmin=0;jtmin=0;ktmin=0
    105 
    106   if(ANY(tmask(isc:iec,jsc:jec,:) > 0.)) then
    107      iminarr=minloc(in_array(isc:iec,jsc:jec,:),tmask(isc:iec,jsc:jec,:) > 0.)
    108      imaxarr=maxloc(in_array(isc:iec,jsc:jec,:),tmask(isc:iec,jsc:jec,:) > 0.)
    109      itmin=iminarr(1)+isc-1
    110      jtmin=iminarr(2)+jsc-1
    111      ktmin=iminarr(3)
    112      itmax=imaxarr(1)+isc-1
    113      jtmax=imaxarr(2)+jsc-1
    114      ktmax=imaxarr(3)

Page 3           Source Listing                  MPP_ARRAY_GLOBAL_MIN_MAX
2021-06-01 08:51                                 mpp_utilities.F90

    115      tmin=in_array(itmin,jtmin,ktmin)
    116      tmax=in_array(itmax,jtmax,ktmax)
    117   end if
    118 
    119 ! use "fudge" to distinguish processors when tracer extreme is independent of processor
    120   fudge = 1.0 + 1.e-12*real(mpp_pe() )
    121   tmax = tmax*fudge
    122   tmin = tmin*fudge
    123   if(tmax == 0.0) then
    124     tmax = tmax + 1.e-12*real(mpp_pe() )
    125   endif
    126   if(tmin == 0.0) then
    127     tmin = tmin + 1.e-12*real(mpp_pe() )
    128   endif
    129 
    130 
    131   tmax0=tmax;tmin0=tmin
    132 
    133   call mpp_max(tmax)
    134   call mpp_min(tmin)
    135 
    136   g_max = tmax
    137   g_min = tmin
    138 
    139 !Now find the location of the global extrema.
    140 !
    141 !Note that the fudge factor above guarantees that the location of max (min) is uinque,
    142 ! since tmax0 (tmin0) has slightly different values on each processor.
    143 !Otherwise, the function in_array(i,j,k) could be equal to global max (min) at more
    144 ! than one point in space and this would be a much more difficult problem to solve.
    145 !
    146 !mpp_max trick
    147 !-999 on all current PE's
    148   xgmax=-999.; ygmax=-999.; zgmax=-999.
    149   xgmin=-999.; ygmin=-999.; zgmin=-999.
    150 
    151 
    152 !except when
    153   if (tmax0 == tmax) then !This happens ONLY on ONE processor because of fudge factor above.
    154      xgmax=geo_x(itmax,jtmax)
    155      ygmax=geo_y(itmax,jtmax)
    156      zgmax=geo_z(ktmax)
    157   endif
    158 
    159   call mpp_max(xgmax)
    160   call mpp_max(ygmax)
    161   call mpp_max(zgmax)
    162 
    163   if (tmin0 == tmin) then !This happens ONLY on ONE processor because of fudge factor above.
    164      xgmin=geo_x(itmin,jtmin)
    165      ygmin=geo_y(itmin,jtmin)
    166      zgmin=geo_z(ktmin)
    167   endif
    168 
    169   call mpp_max(xgmin)
    170   call mpp_max(ygmin)
    171   call mpp_max(zgmin)

Page 4           Source Listing                  MPP_ARRAY_GLOBAL_MIN_MAX
2021-06-01 08:51                                 mpp_utilities.F90

    172 
    173   return
    174 
    175 
    176 end subroutine mpp_array_global_min_max


ENTRY POINTS

  Name                                                      
                                                            
 mpp_utilities_mod_mp_mpp_array_global_min_max_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 ANY                        Func   106                                  scalar                    106                               
 FUDGE                      Local  95       R(8)            8           scalar                    120,121,122                       
 GEO_X                      Dummy  78       R(8)            8     2     1        ARG,IN           154,164                           
 GEO_Y                      Dummy  78       R(8)            8     2     1        ARG,IN           155,165                           
 GEO_Z                      Dummy  78       R(8)            8     1     1        ARG,IN           156,166                           
 G_MAX                      Dummy  77       R(8)            8           scalar   ARG,OUT          100,136                           
 G_MIN                      Dummy  77       R(8)            8           scalar   ARG,OUT          100,137                           
 IEC                        Dummy  77       I(4)            4           scalar   ARG,IN           106,107,108                       
 IGMAX                      Local  94       I(4)            4           scalar                                                      
 IGMIN                      Local  94       I(4)            4           scalar                                                      
 IMAXARR                    Local  98       I(4)            4     1     3                         108,112,113,114                   
 IMINARR                    Local  98       I(4)            4     1     3                         107,109,110,111                   
 IN_ARRAY                   Dummy  77       R(8)            8     3     1        ARG,IN           107,108,115,116                   
 ISC                        Dummy  77       I(4)            4           scalar   ARG,IN           106,107,108,109,112               
 ISD                        Dummy  77       I(4)            4           scalar   ARG,IN           82,83,86                          
 ITMAX                      Local  93       I(4)            4           scalar                    103,112,116,154,155               
 ITMIN                      Local  93       I(4)            4           scalar                    104,109,115,164,165               
 JEC                        Dummy  77       I(4)            4           scalar   ARG,IN           106,107,108                       
 JGMAX                      Local  94       I(4)            4           scalar                                                      
 JGMIN                      Local  94       I(4)            4           scalar                                                      
 JSC                        Dummy  77       I(4)            4           scalar   ARG,IN           106,107,108,110,113               
 JSD                        Dummy  77       I(4)            4           scalar   ARG,IN           82,83,86                          
 JTMAX                      Local  93       I(4)            4           scalar                    103,113,116,154,155               
 JTMIN                      Local  93       I(4)            4           scalar                    104,110,115,164,165               
 KGMAX                      Local  94       I(4)            4           scalar                                                      
 KGMIN                      Local  94       I(4)            4           scalar                                                      
 KTMAX                      Local  93       I(4)            4           scalar                    103,114,116,156                   
 KTMIN                      Local  93       I(4)            4           scalar                    104,111,115,166                   
 MAXLOC                     Func   108                                  scalar                    108                               
 MINLOC                     Func   107                                  scalar                    107                               
 MPP_ARRAY_GLOBAL_MIN_MAX   Subr   77                                                                                               
 MPP_MAX                    Local  80                                   scalar                    80,133,159,160,161,169,170,171    
 MPP_MAX_REAL8_0D           Subr   133                                           PRIV             133,159,160,161,169,170,171       
 MPP_MIN                    Local  80                                   scalar                    80,134                            
 MPP_MIN_REAL8_0D           Subr   134                                           PRIV             134                               
 MPP_MOD                    Module 80                                                             80                                
 MPP_PE                     Func   80       I(4)            4           scalar                    80,120,124,127                    
 MPP_SUM                    Local  80                                   scalar                    80                                
 NK                         Dummy  77       I(4)            4           scalar   ARG,IN                                             

Page 5           Source Listing                  MPP_ARRAY_GLOBAL_MIN_MAX
2021-06-01 08:51 Symbol Table                    mpp_utilities.F90

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 REAL                       Func   120                                  scalar                    120,124,127                       
 TMASK                      Dummy  77       R(8)            8     3     1        ARG,IN           106,107,108                       
 TMAX                       Local  92       R(8)            8           scalar                    102,116,121,123,124,131,133,136,15
                                                                                                  3                                 
 TMAX0                      Local  92       R(8)            8           scalar                    131,153                           
 TMIN                       Local  92       R(8)            8           scalar                    102,115,122,126,127,131,134,137,16
                                                                                                  3                                 
 TMIN0                      Local  92       R(8)            8           scalar                    131,163                           
 XGMAX                      Dummy  78       R(8)            8           scalar   ARG,OUT          148,154,159                       
 XGMIN                      Dummy  78       R(8)            8           scalar   ARG,OUT          149,164,169                       
 YGMAX                      Dummy  78       R(8)            8           scalar   ARG,OUT          148,155,160                       
 YGMIN                      Dummy  78       R(8)            8           scalar   ARG,OUT          149,165,170                       
 ZGMAX                      Dummy  78       R(8)            8           scalar   ARG,OUT          148,156,161                       
 ZGMIN                      Dummy  78       R(8)            8           scalar   ARG,OUT          149,166,171                       

Page 6           Source Listing                  MPP_ARRAY_GLOBAL_MIN_MAX
2021-06-01 08:51                                 mpp_utilities.F90

    177 ! </SUBROUTINE>  NAME="mpp_array_global_min_max"
    178 
    179 
    180 
    181 end module mpp_utilities_mod


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 MPP_ARRAY_GLOBAL_MIN_MAX   Subr   52                                                             52                                
 MPP_UTILITIES_MOD          Module 20                                                                                               
 VERSION                    Param  47       CHAR            7           scalar                                                      

Page 7           Source Listing                  MPP_ARRAY_GLOBAL_MIN_MAX
2021-06-01 08:51 Subprograms/Common Blocks       mpp_utilities.F90



SUBPROGRAMS/COMMON BLOCKS

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 MPP_ARRAY_GLOBAL_MIN_MAX   Subr   77                                                                                               
 MPP_UTILITIES_MOD          Module 20                                                                                               

COMPILER OPTIONS BEING USED

       -align noall                          -align nonone
       -align nocommons                      -align nodcommons
       -align noqcommons                     -align nozcommons
       -align records                        -align nosequence
       -align norec1byte                     -align norec2byte
       -align norec4byte                     -align norec8byte
       -align norec16byte                    -align norec32byte
       -align norec64byte                    -align noarray8byte
       -align noarray16byte                  -align noarray32byte
       -align noarray64byte                  -align noarray128byte
       -align noarray256byte                 -altparam
       -assume accuracy_sensitive            -assume nobscc
       -assume nobuffered_io                 -assume nobuffered_stdout
       -assume byterecl                      -assume nocontiguous_assumed_shape
       -assume nocontiguous_pointer          -assume cc_omp
       -assume nocstring                     -assume nodummy_aliases
       -assume nofpe_summary                 -assume noieee_fpe_flags
       -assume nominus0                      -assume noold_boz
       -assume old_complex_align             -assume old_unit_star
       -assume old_inquire_recl              -assume old_ldout_format
       -assume old_ldout_zero                -assume noold_logical_assign
       -assume noold_logical_ldio            -assume old_maxminloc
       -assume old_xor                       -assume noprotect_allocates
       -assume protect_constants             -assume noprotect_parens
       -assume split_common                  -assume source_include
       -assume nostd_intent_in               -assume std_minus0_rounding
       -assume nostd_mod_proc_name           -assume std_value
       -assume realloc_lhs                   -assume underscore
       -assume no2underscores                -assume norecursion
       -auto                            no   -auto_scalar
  no   -bintext                              -ccdefault default
       -check noarg_temp_created             -check noassume
       -check nobounds                       -check nocontiguous
       -check noformat                       -check nooutput_conversion
       -check nooverflow                     -check nopointers
       -check noshape                        -check nostack
       -check nouninitialized                -check noudio_iostat
       -coarray-num-procs 0             no   -coarray-config-file
       -convert native                       -cross_reference
       -D __INTEL_COMPILER=1910              -D __INTEL_COMPILER_UPDATE=0
       -D __unix__                           -D __unix
       -D __linux__                          -D __linux
       -D __gnu_linux__                      -D unix
       -D linux                              -D __ELF__
       -D __x86_64                           -D __x86_64__
       -D __amd64                            -D __amd64__

Page 8           Source Listing                  MPP_ARRAY_GLOBAL_MIN_MAX
2021-06-01 08:51                                 mpp_utilities.F90

       -D __INTEL_COMPILER_BUILD_DATE=20191121       -D _OPENMP=201611
       -D __INTEL_OFFLOAD                    -D __MMX__
       -D __SSE__                            -D __SSE_MATH__
       -D __SSE2__                           -D __SSE2_MATH__
       -D __pentium4                         -D __pentium4__
       -D __tune_pentium4__                  -D PACKAGE_NAME='"GFDL FMS Library"'
       -D PACKAGE_TARNAME='"FMS"'            -D PACKAGE_VERSION='"2021.02.0"'
       -D PACKAGE_STRING='"GFDL FMS Library 2021.02.0"'       -D PACKAGE_BUGREPORT='"gfdl.climate.model.info@noaa.gov"'
       -D PACKAGE_URL='"https://www.gfdl.noaa.gov/fms"'       -D PACKAGE='"FMS"'
       -D VERSION='"2021.02.0"'              -D STDC_HEADERS=1
       -D HAVE_SYS_TYPES_H=1                 -D HAVE_SYS_STAT_H=1
       -D HAVE_STDLIB_H=1                    -D HAVE_STRING_H=1
       -D HAVE_MEMORY_H=1                    -D HAVE_STRINGS_H=1
       -D HAVE_INTTYPES_H=1                  -D HAVE_STDINT_H=1
       -D HAVE_UNISTD_H=1                    -D HAVE_DLFCN_H=1
       -D LT_OBJDIR='".libs/"'               -D HAVE_MPI_H=1
       -D HAVE_NETCDF_H=1                    -D HAVE_SCHED_GETAFFINITY=1
       -D HAVE_MOD_MPI=1                     -D HAVE_MOD_NETCDF=1
       -D HAVE_CRAY_POINTER=1                -D HAVE_QUAD_PRECISION=1
       -D HAVE_INTERNAL_NML=1                -D use_netCDF=1
       -D use_libMPI=1                       -D INTERNAL_FILE_NML
       -double_size 64                  no   -d_lines
  no   -Qdyncom                              -error_limit 30
  no   -f66                             no   -f77rtl
  no   -fast                                 -fpscomp nofilesfromcmd
       -fpscomp nogeneral                    -fpscomp noioformat
       -fpscomp noldio_spacing               -fpscomp nologicals
  no   -fpconstant                           -fpe3
       -fprm nearest                         -ftz
       -fp_model noprecise                   -fp_model fast
       -fp_model nostrict                    -fp_model nosource
       -fp_model nodouble                    -fp_model noextended
       -fp_model novery_fast                 -fp_model noexcept
       -fp_model nono_except                 -fp_modbits nofp_contract
       -fp_modbits nono_fp_contract          -fp_modbits nofenv_access
       -fp_modbits nono_fenv_access          -fp_modbits nocx_limited_range
       -fp_modbits nono_cx_limited_range       -fp_modbits noprec_div
       -fp_modbits nono_prec_div             -fp_modbits noprec_sqrt
       -fp_modbits nono_prec_sqrt            -fp_modbits ftz
       -fp_modbits nono_ftz                  -fp_modbits nointrin_limited_range
       -fp_modbits nono_intrin_limited_range       -fp_modbits notrunc_compares
       -fp_modbits nono_trunc_compares       -fp_modbits noieee_nan_compares
       -fp_modbits nono_ieee_nan_compares       -fp_modbits honor_f32_conversion
       -fp_modbits nono_honor_f32_conversion       -fp_modbits honor_f64_conversion
       -fp_modbits nono_honor_f64_conversion       -fp_modbits nono_x87_copy
       -fp_modbits nono_no_x87_copy          -fp_modbits noexception_semantics
       -fp_modbits nono_exception_semantics       -fp_modbits noprecise_libm_functions
       -fp_modbits nono_precise_libm_functions       -heap_arrays 0
  no   -threadprivate_compat                 -free
       -g2                                   -iface nomixed_str_len_arg
       -iface nono_mixed_str_len_arg         -init noarrays
       -init nohuge                          -init noinfinity
       -init nominus_huge                    -init nominus_infinity
       -init nominus_tiny                    -init nonan
       -init nosnan                          -init notiny
       -init nozero                     no   -intconstant
       -integer_size 32                 no   -mixed_str_len_arg

Page 9           Source Listing                  MPP_ARRAY_GLOBAL_MIN_MAX
2021-06-01 08:51                                 mpp_utilities.F90

       -module ../.mods                      -names lowercase
  no   -noinclude                       no   -o
       -offload-build=host                   -openmp
       -openmp-simd                          -openmp-offload
       -O0                              no   -pad_source
       -real_size 64                    no   -recursive
       -reentrancy threaded                  -vec=simd
       -show nofullpath                      -show noinclude
       -show map                             -show options
  no   -syntax_only                     no   -threadcom
  no   -U                               no   -vms
       -w noall                              -w nonone
       -w noalignments                       -w nodeclarations
       -w noexternals                        -w nogeneral
       -w noignore_bounds                    -w noignore_loc
       -w nointerfaces                       -w noshape
       -w notruncated_source                 -w nouncalled
       -w nouninitialized                    -w nounused
       -w nousage                       no   -wrap-margins

       -includepath : ./,/opt/intel/2020/compilers_and_libraries/linux/mkl/include/,/opt/intel/2020/compilers_and_libraries_2020.0.166/linux/compiler/include/icc/,
           /usr/include/,./,./,../include/,../mpp/include/,./,/opt/netcdf/4.6.1/INTEL/include/,/opt/intel/2020/compilers_and_libraries/linux/mpi/intel64/include/,
           /opt/intel/2020/compilers_and_libraries/linux/mpi/intel64/include/,/opt/intel/2020/compilers_and_libraries/linux/ipp/include/,
           /opt/intel/2020/compilers_and_libraries/linux/mkl/include/,/opt/intel/2020/compilers_and_libraries/linux/pstl/include/,
           /opt/intel/2020/compilers_and_libraries/linux/tbb/include/,/opt/intel/2020/compilers_and_libraries/linux/daal/include/,
           /opt/intel/2020/compilers_and_libraries_2020.0.166/linux/compiler/include/intel64/,/opt/intel/2020/compilers_and_libraries_2020.0.166/linux/compiler/include/icc/,
           /opt/intel/2020/compilers_and_libraries_2020.0.166/linux/compiler/include/,/usr/local/include/,/usr/lib/gcc/x86_64-redhat-linux/4.8.5/include/,
           /usr/include/,/usr/include/,/usr/include/
       -list filename : mpp_utilities.lst
  no   -o

COMPILER: Intel(R) Fortran 19.1-1555
