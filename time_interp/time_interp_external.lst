Page 1           Source Listing                  TIME_INTERP_EXTERNAL_INIT
2021-06-01 08:55                                 /tmp/ifort16bwor.i90

      1 # 1 "time_interp_external.F90"
      2 !***********************************************************************
      3 !*                   GNU Lesser General Public License
      4 !*
      5 !* This file is part of the GFDL Flexible Modeling System (FMS).
      6 !*
      7 !* FMS is free software: you can redistribute it and/or modify it under
      8 !* the terms of the GNU Lesser General Public License as published by
      9 !* the Free Software Foundation, either version 3 of the License, or (at
     10 !* your option) any later version.
     11 !*
     12 !* FMS is distributed in the hope that it will be useful, but WITHOUT
     13 !* ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
     14 !* FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
     15 !* for more details.
     16 !*
     17 !* You should have received a copy of the GNU Lesser General Public
     18 !* License along with FMS.  If not, see <http://www.gnu.org/licenses/>.
     19 !***********************************************************************
     20 
     21 
     22 module time_interp_external_mod
     23 # 1 "../include/fms_platform.h" 1 
     24 ! -*-f90-*-*
     25 !***********************************************************************
     26 !*                   GNU Lesser General Public License
     27 !*
     28 !* This file is part of the GFDL Flexible Modeling System (FMS).
     29 !*
     30 !* FMS is free software: you can redistribute it and/or modify it under
     31 !* the terms of the GNU Lesser General Public License as published by
     32 !* the Free Software Foundation, either version 3 of the License, or (at
     33 !* your option) any later version.
     34 !*
     35 !* FMS is distributed in the hope that it will be useful, but WITHOUT
     36 !* ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
     37 !* FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
     38 !* for more details.
     39 !*
     40 !* You should have received a copy of the GNU Lesser General Public
     41 !* License along with FMS.  If not, see <http://www.gnu.org/licenses/>.
     42 !***********************************************************************
     43 
     44 
     45 
     46 
     47 
     48 !Set type kinds.
     49 # 37
     50 
     51 !These values are not necessarily portable.
     52 
     53 
     54 
     55 
     56 
     57 

Page 2           Source Listing                  TIME_INTERP_EXTERNAL_INIT
2021-06-01 08:55                                 ../include/fms_platform.h

     58 
     59 !DEC$ MESSAGE:'Using 8-byte addressing'
     60 
     61 
     62 
     63 !Control "pure" functions.
     64 # 54
     65 
     66 
     67 !DEC$ MESSAGE:'Using pure routines.'
     68 
     69 
     70 
     71 !Control array members of derived types.
     72 # 66
     73 
     74 
     75 
     76 
     77 !DEC$ MESSAGE:'Using allocatable derived type array members.'
     78 
     79 
     80 
     81 !Control use of cray pointers.
     82 # 78
     83 
     84 
     85 !DEC$ MESSAGE:'Using cray pointers.'
     86 
     87 
     88 
     89 !Control size of integers that will hold address values.
     90 !Appears for legacy reasons, but seems rather dangerous.
     91 # 89
     92 
     93 
     94 
     95 !If you do not want to use 64-bit integers.
     96 # 95
     97 
     98 
     99 
    100 !If you do not want to use 32-bit floats.
    101 # 106
    102 
    103 
    104 
    105 !If you want to use quad-precision.
    106 ! The NO_QUAD_PRECISION macro will be deprecated and removed at some future time.
    107 ! Model code will rely solely upon the ENABLE_QUAD_PRECISION macro thereafer.
    108 # 114
    109 
    110 
    111 
    112 
    113 
    114 

Page 3           Source Listing                  TIME_INTERP_EXTERNAL_INIT
2021-06-01 08:55                                 ../include/fms_platform.h

    115 
    116 
    117 # 23 "time_interp_external.F90" 2 
    118 !
    119 !<CONTACT EMAIL="Matthew.Harrison@noaa.gov">M.J. Harrison</CONTACT>
    120 !
    121 !<REVIEWER EMAIL="hsimmons@iarc.uaf.edu">Harper Simmons</REVIEWER>
    122 !
    123 !<OVERVIEW>
    124 ! Perform I/O and time interpolation of external fields (contained in a file).
    125 !</OVERVIEW>
    126 
    127 !<DESCRIPTION>
    128 ! Perform I/O and time interpolation for external fields.
    129 ! Uses udunits library to calculate calendar dates and
    130 ! convert units.  Allows for reading data decomposed across
    131 ! model horizontal grid using optional domain2d argument
    132 !
    133 ! data are defined over data domain for domain2d data
    134 ! (halo values are NOT updated by this module)
    135 !
    136 !</DESCRIPTION>
    137 !
    138 !<NAMELIST NAME="time_interp_external_nml">
    139 ! <DATA NAME="num_io_buffers" TYPE="integer">
    140 ! size of record dimension for internal buffer.  This is useful for tuning i/o performance
    141 ! particularly for large datasets (e.g. daily flux fields)
    142 ! </DATA>
    143 !</NAMELIST>
    144 
    145   use fms_mod, only : write_version_number
    146   use mpp_mod, only : mpp_error,FATAL,WARNING,mpp_pe, stdout, stdlog, NOTE
    147   use mpp_mod, only : input_nml_file
    148   use mpp_io_mod, only : mpp_open, mpp_get_atts, mpp_get_info, MPP_NETCDF, MPP_MULTI, MPP_SINGLE,&
    149        mpp_get_times, MPP_RDONLY, MPP_ASCII, default_axis,axistype,fieldtype,atttype, &
    150        mpp_get_axes, mpp_get_fields, mpp_read, default_field, mpp_close, &
    151        mpp_get_tavg_info, validtype, mpp_is_valid, mpp_get_file_name
    152   use time_manager_mod, only : time_type, get_date, set_date, operator ( >= ) , operator ( + ) , days_in_month, &
    153                             operator( - ), operator ( / ) , days_in_year, increment_time, &
    154                             set_time, get_time, operator( > ), get_calendar_type, NO_CALENDAR
    155   use get_cal_time_mod, only : get_cal_time
    156   use mpp_domains_mod, only : domain2d, mpp_get_compute_domain, mpp_get_data_domain, &
    157        mpp_get_global_domain, NULL_DOMAIN2D
    158   use time_interp_mod, only : time_interp, time_interp_init
    159   use axis_utils_mod, only : get_axis_cart, get_axis_modulo, get_axis_modulo_times
    160   use fms_mod, only : lowercase, open_namelist_file, check_nml_error, close_file
    161   use platform_mod, only: r8_kind
    162   use horiz_interp_mod, only : horiz_interp, horiz_interp_type
    163 
    164   implicit none
    165   private
    166 
    167 ! Include variable "version" to be written to log file.
    168 # 1 "../include/file_version.h" 1 
    169 ! -*-f90-*-
    170 !***********************************************************************
    171 !*                   GNU Lesser General Public License

Page 4           Source Listing                  TIME_INTERP_EXTERNAL_INIT
2021-06-01 08:55                                 ../include/file_version.h

    172 !*
    173 !* This file is part of the GFDL Flexible Modeling System (FMS).
    174 !*
    175 !* FMS is free software: you can redistribute it and/or modify it under
    176 !* the terms of the GNU Lesser General Public License as published by
    177 !* the Free Software Foundation, either version 3 of the License, or (at
    178 !* your option) any later version.
    179 !*
    180 !* FMS is distributed in the hope that it will be useful, but WITHOUT
    181 !* ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
    182 !* FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
    183 !* for more details.
    184 !*
    185 !* You should have received a copy of the GNU Lesser General Public
    186 !* License along with FMS.  If not, see <http://www.gnu.org/licenses/>.
    187 !***********************************************************************
    188 
    189 # 23
    190 
    191   character(len=*), parameter :: version = 'unknown'
    192 
    193 # 74 "time_interp_external.F90" 2 
    194 
    195   integer, parameter, public  :: NO_REGION=0, INSIDE_REGION=1, OUTSIDE_REGION=2
    196   integer, parameter, private :: modulo_year= 0001
    197   integer, parameter, private :: LINEAR_TIME_INTERP = 1 ! not used currently
    198   integer, parameter, public  :: SUCCESS = 0, ERR_FIELD_NOT_FOUND = 1
    199   integer,            private :: max_fields = 100, max_files= 40
    200   integer, private :: num_fields = 0, num_files=0
    201 ! denotes time intervals in file (interpreted from metadata)
    202   integer, private :: num_io_buffers = 2 ! set -1 to read all records from disk into memory
    203   logical, private :: module_initialized = .false.
    204   logical, private :: debug_this_module = .false.
    205 
    206   public init_external_field, time_interp_external, time_interp_external_init, &
    207        time_interp_external_exit, get_external_field_size, get_time_axis, get_external_field_missing
    208   public set_override_region, reset_src_data_region, get_external_field_axes
    209 
    210   private find_buf_index,&
    211          set_time_modulo
    212 
    213   type, private :: ext_fieldtype
    214      integer :: unit ! keep unit open when not reading all records
    215      character(len=128) :: name, units
    216      integer :: siz(4), ndim
    217      type(domain2d) :: domain
    218      type(axistype) :: axes(4)
    219      type(time_type), dimension(:), pointer :: time =>NULL() ! midpoint of time interval
    220      type(time_type), dimension(:), pointer :: start_time =>NULL(), end_time =>NULL()
    221      type(fieldtype) :: field ! mpp_io type
    222      type(time_type), dimension(:), pointer :: period =>NULL()
    223      logical :: modulo_time ! denote climatological time axis
    224      real, dimension(:,:,:,:), pointer :: data =>NULL() ! defined over data domain or global domain
    225      logical, dimension(:,:,:,:), pointer :: mask =>NULL() ! defined over data domain or global domain
    226      integer, dimension(:), pointer :: ibuf  =>NULL() ! record numbers associated with buffers
    227      real, dimension(:,:,:,:), pointer :: src_data  =>NULL() ! input data buffer
    228      type(validtype) :: valid ! data validator

Page 5           Source Listing                  TIME_INTERP_EXTERNAL_INIT
2021-06-01 08:55                                 time_interp_external.F90

    229      integer :: nbuf
    230      logical :: domain_present
    231      real(8) :: slope, intercept
    232      integer :: isc,iec,jsc,jec
    233      type(time_type) :: modulo_time_beg, modulo_time_end
    234      logical :: have_modulo_times, correct_leap_year_inconsistency
    235      integer :: region_type
    236      integer :: is_region, ie_region, js_region, je_region
    237      integer :: is_src, ie_src, js_src, je_src
    238      integer :: tdim
    239      integer :: numwindows
    240      logical, dimension(:,:), pointer :: need_compute=>NULL()
    241      real    :: missing ! missing value
    242   end type ext_fieldtype
    243 
    244   type, private :: filetype
    245      character(len=128) :: filename = ''
    246      integer :: unit = -1
    247   end type filetype
    248 
    249   interface time_interp_external
    250      module procedure time_interp_external_0d
    251      module procedure time_interp_external_2d
    252      module procedure time_interp_external_3d
    253   end interface
    254 
    255   integer :: outunit
    256 
    257   type(ext_fieldtype), save, private, pointer :: field(:) => NULL()
    258   type(filetype),      save, private, pointer :: opened_files(:) => NULL()
    259 !Balaji: really should use field%missing
    260   integer, private, parameter :: dk = 8
    261   real(8), private, parameter :: time_interp_missing=-1e99_dk
    262   contains
    263 
    264 ! <SUBROUTINE NAME="time_interp_external_init">
    265 !
    266 ! <DESCRIPTION>
    267 ! Initialize the time_interp_external module
    268 ! </DESCRIPTION>
    269 !
    270     subroutine time_interp_external_init()
    271 
    272       integer :: ioun, io_status, logunit, ierr
    273 
    274       namelist /time_interp_external_nml/ num_io_buffers, debug_this_module, &
    275                                           max_fields, max_files
    276 
    277 ! open and read namelist
    278 
    279       if(module_initialized) return
    280 
    281       logunit = stdlog()
    282       outunit = stdout()
    283       call write_version_number("TIME_INTERP_EXTERNAL_MOD", version)
    284 
    285 

Page 6           Source Listing                  TIME_INTERP_EXTERNAL_INIT
2021-06-01 08:55                                 time_interp_external.F90

    286       read (input_nml_file, time_interp_external_nml, iostat=io_status)
    287       ierr = check_nml_error(io_status, 'time_interp_external_nml')
    288 # 175
    289 
    290 
    291       write(logunit,time_interp_external_nml)
    292       call realloc_fields(max_fields)
    293       call realloc_files(max_files)
    294 
    295       module_initialized = .true.
    296 
    297       call time_interp_init()
    298 
    299       return
    300 
    301     end  subroutine time_interp_external_init


ENTRY POINTS

  Name                                                              
                                                                    
 time_interp_external_mod_mp_time_interp_external_init_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 CHECK_NML_ERROR            Func   287      I(4)            4           scalar   PRIV             160,287                           
 DEBUG_THIS_MODULE          Local  274      L(4)            4           scalar   PRIV             204,274,404,855,997,1108,1111,1202
 IERR                       Local  272      I(4)            4           scalar                    287                               
 INPUT_NML_FILE             Local  286      CHAR                  1     1        ALC,TGT,PRIV     147,286                           
 IOUN                       Local  272      I(4)            4           scalar                                                      
 IO_STATUS                  Local  272      I(4)            4           scalar                    286,287                           
 LOGUNIT                    Local  272      I(4)            4           scalar                    281,291                           
 MAX_FIELDS                 Local  275      I(4)            4           scalar   PRIV             199,275,292,487                   
 MAX_FILES                  Local  275      I(4)            4           scalar   PRIV             199,275,293,430                   
 MODULE_INITIALIZED         Local  279      L(4)            4           scalar   PRIV             203,279,295,390,1481              
 NUM_IO_BUFFERS             Local  274      I(4)            4           scalar   PRIV             202,274,607,608                   
 OUTUNIT                    Local  282      I(4)            4           scalar                    282,485,604,605,733,735,737,740,74
                                                                                                  3,940,942,953,954,1032,1034,1045,1
                                                                                                  046,1108,1111,1202                
 STDLOG                     Func   281      I(4)            4           scalar   PRIV             146,281                           
 STDOUT                     Func   282      I(4)            4           scalar   PRIV             146,282                           
 TIME_INTERP_EXTERNAL_INIT  Subr   270                                                                                              
 TIME_INTERP_EXTERNAL_NML   Local  274                                  scalar                    286,291                           
 TIME_INTERP_INIT           Subr   297                                           PRIV             158,297                           
 VERSION                    Param  283      CHAR            7           scalar                    283                               
 WRITE_VERSION_NUMBER       Subr   283                                           PRIV             145,283                           

Page 7           Source Listing                  TIME_INTERP_EXTERNAL_INIT
2021-06-01 08:55                                 time_interp_external.F90

    302 ! </SUBROUTINE> NAME="time_interp_external_init"
    303 
    304 
    305 !<FUNCTION NAME="init_external_field" TYPE="integer">
    306 !
    307 !<DESCRIPTION>
    308 ! initialize an external field.  Buffer "num_io_buffers" (default=2) in memory to reduce memory allocations.
    309 ! distributed reads are supported using the optional "domain" flag.
    310 ! Units conversion via the optional "desired_units" flag using udunits_mod.
    311 !
    312 ! Return integer id of field for future calls to time_interp_external.
    313 !
    314 ! </DESCRIPTION>
    315 !
    316 !<IN  NAME="file" TYPE="character(len=*)">
    317 ! filename
    318 !</IN>
    319 !<IN  NAME="fieldname" TYPE="character(len=*)">
    320 ! fieldname (in file)
    321 !</IN>
    322 !<IN NAME="format" TYPE="integer">
    323 ! mpp_io flag for format of file (optional). Currently only "MPP_NETCDF" supported
    324 !</IN>
    325 !<IN NAME="threading" TYPE="integer">
    326 ! mpp_io flag for threading (optional).  "MPP_SINGLE" means root pe reads global field and distributes to other PEs
    327 ! "MPP_MULTI" means all PEs read data
    328 !</IN>
    329 !<IN NAME="domain" TYPE="mpp_domains_mod:domain2d">
    330 ! domain flag (optional)
    331 !</IN>
    332 !<IN NAME="desired_units" TYPE="character(len=*)">
    333 ! Target units for data (optional), e.g. convert from deg_K to deg_C.
    334 ! Failure to convert using udunits will result in failure of this module.
    335 !</IN>
    336 !<IN NAME="verbose" TYPE="logical">
    337 ! verbose flag for debugging (optional).
    338 !</IN>
    339 !<INOUT NAME="axis_centers" TYPE="axistype" DIM="(4)">
    340 ! MPP_IO axistype array for grid centers ordered X-Y-Z-T (optional).
    341 !</INOUT>
    342 !<INOUT NAME="axis_sizes" TYPE="integer" DIM="(4)">
    343 !  array of axis lengths ordered X-Y-Z-T (optional).
    344 !</INOUT>
    345 
    346 
    347     function init_external_field(file,fieldname,format,threading,domain,desired_units,&
    348          verbose,axis_centers,axis_sizes,override,correct_leap_year_inconsistency,&
    349          permit_calendar_conversion,use_comp_domain,ierr, nwindows, ignore_axis_atts )
    350 
    351       character(len=*), intent(in)            :: file,fieldname
    352       integer, intent(in), optional           :: format, threading
    353       logical, intent(in), optional           :: verbose
    354       character(len=*), intent(in), optional  :: desired_units
    355       type(domain2d), intent(in), optional    :: domain
    356       type(axistype), intent(inout), optional :: axis_centers(4)
    357       integer, intent(inout), optional        :: axis_sizes(4)
    358       logical, intent(in), optional           :: override, correct_leap_year_inconsistency,&

Page 8           Source Listing                  INIT_EXTERNAL_FIELD
2021-06-01 08:55                                 time_interp_external.F90

    359                                                  permit_calendar_conversion,use_comp_domain
    360       integer,          intent(out), optional :: ierr
    361       integer,          intent(in),  optional :: nwindows
    362       logical, optional                       :: ignore_axis_atts
    363       real                                    :: missing
    364 
    365       integer :: init_external_field
    366 
    367       type(fieldtype), dimension(:), allocatable :: flds
    368       type(axistype), dimension(:), allocatable :: axes, fld_axes
    369       type(axistype) :: time_axis
    370       type(atttype), allocatable, dimension(:) :: global_atts
    371 
    372       real(8) :: slope, intercept
    373       integer :: form, thread, fset, unit,ndim,nvar,natt,ntime,i,j
    374       integer :: iscomp,iecomp,jscomp,jecomp,isglobal,ieglobal,jsglobal,jeglobal
    375       integer :: isdata,iedata,jsdata,jedata, dxsize, dysize,dxsize_max,dysize_max
    376       logical :: verb, transpose_xy,use_comp_domain1
    377       real, dimension(:), allocatable :: tstamp, tstart, tend, tavg
    378       character(len=1) :: cart
    379       character(len=1), dimension(4) :: cart_dir
    380       character(len=128) :: units, fld_units
    381       character(len=128) :: name, msg, calendar_type, timebeg, timeend
    382       integer :: siz(4), siz_in(4), gxsize, gysize,gxsize_max, gysize_max
    383       type(time_type) :: tdiff
    384       integer :: yr, mon, day, hr, minu, sec
    385       integer :: len, nfile, nfields_orig, nbuf, nx,ny
    386       integer :: numwindows
    387       logical :: ignore_axatts
    388 
    389 
    390       if (.not. module_initialized) call mpp_error(FATAL,'Must call time_interp_external_init first')
    391       if(present(ierr)) ierr = SUCCESS
    392       ignore_axatts=.false.
    393       cart_dir(1)='X';cart_dir(2)='Y';cart_dir(3)='Z';cart_dir(4)='T'
    394       if(present(ignore_axis_atts)) ignore_axatts = ignore_axis_atts
    395       use_comp_domain1 = .false.
    396       if(PRESENT(use_comp_domain)) use_comp_domain1 = use_comp_domain
    397       form=MPP_NETCDF
    398       if (PRESENT(format)) form = format
    399       thread = MPP_MULTI
    400       if (PRESENT(threading)) thread = threading
    401       fset = MPP_SINGLE
    402       verb=.false.
    403       if (PRESENT(verbose)) verb=verbose
    404       if (debug_this_module) verb = .true.
    405       numwindows = 1
    406       if(present(nwindows)) numwindows = nwindows
    407 
    408       units = 'same'
    409       if (PRESENT(desired_units)) then
    410           units = desired_units
    411           call mpp_error(FATAL,'==> Unit conversion via time_interp_external &
    412                &has been temporarily deprecated.  Previous versions of&
    413                &this module used udunits_mod to perform unit conversion.&
    414                &  Udunits_mod is in the process of being replaced since &
    415                &there were portability issues associated with this code.&

Page 9           Source Listing                  INIT_EXTERNAL_FIELD
2021-06-01 08:55                                 time_interp_external.F90

    416                & Please remove the desired_units argument from calls to &
    417                &this routine.')
    418       endif
    419       nfile = 0
    420       do i=1,num_files
    421          if(trim(opened_files(i)%filename) == trim(file)) then
    422             nfile = i
    423             exit  ! file is already opened
    424          endif
    425       enddo
    426       if(nfile == 0) then
    427          call mpp_open(unit,trim(file),MPP_RDONLY,form,threading=thread,&
    428               fileset=fset)
    429          num_files = num_files + 1
    430          if(num_files > max_files) then ! not enough space in the file table, reallocate it
    431 !--- z1l: For the case of multiple thread, realoc_files will cause memory leak.
    432 !---      If multiple threads are working on file A. One of the thread finished first and
    433 !---      begin to work on file B, the realloc_files will cause problem for
    434 !---      other threads are working on the file A.
    435 !  call realloc_files(2*size(opened_files))
    436             call mpp_error(FATAL, "time_interp_external: num_files is greater than max_files, "// &
    437                                       "increase time_interp_external_nml max_files")
    438          endif
    439          opened_files(num_files)%filename = trim(file)
    440          opened_files(num_files)%unit = unit
    441       else
    442          unit = opened_files(nfile)%unit
    443       endif
    444 
    445       call mpp_get_info(unit,ndim,nvar,natt,ntime)
    446 
    447       if (ntime < 1) then
    448           write(msg,'(a15,a,a58)') 'external field ',trim(fieldname),&
    449            ' does not have an associated record dimension (REQUIRED) '
    450           call mpp_error(FATAL,trim(msg))
    451       endif
    452       allocate(global_atts(natt))
    453       call mpp_get_atts(unit, global_atts)
    454       allocate(axes(ndim))
    455       call mpp_get_axes(unit, axes, time_axis)
    456       allocate(flds(nvar))
    457       call mpp_get_fields(unit,flds)
    458       allocate(tstamp(ntime),tstart(ntime),tend(ntime),tavg(ntime))
    459       call mpp_get_times(unit,tstamp)
    460       transpose_xy = .false.
    461       isdata=1; iedata=1; jsdata=1; jedata=1
    462       gxsize=1; gysize=1
    463       siz_in = 1
    464 
    465       if (PRESENT(domain)) then
    466          call mpp_get_compute_domain(domain,iscomp,iecomp,jscomp,jecomp)
    467          nx = iecomp-iscomp+1; ny = jecomp-jscomp+1
    468          call mpp_get_data_domain(domain,isdata,iedata,jsdata,jedata,dxsize,dxsize_max,dysize,dysize_max)
    469          call mpp_get_global_domain(domain,isglobal,ieglobal,jsglobal,jeglobal,gxsize,gxsize_max,gysize,gysize_max)
    470       elseif(use_comp_domain1) then
    471          call mpp_error(FATAL,"init_external_field:"//&
    472               " use_comp_domain=true but domain is not present")

Page 10          Source Listing                  INIT_EXTERNAL_FIELD
2021-06-01 08:55                                 time_interp_external.F90

    473       endif
    474 
    475       init_external_field = -1
    476       nfields_orig = num_fields
    477 
    478       do i=1,nvar
    479          call mpp_get_atts(flds(i),name=name,units=fld_units,ndim=ndim,siz=siz_in)
    480          call mpp_get_tavg_info(unit,flds(i),flds,tstamp,tstart,tend,tavg)
    481          call mpp_get_atts(flds(i),missing=missing)
    482 ! why does it convert case of the field name?
    483          if (trim(lowercase(name)) /= trim(lowercase(fieldname))) cycle
    484 
    485          if (verb) write(outunit,*) 'found field ',trim(fieldname), ' in file !!'
    486          num_fields = num_fields + 1
    487          if(num_fields > max_fields) then
    488 !--- z1l: For the case of multiple thread, realoc_fields will cause memory leak.
    489 !---      If multiple threads are working on field A. One of the thread finished first and
    490 !---      begin to work on field B, the realloc_files will cause problem for
    491 !---      other threads are working on the field A.
    492 !call realloc_fields(size(field)*2)
    493             call mpp_error(FATAL, "time_interp_external: num_fields is greater than max_fields, "// &
    494                                       "increase time_interp_external_nml max_fields")
    495          endif
    496 
    497          init_external_field = num_fields
    498          field(num_fields)%unit = unit
    499          field(num_fields)%name = trim(name)
    500          field(num_fields)%units = trim(fld_units)
    501          field(num_fields)%field = flds(i)
    502          field(num_fields)%isc = 1
    503          field(num_fields)%iec = 1
    504          field(num_fields)%jsc = 1
    505          field(num_fields)%jec = 1
    506          field(num_fields)%region_type = NO_REGION
    507          field(num_fields)%is_region   = 0
    508          field(num_fields)%ie_region   = -1
    509          field(num_fields)%js_region   = 0
    510          field(num_fields)%je_region   = -1
    511          if (PRESENT(domain)) then
    512             field(num_fields)%domain_present = .true.
    513             field(num_fields)%domain = domain
    514             field(num_fields)%isc=iscomp;field(num_fields)%iec = iecomp
    515             field(num_fields)%jsc=jscomp;field(num_fields)%jec = jecomp
    516          else
    517             field(num_fields)%domain_present = .false.
    518          endif
    519 
    520          call mpp_get_atts(flds(i),valid=field(num_fields)%valid )
    521          allocate(fld_axes(ndim))
    522          call mpp_get_atts(flds(i),axes=fld_axes)
    523          if (ndim > 4) call mpp_error(FATAL, &
    524               'invalid array rank <=4d fields supported')
    525          field(num_fields)%siz = 1
    526          field(num_fields)%ndim = ndim
    527          field(num_fields)%tdim = 4
    528          field(num_fields)%missing = missing
    529          do j=1,field(num_fields)%ndim

Page 11          Source Listing                  INIT_EXTERNAL_FIELD
2021-06-01 08:55                                 time_interp_external.F90

    530             cart = 'N'
    531             call get_axis_cart(fld_axes(j), cart)
    532             call mpp_get_atts(fld_axes(j),len=len)
    533             if (cart == 'N' .and. .not. ignore_axatts) then
    534                write(msg,'(a,"/",a)')  trim(file),trim(fieldname)
    535                call mpp_error(FATAL,'file/field '//trim(msg)// &
    536                     ' couldnt recognize axis atts in time_interp_external')
    537             else if (cart == 'N' .and. ignore_axatts) then
    538                cart = cart_dir(j)
    539             endif
    540             select case (cart)
    541             case ('X')
    542                if (j.eq.2) transpose_xy = .true.
    543                if (.not.PRESENT(domain) .and. .not.PRESENT(override)) then
    544                   isdata=1;iedata=len
    545                   iscomp=1;iecomp=len
    546                   gxsize = len
    547                   dxsize = len
    548                   field(num_fields)%isc=iscomp;field(num_fields)%iec=iecomp
    549                elseif (PRESENT(override)) then
    550                   gxsize = len
    551                   if (PRESENT(axis_sizes)) axis_sizes(1) = len
    552                endif
    553                field(num_fields)%axes(1) = fld_axes(j)
    554                if(use_comp_domain1) then
    555                   field(num_fields)%siz(1) = nx
    556                else
    557                   field(num_fields)%siz(1) = dxsize
    558                endif
    559                if (len /= gxsize) then
    560                   write(msg,'(a,"/",a)')  trim(file),trim(fieldname)
    561                   call mpp_error(FATAL,'time_interp_ext, file/field '//trim(msg)//' x dim doesnt match model')
    562                endif
    563             case ('Y')
    564                field(num_fields)%axes(2) = fld_axes(j)
    565                if (.not.PRESENT(domain) .and. .not.PRESENT(override)) then
    566                   jsdata=1;jedata=len
    567                   jscomp=1;jecomp=len
    568                   gysize = len
    569                   dysize = len
    570                   field(num_fields)%jsc=jscomp;field(num_fields)%jec=jecomp
    571                elseif (PRESENT(override)) then
    572                   gysize = len
    573                   if (PRESENT(axis_sizes)) axis_sizes(2) = len
    574                endif
    575                if(use_comp_domain1) then
    576                   field(num_fields)%siz(2) = ny
    577                else
    578                   field(num_fields)%siz(2) = dysize
    579                endif
    580                if (len /= gysize) then
    581                   write(msg,'(a,"/",a)')  trim(file),trim(fieldname)
    582                   call mpp_error(FATAL,'time_interp_ext, file/field '//trim(msg)//' y dim doesnt match model')
    583                endif
    584             case ('Z')
    585                field(num_fields)%axes(3) = fld_axes(j)
    586                field(num_fields)%siz(3) = siz_in(3)

Page 12          Source Listing                  INIT_EXTERNAL_FIELD
2021-06-01 08:55                                 time_interp_external.F90

    587             case ('T')
    588                field(num_fields)%axes(4) = fld_axes(j)
    589                field(num_fields)%siz(4) = ntime
    590                field(num_fields)%tdim   = j
    591             end select
    592          enddo
    593          siz = field(num_fields)%siz
    594 
    595          if (PRESENT(axis_centers)) then
    596             axis_centers = field(num_fields)%axes
    597          endif
    598 
    599          if (PRESENT(axis_sizes) .and. .not.PRESENT(override)) then
    600             axis_sizes = field(num_fields)%siz
    601          endif
    602 
    603          deallocate(fld_axes)
    604          if (verb) write(outunit,'(a,4i6)') 'field x,y,z,t local size= ',siz
    605          if (verb) write(outunit,*) 'field contains data in units = ',trim(field(num_fields)%units)
    606          if (transpose_xy) call mpp_error(FATAL,'axis ordering not supported')
    607          if (num_io_buffers .le. 1) call mpp_error(FATAL,'time_interp_ext:num_io_buffers should be at least 2')
    608          nbuf = min(num_io_buffers,siz(4))
    609 
    610          field(num_fields)%numwindows = numwindows
    611          allocate(field(num_fields)%need_compute(nbuf, numwindows))
    612          field(num_fields)%need_compute = .true.
    613 
    614          allocate(field(num_fields)%data(isdata:iedata,jsdata:jedata,siz(3),nbuf),&
    615               field(num_fields)%mask(isdata:iedata,jsdata:jedata,siz(3),nbuf) )
    616             field(num_fields)%mask = .false.
    617             field(num_fields)%data = 0.0
    618          slope=1.0;intercept=0.0
    619 !             if (units /= 'same') call convert_units(trim(field(num_fields)%units),trim(units),slope,intercept)
    620 !             if (verb.and.units /= 'same') then
    621 !                 write(outunit,*) 'attempting to convert data to units = ',trim(units)
    622 !                 write(outunit,'(a,f8.3,a,f8.3)') 'factor = ',slope,' offset= ',intercept
    623 !             endif
    624          field(num_fields)%slope = slope
    625          field(num_fields)%intercept = intercept
    626          allocate(field(num_fields)%ibuf(nbuf))
    627          field(num_fields)%ibuf = -1
    628          field(num_fields)%nbuf =  0 ! initialize buffer number so that first reading fills data(:,:,:,1)
    629          if(PRESENT(override)) then
    630             field(num_fields)%is_src = 1
    631             field(num_fields)%ie_src = gxsize
    632             field(num_fields)%js_src = 1
    633             field(num_fields)%je_src = gysize
    634             allocate(field(num_fields)%src_data(gxsize,gysize,siz(3),nbuf))
    635          else
    636             field(num_fields)%is_src = isdata
    637             field(num_fields)%ie_src = iedata
    638             field(num_fields)%js_src = jsdata
    639             field(num_fields)%je_src = jedata
    640             allocate(field(num_fields)%src_data(isdata:iedata,jsdata:jedata,siz(3),nbuf))
    641          endif
    642 
    643          allocate(field(num_fields)%time(ntime))

Page 13          Source Listing                  INIT_EXTERNAL_FIELD
2021-06-01 08:55                                 time_interp_external.F90

    644          allocate(field(num_fields)%period(ntime))
    645          allocate(field(num_fields)%start_time(ntime))
    646          allocate(field(num_fields)%end_time(ntime))
    647 
    648          call mpp_get_atts(time_axis,units=units,calendar=calendar_type)
    649          do j=1,ntime
    650             field(num_fields)%time(j)       = get_cal_time(tstamp(j),trim(units),trim(calendar_type),permit_calendar_convers
    650 ion)
    651             field(num_fields)%start_time(j) = get_cal_time(tstart(j),trim(units),trim(calendar_type),permit_calendar_convers
    651 ion)
    652             field(num_fields)%end_time(j)   = get_cal_time(  tend(j),trim(units),trim(calendar_type),permit_calendar_convers
    652 ion)
    653          enddo
    654 
    655          if (field(num_fields)%modulo_time) then
    656             call set_time_modulo(field(num_fields)%Time)
    657             call set_time_modulo(field(num_fields)%start_time)
    658             call set_time_modulo(field(num_fields)%end_time)
    659          endif
    660 
    661          if(present(correct_leap_year_inconsistency)) then
    662            field(num_fields)%correct_leap_year_inconsistency = correct_leap_year_inconsistency
    663          else
    664            field(num_fields)%correct_leap_year_inconsistency = .false.
    665          endif
    666 
    667          if(get_axis_modulo_times(time_axis, timebeg, timeend)) then
    668            if(get_calendar_type() == NO_CALENDAR) then
    669              field(num_fields)%modulo_time_beg = set_time(timebeg)
    670              field(num_fields)%modulo_time_end = set_time(timeend)
    671            else
    672              field(num_fields)%modulo_time_beg = set_date(timebeg)
    673              field(num_fields)%modulo_time_end = set_date(timeend)
    674            endif
    675            field(num_fields)%have_modulo_times = .true.
    676          else
    677            field(num_fields)%have_modulo_times = .false.
    678          endif
    679          if(ntime == 1) then
    680             call mpp_error(NOTE, 'time_interp_external_mod: file '//trim(file)//'  has only one time level')
    681          else
    682             do j= 1, ntime
    683                field(num_fields)%period(j) = field(num_fields)%end_time(j)-field(num_fields)%start_time(j)
    684                if (field(num_fields)%period(j) > set_time(0,0)) then
    685                   call get_time(field(num_fields)%period(j), sec, day)
    686                   sec = sec/2+mod(day,2)*43200
    687                   day = day/2
    688                   field(num_fields)%time(j) = field(num_fields)%start_time(j)+&
    689                        set_time(sec,day)
    690                else
    691                   if (j > 1 .and. j < ntime) then
    692                      tdiff = field(num_fields)%time(j+1) -  field(num_fields)%time(j-1)
    693                      call get_time(tdiff, sec, day)
    694                      sec = sec/2+mod(day,2)*43200
    695                      day = day/2
    696                      field(num_fields)%period(j) = set_time(sec,day)
    697                      sec = sec/2+mod(day,2)*43200

Page 14          Source Listing                  INIT_EXTERNAL_FIELD
2021-06-01 08:55                                 time_interp_external.F90

    698                      day = day/2
    699                      field(num_fields)%start_time(j) = field(num_fields)%time(j) - set_time(sec,day)
    700                      field(num_fields)%end_time(j) = field(num_fields)%time(j) + set_time(sec,day)
    701                   elseif ( j == 1) then
    702                      tdiff = field(num_fields)%time(2) -  field(num_fields)%time(1)
    703                      call get_time(tdiff, sec, day)
    704                      field(num_fields)%period(j) = set_time(sec,day)
    705                      sec = sec/2+mod(day,2)*43200
    706                      day = day/2
    707                      field(num_fields)%start_time(j) = field(num_fields)%time(j) - set_time(sec,day)
    708                      field(num_fields)%end_time(j) = field(num_fields)%time(j) + set_time(sec,day)
    709                   else
    710                      tdiff = field(num_fields)%time(ntime) -  field(num_fields)%time(ntime-1)
    711                      call get_time(tdiff, sec, day)
    712                      field(num_fields)%period(j) = set_time(sec,day)
    713                      sec = sec/2+mod(day,2)*43200
    714                      day = day/2
    715                      field(num_fields)%start_time(j) = field(num_fields)%time(j) - set_time(sec,day)
    716                      field(num_fields)%end_time(j) = field(num_fields)%time(j) + set_time(sec,day)
    717                   endif
    718                endif
    719             enddo
    720          endif
    721 
    722          do j=1,ntime-1
    723             if (field(num_fields)%time(j) >= field(num_fields)%time(j+1)) then
    724                write(msg,'(A,i20)') "times not monotonically increasing. Filename: " &
    725                     //TRIM(file)//"  field:  "//TRIM(fieldname)//" timeslice: ", j
    726                call mpp_error(FATAL, TRIM(msg))
    727             endif
    728          enddo
    729 
    730          field(num_fields)%modulo_time = get_axis_modulo(time_axis)
    731 
    732          if (verb) then
    733             if (field(num_fields)%modulo_time) write(outunit,*) 'data are being treated as modulo in time'
    734             do j= 1, ntime
    735                write(outunit,*) 'time index,  ', j
    736                call get_date(field(num_fields)%start_time(j),yr,mon,day,hr,minu,sec)
    737                write(outunit,'(a,i4,a,i2,a,i2,1x,i2,a,i2,a,i2)') &
    738                     'start time: yyyy/mm/dd hh:mm:ss= ',yr,'/',mon,'/',day,hr,':',minu,':',sec
    739                call get_date(field(num_fields)%time(j),yr,mon,day,hr,minu,sec)
    740                write(outunit,'(a,i4,a,i2,a,i2,1x,i2,a,i2,a,i2)') &
    741                     'mid time: yyyy/mm/dd hh:mm:ss= ',yr,'/',mon,'/',day,hr,':',minu,':',sec
    742                call get_date(field(num_fields)%end_time(j),yr,mon,day,hr,minu,sec)
    743                write(outunit,'(a,i4,a,i2,a,i2,1x,i2,a,i2,a,i2)') &
    744                     'end time: yyyy/mm/dd hh:mm:ss= ',yr,'/',mon,'/',day,hr,':',minu,':',sec
    745             enddo
    746          end if
    747 
    748       enddo
    749 
    750       if (num_fields == nfields_orig) then
    751         if (present(ierr)) then
    752            ierr = ERR_FIELD_NOT_FOUND
    753         else
    754            call mpp_error(FATAL,'external field "'//trim(fieldname)//'" not found in file "'//trim(file)//'"')

Page 15          Source Listing                  INIT_EXTERNAL_FIELD
2021-06-01 08:55                                 time_interp_external.F90

    755         endif
    756       endif
    757 
    758       deallocate(global_atts)
    759       deallocate(axes)
    760       deallocate(flds)
    761       deallocate(tstamp, tstart, tend, tavg)
    762 
    763       return
    764 
    765     end function init_external_field


ENTRY POINTS

  Name                                                        
                                                              
 time_interp_external_mod_mp_init_external_field_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 ATTTYPE                    Type   370                                  scalar                    149,370                           
 AXES                       Local  368      RECORD          1424  1     1        ALC              454,455,759                       
 AXISTYPE                   Type   356                                  scalar   PRIV             149,218,356,368,369,1420          
 AXIS_CENTERS               Dummy  348      RECORD          1424  1     4        ARG,INOUT        595,596                           
 AXIS_SIZES                 Dummy  348      I(4)            4     1     4        ARG,INOUT        551,573,599,600                   
 CALENDAR_TYPE              Local  381      CHAR            128         scalar                    648,650,651,652                   
 CART                       Local  378      CHAR            1           scalar                    530,531,533,537,538,540           
 CART_DIR                   Local  379      CHAR            1     1     4                         393,538                           
 CORRECT_LEAP_YEAR_INCONSIS                                                                                                         
 TENCY                      Dummy  348      L(4)            4           scalar   ARG,IN           661,662                           
 DAY                        Local  384      I(4)            4           scalar                    685,686,687,689,693,694,695,696,69
                                                                                                  7,698,699,700,703,704,705,706,707,
                                                                                                  708,711,712,713,714,715,716,736,73
                                                                                                  8,739,741,742,744                 
 DESIRED_UNITS              Dummy  347      CHAR                        scalar   ARG,IN           409,410                           
 DOMAIN                     Dummy  347      DOMAIN2D        752         scalar   ARG,IN           465,466,468,469,511,513,543,565   
 DOMAIN2D                   Type   355                                  scalar                    156,217,355                       
 DXSIZE                     Local  375      I(4)            4           scalar                    468,547,557                       
 DXSIZE_MAX                 Local  375      I(4)            4           scalar                    468                               
 DYSIZE                     Local  375      I(4)            4           scalar                    468,569,578                       
 DYSIZE_MAX                 Local  375      I(4)            4           scalar                    468                               
 ERR_FIELD_NOT_FOUND        Param  752      I(4)            4           scalar                    198,752                           
 FATAL                      Param  390      I(4)            4           scalar   PRIV             146,390,411,436,450,471,493,523,53
                                                                                                  5,561,582,606,607,726,754,858,868,
                                                                                                  884,891,921,933,950,1000,1013,1025
                                                                                                  ,1042,1126,1145,1171,1208,1228,136
                                                                                                  7,1396,1423,1442                  
 FIELD                      Local  498      RECORD          8880  1     1        PTR,PRIV,SAVE    257,498,499,500,501,502,503,504,50
                                                                                                  5,506,507,508,509,510,512,513,514,
                                                                                                  515,517,520,525,526,527,528,529,54
                                                                                                  8,553,555,557,564,570,576,578,585,
                                                                                                  586,588,589,590,593,596,600,605,61
                                                                                                  0,611,612,614,615,616,617,624,625,

Page 16          Source Listing                  INIT_EXTERNAL_FIELD
2021-06-01 08:55 Symbol Table                    time_interp_external.F90

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
                                                                                                  626,627,628,630,631,632,633,634,63
                                                                                                  6,637,638,639,640,643,644,645,646,
                                                                                                  650,651,652,655,656,657,658,662,66
                                                                                                  4,669,670,672,673,675,677,683,684,
                                                                                                  685,688,692,696,699,700,702,704,70
                                                                                                  7,708,710,712,715,716,723,730,733,
                                                                                                  736,739,742,860,861,863,869,882,88
                                                                                                  4,891,897,899,900,901,902,903,906,
                                                                                                  909,910,914,916,917,918,920,922,92
                                                                                                  5,930,932,934,945,946,947,948,953,
                                                                                                  957,958,959,960,963,966,967,968,97
                                                                                                  3,974,1002,1004,1005,1006,1008,100
                                                                                                  9,1010,1012,1014,1017,1022,1024,10
                                                                                                  26,1036,1037,1038,1039,1043,1045,1
                                                                                                  225,1226,1228,1230,1231,1232,1233,
                                                                                                  1234,1235,1236,1237,1247,1248,1249
                                                                                                  ,1250,1251,1291,1292,1320,1321,132
                                                                                                  2,1324,1370,1371,1372,1373,1400,14
                                                                                                  26,1427,1428,1429,1444,1446,1463,1
                                                                                                  464,1465,1467,1469,1470,1471,1472,
                                                                                                  1473,1476                         
 FIELDNAME                  Dummy  347      CHAR                        scalar   ARG,IN           448,483,485,534,560,581,725,754   
 FIELDTYPE                  Type   367                                  scalar                    149,221,367                       
 FILE                       Dummy  347      CHAR                        scalar   ARG,IN           421,427,439,534,560,581,680,725,75
                                                                                                  4                                 
 FLDS                       Local  367      RECORD          1096  1     1        ALC              456,457,479,480,481,501,520,522,76
                                                                                                  0                                 
 FLD_AXES                   Local  368      RECORD          1424  1     1        ALC              521,522,531,532,553,564,585,588,60
                                                                                                  3                                 
 FLD_UNITS                  Local  380      CHAR            128         scalar                    479,500                           
 FORM                       Local  373      I(4)            4           scalar                    397,398,427                       
 FORMAT                     Dummy  347      I(4)            4           scalar   ARG,IN           398                               
 FSET                       Local  373      I(4)            4           scalar                    401,428                           
 GET_AXIS_CART              Subr   531                                           PRIV             159,531                           
 GET_AXIS_MODULO            Func   730      L(4)            4           scalar   PRIV             159,730                           
 GET_AXIS_MODULO_TIMES      Func   667      L(4)            4           scalar   PRIV             159,667                           
 GET_CALENDAR_TYPE          Func   668      I(4)            4           scalar   PRIV             154,668                           
 GET_CAL_TIME               Func   650      RECORD          16          scalar   PRIV             155,650,651,652                   
 GET_DATE                   Subr   736                                           PRIV             152,736,739,742,939,1031,1062     
 GET_TIME                   Subr   685                                           PRIV             154,685,693,703,711               
 GLOBAL_ATTS                Local  370      RECORD          1488  1     1        ALC              452,453,758                       
 GXSIZE                     Local  382      I(4)            4           scalar                    462,469,546,550,559,631,634       
 GXSIZE_MAX                 Local  382      I(4)            4           scalar                    469                               
 GYSIZE                     Local  382      I(4)            4           scalar                    462,469,568,572,580,633,634       
 GYSIZE_MAX                 Local  382      I(4)            4           scalar                    469                               
 HR                         Local  384      I(4)            4           scalar                    736,738,739,741,742,744           
 I                          Local  373      I(4)            4           scalar                    420,421,422,478,479,480,481,501,52
                                                                                                  0,522                             
 IECOMP                     Local  374      I(4)            4           scalar                    466,467,514,545,548               
 IEDATA                     Local  375      I(4)            4           scalar                    461,468,544,614,615,637,640       
 IEGLOBAL                   Local  374      I(4)            4           scalar                    469                               
 IERR                       Dummy  349      I(4)            4           scalar   ARG,OUT          391,751,752                       
 IGNORE_AXATTS              Local  387      L(4)            4           scalar                    392,394,533,537                   
 IGNORE_AXIS_ATTS           Dummy  349      L(4)            4           scalar   ARG,INOUT        394                               
 INIT_EXTERNAL_FIELD        Func   347      I(4)            4           scalar                                                      

Page 17          Source Listing                  INIT_EXTERNAL_FIELD
2021-06-01 08:55 Symbol Table                    time_interp_external.F90

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 INTERCEPT                  Local  372      R(8)            8           scalar                    618,625                           
 ISCOMP                     Local  374      I(4)            4           scalar                    466,467,514,545,548               
 ISDATA                     Local  375      I(4)            4           scalar                    461,468,544,614,615,636,640       
 ISGLOBAL                   Local  374      I(4)            4           scalar                    469                               
 J                          Local  373      I(4)            4           scalar                    529,531,532,538,542,553,564,585,58
                                                                                                  8,590,649,650,651,652,682,683,684,
                                                                                                  685,688,691,692,696,699,700,701,70
                                                                                                  4,707,708,712,715,716,722,723,725,
                                                                                                  734,735,736,739,742               
 JECOMP                     Local  374      I(4)            4           scalar                    466,467,515,567,570               
 JEDATA                     Local  375      I(4)            4           scalar                    461,468,566,614,615,639,640       
 JEGLOBAL                   Local  374      I(4)            4           scalar                    469                               
 JSCOMP                     Local  374      I(4)            4           scalar                    466,467,515,567,570               
 JSDATA                     Local  375      I(4)            4           scalar                    461,468,566,614,615,638,640       
 JSGLOBAL                   Local  374      I(4)            4           scalar                    469                               
 LEN                        Local  385      I(4)            4           scalar                    532,544,545,546,547,550,551,559,56
                                                                                                  6,567,568,569,572,573,580         
 LOWERCASE                  Func   483      CHAR                        scalar   TGT,PRIV         160,483                           
 MIN                        Func   608                                  scalar                    608                               
 MINU                       Local  384      I(4)            4           scalar                    736,738,739,741,742,744           
 MISSING                    Local  363      R(8)            8           scalar                    481,528                           
 MOD                        Func   686                                  scalar                    686,694,697,705,713               
 MON                        Local  384      I(4)            4           scalar                    736,738,739,741,742,744           
 MPP_ERROR                  Local  390                                  scalar   PRIV             146,390,411,436,450,471,493,523,53
                                                                                                  5,561,582,606,607,680,726,754,858,
                                                                                                  868,884,891,921,933,950,1000,1013,
                                                                                                  1025,1042,1126,1145,1171,1208,1228
                                                                                                  ,1367,1396,1423,1442              
 MPP_ERROR_BASIC            Subr   390                                           PRIV             390,411,436,450,471,493,523,535,56
                                                                                                  1,582,606,607,680,726,754,858,868,
                                                                                                  884,891,921,933,950,1000,1013,1025
                                                                                                  ,1042,1126,1145,1171,1208,1228,136
                                                                                                  7,1396,1423,1442                  
 MPP_GET_ATTS               Local  453                                  scalar   PRIV             148,453,479,481,520,522,532,648   
 MPP_GET_AXES               Subr   455                                           PRIV             150,455                           
 MPP_GET_AXIS_ATTS          Subr   532                                           PRIV             532,648                           
 MPP_GET_COMPUTE_DOMAIN     Local  466                                  scalar   PRIV             156,466                           
 MPP_GET_COMPUTE_DOMAIN2D   Subr   466                                           PRIV             466                               
 MPP_GET_DATA_DOMAIN        Local  468                                  scalar   PRIV             156,468                           
 MPP_GET_DATA_DOMAIN2D      Subr   468                                           PRIV             468                               
 MPP_GET_FIELDS             Subr   457                                           PRIV             150,457                           
 MPP_GET_FIELD_ATTS         Subr   479                                           PRIV             479,481,520,522                   
 MPP_GET_GLOBAL_ATTS        Subr   453                                           PRIV             453                               
 MPP_GET_GLOBAL_DOMAIN      Local  469                                  scalar   PRIV             157,469                           
 MPP_GET_GLOBAL_DOMAIN2D    Subr   469                                           PRIV             469                               
 MPP_GET_INFO               Subr   445                                           PRIV             148,445                           
 MPP_GET_TAVG_INFO          Subr   480                                           PRIV             151,480                           
 MPP_GET_TIMES              Subr   459                                           PRIV             149,459                           
 MPP_MULTI                  Param  399      I(4)            4           scalar   PRIV             148,399                           
 MPP_NETCDF                 Param  397      I(4)            4           scalar   PRIV             148,397                           
 MPP_OPEN                   Subr   427                                           PRIV             148,427                           
 MPP_RDONLY                 Param  427      I(4)            4           scalar   PRIV             149,427                           
 MPP_SINGLE                 Param  401      I(4)            4           scalar   PRIV             148,401                           
 MSG                        Local  381      CHAR            128         scalar                    448,450,534,535,560,561,581,582,72
                                                                                                  4,726                             

Page 18          Source Listing                  INIT_EXTERNAL_FIELD
2021-06-01 08:55 Symbol Table                    time_interp_external.F90

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 NAME                       Local  381      CHAR            128         scalar                    479,483,499                       
 NATT                       Local  373      I(4)            4           scalar                    445,452                           
 NBUF                       Local  385      I(4)            4           scalar                    608,611,614,615,626,634,640       
 NDIM                       Local  373      I(4)            4           scalar                    445,454,479,521,523,526           
 NFIELDS_ORIG               Local  385      I(4)            4           scalar                    476,750                           
 NFILE                      Local  385      I(4)            4           scalar                    419,422,426,442                   
 NOTE                       Param  680      I(4)            4           scalar   PRIV             146,680                           
 NO_CALENDAR                Param  668      I(4)            4           scalar   PRIV             154,668                           
 NO_REGION                  Param  506      I(4)            4           scalar                    195,506,901,957,1143,1170,1207    
 NTIME                      Local  373      I(4)            4           scalar                    445,447,458,589,643,644,645,646,64
                                                                                                  9,679,682,691,710,722,734         
 NUMWINDOWS                 Local  386      I(4)            4           scalar                    405,406,610,611                   
 NUM_FIELDS                 Local  476      I(4)            4           scalar   PRIV             200,476,486,487,497,498,499,500,50
                                                                                                  1,502,503,504,505,506,507,508,509,
                                                                                                  510,512,513,514,515,517,520,525,52
                                                                                                  6,527,528,529,548,553,555,557,564,
                                                                                                  570,576,578,585,586,588,589,590,59
                                                                                                  3,596,600,605,610,611,612,614,615,
                                                                                                  616,617,624,625,626,627,628,630,63
                                                                                                  1,632,633,634,636,637,638,639,640,
                                                                                                  643,644,645,646,650,651,652,655,65
                                                                                                  6,657,658,662,664,669,670,672,673,
                                                                                                  675,677,683,684,685,688,692,696,69
                                                                                                  9,700,702,704,707,708,710,712,715,
                                                                                                  716,723,730,733,736,739,742,750,85
                                                                                                  7,999,1366,1395,1422,1441,1462,147
                                                                                                  9                                 
 NUM_FILES                  Local  420      I(4)            4           scalar   PRIV             200,420,429,430,439,440           
 NVAR                       Local  373      I(4)            4           scalar                    445,456,478                       
 NWINDOWS                   Dummy  349      I(4)            4           scalar   ARG,IN           406                               
 NX                         Local  385      I(4)            4           scalar                    467,555                           
 NY                         Local  385      I(4)            4           scalar                    467,576                           
 OPENED_FILES               Local  421      RECORD          132   1     1        PTR,PRIV,SAVE    258,421,439,440,442,1265,1266,1275
                                                                                                  ,1276,1277,1279,1477              
 OVERRIDE                   Dummy  348      L(4)            4           scalar   ARG,IN           543,549,565,571,599,629           
 PERMIT_CALENDAR_CONVERSION Dummy  349      L(4)            4           scalar   ARG,IN           650,651,652                       
 PRESENT                    Func   391                                  scalar                    391,394,396,398,400,403,406,409,46
                                                                                                  5,511,543,549,551,565,571,573,595,
                                                                                                  599,629,661,751                   
 SEC                        Local  384      I(4)            4           scalar                    685,686,689,693,694,696,697,699,70
                                                                                                  0,703,704,705,707,708,711,712,713,
                                                                                                  715,716,736,738,739,741,742,744   
 SET_DATE                   Local  672                                  scalar   PRIV             152,672,673,1064                  
 SET_DATE_C                 Func   672      RECORD          16          scalar   PRIV             672,673                           
 SET_TIME                   Local  669                                  scalar   PRIV             154,669,670,684,689,696,699,700,70
                                                                                                  4,707,708,712,715,716             
 SET_TIME_C                 Func   669      RECORD          16          scalar   PRIV             669,670                           
 SET_TIME_I                 Func   684      RECORD          16          scalar   PRIV             684,689,696,699,700,704,707,708,71
                                                                                                  2,715,716                         
 SET_TIME_MODULO            Subr   656                                           PRIV             211,656,657,658                   
 SIZ                        Local  382      I(4)            4     1     4                         593,604,608,614,615,634,640       
 SIZ_IN                     Local  382      I(4)            4     1     4        TGT              463,479,586                       
 SLOPE                      Local  372      R(8)            8           scalar                    618,624                           
 SUCCESS                    Param  391      I(4)            4           scalar                    198,391                           
 TAVG                       Local  377      R(8)            8     1     1        ALC              458,480,761                       

Page 19          Source Listing                  INIT_EXTERNAL_FIELD
2021-06-01 08:55 Symbol Table                    time_interp_external.F90

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 TDIFF                      Local  383      TIME_TYPE       16          scalar                    692,693,702,703,710,711           
 TEND                       Local  377      R(8)            8     1     1        ALC              458,480,652,761                   
 THREAD                     Local  373      I(4)            4           scalar                    399,400,427                       
 THREADING                  Dummy  347      I(4)            4           scalar   ARG,IN           400                               
 TIMEBEG                    Local  381      CHAR            128         scalar                    667,669,672                       
 TIMEEND                    Local  381      CHAR            128         scalar                    667,670,673                       
 TIME_AXIS                  Local  369      AXISTYPE        1424        scalar                    455,648,667,730                   
 TIME_GE                    Func   723      L(4)            4           scalar   PRIV             723                               
 TIME_GT                    Func   684      L(4)            4           scalar   PRIV             684                               
 TIME_MINUS                 Func   683      RECORD          16          scalar   PRIV             683,692,699,702,707,710,715       
 TIME_PLUS                  Func   688      RECORD          16          scalar   PRIV             688,700,708,716                   
 TIME_TYPE                  Type   383                                  scalar                    152,219,220,222,233,383,774,823,98
                                                                                                  3,1054,1437                       
 TRANSPOSE_XY               Local  376      L(4)            4           scalar                    460,542,606                       
 TRIM                       Func   421                                  scalar                    421,427,439,448,450,483,485,499,50
                                                                                                  0,534,535,560,561,581,582,605,650,
                                                                                                  651,652,680,725,726,754           
 TSTAMP                     Local  377      R(8)            8     1     1        ALC              458,459,480,650,761               
 TSTART                     Local  377      R(8)            8     1     1        ALC              458,480,651,761                   
 UNIT                       Local  373      I(4)            4           scalar                    427,440,442,445,453,455,457,459,48
                                                                                                  0,498                             
 UNITS                      Local  380      CHAR            128         scalar                    408,410,648,650,651,652           
 USE_COMP_DOMAIN            Dummy  349      L(4)            4           scalar   ARG,IN           396                               
 USE_COMP_DOMAIN1           Local  376      L(4)            4           scalar                    395,396,470,554,575               
 VERB                       Local  376      L(4)            4           scalar                    402,403,404,485,604,605,732       
 VERBOSE                    Dummy  348      L(4)            4           scalar   ARG,IN           403                               
 YR                         Local  384      I(4)            4           scalar                    736,738,739,741,742,744           


TYPE COMPONENTS/COMMON VARIABLES

 Name                       Type            Bytes Offset   Dimen Elements Attributes       References                         
                                                                                                                              
 EXT_FIELDTYPE.AXES         RECORD          1424  1032     1     4                         553,564,585,588,596,1303,1426,1427 
                                                                                           ,1428,1429,1467                    
 EXT_FIELDTYPE.CORRECT_LEAP_YEAR_INCONSISTENCY                                                                             ...
                            L(4)            4     8724           scalar                    662,664,918,1010                   
 EXT_FIELDTYPE.DATA         R(8)            8     8120     4     1        PTR              614,617,903,910,959,960,967,968,10 
                                                                                           06,1043,1102,1162,1173,1174,1177,1 
                                                                                           178,1198,1210,1211,1213,1214,1310, 
                                                                                           1464                               
 EXT_FIELDTYPE.DOMAIN       DOMAIN2D        752   280            scalar                    513,1109,1302,1469                 
 EXT_FIELDTYPE.DOMAIN_PRESENT                                                                                              ...
                            L(4)            4     8652           scalar                    512,517,1107,1314                  
 EXT_FIELDTYPE.END_TIME     RECORD          16    6872     1     1        PTR              646,652,658,683,700,708,716,742,13 
                                                                                           06,1463                            
 EXT_FIELDTYPE.FIELD        FIELDTYPE       1096  6944           scalar                    501,1109,1117,1206,1307,1470       
 EXT_FIELDTYPE.HAVE_MODULO_TIMES                                                                                           ...
                            L(4)            4     8720           scalar                    675,677,916,1008                   
 EXT_FIELDTYPE.IBUF         I(4)            4     8408     1     1        PTR              626,627,900,947,948,953,1005,1038, 
                                                                                           1039,1045,1094,1104,1191,1200,1311 
                                                                                           ,1464                              
 EXT_FIELDTYPE.IEC          I(4)            4     8676           scalar                    503,514,548,860,1121,1317          
 EXT_FIELDTYPE.IE_REGION    I(4)            4     8736           scalar                    508,1139,1249                      
 EXT_FIELDTYPE.IE_SRC       I(4)            4     8752           scalar                    631,637,1113,1225,1235             

Page 20          Source Listing                  INIT_EXTERNAL_FIELD
2021-06-01 08:55 Symbol Table                    time_interp_external.F90

 Name                       Type            Bytes Offset   Dimen Elements Attributes       References                         
                                                                                                                              
 EXT_FIELDTYPE.INTERCEPT    R(8)            8     8664           scalar                    625,1178,1214,1316,1473            
 EXT_FIELDTYPE.ISC          I(4)            4     8672           scalar                    502,514,548,860,1121,1317          
 EXT_FIELDTYPE.IS_REGION    I(4)            4     8732           scalar                    507,1139,1248                      
 EXT_FIELDTYPE.IS_SRC       I(4)            4     8748           scalar                    630,636,1113,1225,1234             
 EXT_FIELDTYPE.JEC          I(4)            4     8684           scalar                    505,515,570,861,1122,1318          
 EXT_FIELDTYPE.JE_REGION    I(4)            4     8744           scalar                    510,1140,1251                      
 EXT_FIELDTYPE.JE_SRC       I(4)            4     8760           scalar                    633,639,1114,1226,1237             
 EXT_FIELDTYPE.JSC          I(4)            4     8680           scalar                    504,515,570,861,1122,1318          
 EXT_FIELDTYPE.JS_REGION    I(4)            4     8740           scalar                    509,1140,1250                      
 EXT_FIELDTYPE.JS_SRC       I(4)            4     8756           scalar                    632,638,1114,1226,1236             
 EXT_FIELDTYPE.MASK         L(4)            4     8264     4     1        PTR              615,616,902,909,914,958,966,973,97 
                                                                                           4,1166,1174,1177,1211,1213,1464    
 EXT_FIELDTYPE.MISSING      R(8)            8     8872           scalar                    528,906,963,1400                   
 EXT_FIELDTYPE.MODULO_TIME  L(4)            4     8112           scalar                    655,730,733,925,1017,1309          
 EXT_FIELDTYPE.MODULO_TIME_BEG                                                                                             ...
                            TIME_TYPE       16    8688           scalar                    669,672,917,1009                   
 EXT_FIELDTYPE.MODULO_TIME_END                                                                                             ...
                            TIME_TYPE       16    8704           scalar                    670,673,917,1009                   
 EXT_FIELDTYPE.NAME         CHAR            128   4              scalar                    499,869,884,891,922,934,1014,1026, 
                                                                                           1108,1111,1202,1298                
 EXT_FIELDTYPE.NBUF         I(4)            4     8648           scalar                    628,1101,1102,1103,1197,1198,1199, 
                                                                                           1313,1471                          
 EXT_FIELDTYPE.NDIM         I(4)            4     276            scalar                    526,529,1301                       
 EXT_FIELDTYPE.NEED_COMPUTE L(4)            4     8776     2     1        PTR              611,612,1105,1136,1168             
 EXT_FIELDTYPE.NUMWINDOWS   I(4)            4     8768           scalar                    610,863,1124                       
 EXT_FIELDTYPE.PERIOD       RECORD          16    8040     1     1        PTR              644,683,684,685,696,704,712,1308,1 
                                                                                           464                                
 EXT_FIELDTYPE.REGION_TYPE  I(4)            4     8728           scalar                    506,901,957,1143,1147,1170,1207,12 
                                                                                           47                                 
 EXT_FIELDTYPE.SIZ          I(4)            4     260      1     4                         525,555,557,576,578,586,589,593,60 
                                                                                           0,882,897,1002,1300,1370,1371,1372 
                                                                                           ,1373                              
 EXT_FIELDTYPE.SLOPE        R(8)            8     8656           scalar                    624,1178,1214,1315,1472            
 EXT_FIELDTYPE.SRC_DATA     R(8)            8     8480     4     1        PTR              634,640,1085,1109,1115,1117,1142,1 
                                                                                           161,1162,1173,1204,1206,1210,1228, 
                                                                                           1230,1231,1232,1233,1312,1465      
 EXT_FIELDTYPE.START_TIME   RECORD          16    6800     1     1        PTR              645,651,657,683,688,699,707,715,73 
                                                                                           6,1305,1463                        
 EXT_FIELDTYPE.TDIM         I(4)            4     8764           scalar                    527,590,1116,1205                  
 EXT_FIELDTYPE.TIME         RECORD          16    6728     1     1        PTR              643,650,656,688,692,699,700,702,70 
                                                                                           7,708,710,715,716,723,739,917,930, 
                                                                                           1009,1022,1304,1444,1446,1463      
 EXT_FIELDTYPE.UNIT         I(4)            4     0              scalar                    498,920,932,1012,1024,1109,1117,12 
                                                                                           06,1297                            
 EXT_FIELDTYPE.UNITS        CHAR            128   132            scalar                    500,605,1299                       
 EXT_FIELDTYPE.VALID        VALIDTYPE       24    8624           scalar                    520,1142,1174,1211                 
 FILETYPE.FILENAME          CHAR            128   0              scalar                    421,439,1271                       
 FILETYPE.UNIT              I(4)            4     128            scalar                    440,442,1272                       

Page 21          Source Listing                  INIT_EXTERNAL_FIELD
2021-06-01 08:55                                 time_interp_external.F90

    766 
    767 !</FUNCTION> NAME="init_external_field"
    768 
    769 
    770     subroutine time_interp_external_2d(index, time, data_in, interp, verbose,horz_interp, mask_out, &
    771                is_in, ie_in, js_in, je_in, window_id)
    772 
    773       integer, intent(in) :: index
    774       type(time_type), intent(in) :: time
    775       real, dimension(:,:), intent(inout) :: data_in
    776       integer, intent(in), optional :: interp
    777       logical, intent(in), optional :: verbose
    778       type(horiz_interp_type),intent(in), optional :: horz_interp
    779       logical, dimension(:,:), intent(out), optional :: mask_out ! set to true where output data is valid
    780       integer,                  intent(in), optional :: is_in, ie_in, js_in, je_in
    781       integer,                  intent(in), optional :: window_id
    782 
    783       real   , dimension(size(data_in,1), size(data_in,2), 1) :: data_out
    784       logical, dimension(size(data_in,1), size(data_in,2), 1) :: mask3d
    785 
    786       data_out(:,:,1) = data_in(:,:) ! fill initial values for the portions of array that are not touched by 3d routine
    787       call time_interp_external_3d(index, time, data_out, interp, verbose, horz_interp, mask3d, &
    788                                    is_in=is_in,ie_in=ie_in,js_in=js_in,je_in=je_in,window_id=window_id)
    789       data_in(:,:) = data_out(:,:,1)
    790       if (PRESENT(mask_out)) mask_out(:,:) = mask3d(:,:,1)
    791 
    792       return
    793     end subroutine time_interp_external_2d

Page 22          Source Listing                  TIME_INTERP_EXTERNAL_2D
2021-06-01 08:55 Entry Points                    time_interp_external.F90



ENTRY POINTS

  Name                                                            
                                                                  
 time_interp_external_mod_mp_time_interp_external_2d_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 DATA_IN                    Dummy  770      R(8)            8     2     1        ARG,INOUT        783,784,786,789                   
 DATA_OUT                   Local  783      R(8)            8     3     0                         786,787,789                       
 HORIZ_INTERP_TYPE          Type   778                                  scalar                    162,778,827,1075                  
 HORZ_INTERP                Dummy  770      HORIZ_INTERP_TYPE                                                                       
                                                            2208        scalar   ARG,IN           787                               
 IE_IN                      Dummy  771      I(4)            4           scalar   ARG,IN           788                               
 INDEX                      Dummy  770      I(4)            4           scalar   ARG,IN           787                               
 INTERP                     Dummy  770      I(4)            4           scalar   ARG,IN           787                               
 IS_IN                      Dummy  771      I(4)            4           scalar   ARG,IN           788                               
 JE_IN                      Dummy  771      I(4)            4           scalar   ARG,IN           788                               
 JS_IN                      Dummy  771      I(4)            4           scalar   ARG,IN           788                               
 MASK3D                     Local  784      L(4)            4     3     0                         787,790                           
 MASK_OUT                   Dummy  770      L(4)            4     2     1        ARG,OUT          790                               
 PRESENT                    Func   790                                  scalar                    790                               
 SIZE                       Func   783                                  scalar                    783,784                           
 TIME                       Dummy  770      TIME_TYPE       16          scalar   ARG,IN           787                               
 TIME_INTERP_EXTERNAL_2D    Subr   770                                           PRIV                                               
 VERBOSE                    Dummy  770      L(4)            4           scalar   ARG,IN           787                               
 WINDOW_ID                  Dummy  771      I(4)            4           scalar   ARG,IN           788                               

Page 23          Source Listing                  TIME_INTERP_EXTERNAL_2D
2021-06-01 08:55                                 time_interp_external.F90

    794 
    795 !<SUBROUTINE NAME="time_interp_external" >
    796 !
    797 !<DESCRIPTION>
    798 ! Provide data from external file interpolated to current model time.
    799 ! Data may be local to current processor or global, depending on
    800 ! "init_external_field" flags.
    801 !</DESCRIPTION>
    802 !
    803 !<IN NAME="index" TYPE="integer">
    804 ! index of external field from previous call to init_external_field
    805 !</IN>
    806 !<IN NAME="time" TYPE="time_manager_mod:time_type">
    807 ! target time for data
    808 !</IN>
    809 !<INOUT NAME="data" TYPE="real" DIM="(:,:),(:,:,:)">
    810 ! global or local data array
    811 !</INOUT>
    812 !<IN NAME="interp" TYPE="integer">
    813 ! time_interp_external defined interpolation method (optional).  Currently this module only supports
    814 ! LINEAR_TIME_INTERP.
    815 !</IN>
    816 !<IN NAME="verbose" TYPE="logical">
    817 ! verbose flag for debugging (optional).
    818 !</IN>
    819 
    820     subroutine time_interp_external_3d(index, time, data, interp,verbose,horz_interp, mask_out, is_in, ie_in, js_in, je_in, 
    820 window_id)
    821 
    822       integer,                    intent(in)           :: index
    823       type(time_type),            intent(in)           :: time
    824       real, dimension(:,:,:),  intent(inout)           :: data
    825       integer,                    intent(in), optional :: interp
    826       logical,                    intent(in), optional :: verbose
    827       type(horiz_interp_type),    intent(in), optional :: horz_interp
    828       logical, dimension(:,:,:), intent(out), optional :: mask_out ! set to true where output data is valid
    829       integer,                    intent(in), optional :: is_in, ie_in, js_in, je_in
    830       integer,                    intent(in), optional :: window_id
    831 
    832       integer :: nx, ny, nz, interp_method, t1, t2
    833       integer :: i1, i2, isc, iec, jsc, jec, mod_time
    834       integer :: yy, mm, dd, hh, min, ss
    835       character(len=256) :: err_msg, filename
    836 
    837       integer :: isw, iew, jsw, jew, nxw, nyw
    838 ! these are boundaries of the updated portion of the "data" argument
    839 ! they are calculated using sizes of the "data" and isc,iec,jsc,jsc
    840 ! fileds from respective input field, to center the updated portion
    841 ! in the output array
    842 
    843       real :: w1,w2
    844       logical :: verb
    845       character(len=16) :: message1, message2
    846 
    847       nx = size(data,1)
    848       ny = size(data,2)
    849       nz = size(data,3)

Page 24          Source Listing                  TIME_INTERP_EXTERNAL_3D
2021-06-01 08:55                                 time_interp_external.F90

    850 
    851       interp_method = LINEAR_TIME_INTERP
    852       if (PRESENT(interp)) interp_method = interp
    853       verb=.false.
    854       if (PRESENT(verbose)) verb=verbose
    855       if (debug_this_module) verb = .true.
    856 
    857       if (index < 1.or.index > num_fields) &
    858            call mpp_error(FATAL,'invalid index in call to time_interp_ext -- field was not initialized or failed to initiali
    858 ze')
    859 
    860       isc=field(index)%isc;iec=field(index)%iec
    861       jsc=field(index)%jsc;jec=field(index)%jec
    862 
    863       if( field(index)%numwindows == 1 ) then
    864          nxw = iec-isc+1
    865          nyw = jec-jsc+1
    866       else
    867          if( .not. present(is_in) .or. .not. present(ie_in) .or. .not. present(js_in) .or. .not. present(je_in) ) then
    868             call mpp_error(FATAL, 'time_interp_external: is_in, ie_in, js_in and je_in must be present ' // &
    869                                   'when numwindows > 1, field='//trim(field(index)%name))
    870          endif
    871          nxw = ie_in - is_in + 1
    872          nyw = je_in - js_in + 1
    873          isc = isc + is_in - 1
    874          iec = isc + ie_in - is_in
    875          jsc = jsc + js_in - 1
    876          jec = jsc + je_in - js_in
    877       endif
    878 
    879       isw = (nx-nxw)/2+1; iew = isw+nxw-1
    880       jsw = (ny-nyw)/2+1; jew = jsw+nyw-1
    881 
    882       if (nx < nxw .or. ny < nyw .or. nz < field(index)%siz(3)) then
    883          write(message1,'(i6,2i5)') nx,ny,nz
    884          call mpp_error(FATAL,'field '//trim(field(index)%name)//' Array size mismatch in time_interp_external.'// &
    885          ' Array "data" is too small. shape(data)='//message1)
    886       endif
    887       if(PRESENT(mask_out)) then
    888         if (size(mask_out,1) /= nx .or. size(mask_out,2) /= ny .or. size(mask_out,3) /= nz) then
    889           write(message1,'(i6,2i5)') nx,ny,nz
    890           write(message2,'(i6,2i5)') size(mask_out,1),size(mask_out,2),size(mask_out,3)
    891           call mpp_error(FATAL,'field '//trim(field(index)%name)//' array size mismatch in time_interp_external.'// &
    892           ' Shape of array "mask_out" does not match that of array "data".'// &
    893           ' shape(data)='//message1//' shape(mask_out)='//message2)
    894         endif
    895       endif
    896 
    897       if (field(index)%siz(4) == 1) then
    898 ! only one record in the file => time-independent field
    899          call load_record(field(index),1,horz_interp, is_in, ie_in ,js_in, je_in,window_id)
    900          i1 = find_buf_index(1,field(index)%ibuf)
    901          if( field(index)%region_type == NO_REGION ) then
    902             where(field(index)%mask(isc:iec,jsc:jec,:,i1))
    903                data(isw:iew,jsw:jew,:) = field(index)%data(isc:iec,jsc:jec,:,i1)
    904             elsewhere
    905 !               data(isw:iew,jsw:jew,:) = time_interp_missing !field(index)%missing? Balaji

Page 25          Source Listing                  TIME_INTERP_EXTERNAL_3D
2021-06-01 08:55                                 time_interp_external.F90

    906                data(isw:iew,jsw:jew,:) = field(index)%missing
    907             end where
    908          else
    909             where(field(index)%mask(isc:iec,jsc:jec,:,i1))
    910                data(isw:iew,jsw:jew,:) = field(index)%data(isc:iec,jsc:jec,:,i1)
    911             end where
    912          endif
    913          if(PRESENT(mask_out)) &
    914               mask_out(isw:iew,jsw:jew,:) = field(index)%mask(isc:iec,jsc:jec,:,i1)
    915       else
    916         if(field(index)%have_modulo_times) then
    917           call time_interp(time,field(index)%modulo_time_beg, field(index)%modulo_time_end, field(index)%time(:), &
    918                           w2, t1, t2, field(index)%correct_leap_year_inconsistency, err_msg=err_msg)
    919           if(err_msg .NE. '') then
    920              filename = mpp_get_file_name(field(index)%unit)
    921              call mpp_error(FATAL,"time_interp_external 1: "//trim(err_msg)//&
    922                     ",file="//trim(filename)//",field="//trim(field(index)%name) )
    923           endif
    924         else
    925           if(field(index)%modulo_time) then
    926             mod_time=1
    927           else
    928             mod_time=0
    929           endif
    930           call time_interp(time,field(index)%time(:),w2,t1,t2,modtime=mod_time, err_msg=err_msg)
    931           if(err_msg .NE. '') then
    932              filename = mpp_get_file_name(field(index)%unit)
    933              call mpp_error(FATAL,"time_interp_external 2: "//trim(err_msg)//&
    934                     ",file="//trim(filename)//",field="//trim(field(index)%name) )
    935           endif
    936         endif
    937          w1 = 1.0-w2
    938          if (verb) then
    939             call get_date(time,yy,mm,dd,hh,min,ss)
    940             write(outunit,'(a,i4,a,i2,a,i2,1x,i2,a,i2,a,i2)') &
    941                  'target time yyyy/mm/dd hh:mm:ss= ',yy,'/',mm,'/',dd,hh,':',min,':',ss
    942             write(outunit,*) 't1, t2, w1, w2= ', t1, t2, w1, w2
    943          endif
    944 
    945          call load_record(field(index),t1,horz_interp, is_in, ie_in ,js_in, je_in, window_id)
    946          call load_record(field(index),t2,horz_interp, is_in, ie_in ,js_in, je_in, window_id)
    947          i1 = find_buf_index(t1,field(index)%ibuf)
    948          i2 = find_buf_index(t2,field(index)%ibuf)
    949          if(i1<0.or.i2<0) &
    950               call mpp_error(FATAL,'time_interp_external : records were not loaded correctly in memory')
    951 
    952          if (verb) then
    953             write(outunit,*) 'ibuf= ',field(index)%ibuf
    954             write(outunit,*) 'i1,i2= ',i1, i2
    955          endif
    956 
    957          if( field(index)%region_type == NO_REGION ) then
    958             where(field(index)%mask(isc:iec,jsc:jec,:,i1).and.field(index)%mask(isc:iec,jsc:jec,:,i2))
    959                data(isw:iew,jsw:jew,:) = field(index)%data(isc:iec,jsc:jec,:,i1)*w1 + &
    960                     field(index)%data(isc:iec,jsc:jec,:,i2)*w2
    961             elsewhere
    962 !               data(isw:iew,jsw:jew,:) = time_interp_missing !field(index)%missing? Balaji

Page 26          Source Listing                  TIME_INTERP_EXTERNAL_3D
2021-06-01 08:55                                 time_interp_external.F90

    963                data(isw:iew,jsw:jew,:) = field(index)%missing
    964             end where
    965          else
    966             where(field(index)%mask(isc:iec,jsc:jec,:,i1).and.field(index)%mask(isc:iec,jsc:jec,:,i2))
    967                data(isw:iew,jsw:jew,:) = field(index)%data(isc:iec,jsc:jec,:,i1)*w1 + &
    968                     field(index)%data(isc:iec,jsc:jec,:,i2)*w2
    969             end where
    970          endif
    971          if(PRESENT(mask_out)) &
    972               mask_out(isw:iew,jsw:jew,:) = &
    973                                         field(index)%mask(isc:iec,jsc:jec,:,i1).and.&
    974                                         field(index)%mask(isc:iec,jsc:jec,:,i2)
    975       endif
    976 
    977     end subroutine time_interp_external_3d


ENTRY POINTS

  Name                                                            
                                                                  
 time_interp_external_mod_mp_time_interp_external_3d_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 DATA                       Dummy  820      R(8)            8     3     1        ARG,INOUT        847,848,849,903,906,910,959,963,96
                                                                                                  7                                 
 DD                         Local  834      I(4)            4           scalar                    939,941                           
 ERR_MSG                    Local  835      CHAR            256         scalar                    918,919,921,930,931,933           
 FILENAME                   Local  835      CHAR            256         scalar                    920,922,932,934                   
 FIND_BUF_INDEX             Func   900      I(4)            4           scalar   PRIV             210,900,947,948,1005,1038,1039,109
                                                                                                  4,1191,1338,1342                  
 FIND_BUF_INDEX@0           Local  900      I(4)            4           scalar                                                      
 HH                         Local  834      I(4)            4           scalar                    939,941                           
 HORZ_INTERP                Dummy  820      HORIZ_INTERP_TYPE                                                                       
                                                            2208        scalar   ARG,IN           899,945,946                       
 I1                         Local  833      I(4)            4           scalar                    900,902,903,909,910,914,947,949,95
                                                                                                  4,958,959,966,967,973             
 I2                         Local  833      I(4)            4           scalar                    948,949,954,958,960,966,968,974   
 IEC                        Local  833      I(4)            4           scalar                    860,864,874,902,903,909,910,914,95
                                                                                                  8,959,960,966,967,968,973,974     
 IEW                        Local  837      I(4)            4           scalar                    879,903,906,910,914,959,963,967,97
                                                                                                  2                                 
 IE_IN                      Dummy  820      I(4)            4           scalar   ARG,IN           867,871,874,899,945,946           
 INDEX                      Dummy  820      I(4)            4           scalar   ARG,IN           857,860,861,863,869,882,884,891,89
                                                                                                  7,899,900,901,902,903,906,909,910,
                                                                                                  914,916,917,918,920,922,925,930,93
                                                                                                  2,934,945,946,947,948,953,957,958,
                                                                                                  959,960,963,966,967,968,973,974   
 INTERP                     Dummy  820      I(4)            4           scalar   ARG,IN           852                               
 INTERP_METHOD              Local  832      I(4)            4           scalar                    851,852                           
 ISC                        Local  833      I(4)            4           scalar                    860,864,873,874,902,903,909,910,91
                                                                                                  4,958,959,960,966,967,968,973,974 
 ISW                        Local  837      I(4)            4           scalar                    879,903,906,910,914,959,963,967,97

Page 27          Source Listing                  TIME_INTERP_EXTERNAL_3D
2021-06-01 08:55 Symbol Table                    time_interp_external.F90

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
                                                                                                  2                                 
 IS_IN                      Dummy  820      I(4)            4           scalar   ARG,IN           867,871,873,874,899,945,946       
 JEC                        Local  833      I(4)            4           scalar                    861,865,876,902,903,909,910,914,95
                                                                                                  8,959,960,966,967,968,973,974     
 JEW                        Local  837      I(4)            4           scalar                    880,903,906,910,914,959,963,967,97
                                                                                                  2                                 
 JE_IN                      Dummy  820      I(4)            4           scalar   ARG,IN           867,872,876,899,945,946           
 JSC                        Local  833      I(4)            4           scalar                    861,865,875,876,902,903,909,910,91
                                                                                                  4,958,959,960,966,967,968,973,974 
 JSW                        Local  837      I(4)            4           scalar                    880,903,906,910,914,959,963,967,97
                                                                                                  2                                 
 JS_IN                      Dummy  820      I(4)            4           scalar   ARG,IN           867,872,875,876,899,945,946       
 LINEAR_TIME_INTERP         Param  851      I(4)            4           scalar   PRIV             197,851                           
 MASK_OUT                   Dummy  820      L(4)            4     3     1        ARG,OUT          887,888,890,913,914,971,972       
 MESSAGE1                   Local  845      CHAR            16          scalar                    883,885,889,893                   
 MESSAGE2                   Local  845      CHAR            16          scalar                    890,893                           
 MIN                        Local  834      I(4)            4           scalar                    939,941                           
 MM                         Local  834      I(4)            4           scalar                    939,941                           
 MOD_TIME                   Local  833      I(4)            4           scalar                    926,928,930                       
 MPP_GET_FILE_NAME          Func   920      CHAR            256         scalar   PRIV             151,920,932,1012,1024             
 NX                         Local  832      I(4)            4           scalar                    847,879,882,883,888,889           
 NXW                        Local  837      I(4)            4           scalar                    864,871,879,882                   
 NY                         Local  832      I(4)            4           scalar                    848,880,882,883,888,889           
 NYW                        Local  837      I(4)            4           scalar                    865,872,880,882                   
 NZ                         Local  832      I(4)            4           scalar                    849,882,883,888,889               
 PRESENT                    Func   852                                  scalar                    852,854,867,887,913,971           
 SIZE                       Func   847                                  scalar                    847,848,849,888,890               
 SS                         Local  834      I(4)            4           scalar                    939,941                           
 T1                         Local  832      I(4)            4           scalar                    918,930,942,945,947               
 T2                         Local  832      I(4)            4           scalar                    918,930,942,946,948               
 TIME                       Dummy  820      TIME_TYPE       16          scalar   ARG,IN           917,930,939                       
 TIME_INTERP                Local  917                                  scalar   PRIV             158,917,930,1009,1022             
 TIME_INTERP_EXTERNAL_3D    Subr   820                                           PRIV             787                               
 TIME_INTERP_LIST           Subr   930                                           PRIV             930,1022                          
 TIME_INTERP_MODULO         Subr   917                                           PRIV             917,1009                          
 TRIM                       Func   869                                  scalar                    869,884,891,921,922,933,934       
 VERB                       Local  844      L(4)            4           scalar                    853,854,855,938,952               
 VERBOSE                    Dummy  820      L(4)            4           scalar   ARG,IN           854                               
 W1                         Local  843      R(8)            8           scalar                    937,942,959,967                   
 W2                         Local  843      R(8)            8           scalar                    918,930,937,942,960,968           
 WINDOW_ID                  Dummy  820      I(4)            4           scalar   ARG,IN           899,945,946                       
 YY                         Local  834      I(4)            4           scalar                    939,941                           

Page 28          Source Listing                  TIME_INTERP_EXTERNAL_3D
2021-06-01 08:55                                 time_interp_external.F90

    978 !</SUBROUTINE> NAME="time_interp_external"
    979 
    980     subroutine time_interp_external_0d(index, time, data, verbose)
    981 
    982       integer, intent(in) :: index
    983       type(time_type), intent(in) :: time
    984       real, intent(inout) :: data
    985       logical, intent(in), optional :: verbose
    986 
    987       integer :: t1, t2
    988       integer :: i1, i2, mod_time
    989       integer :: yy, mm, dd, hh, min, ss
    990       character(len=256) :: err_msg, filename
    991 
    992       real :: w1,w2
    993       logical :: verb
    994 
    995       verb=.false.
    996       if (PRESENT(verbose)) verb=verbose
    997       if (debug_this_module) verb = .true.
    998 
    999       if (index < 1.or.index > num_fields) &
   1000            call mpp_error(FATAL,'invalid index in call to time_interp_ext -- field was not initialized or failed to initiali
   1000 ze')
   1001 
   1002       if (field(index)%siz(4) == 1) then
   1003 ! only one record in the file => time-independent field
   1004          call load_record_0d(field(index),1)
   1005          i1 = find_buf_index(1,field(index)%ibuf)
   1006          data = field(index)%data(1,1,1,i1)
   1007       else
   1008         if(field(index)%have_modulo_times) then
   1009           call time_interp(time,field(index)%modulo_time_beg, field(index)%modulo_time_end, field(index)%time(:), &
   1010                           w2, t1, t2, field(index)%correct_leap_year_inconsistency, err_msg=err_msg)
   1011           if(err_msg .NE. '') then
   1012              filename = mpp_get_file_name(field(index)%unit)
   1013              call mpp_error(FATAL,"time_interp_external 3:"//trim(err_msg)//&
   1014                     ",file="//trim(filename)//",field="//trim(field(index)%name) )
   1015           endif
   1016         else
   1017           if(field(index)%modulo_time) then
   1018             mod_time=1
   1019           else
   1020             mod_time=0
   1021           endif
   1022           call time_interp(time,field(index)%time(:),w2,t1,t2,modtime=mod_time, err_msg=err_msg)
   1023           if(err_msg .NE. '') then
   1024              filename = mpp_get_file_name(field(index)%unit)
   1025              call mpp_error(FATAL,"time_interp_external 4:"//trim(err_msg)// &
   1026                     ",file="//trim(filename)//",field="//trim(field(index)%name) )
   1027           endif
   1028         endif
   1029          w1 = 1.0-w2
   1030          if (verb) then
   1031             call get_date(time,yy,mm,dd,hh,min,ss)
   1032             write(outunit,'(a,i4,a,i2,a,i2,1x,i2,a,i2,a,i2)') &
   1033                  'target time yyyy/mm/dd hh:mm:ss= ',yy,'/',mm,'/',dd,hh,':',min,':',ss

Page 29          Source Listing                  TIME_INTERP_EXTERNAL_0D
2021-06-01 08:55                                 time_interp_external.F90

   1034             write(outunit,*) 't1, t2, w1, w2= ', t1, t2, w1, w2
   1035          endif
   1036          call load_record_0d(field(index),t1)
   1037          call load_record_0d(field(index),t2)
   1038          i1 = find_buf_index(t1,field(index)%ibuf)
   1039          i2 = find_buf_index(t2,field(index)%ibuf)
   1040 
   1041          if(i1<0.or.i2<0) &
   1042               call mpp_error(FATAL,'time_interp_external : records were not loaded correctly in memory')
   1043          data = field(index)%data(1,1,1,i1)*w1 + field(index)%data(1,1,1,i2)*w2
   1044          if (verb) then
   1045             write(outunit,*) 'ibuf= ',field(index)%ibuf
   1046             write(outunit,*) 'i1,i2= ',i1, i2
   1047          endif
   1048       endif
   1049 
   1050     end subroutine time_interp_external_0d


ENTRY POINTS

  Name                                                            
                                                                  
 time_interp_external_mod_mp_time_interp_external_0d_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 DATA                       Dummy  980      R(8)            8           scalar   ARG,INOUT        1006,1043                         
 DD                         Local  989      I(4)            4           scalar                    1031,1033                         
 ERR_MSG                    Local  990      CHAR            256         scalar                    1010,1011,1013,1022,1023,1025     
 FILENAME                   Local  990      CHAR            256         scalar                    1012,1014,1024,1026               
 HH                         Local  989      I(4)            4           scalar                    1031,1033                         
 I1                         Local  988      I(4)            4           scalar                    1005,1006,1038,1041,1043,1046     
 I2                         Local  988      I(4)            4           scalar                    1039,1041,1043,1046               
 INDEX                      Dummy  980      I(4)            4           scalar   ARG,IN           999,1002,1004,1005,1006,1008,1009,
                                                                                                  1010,1012,1014,1017,1022,1024,1026
                                                                                                  ,1036,1037,1038,1039,1043,1045    
 MIN                        Local  989      I(4)            4           scalar                    1031,1033                         
 MM                         Local  989      I(4)            4           scalar                    1031,1033                         
 MOD_TIME                   Local  988      I(4)            4           scalar                    1018,1020,1022                    
 PRESENT                    Func   996                                  scalar                    996                               
 SS                         Local  989      I(4)            4           scalar                    1031,1033                         
 T1                         Local  987      I(4)            4           scalar                    1010,1022,1034,1036,1038          
 T2                         Local  987      I(4)            4           scalar                    1010,1022,1034,1037,1039          
 TIME                       Dummy  980      TIME_TYPE       16          scalar   ARG,IN           1009,1022,1031                    
 TIME_INTERP_EXTERNAL_0D    Subr   980                                           PRIV                                               
 TRIM                       Func   1013                                 scalar                    1013,1014,1025,1026               
 VERB                       Local  993      L(4)            4           scalar                    995,996,997,1030,1044             
 VERBOSE                    Dummy  980      L(4)            4           scalar   ARG,IN           996                               
 W1                         Local  992      R(8)            8           scalar                    1029,1034,1043                    
 W2                         Local  992      R(8)            8           scalar                    1010,1022,1029,1034,1043          
 YY                         Local  989      I(4)            4           scalar                    1031,1033                         

Page 30          Source Listing                  TIME_INTERP_EXTERNAL_0D
2021-06-01 08:55                                 time_interp_external.F90

   1051 
   1052     subroutine set_time_modulo(Time)
   1053 
   1054       type(time_type), intent(inout), dimension(:) :: Time
   1055 
   1056       integer :: ntime, n
   1057       integer :: yr, mon, dy, hr, minu, sec
   1058 
   1059       ntime = size(Time(:))
   1060 
   1061       do n = 1, ntime
   1062          call get_date(Time(n), yr, mon, dy, hr, minu, sec)
   1063          yr = modulo_year
   1064          Time(n) = set_date(yr, mon, dy, hr, minu, sec)
   1065       enddo
   1066 
   1067 
   1068     end subroutine set_time_modulo


ENTRY POINTS

  Name                                                    
                                                          
 time_interp_external_mod_mp_set_time_modulo_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 DY                         Local  1057     I(4)            4           scalar                    1062,1064                         
 HR                         Local  1057     I(4)            4           scalar                    1062,1064                         
 MINU                       Local  1057     I(4)            4           scalar                    1062,1064                         
 MODULO_YEAR                Param  1063     I(4)            4           scalar   PRIV             196,1063                          
 MON                        Local  1057     I(4)            4           scalar                    1062,1064                         
 N                          Local  1056     I(4)            4           scalar                    1061,1062,1064                    
 NTIME                      Local  1056     I(4)            4           scalar                    1059,1061                         
 SEC                        Local  1057     I(4)            4           scalar                    1062,1064                         
 SET_DATE_I                 Func   1064     RECORD          16          scalar   PRIV             1064                              
 SET_TIME_MODULO            Subr   1052                                                                                             
 SIZE                       Func   1059                                 scalar                    1059                              
 TIME                       Dummy  1052     RECORD          16    1     1        ARG,INOUT        1059,1062,1064                    
 YR                         Local  1057     I(4)            4           scalar                    1062,1063,1064                    

Page 31          Source Listing                  SET_TIME_MODULO
2021-06-01 08:55                                 time_interp_external.F90

   1069 
   1070 ! ============================================================================
   1071 ! load specified record from file
   1072 subroutine load_record(field, rec, interp, is_in, ie_in, js_in, je_in, window_id_in)
   1073   type(ext_fieldtype),     intent(inout)        :: field
   1074   integer            ,     intent(in)           :: rec    ! record number
   1075   type(horiz_interp_type), intent(in), optional :: interp
   1076   integer,                 intent(in), optional :: is_in, ie_in, js_in, je_in
   1077   integer,                 intent(in), optional :: window_id_in
   1078 
   1079 ! ---- local vars
   1080   integer :: ib ! index in the array of input buffers
   1081   integer :: isw,iew,jsw,jew ! boundaries of the domain on each window
   1082   integer :: is_region, ie_region, js_region, je_region, i, j, n
   1083   integer :: start(4), nread(4)
   1084   logical :: need_compute
   1085   real    :: mask_in(size(field%src_data,1),size(field%src_data,2),size(field%src_data,3))
   1086   real, allocatable :: mask_out(:,:,:)
   1087   integer :: window_id
   1088 
   1089   window_id = 1
   1090   if( PRESENT(window_id_in) ) window_id = window_id_in
   1091   need_compute = .true.
   1092 
   1093 !$OMP CRITICAL
   1094   ib = find_buf_index(rec,field%ibuf)
   1095 
   1096   if(ib>0) then
   1097 !--- do nothing
   1098      need_compute = .false.
   1099   else
   1100 ! calculate current buffer number in round-robin fasion
   1101      field%nbuf = field%nbuf + 1
   1102      if(field%nbuf > size(field%data,4).or.field%nbuf <= 0) field%nbuf = 1
   1103      ib = field%nbuf
   1104      field%ibuf(ib) = rec
   1105      field%need_compute(ib,:) = .true.
   1106 
   1107      if (field%domain_present .and. .not.PRESENT(interp)) then
   1108         if (debug_this_module) write(outunit,*) 'reading record with domain for field ',trim(field%name)
   1109         call mpp_read(field%unit,field%field,field%domain,field%src_data(:,:,:,ib),rec)
   1110      else
   1111         if (debug_this_module) write(outunit,*) 'reading record without domain for field ',trim(field%name)
   1112         start = 1; nread = 1
   1113         start(1) = field%is_src; nread(1) = field%ie_src - field%is_src + 1
   1114         start(2) = field%js_src; nread(2) = field%je_src - field%js_src + 1
   1115         start(3) = 1;            nread(3) = size(field%src_data,3)
   1116         start(field%tdim) = rec; nread(field%tdim) = 1
   1117         call mpp_read(field%unit,field%field,field%src_data(:,:,:,ib),start,nread)
   1118      endif
   1119   endif
   1120 !$OMP END CRITICAL
   1121   isw=field%isc;iew=field%iec
   1122   jsw=field%jsc;jew=field%jec
   1123 
   1124   if( field%numwindows > 1) then
   1125      if( .NOT. PRESENT(is_in) .OR. .NOT. PRESENT(ie_in) .OR. .NOT. PRESENT(js_in) .OR. .NOT. PRESENT(je_in) ) then

Page 32          Source Listing                  LOAD_RECORD
2021-06-01 08:55                                 time_interp_external.F90

   1126         call mpp_error(FATAL, 'time_interp_external(load_record): is_in, ie_in, js_in, je_in must be present when numwindows
   1126 >1')
   1127      endif
   1128      isw = isw + is_in - 1
   1129      iew = isw + ie_in - is_in
   1130      jsw = jsw + js_in - 1
   1131      jew = jsw + je_in - js_in
   1132   endif
   1133 
   1134 ! interpolate to target grid
   1135 
   1136   need_compute = field%need_compute(ib, window_id)
   1137   if(need_compute) then
   1138      if(PRESENT(interp)) then
   1139         is_region = field%is_region; ie_region = field%ie_region
   1140         js_region = field%js_region; je_region = field%je_region
   1141         mask_in = 0.0
   1142         where (mpp_is_valid(field%src_data(:,:,:,ib), field%valid)) mask_in = 1.0
   1143         if ( field%region_type .NE. NO_REGION ) then
   1144            if( ANY(mask_in == 0.0) ) then
   1145               call mpp_error(FATAL, "time_interp_external: mask_in should be all 1 when region_type is not NO_REGION")
   1146            endif
   1147            if( field%region_type == OUTSIDE_REGION) then
   1148               do j = js_region, je_region
   1149                  do i = is_region, ie_region
   1150                     mask_in(i,j,:) = 0.0
   1151                  enddo
   1152               enddo
   1153            else  ! field%region_choice == INSIDE_REGION
   1154               do j = 1, size(mask_in,2)
   1155                  do i = 1, size(mask_in,1)
   1156                     if( j<js_region .OR. j>je_region .OR. i<is_region .OR. i>ie_region ) mask_in(i,j,:) = 0.0
   1157                  enddo
   1158               enddo
   1159            endif
   1160         endif
   1161         allocate(mask_out(isw:iew,jsw:jew, size(field%src_data,3)))
   1162         call horiz_interp(interp,field%src_data(:,:,:,ib),field%data(isw:iew,jsw:jew,:,ib), &
   1163              mask_in=mask_in, &
   1164              mask_out=mask_out)
   1165 
   1166         field%mask(isw:iew,jsw:jew,:,ib) = mask_out(isw:iew,jsw:jew,:) > 0
   1167         deallocate(mask_out)
   1168         field%need_compute(ib, window_id) = .false.
   1169      else
   1170         if ( field%region_type .NE. NO_REGION ) then
   1171            call mpp_error(FATAL, "time_interp_external: region_type should be NO_REGION when interp is not present")
   1172         endif
   1173         field%data(isw:iew,jsw:jew,:,ib) = field%src_data(isw:iew,jsw:jew,:,ib)
   1174         field%mask(isw:iew,jsw:jew,:,ib) = mpp_is_valid(field%data(isw:iew,jsw:jew,:,ib),field%valid)
   1175      endif
   1176 ! convert units
   1177      where(field%mask(isw:iew,jsw:jew,:,ib)) field%data(isw:iew,jsw:jew,:,ib) = &
   1178           field%data(isw:iew,jsw:jew,:,ib)*field%slope + field%intercept
   1179   endif
   1180 
   1181 end subroutine load_record

Page 33          Source Listing                  LOAD_RECORD
2021-06-01 08:55 Entry Points                    time_interp_external.F90



ENTRY POINTS

  Name                                                
                                                      
 time_interp_external_mod_mp_load_record_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 ANY                        Func   1144                                 scalar                    1144                              
 EXT_FIELDTYPE              Type   1073                     8880        scalar   PRIV             242,257,1073,1185,1288            
 FIELD                      Dummy  1072     EXT_FIELDTYPE   8880        scalar   ARG,INOUT        1085,1094,1101,1102,1103,1104,1105
                                                                                                  ,1107,1108,1109,1111,1113,1114,111
                                                                                                  5,1116,1117,1121,1122,1124,1136,11
                                                                                                  39,1140,1142,1143,1147,1161,1162,1
                                                                                                  166,1168,1170,1173,1174,1177,1178 
 HORIZ_INTERP               Local  1162                                 scalar   PRIV             162,1162                          
 HORIZ_INTERP_BASE_3D       Subr   1162                                          PRIV             1162                              
 I                          Local  1082     I(4)            4           scalar                    1149,1150,1155,1156               
 IB                         Local  1080     I(4)            4           scalar                    1094,1096,1103,1104,1105,1109,1117
                                                                                                  ,1136,1142,1162,1166,1168,1173,117
                                                                                                  4,1177,1178                       
 IEW                        Local  1081     I(4)            4           scalar                    1121,1129,1161,1162,1166,1173,1174
                                                                                                  ,1177,1178                        
 IE_IN                      Dummy  1072     I(4)            4           scalar   ARG,IN           1125,1129                         
 IE_REGION                  Local  1082     I(4)            4           scalar                    1139,1149,1156                    
 INTERP                     Dummy  1072     HORIZ_INTERP_TYPE                                                                       
                                                            2208        scalar   ARG,IN           1107,1138,1162                    
 ISW                        Local  1081     I(4)            4           scalar                    1121,1128,1129,1161,1162,1166,1173
                                                                                                  ,1174,1177,1178                   
 IS_IN                      Dummy  1072     I(4)            4           scalar   ARG,IN           1125,1128,1129                    
 IS_REGION                  Local  1082     I(4)            4           scalar                    1139,1149,1156                    
 J                          Local  1082     I(4)            4           scalar                    1148,1150,1154,1156               
 JEW                        Local  1081     I(4)            4           scalar                    1122,1131,1161,1162,1166,1173,1174
                                                                                                  ,1177,1178                        
 JE_IN                      Dummy  1072     I(4)            4           scalar   ARG,IN           1125,1131                         
 JE_REGION                  Local  1082     I(4)            4           scalar                    1140,1148,1156                    
 JSW                        Local  1081     I(4)            4           scalar                    1122,1130,1131,1161,1162,1166,1173
                                                                                                  ,1174,1177,1178                   
 JS_IN                      Dummy  1072     I(4)            4           scalar   ARG,IN           1125,1130,1131                    
 JS_REGION                  Local  1082     I(4)            4           scalar                    1140,1148,1156                    
 LOAD_RECORD                Subr   1072                                                           899,945,946                       
 MASK_IN                    Local  1085     R(8)            8     3     0                         1141,1142,1144,1150,1154,1155,1156
                                                                                                  ,1163                             
 MASK_OUT                   Local  1086     R(8)            8     3     1        ALC              1161,1164,1166,1167               
 MPP_IS_VALID               Func   1142     L(4)            4           scalar   PRIV             151,1142,1174,1211                
 MPP_READ                   Local  1109                                 scalar   PRIV             150,1109,1117,1206                
 MPP_READ_2DDECOMP_R3D_R8   Subr   1109                                          PRIV             1109                              
 MPP_READ_REGION_R3D_R8     Subr   1117                                          PRIV             1117,1206                         
 N                          Local  1082     I(4)            4           scalar                                                      
 NEED_COMPUTE               Local  1084     L(4)            4           scalar                    1091,1098,1136,1137               
 NREAD                      Local  1083     I(4)            4     1     4        TGT              1112,1113,1114,1115,1116,1117     
 OUTSIDE_REGION             Param  1147     I(4)            4           scalar                    195,1147                          

Page 34          Source Listing                  LOAD_RECORD
2021-06-01 08:55 Symbol Table                    time_interp_external.F90

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 PRESENT                    Func   1090                                 scalar                    1090,1107,1125,1138               
 REC                        Dummy  1072     I(4)            4           scalar   ARG,IN           1094,1104,1109,1116               
 SIZE                       Func   1085                                 scalar                    1085,1102,1115,1154,1155,1161     
 START                      Local  1083     I(4)            4     1     4        TGT              1112,1113,1114,1115,1116,1117     
 TRIM                       Func   1108                                 scalar                    1108,1111                         
 WINDOW_ID                  Local  1087     I(4)            4           scalar                    1089,1090,1136,1168               
 WINDOW_ID_IN               Dummy  1072     I(4)            4           scalar   ARG,IN           1090                              

Page 35          Source Listing                  LOAD_RECORD
2021-06-01 08:55                                 time_interp_external.F90

   1182 
   1183 
   1184 subroutine load_record_0d(field, rec)
   1185   type(ext_fieldtype),     intent(inout)        :: field
   1186   integer            ,     intent(in)           :: rec    ! record number
   1187 ! ---- local vars
   1188   integer :: ib ! index in the array of input buffers
   1189   integer :: start(4), nread(4)
   1190 
   1191   ib = find_buf_index(rec,field%ibuf)
   1192 
   1193   if(ib>0) then
   1194      return
   1195   else
   1196 ! calculate current buffer number in round-robin fasion
   1197      field%nbuf = field%nbuf + 1
   1198      if(field%nbuf > size(field%data,4).or.field%nbuf <= 0) field%nbuf = 1
   1199      ib = field%nbuf
   1200      field%ibuf(ib) = rec
   1201 
   1202      if (debug_this_module) write(outunit,*) 'reading record without domain for field ',trim(field%name)
   1203      start = 1; nread = 1
   1204      start(3) = 1;            nread(3) = size(field%src_data,3)
   1205      start(field%tdim) = rec; nread(field%tdim) = 1
   1206      call mpp_read(field%unit,field%field,field%src_data(:,:,:,ib),start,nread)
   1207      if ( field%region_type .NE. NO_REGION ) then
   1208         call mpp_error(FATAL, "time_interp_external: region_type should be NO_REGION when field is scalar")
   1209      endif
   1210      field%data(1,1,:,ib) = field%src_data(1,1,:,ib)
   1211      field%mask(1,1,:,ib) = mpp_is_valid(field%data(1,1,:,ib),field%valid)
   1212 ! convert units
   1213      where(field%mask(1,1,:,ib)) field%data(1,1,:,ib) = &
   1214           field%data(1,1,:,ib)*field%slope + field%intercept
   1215   endif
   1216 
   1217 end subroutine load_record_0d

Page 36          Source Listing                  LOAD_RECORD_0D
2021-06-01 08:55 Entry Points                    time_interp_external.F90



ENTRY POINTS

  Name                                                   
                                                         
 time_interp_external_mod_mp_load_record_0d_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 FIELD                      Dummy  1184     EXT_FIELDTYPE   8880        scalar   ARG,INOUT        1191,1197,1198,1199,1200,1202,1204
                                                                                                  ,1205,1206,1207,1210,1211,1213,121
                                                                                                  4                                 
 IB                         Local  1188     I(4)            4           scalar                    1191,1193,1199,1200,1206,1210,1211
                                                                                                  ,1213,1214                        
 LOAD_RECORD_0D             Subr   1184                                                           1004,1036,1037                    
 NREAD                      Local  1189     I(4)            4     1     4        TGT              1203,1204,1205,1206               
 REC                        Dummy  1184     I(4)            4           scalar   ARG,IN           1191,1200,1205                    
 SIZE                       Func   1198                                 scalar                    1198,1204                         
 START                      Local  1189     I(4)            4     1     4        TGT              1203,1204,1205,1206               
 TRIM                       Func   1202                                 scalar                    1202                              

Page 37          Source Listing                  LOAD_RECORD_0D
2021-06-01 08:55                                 time_interp_external.F90

   1218 
   1219 ! ============================================================================
   1220 subroutine reset_src_data_region(index, is, ie, js, je)
   1221    integer, intent(in) :: index
   1222    integer, intent(in) :: is, ie, js, je
   1223    integer             :: nk, nbuf
   1224 
   1225    if( is == field(index)%is_src .AND. ie == field(index)%ie_src .AND. &
   1226        js == field(index)%js_src .AND. ie == field(index)%je_src ) return
   1227 
   1228    if( .NOT. ASSOCIATED(field(index)%src_data) ) call mpp_error(FATAL, &
   1229        "time_interp_external: field(index)%src_data is not associated")
   1230    nk = size(field(index)%src_data,3)
   1231    nbuf = size(field(index)%src_data,4)
   1232    deallocate(field(index)%src_data)
   1233    allocate(field(index)%src_data(is:ie,js:je,nk,nbuf))
   1234    field(index)%is_src = is
   1235    field(index)%ie_src = ie
   1236    field(index)%js_src = js
   1237    field(index)%je_src = je
   1238 
   1239 
   1240 end subroutine reset_src_data_region


ENTRY POINTS

  Name                                                          
                                                                
 time_interp_external_mod_mp_reset_src_data_region_             

Page 38          Source Listing                  RESET_SRC_DATA_REGION
2021-06-01 08:55 Symbol Table                    time_interp_external.F90



SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 ASSOCIATED                 Func   1228                                 scalar                    1228                              
 IE                         Dummy  1220     I(4)            4           scalar   ARG,IN           1225,1226,1233,1235               
 INDEX                      Dummy  1220     I(4)            4           scalar   ARG,IN           1225,1226,1228,1230,1231,1232,1233
                                                                                                  ,1234,1235,1236,1237              
 IS                         Dummy  1220     I(4)            4           scalar   ARG,IN           1225,1233,1234                    
 JE                         Dummy  1220     I(4)            4           scalar   ARG,IN           1233,1237                         
 JS                         Dummy  1220     I(4)            4           scalar   ARG,IN           1226,1233,1236                    
 NBUF                       Local  1223     I(4)            4           scalar                    1231,1233                         
 NK                         Local  1223     I(4)            4           scalar                    1230,1233                         
 RESET_SRC_DATA_REGION      Subr   1220                                                                                             
 SIZE                       Func   1230                                 scalar                    1230,1231                         

Page 39          Source Listing                  RESET_SRC_DATA_REGION
2021-06-01 08:55                                 time_interp_external.F90

   1241 
   1242 ! ============================================================================
   1243 subroutine set_override_region(index, region_type, is_region, ie_region, js_region, je_region)
   1244    integer, intent(in) :: index, region_type
   1245    integer, intent(in) :: is_region, ie_region, js_region, je_region
   1246 
   1247    field(index)%region_type = region_type
   1248    field(index)%is_region   = is_region
   1249    field(index)%ie_region   = ie_region
   1250    field(index)%js_region   = js_region
   1251    field(index)%je_region   = je_region
   1252 
   1253    return
   1254 
   1255 end subroutine set_override_region


ENTRY POINTS

  Name                                                        
                                                              
 time_interp_external_mod_mp_set_override_region_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 IE_REGION                  Dummy  1243     I(4)            4           scalar   ARG,IN           1249                              
 INDEX                      Dummy  1243     I(4)            4           scalar   ARG,IN           1247,1248,1249,1250,1251          
 IS_REGION                  Dummy  1243     I(4)            4           scalar   ARG,IN           1248                              
 JE_REGION                  Dummy  1243     I(4)            4           scalar   ARG,IN           1251                              
 JS_REGION                  Dummy  1243     I(4)            4           scalar   ARG,IN           1250                              
 REGION_TYPE                Dummy  1243     I(4)            4           scalar   ARG,IN           1247                              
 SET_OVERRIDE_REGION        Subr   1243                                                                                             

Page 40          Source Listing                  SET_OVERRIDE_REGION
2021-06-01 08:55                                 time_interp_external.F90

   1256 
   1257 ! ============================================================================
   1258 ! reallocates array of fields, increasing its size
   1259 subroutine realloc_files(n)
   1260   integer, intent(in) :: n ! new size
   1261 
   1262   type(filetype), pointer :: ptr(:)
   1263   integer :: i
   1264 
   1265   if (associated(opened_files)) then
   1266      if (n <= size(opened_files)) return ! do nothing, if requested size no more than current
   1267   endif
   1268 
   1269   allocate(ptr(n))
   1270   do i = 1, size(ptr)
   1271      ptr(i)%filename = ''
   1272      ptr(i)%unit = -1
   1273   enddo
   1274 
   1275   if (associated(opened_files))then
   1276      ptr(1:size(opened_files)) = opened_files(:)
   1277      deallocate(opened_files)
   1278   endif
   1279   opened_files => ptr
   1280 
   1281 end subroutine realloc_files


ENTRY POINTS

  Name                                                  
                                                        
 time_interp_external_mod_mp_realloc_files_             

Page 41          Source Listing                  REALLOC_FILES
2021-06-01 08:55 Symbol Table                    time_interp_external.F90



SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 ASSOCIATED                 Func   1265                                 scalar                    1265,1275                         
 FILETYPE                   Type   1262                     132         scalar   PRIV             247,258,1262                      
 I                          Local  1263     I(4)            4           scalar                    1270,1271,1272                    
 N                          Dummy  1259     I(4)            4           scalar   ARG,IN           1266,1269                         
 PTR                        Local  1262     RECORD          132   1     1        PTR              1269,1270,1271,1272,1276,1279     
 REALLOC_FILES              Subr   1259                                                           293                               
 SIZE                       Func   1266                                 scalar                    1266,1270,1276                    

Page 42          Source Listing                  REALLOC_FILES
2021-06-01 08:55                                 time_interp_external.F90

   1282 
   1283 ! ============================================================================
   1284 ! reallocates array of fields,increasing its size
   1285 subroutine realloc_fields(n)
   1286   integer, intent(in) :: n ! new size
   1287 
   1288   type(ext_fieldtype), pointer :: ptr(:)
   1289   integer :: i, ier
   1290 
   1291   if (associated(field)) then
   1292      if (n <= size(field)) return ! do nothing if requested size no more then current
   1293   endif
   1294 
   1295   allocate(ptr(n))
   1296   do i=1,size(ptr)
   1297      ptr(i)%unit=-1
   1298      ptr(i)%name=''
   1299      ptr(i)%units=''
   1300      ptr(i)%siz=-1
   1301      ptr(i)%ndim=-1
   1302      ptr(i)%domain = NULL_DOMAIN2D
   1303      ptr(i)%axes(:) = default_axis
   1304      if (ASSOCIATED(ptr(i)%time))       DEALLOCATE(ptr(i)%time, stat=ier)
   1305      if (ASSOCIATED(ptr(i)%start_time)) DEALLOCATE(ptr(i)%start_time, stat=ier)
   1306      if (ASSOCIATED(ptr(i)%end_time))   DEALLOCATE(ptr(i)%end_time, stat=ier)
   1307      ptr(i)%field = default_field
   1308      if (ASSOCIATED(ptr(i)%period)) DEALLOCATE(ptr(i)%period, stat=ier)
   1309      ptr(i)%modulo_time=.false.
   1310      if (ASSOCIATED(ptr(i)%data)) DEALLOCATE(ptr(i)%data, stat=ier)
   1311      if (ASSOCIATED(ptr(i)%ibuf)) DEALLOCATE(ptr(i)%ibuf, stat=ier)
   1312      if (ASSOCIATED(ptr(i)%src_data)) DEALLOCATE(ptr(i)%src_data, stat=ier)
   1313      ptr(i)%nbuf=-1
   1314      ptr(i)%domain_present=.false.
   1315      ptr(i)%slope=1.0
   1316      ptr(i)%intercept=0.0
   1317      ptr(i)%isc=-1;ptr(i)%iec=-1
   1318      ptr(i)%jsc=-1;ptr(i)%jec=-1
   1319   enddo
   1320   if (associated(field)) then
   1321      ptr(1:size(field)) = field(:)
   1322      deallocate(field)
   1323   endif
   1324   field=>ptr
   1325 
   1326 end subroutine realloc_fields

Page 43          Source Listing                  REALLOC_FIELDS
2021-06-01 08:55 Entry Points                    time_interp_external.F90



ENTRY POINTS

  Name                                                   
                                                         
 time_interp_external_mod_mp_realloc_fields_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 ASSOCIATED                 Func   1291                                 scalar                    1291,1304,1305,1306,1308,1310,1311
                                                                                                  ,1312,1320                        
 DEFAULT_AXIS               Local  1303     AXISTYPE        1424        scalar   PRIV,SAVE        149,1303,1467                     
 DEFAULT_FIELD              Local  1307     FIELDTYPE       1096        scalar   PRIV,SAVE        150,1307,1470                     
 I                          Local  1289     I(4)            4           scalar                    1296,1297,1298,1299,1300,1301,1302
                                                                                                  ,1303,1304,1305,1306,1307,1308,130
                                                                                                  9,1310,1311,1312,1313,1314,1315,13
                                                                                                  16,1317,1318                      
 IER                        Local  1289     I(4)            4           scalar                    1304,1305,1306,1308,1310,1311,1312
 N                          Dummy  1285     I(4)            4           scalar   ARG,IN           1292,1295                         
 NULL_DOMAIN2D              Local  1302     DOMAIN2D        752         scalar   PRIV,SAVE        157,1302,1469                     
 PTR                        Local  1288     RECORD          8880  1     1        PTR              1295,1296,1297,1298,1299,1300,1301
                                                                                                  ,1302,1303,1304,1305,1306,1307,130
                                                                                                  8,1309,1310,1311,1312,1313,1314,13
                                                                                                  15,1316,1317,1318,1321,1324       
 REALLOC_FIELDS             Subr   1285                                                           292                               
 SIZE                       Func   1292                                 scalar                    1292,1296,1321                    

Page 44          Source Listing                  REALLOC_FIELDS
2021-06-01 08:55                                 time_interp_external.F90

   1327 
   1328 
   1329     function find_buf_index(indx,buf)
   1330       integer :: indx
   1331       integer, dimension(:) :: buf
   1332       integer :: find_buf_index
   1333 
   1334       integer :: nbuf, i
   1335 
   1336       nbuf = size(buf(:))
   1337 
   1338       find_buf_index = -1
   1339 
   1340       do i=1,nbuf
   1341          if (buf(i) == indx) then
   1342             find_buf_index = i
   1343             exit
   1344          endif
   1345       enddo
   1346 
   1347     end function find_buf_index


ENTRY POINTS

  Name                                                   
                                                         
 time_interp_external_mod_mp_find_buf_index_             

Page 45          Source Listing                  FIND_BUF_INDEX
2021-06-01 08:55 Symbol Table                    time_interp_external.F90



SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 BUF                        Dummy  1329     I(4)            4     1     1        ARG,INOUT        1336,1341                         
 FIND_BUF_INDEX             Func   1329     I(4)            4           scalar                                                      
 I                          Local  1334     I(4)            4           scalar                    1340,1341,1342                    
 INDX                       Dummy  1329     I(4)            4           scalar   ARG,INOUT        1341                              
 NBUF                       Local  1334     I(4)            4           scalar                    1336,1340                         
 SIZE                       Func   1336                                 scalar                    1336                              

Page 46          Source Listing                  FIND_BUF_INDEX
2021-06-01 08:55                                 time_interp_external.F90

   1348 
   1349 !<FUNCTION NAME="get_external_field_size" TYPE="integer" DIM="(4)">
   1350 !
   1351 !<DESCRIPTION>
   1352 ! return size of field after call to init_external_field.
   1353 ! Ordering is X/Y/Z/T.
   1354 ! This call only makes sense for non-distributed reads.
   1355 !</DESCRIPTION>
   1356 !
   1357 !<IN NAME="index" TYPE="integer">
   1358 ! returned from previous call to init_external_field.
   1359 !</IN>
   1360 
   1361     function get_external_field_size(index)
   1362 
   1363       integer :: index
   1364       integer :: get_external_field_size(4)
   1365 
   1366       if (index .lt. 1 .or. index .gt. num_fields) &
   1367            call mpp_error(FATAL,'invalid index in call to get_external_field_size')
   1368 
   1369 
   1370       get_external_field_size(1) = field(index)%siz(1)
   1371       get_external_field_size(2) = field(index)%siz(2)
   1372       get_external_field_size(3) = field(index)%siz(3)
   1373       get_external_field_size(4) = field(index)%siz(4)
   1374 
   1375     end function get_external_field_size

Page 47          Source Listing                  GET_EXTERNAL_FIELD_SIZE
2021-06-01 08:55 Entry Points                    time_interp_external.F90



ENTRY POINTS

  Name                                                            
                                                                  
 time_interp_external_mod_mp_get_external_field_size_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 GET_EXTERNAL_FIELD_SIZE    Func   1361     I(4)            4     1     4                                                           
 INDEX                      Dummy  1361     I(4)            4           scalar   ARG,INOUT        1366,1370,1371,1372,1373          

Page 48          Source Listing                  GET_EXTERNAL_FIELD_SIZE
2021-06-01 08:55                                 time_interp_external.F90

   1376 !</FUNCTION> NAME="get_external_field_size"
   1377 
   1378 
   1379 !<FUNCTION NAME="get_external_field_missing" TYPE="real">
   1380 !
   1381 !<DESCRIPTION>
   1382 ! return missing value
   1383 !</DESCRIPTION>
   1384 !
   1385 !<IN NAME="index" TYPE="integer">
   1386 ! returned from previous call to init_external_field.
   1387 !</IN>
   1388 
   1389     function get_external_field_missing(index)
   1390 
   1391       integer :: index
   1392       real :: missing
   1393       real :: get_external_field_missing
   1394 
   1395       if (index .lt. 1 .or. index .gt. num_fields) &
   1396            call mpp_error(FATAL,'invalid index in call to get_external_field_size')
   1397 
   1398 
   1399 !      call mpp_get_atts(field(index)%field,missing=missing)
   1400       get_external_field_missing = field(index)%missing
   1401 
   1402     end function get_external_field_missing


ENTRY POINTS

  Name                                                               
                                                                     
 time_interp_external_mod_mp_get_external_field_missing_             

Page 49          Source Listing                  GET_EXTERNAL_FIELD_MISSING
2021-06-01 08:55 Symbol Table                    time_interp_external.F90



SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 GET_EXTERNAL_FIELD_MISSING Func   1389     R(8)            8           scalar                                                      
 INDEX                      Dummy  1389     I(4)            4           scalar   ARG,INOUT        1395,1400                         
 MISSING                    Local  1392     R(8)            8           scalar                                                      

Page 50          Source Listing                  GET_EXTERNAL_FIELD_MISSING
2021-06-01 08:55                                 time_interp_external.F90

   1403 !</FUNCTION> NAME="get_external_field_missing"
   1404 
   1405 !<FUNCTION NAME="get_external_field_axes" TYPE="axistype" DIM="(4)">
   1406 !
   1407 !<DESCRIPTION>
   1408 ! return field axes after call to init_external_field.
   1409 ! Ordering is X/Y/Z/T.
   1410 !</DESCRIPTION>
   1411 !
   1412 !<IN NAME="index" TYPE="integer">
   1413 ! returned from previous call to init_external_field.
   1414 !</IN>
   1415 
   1416 
   1417     function get_external_field_axes(index)
   1418 
   1419       integer :: index
   1420       type(axistype), dimension(4) :: get_external_field_axes
   1421 
   1422       if (index .lt. 1 .or. index .gt. num_fields) &
   1423            call mpp_error(FATAL,'invalid index in call to get_external_field_size')
   1424 
   1425 
   1426       get_external_field_axes(1) = field(index)%axes(1)
   1427       get_external_field_axes(2) = field(index)%axes(2)
   1428       get_external_field_axes(3) = field(index)%axes(3)
   1429       get_external_field_axes(4) = field(index)%axes(4)
   1430 
   1431     end function get_external_field_axes

Page 51          Source Listing                  GET_EXTERNAL_FIELD_AXES
2021-06-01 08:55 Entry Points                    time_interp_external.F90



ENTRY POINTS

  Name                                                            
                                                                  
 time_interp_external_mod_mp_get_external_field_axes_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 GET_EXTERNAL_FIELD_AXES    Func   1417     AXISTYPE        1424  1     4                                                           
 INDEX                      Dummy  1417     I(4)            4           scalar   ARG,INOUT        1422,1426,1427,1428,1429          

Page 52          Source Listing                  GET_EXTERNAL_FIELD_AXES
2021-06-01 08:55                                 time_interp_external.F90

   1432 !</FUNCTION> NAME="get_external_field_axes"
   1433 
   1434 ! ===========================================================================
   1435 subroutine get_time_axis(index, time)
   1436   integer        , intent(in)  :: index   ! field id
   1437   type(time_type), intent(out) :: time(:) ! array of time values to be filled
   1438 
   1439   integer :: n ! size of the data to be assigned
   1440 
   1441   if (index < 1.or.index > num_fields) &
   1442        call mpp_error(FATAL,'invalid index in call to get_time_axis')
   1443 
   1444   n = min(size(time),size(field(index)%time))
   1445 
   1446   time(1:n) = field(index)%time(1:n)
   1447 end subroutine


ENTRY POINTS

  Name                                                  
                                                        
 time_interp_external_mod_mp_get_time_axis_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 GET_TIME_AXIS              Subr   1435                                                                                             
 INDEX                      Dummy  1435     I(4)            4           scalar   ARG,IN           1441,1444,1446                    
 MIN                        Func   1444                                 scalar                    1444                              
 N                          Local  1439     I(4)            4           scalar                    1444,1446                         
 SIZE                       Func   1444                                 scalar                    1444                              
 TIME                       Dummy  1435     RECORD          16    1     1        ARG,OUT          1444,1446                         

Page 53          Source Listing                  GET_TIME_AXIS
2021-06-01 08:55                                 time_interp_external.F90

   1448 
   1449 !<SUBROUTINE NAME="time_interp_external_exit">
   1450 !
   1451 !<DESCRIPTION>
   1452 ! exit time_interp_external_mod.  Close all open files and
   1453 ! release storage
   1454 !</DESCRIPTION>
   1455 
   1456     subroutine time_interp_external_exit()
   1457 
   1458       integer :: i,j
   1459 !
   1460 ! release storage arrays
   1461 !
   1462       do i=1,num_fields
   1463          deallocate(field(i)%time,field(i)%start_time,field(i)%end_time,&
   1464               field(i)%period,field(i)%data,field(i)%mask,field(i)%ibuf)
   1465          if (ASSOCIATED(field(i)%src_data)) deallocate(field(i)%src_data)
   1466          do j=1,4
   1467             field(i)%axes(j) = default_axis
   1468          enddo
   1469          field(i)%domain = NULL_DOMAIN2D
   1470          field(i)%field = default_field
   1471          field(i)%nbuf = 0
   1472          field(i)%slope = 0.
   1473          field(i)%intercept = 0.
   1474       enddo
   1475 
   1476       deallocate(field)
   1477       deallocate(opened_files)
   1478 
   1479       num_fields = 0
   1480 
   1481       module_initialized = .false.
   1482 
   1483     end subroutine time_interp_external_exit

Page 54          Source Listing                  TIME_INTERP_EXTERNAL_EXIT
2021-06-01 08:55 Entry Points                    time_interp_external.F90



ENTRY POINTS

  Name                                                              
                                                                    
 time_interp_external_mod_mp_time_interp_external_exit_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 ASSOCIATED                 Func   1465                                 scalar                    1465                              
 I                          Local  1458     I(4)            4           scalar                    1462,1463,1464,1465,1467,1469,1470
                                                                                                  ,1471,1472,1473                   
 J                          Local  1458     I(4)            4           scalar                    1466,1467                         
 TIME_INTERP_EXTERNAL_EXIT  Subr   1456                                                                                             

Page 55          Source Listing                  TIME_INTERP_EXTERNAL_EXIT
2021-06-01 08:55                                 time_interp_external.F90

   1484 !</SUBROUTINE> NAME="time_interp_external_exit"
   1485 
   1486 end module time_interp_external_mod


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 AXIS_UTILS_MOD             Module 159                                                            159                               
 CLOSE_FILE                 Subr   160                                           PRIV             160                               
 DAYS_IN_MONTH              Func   152      I(4)            4           scalar   PRIV             152                               
 DAYS_IN_YEAR               Func   153      I(4)            4           scalar   PRIV             153                               
 DK                         Param  260      I(4)            4           scalar   PRIV             260,261                           
 FMS_MOD                    Module 145                                                            145,160                           
 GET_CAL_TIME_MOD           Module 155                                                            155                               
 GET_EXTERNAL_FIELD_AXES@0  Local  1417     RECORD          1424  1     4                                                           
 GET_EXTERNAL_FIELD_MISSING                                                                                                         
 @0                         Local  1389     R(8)            8           scalar                                                      
 GET_EXTERNAL_FIELD_SIZE@0  Local  1361     I(4)            4     1     4                                                           
 GET_TIME_AXIS              Subr   207                                                            207                               
 HORIZ_INTERP_MOD           Module 162                                                            162                               
 INCREMENT_TIME             Func   153      RECORD          16          scalar   PRIV             153                               
 INIT_EXTERNAL_FIELD@0      Local  347      I(4)            4           scalar                                                      
 INSIDE_REGION              Param  195      I(4)            4           scalar                    195                               
 MPP_ASCII                  Param  149      I(4)            4           scalar   PRIV             149                               
 MPP_CLOSE                  Subr   150                                           PRIV             150                               
 MPP_DOMAINS_MOD            Module 156                                                            156                               
 MPP_IO_MOD                 Module 148                                                            148                               
 MPP_MOD                    Module 146                                                            146,147                           
 MPP_PE                     Func   146      I(4)            4           scalar   PRIV             146                               
 NULL                       Func   219                                  scalar   PTR              219,220,222,224,225,226,227,240,25
                                                                                                  7,258                             
 OPEN_NAMELIST_FILE         Func   160      I(4)            4           scalar   PRIV             160                               
 Operator (>=)                     152                                                                                              
 PLATFORM_MOD               Module 161                                                            161                               
 R8_KIND                    Param  161      I(4)            4           scalar   PRIV             161                               
 RESET_SRC_DATA_REGION      Subr   208                                                            208                               
 SET_OVERRIDE_REGION        Subr   208                                                            208                               
 TIME_INTERP_EXTERNAL       Local  249                                  scalar                    206                               
 TIME_INTERP_EXTERNAL_EXIT  Subr   207                                                            207                               
 TIME_INTERP_EXTERNAL_INIT  Subr   206                                                            206                               
 TIME_INTERP_EXTERNAL_MOD   Module 22                                                                                               
 TIME_INTERP_MISSING        Param  261      R(8)            8           scalar   PRIV             261                               
 TIME_INTERP_MOD            Module 158                                                            158                               
 TIME_MANAGER_MOD           Module 152                                                            152                               
 VALIDTYPE                  Type   151                                  scalar                    151,228                           
 WARNING                    Param  146      I(4)            4           scalar   PRIV             146                               

Page 56          Source Listing                  TIME_INTERP_EXTERNAL_EXIT
2021-06-01 08:55 Subprograms/Common Blocks       time_interp_external.F90



SUBPROGRAMS/COMMON BLOCKS

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 FIND_BUF_INDEX             Func   1329     I(4)            4           scalar                                                      
 GET_EXTERNAL_FIELD_AXES    Func   1417     AXISTYPE        1424  1     4                                                           
 GET_EXTERNAL_FIELD_MISSING Func   1389     R(8)            8           scalar                                                      
 GET_EXTERNAL_FIELD_SIZE    Func   1361     I(4)            4     1     4                                                           
 GET_TIME_AXIS              Subr   1435                                                                                             
 INIT_EXTERNAL_FIELD        Func   347      I(4)            4           scalar                                                      
 LOAD_RECORD                Subr   1072                                                           899,945,946                       
 LOAD_RECORD_0D             Subr   1184                                                           1004,1036,1037                    
 REALLOC_FIELDS             Subr   1285                                                           292                               
 REALLOC_FILES              Subr   1259                                                           293                               
 RESET_SRC_DATA_REGION      Subr   1220                                                                                             
 SET_OVERRIDE_REGION        Subr   1243                                                                                             
 SET_TIME_MODULO            Subr   1052                                                                                             
 TIME_INTERP_EXTERNAL_0D    Subr   980                                           PRIV                                               
 TIME_INTERP_EXTERNAL_2D    Subr   770                                           PRIV                                               
 TIME_INTERP_EXTERNAL_3D    Subr   820                                           PRIV             787                               
 TIME_INTERP_EXTERNAL_EXIT  Subr   1456                                                                                             
 TIME_INTERP_EXTERNAL_INIT  Subr   270                                                                                              
 TIME_INTERP_EXTERNAL_MOD   Module 22                                                                                               

COMPILER OPTIONS BEING USED

       -align noall                          -align nonone
       -align nocommons                      -align nodcommons
       -align noqcommons                     -align nozcommons
       -align records                        -align nosequence
       -align norec1byte                     -align norec2byte
       -align norec4byte                     -align norec8byte
       -align norec16byte                    -align norec32byte
       -align norec64byte                    -align noarray8byte
       -align noarray16byte                  -align noarray32byte
       -align noarray64byte                  -align noarray128byte
       -align noarray256byte                 -altparam
       -assume accuracy_sensitive            -assume nobscc
       -assume nobuffered_io                 -assume nobuffered_stdout
       -assume byterecl                      -assume nocontiguous_assumed_shape
       -assume nocontiguous_pointer          -assume cc_omp
       -assume nocstring                     -assume nodummy_aliases
       -assume nofpe_summary                 -assume noieee_fpe_flags
       -assume nominus0                      -assume noold_boz
       -assume old_complex_align             -assume old_unit_star
       -assume old_inquire_recl              -assume old_ldout_format
       -assume old_ldout_zero                -assume noold_logical_assign
       -assume noold_logical_ldio            -assume old_maxminloc
       -assume old_xor                       -assume noprotect_allocates
       -assume protect_constants             -assume noprotect_parens
       -assume split_common                  -assume source_include
       -assume nostd_intent_in               -assume std_minus0_rounding
       -assume nostd_mod_proc_name           -assume std_value
       -assume realloc_lhs                   -assume underscore
       -assume no2underscores                -assume norecursion

Page 57          Source Listing                  TIME_INTERP_EXTERNAL_EXIT
2021-06-01 08:55                                 time_interp_external.F90

       -auto                            no   -auto_scalar
  no   -bintext                              -ccdefault default
       -check noarg_temp_created             -check noassume
       -check nobounds                       -check nocontiguous
       -check noformat                       -check nooutput_conversion
       -check nooverflow                     -check nopointers
       -check noshape                        -check nostack
       -check nouninitialized                -check noudio_iostat
       -coarray-num-procs 0             no   -coarray-config-file
       -convert native                       -cross_reference
       -D __INTEL_COMPILER=1910              -D __INTEL_COMPILER_UPDATE=0
       -D __unix__                           -D __unix
       -D __linux__                          -D __linux
       -D __gnu_linux__                      -D unix
       -D linux                              -D __ELF__
       -D __x86_64                           -D __x86_64__
       -D __amd64                            -D __amd64__
       -D __INTEL_COMPILER_BUILD_DATE=20191121       -D _OPENMP=201611
       -D __INTEL_OFFLOAD                    -D __MMX__
       -D __SSE__                            -D __SSE_MATH__
       -D __SSE2__                           -D __SSE2_MATH__
       -D __pentium4                         -D __pentium4__
       -D __tune_pentium4__                  -D PACKAGE_NAME='"GFDL FMS Library"'
       -D PACKAGE_TARNAME='"FMS"'            -D PACKAGE_VERSION='"2021.02.0"'
       -D PACKAGE_STRING='"GFDL FMS Library 2021.02.0"'       -D PACKAGE_BUGREPORT='"gfdl.climate.model.info@noaa.gov"'
       -D PACKAGE_URL='"https://www.gfdl.noaa.gov/fms"'       -D PACKAGE='"FMS"'
       -D VERSION='"2021.02.0"'              -D STDC_HEADERS=1
       -D HAVE_SYS_TYPES_H=1                 -D HAVE_SYS_STAT_H=1
       -D HAVE_STDLIB_H=1                    -D HAVE_STRING_H=1
       -D HAVE_MEMORY_H=1                    -D HAVE_STRINGS_H=1
       -D HAVE_INTTYPES_H=1                  -D HAVE_STDINT_H=1
       -D HAVE_UNISTD_H=1                    -D HAVE_DLFCN_H=1
       -D LT_OBJDIR='".libs/"'               -D HAVE_MPI_H=1
       -D HAVE_NETCDF_H=1                    -D HAVE_SCHED_GETAFFINITY=1
       -D HAVE_MOD_MPI=1                     -D HAVE_MOD_NETCDF=1
       -D HAVE_CRAY_POINTER=1                -D HAVE_QUAD_PRECISION=1
       -D HAVE_INTERNAL_NML=1                -D use_netCDF=1
       -D use_libMPI=1                       -D INTERNAL_FILE_NML
       -double_size 64                  no   -d_lines
  no   -Qdyncom                              -error_limit 30
  no   -f66                             no   -f77rtl
  no   -fast                                 -fpscomp nofilesfromcmd
       -fpscomp nogeneral                    -fpscomp noioformat
       -fpscomp noldio_spacing               -fpscomp nologicals
  no   -fpconstant                           -fpe3
       -fprm nearest                         -ftz
       -fp_model noprecise                   -fp_model fast
       -fp_model nostrict                    -fp_model nosource
       -fp_model nodouble                    -fp_model noextended
       -fp_model novery_fast                 -fp_model noexcept
       -fp_model nono_except                 -fp_modbits nofp_contract
       -fp_modbits nono_fp_contract          -fp_modbits nofenv_access
       -fp_modbits nono_fenv_access          -fp_modbits nocx_limited_range
       -fp_modbits nono_cx_limited_range       -fp_modbits noprec_div
       -fp_modbits nono_prec_div             -fp_modbits noprec_sqrt
       -fp_modbits nono_prec_sqrt            -fp_modbits ftz
       -fp_modbits nono_ftz                  -fp_modbits nointrin_limited_range

Page 58          Source Listing                  TIME_INTERP_EXTERNAL_EXIT
2021-06-01 08:55                                 time_interp_external.F90

       -fp_modbits nono_intrin_limited_range       -fp_modbits notrunc_compares
       -fp_modbits nono_trunc_compares       -fp_modbits noieee_nan_compares
       -fp_modbits nono_ieee_nan_compares       -fp_modbits honor_f32_conversion
       -fp_modbits nono_honor_f32_conversion       -fp_modbits honor_f64_conversion
       -fp_modbits nono_honor_f64_conversion       -fp_modbits nono_x87_copy
       -fp_modbits nono_no_x87_copy          -fp_modbits noexception_semantics
       -fp_modbits nono_exception_semantics       -fp_modbits noprecise_libm_functions
       -fp_modbits nono_precise_libm_functions       -heap_arrays 0
  no   -threadprivate_compat                 -free
       -g2                                   -iface nomixed_str_len_arg
       -iface nono_mixed_str_len_arg         -init noarrays
       -init nohuge                          -init noinfinity
       -init nominus_huge                    -init nominus_infinity
       -init nominus_tiny                    -init nonan
       -init nosnan                          -init notiny
       -init nozero                     no   -intconstant
       -integer_size 32                 no   -mixed_str_len_arg
       -module ../.mods                      -names lowercase
  no   -noinclude                       no   -o
       -offload-build=host                   -openmp
       -openmp-simd                          -openmp-offload
       -O0                              no   -pad_source
       -real_size 64                    no   -recursive
       -reentrancy threaded                  -vec=simd
       -show nofullpath                      -show noinclude
       -show map                             -show options
  no   -syntax_only                     no   -threadcom
  no   -U                               no   -vms
       -w noall                              -w nonone
       -w noalignments                       -w nodeclarations
       -w noexternals                        -w nogeneral
       -w noignore_bounds                    -w noignore_loc
       -w nointerfaces                       -w noshape
       -w notruncated_source                 -w nouncalled
       -w nouninitialized                    -w nounused
       -w nousage                       no   -wrap-margins

       -includepath : /opt/netcdf/4.6.1/INTEL/include/,/opt/intel/2020/compilers_and_libraries/linux/pstl/include/,
           /opt/intel/2020/compilers_and_libraries_2020.0.166/linux/compiler/include/,.f90,./.f90,./.f90,../include/.f90,
           ./.f90,/opt/netcdf/4.6.1/INTEL/include/.f90,/opt/intel/2020/compilers_and_libraries/linux/mpi/intel64/include/.f90,
           /opt/intel/2020/compilers_and_libraries/linux/mpi/intel64/include/.f90,/opt/intel/2020/compilers_and_libraries/linux/ipp/include/.f90,
           /opt/intel/2020/compilers_and_libraries/linux/mkl/include/.f90,/opt/intel/2020/compilers_and_libraries/linux/pstl/include/.f90,
           /opt/intel/2020/compilers_and_libraries/linux/tbb/include/.f90,/opt/intel/2020/compilers_and_libraries/linux/daal/include/.f90,
           /opt/intel/2020/compilers_and_libraries_2020.0.166/linux/compiler/include/intel64/.f90,/opt/intel/2020/compilers_and_libraries_2020.0.166/linux/compiler/include/icc/.f90,
           /opt/intel/2020/compilers_and_libraries_2020.0.166/linux/compiler/include/.f90,/usr/local/include/.f90,
           /usr/lib/gcc/x86_64-redhat-linux/4.8.5/include/.f90,/usr/include/.f90,/usr/include/.f90,/usr/include/.f90
       -list filename : time_interp_external.lst
  no   -o

COMPILER: Intel(R) Fortran 19.1-1555
