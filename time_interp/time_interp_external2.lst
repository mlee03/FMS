Page 1           Source Listing                  TIME_INTERP_EXTERNAL_INIT
2021-06-01 08:55                                 /tmp/ifortPU6wVi.i90

      1 # 1 "time_interp_external2.F90"
      2 !***********************************************************************
      3 !*                   GNU Lesser General Public License
      4 !*
      5 !* This file is part of the GFDL Flexible Modeling System (FMS).
      6 !*
      7 !* FMS is free software: you can redistribute it and/or modify it under
      8 !* the terms of the GNU Lesser General Public License as published by
      9 !* the Free Software Foundation, either version 3 of the License, or (at
     10 !* your option) any later version.
     11 !*
     12 !* FMS is distributed in the hope that it will be useful, but WITHOUT
     13 !* ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
     14 !* FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
     15 !* for more details.
     16 !*
     17 !* You should have received a copy of the GNU Lesser General Public
     18 !* License along with FMS.  If not, see <http://www.gnu.org/licenses/>.
     19 !***********************************************************************
     20 
     21 
     22 module time_interp_external2_mod
     23 !
     24 !<CONTACT EMAIL="Matthew.Harrison@noaa.gov">M.J. Harrison</CONTACT>
     25 !
     26 !<REVIEWER EMAIL="hsimmons@iarc.uaf.edu">Harper Simmons</REVIEWER>
     27 !
     28 !<OVERVIEW>
     29 ! Perform I/O and time interpolation of external fields (contained in a file).
     30 !</OVERVIEW>
     31 
     32 !<DESCRIPTION>
     33 ! Perform I/O and time interpolation for external fields.
     34 ! Uses udunits library to calculate calendar dates and
     35 ! convert units.  Allows for reading data decomposed across
     36 ! model horizontal grid using optional domain2d argument
     37 !
     38 ! data are defined over data domain for domain2d data
     39 ! (halo values are NOT updated by this module)
     40 !
     41 !</DESCRIPTION>
     42 !
     43 !<NAMELIST NAME="time_interp_external_nml">
     44 ! <DATA NAME="num_io_buffers" TYPE="integer">
     45 ! size of record dimension for internal buffer.  This is useful for tuning i/o performance
     46 ! particularly for large datasets (e.g. daily flux fields)
     47 ! </DATA>
     48 !</NAMELIST>
     49 
     50   use platform_mod, only : DOUBLE_KIND => r8_kind
     51   use fms_mod, only : write_version_number
     52   use mpp_mod, only : mpp_error,FATAL,WARNING,mpp_pe, stdout, stdlog, NOTE
     53   use mpp_mod, only : input_nml_file, mpp_npes, mpp_root_pe, mpp_broadcast, mpp_get_current_pelist
     54   use time_manager_mod, only : time_type, get_date, set_date, operator ( >= ) , operator ( + ) , days_in_month, &
     55                             operator( - ), operator ( / ) , days_in_year, increment_time, &
     56                             set_time, get_time, operator( > ), get_calendar_type, NO_CALENDAR
     57   use get_cal_time_mod, only : get_cal_time

Page 2           Source Listing                  TIME_INTERP_EXTERNAL_INIT
2021-06-01 08:55                                 time_interp_external2.F90

     58   use mpp_domains_mod, only : domain2d, mpp_get_compute_domain, mpp_get_data_domain, &
     59        mpp_get_global_domain, NULL_DOMAIN2D
     60   use time_interp_mod, only : time_interp, time_interp_init
     61   use axis_utils2_mod, only : get_axis_cart, get_axis_modulo, get_axis_modulo_times
     62   use fms_mod, only : lowercase, check_nml_error
     63   use platform_mod, only: r8_kind
     64   use horiz_interp_mod, only : horiz_interp, horiz_interp_type
     65   use fms2_io_mod,      only : Valid_t, FmsNetcdfDomainFile_t, open_file, get_unlimited_dimension_name, &
     66                                variable_att_exists, FmsNetcdfFile_t, &
     67                                variable_exists, get_valid, get_variable_num_dimensions, read_data, &
     68                                is_valid, close_file, get_dimension_size, get_variable_dimension_names, &
     69                                get_variable_size, get_time_calendar, get_variable_missing, get_variable_units
     70 
     71   implicit none
     72   private
     73 
     74 ! Include variable "version" to be written to log file.
     75 # 1 "../include/file_version.h" 1 
     76 ! -*-f90-*-
     77 !***********************************************************************
     78 !*                   GNU Lesser General Public License
     79 !*
     80 !* This file is part of the GFDL Flexible Modeling System (FMS).
     81 !*
     82 !* FMS is free software: you can redistribute it and/or modify it under
     83 !* the terms of the GNU Lesser General Public License as published by
     84 !* the Free Software Foundation, either version 3 of the License, or (at
     85 !* your option) any later version.
     86 !*
     87 !* FMS is distributed in the hope that it will be useful, but WITHOUT
     88 !* ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
     89 !* FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
     90 !* for more details.
     91 !*
     92 !* You should have received a copy of the GNU Lesser General Public
     93 !* License along with FMS.  If not, see <http://www.gnu.org/licenses/>.
     94 !***********************************************************************
     95 
     96 # 23
     97 
     98   character(len=*), parameter :: version = 'unknown'
     99 
    100 # 75 "time_interp_external2.F90" 2 
    101 
    102   integer, parameter, public  :: NO_REGION=0, INSIDE_REGION=1, OUTSIDE_REGION=2
    103   integer, parameter, private :: modulo_year= 0001
    104   integer, parameter, private :: LINEAR_TIME_INTERP = 1 ! not used currently
    105   integer, parameter, public  :: SUCCESS = 0, ERR_FIELD_NOT_FOUND = 1
    106   real,    parameter, private :: DEFAULT_MISSING_VALUE = -1e20
    107   integer,            private :: max_fields = 100, max_files= 40
    108   integer, private :: num_fields = 0, num_files=0
    109 ! denotes time intervals in file (interpreted from metadata)
    110   integer, private :: num_io_buffers = 2 ! set -1 to read all records from disk into memory
    111   logical, private :: module_initialized = .false.
    112   logical, private :: debug_this_module = .false.
    113 
    114   public init_external_field, time_interp_external, time_interp_external_init, &

Page 3           Source Listing                  TIME_INTERP_EXTERNAL_INIT
2021-06-01 08:55                                 time_interp_external2.F90

    115        time_interp_external_exit, get_external_field_size, get_time_axis, get_external_field_missing
    116   public set_override_region, reset_src_data_region
    117   public get_external_fileobj
    118 
    119   private find_buf_index,&
    120          set_time_modulo
    121 
    122   type, private :: ext_fieldtype
    123      type(FmsNetcdfFile_t), pointer :: fileobj=>NULL() ! keep unit open when not reading all records
    124      character(len=128) :: name, units
    125      integer :: siz(4), ndim
    126      character(len=32) :: axisname(4)
    127      type(domain2d) :: domain
    128      type(time_type), dimension(:), pointer :: time =>NULL() ! midpoint of time interval
    129      type(time_type), dimension(:), pointer :: start_time =>NULL(), end_time =>NULL()
    130      type(time_type), dimension(:), pointer :: period =>NULL()
    131      logical :: modulo_time ! denote climatological time axis
    132      real, dimension(:,:,:,:), pointer :: data =>NULL() ! defined over data domain or global domain
    133      logical, dimension(:,:,:,:), pointer :: mask =>NULL() ! defined over data domain or global domain
    134      integer, dimension(:), pointer :: ibuf  =>NULL() ! record numbers associated with buffers
    135      real, dimension(:,:,:,:), pointer :: src_data  =>NULL() ! input data buffer
    136      type(valid_t) :: valid ! data validator
    137      integer :: nbuf
    138      logical :: domain_present
    139      real(DOUBLE_KIND) :: slope, intercept
    140      integer :: isc,iec,jsc,jec
    141      type(time_type) :: modulo_time_beg, modulo_time_end
    142      logical :: have_modulo_times, correct_leap_year_inconsistency
    143      integer :: region_type
    144      integer :: is_region, ie_region, js_region, je_region
    145      integer :: is_src, ie_src, js_src, je_src
    146      integer :: tdim
    147      integer :: numwindows
    148      logical, dimension(:,:), pointer :: need_compute=>NULL()
    149      real    :: missing ! missing value
    150   end type ext_fieldtype
    151 
    152   type, private :: filetype
    153      character(len=128) :: filename = ''
    154      type(FmsNetcdfFile_t), pointer :: fileobj => NULL()
    155   end type filetype
    156 
    157   interface time_interp_external
    158      module procedure time_interp_external_0d
    159      module procedure time_interp_external_2d
    160      module procedure time_interp_external_3d
    161   end interface
    162 
    163   integer :: outunit
    164 
    165   type(ext_fieldtype), save, private, pointer :: field(:) => NULL()
    166   type(filetype),      save, private, pointer :: opened_files(:) => NULL()
    167 !Balaji: really should use field%missing
    168   integer, private, parameter :: dk = DOUBLE_KIND ! ensures that time_interp_missing is in range for mixed-mode
    169 ! compiling
    170   real(DOUBLE_KIND), private, parameter :: time_interp_missing=-1e99_dk
    171   contains

Page 4           Source Listing                  TIME_INTERP_EXTERNAL_INIT
2021-06-01 08:55                                 time_interp_external2.F90

    172 
    173 ! <SUBROUTINE NAME="time_interp_external_init">
    174 !
    175 ! <DESCRIPTION>
    176 ! Initialize the time_interp_external module
    177 ! </DESCRIPTION>
    178 !
    179     subroutine time_interp_external_init()
    180 
    181       integer :: ioun, io_status, logunit, ierr
    182 
    183       namelist /time_interp_external_nml/ num_io_buffers, debug_this_module, &
    184                                           max_fields, max_files
    185 
    186 ! open and read namelist
    187 
    188       if(module_initialized) return
    189 
    190       logunit = stdlog()
    191       outunit = stdout()
    192       call write_version_number("TIME_INTERP_EXTERNAL_MOD", version)
    193 
    194       read (input_nml_file, time_interp_external_nml, iostat=io_status)
    195       ierr = check_nml_error(io_status, 'time_interp_external_nml')
    196 
    197       write(logunit,time_interp_external_nml)
    198       call realloc_fields(max_fields)
    199       call realloc_files(max_files)
    200 
    201       module_initialized = .true.
    202 
    203       call time_interp_init()
    204 
    205       return
    206 
    207     end  subroutine time_interp_external_init

Page 5           Source Listing                  TIME_INTERP_EXTERNAL_INIT
2021-06-01 08:55 Entry Points                    time_interp_external2.F90



ENTRY POINTS

  Name                                                               
                                                                     
 time_interp_external2_mod_mp_time_interp_external_init_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 CHECK_NML_ERROR            Func   195      I(4)            4           scalar   PRIV             62,195                            
 DEBUG_THIS_MODULE          Local  183      L(4)            4           scalar   PRIV             112,183,306,799,941,1051,1141     
 IERR                       Local  181      I(4)            4           scalar                    195                               
 INPUT_NML_FILE             Local  194      CHAR                  1     1        ALC,TGT,PRIV     53,194                            
 IOUN                       Local  181      I(4)            4           scalar                                                      
 IO_STATUS                  Local  181      I(4)            4           scalar                    194,195                           
 LOGUNIT                    Local  181      I(4)            4           scalar                    190,197                           
 MAX_FIELDS                 Local  184      I(4)            4           scalar   PRIV             107,184,198,423                   
 MAX_FILES                  Local  184      I(4)            4           scalar   PRIV             107,184,199,330                   
 MODULE_INITIALIZED         Local  188      L(4)            4           scalar   PRIV             111,188,201,297,1393              
 NUM_IO_BUFFERS             Local  183      I(4)            4           scalar   PRIV             110,183,545,546                   
 OUTUNIT                    Local  191      I(4)            4           scalar                    191,542,543,670,672,674,677,680,88
                                                                                                  4,886,897,898,976,978,989,990,1051
                                                                                                  ,1141                             
 STDLOG                     Func   190      I(4)            4           scalar   PRIV             52,190                            
 STDOUT                     Func   191      I(4)            4           scalar   PRIV             52,191                            
 TIME_INTERP_EXTERNAL_INIT  Subr   179                                                                                              
 TIME_INTERP_EXTERNAL_NML   Local  183                                  scalar                    194,197                           
 TIME_INTERP_INIT           Subr   203                                           PRIV             60,203                            
 VERSION                    Param  192      CHAR            7           scalar                    192                               
 WRITE_VERSION_NUMBER       Subr   192                                           PRIV             51,192                            

Page 6           Source Listing                  TIME_INTERP_EXTERNAL_INIT
2021-06-01 08:55                                 time_interp_external2.F90

    208 ! </SUBROUTINE> NAME="time_interp_external_init"
    209 
    210 
    211 !<FUNCTION NAME="init_external_field" TYPE="integer">
    212 !
    213 !<DESCRIPTION>
    214 ! initialize an external field.  Buffer "num_io_buffers" (default=2) in memory to reduce memory allocations.
    215 ! distributed reads are supported using the optional "domain" flag.
    216 ! Units conversion via the optional "desired_units" flag using udunits_mod.
    217 !
    218 ! Return integer id of field for future calls to time_interp_external.
    219 !
    220 ! </DESCRIPTION>
    221 !
    222 !<IN  NAME="file" TYPE="character(len=*)">
    223 ! filename
    224 !</IN>
    225 !<IN  NAME="fieldname" TYPE="character(len=*)">
    226 ! fieldname (in file)
    227 !</IN>
    228 !<IN NAME="format" TYPE="integer">
    229 ! mpp_io flag for format of file (optional). Currently only "MPP_NETCDF" supported
    230 !</IN>
    231 !<IN NAME="threading" TYPE="integer">
    232 ! mpp_io flag for threading (optional).  "MPP_SINGLE" means root pe reads global field and distributes to other PEs
    233 ! "MPP_MULTI" means all PEs read data
    234 !</IN>
    235 !<IN NAME="domain" TYPE="mpp_domains_mod:domain2d">
    236 ! domain flag (optional)
    237 !</IN>
    238 !<IN NAME="desired_units" TYPE="character(len=*)">
    239 ! Target units for data (optional), e.g. convert from deg_K to deg_C.
    240 ! Failure to convert using udunits will result in failure of this module.
    241 !</IN>
    242 !<IN NAME="verbose" TYPE="logical">
    243 ! verbose flag for debugging (optional).
    244 !</IN>
    245 !<INOUT NAME="axis_centers" TYPE="axistype" DIM="(4)">
    246 ! MPP_IO axistype array for grid centers ordered X-Y-Z-T (optional).
    247 !</INOUT>
    248 !<INOUT NAME="axis_sizes" TYPE="integer" DIM="(4)">
    249 !  array of axis lengths ordered X-Y-Z-T (optional).
    250 !</INOUT>
    251 
    252 
    253     function init_external_field(file,fieldname,domain,desired_units,&
    254          verbose,axis_names, axis_sizes,override,correct_leap_year_inconsistency,&
    255          permit_calendar_conversion,use_comp_domain,ierr, nwindows, ignore_axis_atts, ongrid )
    256 
    257       character(len=*), intent(in)            :: file,fieldname
    258       logical, intent(in), optional           :: verbose
    259       character(len=*), intent(in), optional  :: desired_units
    260       type(domain2d), intent(in), optional    :: domain
    261       integer, intent(inout), optional        :: axis_sizes(4)
    262       character(len=*), intent(out), optional :: axis_names(4)
    263       logical, intent(in), optional           :: override, correct_leap_year_inconsistency,&
    264                                                  permit_calendar_conversion,use_comp_domain

Page 7           Source Listing                  INIT_EXTERNAL_FIELD
2021-06-01 08:55                                 time_interp_external2.F90

    265       integer,          intent(out), optional :: ierr
    266       integer,          intent(in),  optional :: nwindows
    267       logical, optional                       :: ignore_axis_atts
    268       logical, optional                       :: ongrid !< Optional flag indicating if the data is ongrid
    269 
    270       logical :: ongrid_local !< Flag indicating if the data is ongrid
    271 
    272       integer :: init_external_field
    273 
    274       real(DOUBLE_KIND) :: slope, intercept
    275       integer :: unit,ndim,nvar,natt,ntime,i,j
    276       integer :: iscomp,iecomp,jscomp,jecomp,isglobal,ieglobal,jsglobal,jeglobal
    277       integer :: isdata,iedata,jsdata,jedata, dxsize, dysize,dxsize_max,dysize_max
    278       logical :: verb, transpose_xy,use_comp_domain1
    279       real, dimension(:), allocatable :: tstamp, tstart, tend, tavg
    280       character(len=1) :: cart
    281       character(len=1), dimension(4) :: cart_dir
    282       character(len=128) :: units, fld_units
    283       character(len=128) :: name, msg, calendar_type, timebeg, timeend
    284       character(len=128) :: timename, timeunits
    285       character(len=128), allocatable :: axisname(:)
    286       integer,            allocatable :: axislen(:)
    287       integer :: siz(4), siz_in(4), gxsize, gysize,gxsize_max, gysize_max
    288       type(time_type) :: tdiff
    289       integer :: yr, mon, day, hr, minu, sec
    290       integer :: len, nfile, nfields_orig, nbuf, nx,ny
    291       integer :: numwindows
    292       logical :: ignore_axatts
    293       logical :: have_modulo_time
    294       type(FmsNetcdfFile_t), pointer :: fileobj=>NULL()
    295       integer, dimension(:), allocatable :: pes  !< List of ranks in the current pelist
    296 
    297       if (.not. module_initialized) call mpp_error(FATAL,'Must call time_interp_external_init first')
    298       if(present(ierr)) ierr = SUCCESS
    299       ignore_axatts=.false.
    300       cart_dir(1)='X';cart_dir(2)='Y';cart_dir(3)='Z';cart_dir(4)='T'
    301       if(present(ignore_axis_atts)) ignore_axatts = ignore_axis_atts
    302       use_comp_domain1 = .false.
    303       if(PRESENT(use_comp_domain)) use_comp_domain1 = use_comp_domain
    304       verb=.false.
    305       if (PRESENT(verbose)) verb=verbose
    306       if (debug_this_module) verb = .true.
    307       numwindows = 1
    308       if(present(nwindows)) numwindows = nwindows
    309 
    310       units = 'same'
    311       if (PRESENT(desired_units)) then
    312           units = desired_units
    313           call mpp_error(FATAL,'==> Unit conversion via time_interp_external &
    314                &has been temporarily deprecated.  Previous versions of&
    315                &this module used udunits_mod to perform unit conversion.&
    316                &  Udunits_mod is in the process of being replaced since &
    317                &there were portability issues associated with this code.&
    318                & Please remove the desired_units argument from calls to &
    319                &this routine.')
    320       endif
    321       nfile = 0

Page 8           Source Listing                  INIT_EXTERNAL_FIELD
2021-06-01 08:55                                 time_interp_external2.F90

    322       do i=1,num_files
    323          if(trim(opened_files(i)%filename) == trim(file)) then
    324             nfile = i
    325             exit  ! file is already opened
    326          endif
    327       enddo
    328       if(nfile == 0) then
    329          num_files = num_files + 1
    330          if(num_files > max_files) then ! not enough space in the file table, reallocate it
    331 !--- z1l: For the case of multiple thread, realoc_files will cause memory leak.
    332 !---      If multiple threads are working on file A. One of the thread finished first and
    333 !---      begin to work on file B, the realloc_files will cause problem for
    334 !---      other threads are working on the file A.
    335 !  call realloc_files(2*size(opened_files))
    336             call mpp_error(FATAL, "time_interp_external: num_files is greater than max_files, "// &
    337                                       "increase time_interp_external_nml max_files")
    338          endif
    339          opened_files(num_files)%filename = trim(file)
    340          allocate(opened_files(num_files)%fileobj)
    341          fileobj => opened_files(num_files)%fileobj
    342 
    343          if(.not. open_file(opened_files(num_files)%fileobj, trim(file), 'read')) &
    344              call mpp_error(FATAL, 'time_interp_external_mod: Error in opening file '//trim(file))
    345       else
    346          fileobj => opened_files(nfile)%fileobj
    347       endif
    348 
    349       call get_unlimited_dimension_name(fileobj, timename)
    350       call get_dimension_size(fileobj, timename, ntime)
    351 
    352       if (ntime < 1) then
    353           write(msg,'(a15,a,a58)') 'external field ',trim(fieldname),&
    354            ' does not have an associated record dimension (REQUIRED) '
    355           call mpp_error(FATAL,trim(msg))
    356       endif
    357 
    358 !--- get time calendar_type
    359       call get_time_calendar(fileobj, timename, calendar_type)
    360 
    361 !--- get time units
    362       call get_variable_units(fileobj, timename, timeunits)
    363 
    364 !--- get timebeg and timeend
    365       have_modulo_time = get_axis_modulo_times(fileobj, timename, timebeg, timeend)
    366 
    367       allocate(pes(mpp_npes()))
    368       call mpp_get_current_pelist(pes)
    369       allocate(tstamp(ntime),tstart(ntime),tend(ntime),tavg(ntime))
    370 
    371 !< Only root reads the unlimited dimension and broadcasts it to the other ranks
    372       if (mpp_root_pe() .eq. mpp_pe()) call read_data(fileobj, timename, tstamp)
    373       call mpp_broadcast(tstamp, size(tstamp), mpp_root_pe(), pelist=pes)
    374       deallocate(pes)
    375 
    376       transpose_xy = .false.
    377       isdata=1; iedata=1; jsdata=1; jedata=1
    378       gxsize=1; gysize=1

Page 9           Source Listing                  INIT_EXTERNAL_FIELD
2021-06-01 08:55                                 time_interp_external2.F90

    379       siz_in = 1
    380 
    381       if (PRESENT(domain)) then
    382          call mpp_get_compute_domain(domain,iscomp,iecomp,jscomp,jecomp)
    383          nx = iecomp-iscomp+1; ny = jecomp-jscomp+1
    384          call mpp_get_data_domain(domain,isdata,iedata,jsdata,jedata,dxsize,dxsize_max,dysize,dysize_max)
    385          call mpp_get_global_domain(domain,isglobal,ieglobal,jsglobal,jeglobal,gxsize,gxsize_max,gysize,gysize_max)
    386          ongrid_local = .false.
    387          if (present(ongrid)) ongrid_local = ongrid
    388 !> If this is an ongrid case, set is[e]js[e]data to be equal to the compute domain.
    389 !! This is what it is used to allocate space for the data!
    390          if (ongrid_local) then
    391               isdata=iscomp
    392               iedata=iecomp
    393               jsdata=jscomp
    394               jedata=jecomp
    395          endif
    396       elseif(use_comp_domain1) then
    397          call mpp_error(FATAL,"init_external_field:"//&
    398               " use_comp_domain=true but domain is not present")
    399       endif
    400 
    401       init_external_field = -1
    402       nfields_orig = num_fields
    403 
    404       tavg = -1.0
    405       tstart = tstamp
    406       tend = tstamp
    407       if(variable_att_exists(fileobj, fieldname, 'time_avg_info')) then
    408         if(variable_exists(fileobj, 'average_T1')) call read_data(fileobj, 'average_T1', tstart)
    409         if(variable_exists(fileobj, 'average_T2')) call read_data(fileobj, 'average_T2', tend)
    410         if(variable_exists(fileobj, 'average_DT')) call read_data(fileobj, 'average_DT', tavg)
    411       endif
    412 
    413       if (.not. variable_exists(fileobj, fieldname) ) then
    414         if (present(ierr)) then
    415            ierr = ERR_FIELD_NOT_FOUND
    416            return
    417         else
    418            call mpp_error(FATAL,'external field "'//trim(fieldname)//'" not found in file "'//trim(file)//'"')
    419         endif
    420       endif
    421 
    422       num_fields = num_fields + 1
    423       if(num_fields > max_fields) then
    424 !--- z1l: For the case of multiple thread, realoc_fields will cause memory leak.
    425 !---      If multiple threads are working on field A. One of the thread finished first and
    426 !---      begin to work on field B, the realloc_files will cause problem for
    427 !---      other threads are working on the field A.
    428 !call realloc_fields(size(field)*2)
    429          call mpp_error(FATAL, "time_interp_external: num_fields is greater than max_fields, "// &
    430                                    "increase time_interp_external_nml max_fields")
    431       endif
    432 
    433 !--- get field attribute
    434       call get_variable_units(fileobj, fieldname, fld_units)
    435 

Page 10          Source Listing                  INIT_EXTERNAL_FIELD
2021-06-01 08:55                                 time_interp_external2.F90

    436       init_external_field = num_fields
    437       field(num_fields)%fileobj => fileobj
    438       field(num_fields)%name = trim(fieldname)
    439       field(num_fields)%units = trim(fld_units)
    440       field(num_fields)%isc = 1
    441       field(num_fields)%iec = 1
    442       field(num_fields)%jsc = 1
    443       field(num_fields)%jec = 1
    444       field(num_fields)%region_type = NO_REGION
    445       field(num_fields)%is_region   = 0
    446       field(num_fields)%ie_region   = -1
    447       field(num_fields)%js_region   = 0
    448       field(num_fields)%je_region   = -1
    449       if (PRESENT(domain)) then
    450          field(num_fields)%domain_present = .true.
    451          field(num_fields)%domain = domain
    452          field(num_fields)%isc=iscomp;field(num_fields)%iec = iecomp
    453          field(num_fields)%jsc=jscomp;field(num_fields)%jec = jecomp
    454       else
    455          field(num_fields)%domain_present = .false.
    456       endif
    457 
    458       field(num_fields)%valid = get_valid(fileobj, fieldname)
    459       ndim = get_variable_num_dimensions(fileobj, fieldname)
    460       if (ndim > 4) call mpp_error(FATAL, &
    461            'invalid array rank <=4d fields supported')
    462 
    463       field(num_fields)%siz = 1
    464       field(num_fields)%ndim = ndim
    465       field(num_fields)%tdim = 4
    466 !--- get field missing value
    467       field(num_fields)%missing = get_variable_missing(fileobj, fieldname)
    468 
    469       allocate(axisname(ndim), axislen(ndim))
    470 
    471       call get_variable_dimension_names(fileobj, fieldname, axisname)
    472       call get_variable_size(fileobj, fieldname, axislen)
    473       do j=1,field(num_fields)%ndim
    474          call get_axis_cart(fileobj, axisname(j), cart)
    475          len = axislen(j)
    476          if (cart == 'N' .and. .not. ignore_axatts) then
    477             write(msg,'(a,"/",a)')  trim(file),trim(fieldname)
    478             call mpp_error(FATAL,'file/field '//trim(msg)// &
    479                  ' couldnt recognize axis atts in time_interp_external')
    480          else if (cart == 'N' .and. ignore_axatts) then
    481             cart = cart_dir(j)
    482          endif
    483          select case (cart)
    484          case ('X')
    485             if (j.eq.2) transpose_xy = .true.
    486             if (.not.PRESENT(domain) .and. .not.PRESENT(override)) then
    487                isdata=1;iedata=len
    488                iscomp=1;iecomp=len
    489                gxsize = len
    490                dxsize = len
    491                field(num_fields)%isc=iscomp;field(num_fields)%iec=iecomp
    492             elseif (PRESENT(override)) then

Page 11          Source Listing                  INIT_EXTERNAL_FIELD
2021-06-01 08:55                                 time_interp_external2.F90

    493                gxsize = len
    494                if (PRESENT(axis_sizes)) axis_sizes(1) = len
    495             endif
    496             field(num_fields)%axisname(1) = axisname(j)
    497             if(use_comp_domain1) then
    498                field(num_fields)%siz(1) = nx
    499             else
    500                field(num_fields)%siz(1) = dxsize
    501             endif
    502             if (len /= gxsize) then
    503                write(msg,'(a,"/",a)')  trim(file),trim(fieldname)
    504                call mpp_error(FATAL,'time_interp_ext, file/field '//trim(msg)//' x dim doesnt match model')
    505             endif
    506          case ('Y')
    507             field(num_fields)%axisname(2) = axisname(j)
    508             if (.not.PRESENT(domain) .and. .not.PRESENT(override)) then
    509                jsdata=1;jedata=len
    510                jscomp=1;jecomp=len
    511                gysize = len
    512                dysize = len
    513                field(num_fields)%jsc=jscomp;field(num_fields)%jec=jecomp
    514             elseif (PRESENT(override)) then
    515                gysize = len
    516                if (PRESENT(axis_sizes)) axis_sizes(2) = len
    517             endif
    518             if(use_comp_domain1) then
    519                field(num_fields)%siz(2) = ny
    520             else
    521                field(num_fields)%siz(2) = dysize
    522             endif
    523             if (len /= gysize) then
    524                write(msg,'(a,"/",a)')  trim(file),trim(fieldname)
    525                call mpp_error(FATAL,'time_interp_ext, file/field '//trim(msg)//' y dim doesnt match model')
    526             endif
    527          case ('Z')
    528             field(num_fields)%axisname(3) = axisname(j)
    529             field(num_fields)%siz(3) = len
    530          case ('T')
    531             field(num_fields)%axisname(4) = axisname(j)
    532             field(num_fields)%siz(4) = ntime
    533             field(num_fields)%tdim   = j
    534          end select
    535       enddo
    536       siz = field(num_fields)%siz
    537       if(PRESENT(axis_names)) axis_names = field(num_fields)%axisname
    538       if (PRESENT(axis_sizes) .and. .not.PRESENT(override)) then
    539          axis_sizes = field(num_fields)%siz
    540       endif
    541 
    542       if (verb) write(outunit,'(a,4i6)') 'field x,y,z,t local size= ',siz
    543       if (verb) write(outunit,*) 'field contains data in units = ',trim(field(num_fields)%units)
    544       if (transpose_xy) call mpp_error(FATAL,'axis ordering not supported')
    545       if (num_io_buffers .le. 1) call mpp_error(FATAL,'time_interp_ext:num_io_buffers should be at least 2')
    546       nbuf = min(num_io_buffers,siz(4))
    547 
    548       field(num_fields)%numwindows = numwindows
    549       allocate(field(num_fields)%need_compute(nbuf, numwindows))

Page 12          Source Listing                  INIT_EXTERNAL_FIELD
2021-06-01 08:55                                 time_interp_external2.F90

    550       field(num_fields)%need_compute = .true.
    551 
    552       allocate(field(num_fields)%data(isdata:iedata,jsdata:jedata,siz(3),nbuf),&
    553                field(num_fields)%mask(isdata:iedata,jsdata:jedata,siz(3),nbuf) )
    554       field(num_fields)%mask = .false.
    555       field(num_fields)%data = 0.0
    556          slope=1.0;intercept=0.0
    557 !             if (units /= 'same') call convert_units(trim(field(num_fields)%units),trim(units),slope,intercept)
    558 !             if (verb.and.units /= 'same') then
    559 !                 write(outunit,*) 'attempting to convert data to units = ',trim(units)
    560 !                 write(outunit,'(a,f8.3,a,f8.3)') 'factor = ',slope,' offset= ',intercept
    561 !             endif
    562       field(num_fields)%slope = slope
    563       field(num_fields)%intercept = intercept
    564       allocate(field(num_fields)%ibuf(nbuf))
    565       field(num_fields)%ibuf = -1
    566       field(num_fields)%nbuf =  0 ! initialize buffer number so that first reading fills data(:,:,:,1)
    567       if(PRESENT(override)) then
    568          field(num_fields)%is_src = 1
    569          field(num_fields)%ie_src = gxsize
    570          field(num_fields)%js_src = 1
    571          field(num_fields)%je_src = gysize
    572          allocate(field(num_fields)%src_data(gxsize,gysize,siz(3),nbuf))
    573       else
    574          field(num_fields)%is_src = isdata
    575          field(num_fields)%ie_src = iedata
    576          field(num_fields)%js_src = jsdata
    577          field(num_fields)%je_src = jedata
    578          allocate(field(num_fields)%src_data(isdata:iedata,jsdata:jedata,siz(3),nbuf))
    579       endif
    580 
    581       allocate(field(num_fields)%time(ntime))
    582       allocate(field(num_fields)%period(ntime))
    583       allocate(field(num_fields)%start_time(ntime))
    584       allocate(field(num_fields)%end_time(ntime))
    585 
    586       do j=1,ntime
    587          field(num_fields)%time(j)       = get_cal_time(tstamp(j),trim(timeunits),trim(calendar_type),permit_calendar_conver
    587 sion)
    588          field(num_fields)%start_time(j) = get_cal_time(tstart(j),trim(timeunits),trim(calendar_type),permit_calendar_conver
    588 sion)
    589          field(num_fields)%end_time(j)   = get_cal_time(  tend(j),trim(timeunits),trim(calendar_type),permit_calendar_conver
    589 sion)
    590       enddo
    591 
    592       if (field(num_fields)%modulo_time) then
    593          call set_time_modulo(field(num_fields)%Time)
    594          call set_time_modulo(field(num_fields)%start_time)
    595          call set_time_modulo(field(num_fields)%end_time)
    596       endif
    597 
    598       if(present(correct_leap_year_inconsistency)) then
    599         field(num_fields)%correct_leap_year_inconsistency = correct_leap_year_inconsistency
    600       else
    601         field(num_fields)%correct_leap_year_inconsistency = .false.
    602       endif
    603 

Page 13          Source Listing                  INIT_EXTERNAL_FIELD
2021-06-01 08:55                                 time_interp_external2.F90

    604       if(have_modulo_time) then
    605          if(get_calendar_type() == NO_CALENDAR) then
    606             field(num_fields)%modulo_time_beg = set_time(timebeg)
    607             field(num_fields)%modulo_time_end = set_time(timeend)
    608          else
    609             field(num_fields)%modulo_time_beg = set_date(timebeg)
    610             field(num_fields)%modulo_time_end = set_date(timeend)
    611          endif
    612          field(num_fields)%have_modulo_times = .true.
    613       else
    614          field(num_fields)%have_modulo_times = .false.
    615       endif
    616       if(ntime == 1) then
    617          call mpp_error(NOTE, 'time_interp_external_mod: file '//trim(file)//'  has only one time level')
    618       else
    619          do j= 1, ntime
    620             field(num_fields)%period(j) = field(num_fields)%end_time(j)-field(num_fields)%start_time(j)
    621             if (field(num_fields)%period(j) > set_time(0,0)) then
    622                call get_time(field(num_fields)%period(j), sec, day)
    623                sec = sec/2+mod(day,2)*43200
    624                day = day/2
    625                field(num_fields)%time(j) = field(num_fields)%start_time(j)+&
    626                     set_time(sec,day)
    627             else
    628                if (j > 1 .and. j < ntime) then
    629                   tdiff = field(num_fields)%time(j+1) -  field(num_fields)%time(j-1)
    630                   call get_time(tdiff, sec, day)
    631                   sec = sec/2+mod(day,2)*43200
    632                   day = day/2
    633                   field(num_fields)%period(j) = set_time(sec,day)
    634                   sec = sec/2+mod(day,2)*43200
    635                   day = day/2
    636                   field(num_fields)%start_time(j) = field(num_fields)%time(j) - set_time(sec,day)
    637                   field(num_fields)%end_time(j) = field(num_fields)%time(j) + set_time(sec,day)
    638                elseif ( j == 1) then
    639                   tdiff = field(num_fields)%time(2) -  field(num_fields)%time(1)
    640                   call get_time(tdiff, sec, day)
    641                   field(num_fields)%period(j) = set_time(sec,day)
    642                   sec = sec/2+mod(day,2)*43200
    643                   day = day/2
    644                   field(num_fields)%start_time(j) = field(num_fields)%time(j) - set_time(sec,day)
    645                   field(num_fields)%end_time(j) = field(num_fields)%time(j) + set_time(sec,day)
    646                else
    647                   tdiff = field(num_fields)%time(ntime) -  field(num_fields)%time(ntime-1)
    648                   call get_time(tdiff, sec, day)
    649                   field(num_fields)%period(j) = set_time(sec,day)
    650                   sec = sec/2+mod(day,2)*43200
    651                   day = day/2
    652                   field(num_fields)%start_time(j) = field(num_fields)%time(j) - set_time(sec,day)
    653                   field(num_fields)%end_time(j) = field(num_fields)%time(j) + set_time(sec,day)
    654                endif
    655             endif
    656          enddo
    657       endif
    658 
    659       do j=1,ntime-1
    660          if (field(num_fields)%time(j) >= field(num_fields)%time(j+1)) then

Page 14          Source Listing                  INIT_EXTERNAL_FIELD
2021-06-01 08:55                                 time_interp_external2.F90

    661             write(msg,'(A,i20)') "times not monotonically increasing. Filename: " &
    662                  //TRIM(file)//"  field:  "//TRIM(fieldname)//" timeslice: ", j
    663             call mpp_error(FATAL, TRIM(msg))
    664          endif
    665       enddo
    666 
    667       field(num_fields)%modulo_time = get_axis_modulo(fileobj, timename)
    668 
    669       if (verb) then
    670          if (field(num_fields)%modulo_time) write(outunit,*) 'data are being treated as modulo in time'
    671          do j= 1, ntime
    672             write(outunit,*) 'time index,  ', j
    673             call get_date(field(num_fields)%start_time(j),yr,mon,day,hr,minu,sec)
    674             write(outunit,'(a,i4,a,i2,a,i2,1x,i2,a,i2,a,i2)') &
    675                  'start time: yyyy/mm/dd hh:mm:ss= ',yr,'/',mon,'/',day,hr,':',minu,':',sec
    676             call get_date(field(num_fields)%time(j),yr,mon,day,hr,minu,sec)
    677             write(outunit,'(a,i4,a,i2,a,i2,1x,i2,a,i2,a,i2)') &
    678                  'mid time: yyyy/mm/dd hh:mm:ss= ',yr,'/',mon,'/',day,hr,':',minu,':',sec
    679             call get_date(field(num_fields)%end_time(j),yr,mon,day,hr,minu,sec)
    680             write(outunit,'(a,i4,a,i2,a,i2,1x,i2,a,i2,a,i2)') &
    681                  'end time: yyyy/mm/dd hh:mm:ss= ',yr,'/',mon,'/',day,hr,':',minu,':',sec
    682          enddo
    683       end if
    684 
    685       deallocate(axisname, axislen)
    686       deallocate(tstamp, tstart, tend, tavg)
    687 
    688       return
    689 
    690     end function init_external_field

Page 15          Source Listing                  INIT_EXTERNAL_FIELD
2021-06-01 08:55 Entry Points                    time_interp_external2.F90



ENTRY POINTS

  Name                                                         
                                                               
 time_interp_external2_mod_mp_init_external_field_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 AXISLEN                    Local  286      I(4)            4     1     1        ALC              469,472,475,685                   
 AXISNAME                   Local  285      CHAR            128   1     1        ALC              469,471,474,496,507,528,531,685   
 AXIS_NAMES                 Dummy  254      CHAR                  1     4        ARG,OUT          537                               
 AXIS_SIZES                 Dummy  254      I(4)            4     1     4        ARG,INOUT        494,516,538,539                   
 CALENDAR_TYPE              Local  283      CHAR            128         scalar                    359,587,588,589                   
 CART                       Local  280      CHAR            1           scalar                    474,476,480,481,483               
 CART_DIR                   Local  281      CHAR            1     1     4                         300,481                           
 COMPRESSED_READ_1D         Subr   372                                           PRIV             372,408,409,410                   
 CORRECT_LEAP_YEAR_INCONSIS                                                                                                         
 TENCY                      Dummy  254      L(4)            4           scalar   ARG,IN           598,599                           
 DAY                        Local  289      I(4)            4           scalar                    622,623,624,626,630,631,632,633,63
                                                                                                  4,635,636,637,640,641,642,643,644,
                                                                                                  645,648,649,650,651,652,653,673,67
                                                                                                  5,676,678,679,681                 
 DESIRED_UNITS              Dummy  253      CHAR                        scalar   ARG,IN           311,312                           
 DOMAIN                     Dummy  253      DOMAIN2D        752         scalar   ARG,IN           381,382,384,385,449,451,486,508   
 DOMAIN2D                   Type   260                                  scalar                    58,127,260                        
 DOUBLE_KIND                Param  274      I(4)            4           scalar   PRIV             139,168,170,274                   
 DXSIZE                     Local  277      I(4)            4           scalar                    384,490,500                       
 DXSIZE_MAX                 Local  277      I(4)            4           scalar                    384                               
 DYSIZE                     Local  277      I(4)            4           scalar                    384,512,521                       
 DYSIZE_MAX                 Local  277      I(4)            4           scalar                    384                               
 ERR_FIELD_NOT_FOUND        Param  415      I(4)            4           scalar                    105,415                           
 FATAL                      Param  297      I(4)            4           scalar   PRIV             52,297,313,336,344,355,397,418,429
                                                                                                  ,460,478,504,525,544,545,663,802,8
                                                                                                  12,828,835,865,877,894,944,957,969
                                                                                                  ,986,1065,1084,1110,1147,1167,1307
                                                                                                  ,1336,1352                        
 FIELD                      Local  437      RECORD          2256  1     1        PTR,PRIV,SAVE    165,437,438,439,440,441,442,443,44
                                                                                                  4,445,446,447,448,450,451,452,453,
                                                                                                  455,458,463,464,465,467,473,491,49
                                                                                                  6,498,500,507,513,519,521,528,529,
                                                                                                  531,532,533,536,537,539,543,548,54
                                                                                                  9,550,552,553,554,555,562,563,564,
                                                                                                  565,566,568,569,570,571,572,574,57
                                                                                                  5,576,577,578,581,582,583,584,587,
                                                                                                  588,589,592,593,594,595,599,601,60
                                                                                                  6,607,609,610,612,614,620,621,622,
                                                                                                  625,629,633,636,637,639,641,644,64
                                                                                                  5,647,649,652,653,660,667,670,673,
                                                                                                  676,679,804,805,807,813,826,828,83
                                                                                                  5,841,843,844,845,846,847,850,853,
                                                                                                  854,858,860,861,862,864,866,869,87
                                                                                                  4,876,878,889,890,891,892,897,901,

Page 16          Source Listing                  INIT_EXTERNAL_FIELD
2021-06-01 08:55 Symbol Table                    time_interp_external2.F90

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
                                                                                                  902,903,904,907,910,911,912,917,91
                                                                                                  8,946,948,949,950,952,953,954,956,
                                                                                                  958,961,966,968,970,980,981,982,98
                                                                                                  3,987,989,1164,1165,1167,1169,1170
                                                                                                  ,1171,1172,1173,1174,1175,1176,118
                                                                                                  6,1187,1188,1189,1190,1233,1234,12
                                                                                                  60,1261,1262,1264,1310,1311,1312,1
                                                                                                  313,1339,1354,1356,1373,1374,1375,
                                                                                                  1376,1377,1378,1379,1388          
 FIELDNAME                  Dummy  253      CHAR                        scalar   ARG,IN           353,407,413,418,434,438,458,459,46
                                                                                                  7,471,472,477,503,524,662         
 FILE                       Dummy  253      CHAR                        scalar   ARG,IN           323,339,343,344,418,477,503,524,61
                                                                                                  7,662                             
 FILEOBJ                    Local  294      FMSNETCDFFILE_T 872         scalar   PTR,TGT          294,341,346,349,350,359,362,365,37
                                                                                                  2,407,408,409,410,413,434,437,458,
                                                                                                  459,467,471,472,474,667           
 FLD_UNITS                  Local  282      CHAR            128         scalar                    434,439                           
 FMSNETCDFFILE_T            Type   294                                  scalar                    66,123,154,294,723                
 GET_AXIS_CART              Subr   474                                           PRIV             61,474                            
 GET_AXIS_MODULO            Func   667      L(4)            4           scalar   PRIV             61,667                            
 GET_AXIS_MODULO_TIMES      Func   365      L(4)            4           scalar   PRIV             61,365                            
 GET_CALENDAR_TYPE          Func   605      I(4)            4           scalar   PRIV             56,605                            
 GET_CAL_TIME               Func   587      RECORD          16          scalar   PRIV             57,587,588,589                    
 GET_DATE                   Subr   673                                           PRIV             54,673,676,679,883,975,1006       
 GET_DIMENSION_SIZE         Subr   350                                           PRIV             68,350                            
 GET_TIME                   Subr   622                                           PRIV             56,622,630,640,648                
 GET_TIME_CALENDAR          Subr   359                                           PRIV             69,359                            
 GET_UNLIMITED_DIMENSION_NA                                                                                                         
 ME                         Subr   349                                           PRIV             65,349                            
 GET_VALID                  Func   458      RECORD          56          scalar   PRIV             67,458                            
 GET_VARIABLE_DIMENSION_NAM                                                                                                         
 ES                         Subr   471                                           PRIV             68,471                            
 GET_VARIABLE_MISSING       Func   467      R(8)            8           scalar   PRIV             69,467                            
 GET_VARIABLE_NUM_DIMENSION                                                                                                         
 S                          Func   459      I(4)            4           scalar   PRIV             67,459                            
 GET_VARIABLE_SIZE          Subr   472                                           PRIV             69,472                            
 GET_VARIABLE_UNITS         Subr   362                                           PRIV             69,362,434                        
 GXSIZE                     Local  287      I(4)            4           scalar                    378,385,489,493,502,569,572       
 GXSIZE_MAX                 Local  287      I(4)            4           scalar                    385                               
 GYSIZE                     Local  287      I(4)            4           scalar                    378,385,511,515,523,571,572       
 GYSIZE_MAX                 Local  287      I(4)            4           scalar                    385                               
 HAVE_MODULO_TIME           Local  293      L(4)            4           scalar                    365,604                           
 HR                         Local  289      I(4)            4           scalar                    673,675,676,678,679,681           
 I                          Local  275      I(4)            4           scalar                    322,323,324                       
 IECOMP                     Local  276      I(4)            4           scalar                    382,383,392,452,488,491           
 IEDATA                     Local  277      I(4)            4           scalar                    377,384,392,487,552,553,575,578   
 IEGLOBAL                   Local  276      I(4)            4           scalar                    385                               
 IERR                       Dummy  255      I(4)            4           scalar   ARG,OUT          298,414,415                       
 IGNORE_AXATTS              Local  292      L(4)            4           scalar                    299,301,476,480                   
 IGNORE_AXIS_ATTS           Dummy  255      L(4)            4           scalar   ARG,INOUT        301                               
 INIT_EXTERNAL_FIELD        Func   253      I(4)            4           scalar                                                      
 INTERCEPT                  Local  274      R(8)            8           scalar                    556,563                           
 ISCOMP                     Local  276      I(4)            4           scalar                    382,383,391,452,488,491           
 ISDATA                     Local  277      I(4)            4           scalar                    377,384,391,487,552,553,574,578   
 ISGLOBAL                   Local  276      I(4)            4           scalar                    385                               

Page 17          Source Listing                  INIT_EXTERNAL_FIELD
2021-06-01 08:55 Symbol Table                    time_interp_external2.F90

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 J                          Local  275      I(4)            4           scalar                    473,474,475,481,485,496,507,528,53
                                                                                                  1,533,586,587,588,589,619,620,621,
                                                                                                  622,625,628,629,633,636,637,638,64
                                                                                                  1,644,645,649,652,653,659,660,662,
                                                                                                  671,672,673,676,679               
 JECOMP                     Local  276      I(4)            4           scalar                    382,383,394,453,510,513           
 JEDATA                     Local  277      I(4)            4           scalar                    377,384,394,509,552,553,577,578   
 JEGLOBAL                   Local  276      I(4)            4           scalar                    385                               
 JSCOMP                     Local  276      I(4)            4           scalar                    382,383,393,453,510,513           
 JSDATA                     Local  277      I(4)            4           scalar                    377,384,393,509,552,553,576,578   
 JSGLOBAL                   Local  276      I(4)            4           scalar                    385                               
 LEN                        Local  290      I(4)            4           scalar                    475,487,488,489,490,493,494,502,50
                                                                                                  9,510,511,512,515,516,523,529     
 MIN                        Func   546                                  scalar                    546                               
 MINU                       Local  289      I(4)            4           scalar                    673,675,676,678,679,681           
 MOD                        Func   623                                  scalar                    623,631,634,642,650               
 MON                        Local  289      I(4)            4           scalar                    673,675,676,678,679,681           
 MPP_BROADCAST              Local  373                                  scalar   PRIV             53,373                            
 MPP_BROADCAST_REAL8        Subr   373                                           PRIV             373                               
 MPP_ERROR                  Local  297                                  scalar   PRIV             52,297,313,336,344,355,397,418,429
                                                                                                  ,460,478,504,525,544,545,617,663,8
                                                                                                  02,812,828,835,865,877,894,944,957
                                                                                                  ,969,986,1065,1084,1110,1147,1167,
                                                                                                  1307,1336,1352                    
 MPP_ERROR_BASIC            Subr   297                                           PRIV             297,313,336,344,355,397,418,429,46
                                                                                                  0,478,504,525,544,545,617,663,802,
                                                                                                  812,828,835,865,877,894,944,957,96
                                                                                                  9,986,1065,1084,1110,1147,1167,130
                                                                                                  7,1336,1352                       
 MPP_GET_COMPUTE_DOMAIN     Local  382                                  scalar   PRIV             58,382                            
 MPP_GET_COMPUTE_DOMAIN2D   Subr   382                                           PRIV             382                               
 MPP_GET_CURRENT_PELIST     Subr   368                                           PRIV             53,368                            
 MPP_GET_DATA_DOMAIN        Local  384                                  scalar   PRIV             58,384                            
 MPP_GET_DATA_DOMAIN2D      Subr   384                                           PRIV             384                               
 MPP_GET_GLOBAL_DOMAIN      Local  385                                  scalar   PRIV             59,385                            
 MPP_GET_GLOBAL_DOMAIN2D    Subr   385                                           PRIV             385                               
 MPP_NPES                   Func   367      I(4)            4           scalar   PRIV             53,367                            
 MPP_PE                     Func   372      I(4)            4           scalar   PRIV             52,372                            
 MPP_ROOT_PE                Func   372      I(4)            4           scalar   PRIV             53,372,373                        
 MSG                        Local  283      CHAR            128         scalar                    353,355,477,478,503,504,524,525,66
                                                                                                  1,663                             
 NAME                       Local  283      CHAR            128         scalar                                                      
 NATT                       Local  275      I(4)            4           scalar                                                      
 NBUF                       Local  290      I(4)            4           scalar                    546,549,552,553,564,572,578       
 NDIM                       Local  275      I(4)            4           scalar                    459,460,464,469                   
 NETCDF_FILE_OPEN_WRAP      Func   343      L(4)            4           scalar   PRIV             343                               
 NFIELDS_ORIG               Local  290      I(4)            4           scalar                    402                               
 NFILE                      Local  290      I(4)            4           scalar                    321,324,328,346                   
 NOTE                       Param  617      I(4)            4           scalar   PRIV             52,617                            
 NO_CALENDAR                Param  605      I(4)            4           scalar   PRIV             56,605                            
 NO_REGION                  Param  444      I(4)            4           scalar                    102,444,845,901,1082,1109,1146    
 NTIME                      Local  275      I(4)            4           scalar                    350,352,369,532,581,582,583,584,58
                                                                                                  6,616,619,628,647,659,671         
 NULL                       Func   294                                  scalar   PTR              123,128,129,130,132,133,134,135,14
                                                                                                  8,154,165,166,294,1239            

Page 18          Source Listing                  INIT_EXTERNAL_FIELD
2021-06-01 08:55 Symbol Table                    time_interp_external2.F90

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 NUMWINDOWS                 Local  291      I(4)            4           scalar                    307,308,548,549                   
 NUM_FIELDS                 Local  402      I(4)            4           scalar   PRIV             108,402,422,423,436,437,438,439,44
                                                                                                  0,441,442,443,444,445,446,447,448,
                                                                                                  450,451,452,453,455,458,463,464,46
                                                                                                  5,467,473,491,496,498,500,507,513,
                                                                                                  519,521,528,529,531,532,533,536,53
                                                                                                  7,539,543,548,549,550,552,553,554,
                                                                                                  555,562,563,564,565,566,568,569,57
                                                                                                  0,571,572,574,575,576,577,578,581,
                                                                                                  582,583,584,587,588,589,592,593,59
                                                                                                  4,595,599,601,606,607,609,610,612,
                                                                                                  614,620,621,622,625,629,633,636,63
                                                                                                  7,639,641,644,645,647,649,652,653,
                                                                                                  660,667,670,673,676,679,801,943,13
                                                                                                  06,1335,1351,1372,1391            
 NUM_FILES                  Local  322      I(4)            4           scalar   PRIV             108,322,329,330,339,340,341,343,72
                                                                                                  8,1383                            
 NVAR                       Local  275      I(4)            4           scalar                                                      
 NWINDOWS                   Dummy  255      I(4)            4           scalar   ARG,IN           308                               
 NX                         Local  290      I(4)            4           scalar                    383,498                           
 NY                         Local  290      I(4)            4           scalar                    383,519                           
 ONGRID                     Dummy  255      L(4)            4           scalar   ARG,INOUT        387                               
 ONGRID_LOCAL               Local  270      L(4)            4           scalar                    386,387,390                       
 OPENED_FILES               Local  323      RECORD          136   1     1        PTR,PRIV,SAVE    166,323,339,340,341,343,346,729,73
                                                                                                  0,1204,1205,1217,1218,1219,1221,13
                                                                                                  84,1385,1389                      
 OPEN_FILE                  Local  343                                  scalar   PRIV             65,343                            
 OVERRIDE                   Dummy  254      L(4)            4           scalar   ARG,IN           486,492,508,514,538,567           
 PERMIT_CALENDAR_CONVERSION Dummy  255      L(4)            4           scalar   ARG,IN           587,588,589                       
 PES                        Local  295      I(4)            4     1     1        ALC              367,368,373,374                   
 PRESENT                    Func   298                                  scalar                    298,301,303,305,308,311,381,387,41
                                                                                                  4,449,486,492,494,508,514,516,537,
                                                                                                  538,567,598                       
 READ_DATA                  Local  372                                  scalar   PRIV             67,372,408,409,410,1057,1145      
 SEC                        Local  289      I(4)            4           scalar                    622,623,626,630,631,633,634,636,63
                                                                                                  7,640,641,642,644,645,648,649,650,
                                                                                                  652,653,673,675,676,678,679,681   
 SET_DATE                   Local  609                                  scalar   PRIV             54,609,610,1008                   
 SET_DATE_C                 Func   609      RECORD          16          scalar   PRIV             609,610                           
 SET_TIME                   Local  606                                  scalar   PRIV             56,606,607,621,626,633,636,637,641
                                                                                                  ,644,645,649,652,653              
 SET_TIME_C                 Func   606      RECORD          16          scalar   PRIV             606,607                           
 SET_TIME_I                 Func   621      RECORD          16          scalar   PRIV             621,626,633,636,637,641,644,645,64
                                                                                                  9,652,653                         
 SET_TIME_MODULO            Subr   593                                           PRIV             120,593,594,595                   
 SIZ                        Local  287      I(4)            4     1     4                         536,542,546,552,553,572,578       
 SIZE                       Func   373                                  scalar                    373                               
 SIZ_IN                     Local  287      I(4)            4     1     4                         379                               
 SLOPE                      Local  274      R(8)            8           scalar                    556,562                           
 SUCCESS                    Param  298      I(4)            4           scalar                    105,298                           
 TAVG                       Local  279      R(8)            8     1     1        ALC              369,404,410,686                   
 TDIFF                      Local  288      TIME_TYPE       16          scalar                    629,630,639,640,647,648           
 TEND                       Local  279      R(8)            8     1     1        ALC              369,406,409,589,686               
 TIMEBEG                    Local  283      CHAR            128         scalar                    365,606,609                       
 TIMEEND                    Local  283      CHAR            128         scalar                    365,607,610                       

Page 19          Source Listing                  INIT_EXTERNAL_FIELD
2021-06-01 08:55 Symbol Table                    time_interp_external2.F90

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 TIMENAME                   Local  284      CHAR            128         scalar                    349,350,359,362,365,372,667       
 TIMEUNITS                  Local  284      CHAR            128         scalar                    362,587,588,589                   
 TIME_GE                    Func   660      L(4)            4           scalar   PRIV             660                               
 TIME_GT                    Func   621      L(4)            4           scalar   PRIV             621                               
 TIME_MINUS                 Func   620      RECORD          16          scalar   PRIV             620,629,636,639,644,647,652       
 TIME_PLUS                  Func   625      RECORD          16          scalar   PRIV             625,637,645,653                   
 TIME_TYPE                  Type   288                                  scalar                    54,128,129,130,141,288,699,767,927
                                                                                                  ,998,1347                         
 TRANSPOSE_XY               Local  278      L(4)            4           scalar                    376,485,544                       
 TRIM                       Func   323                                  scalar                    323,339,343,344,353,355,418,438,43
                                                                                                  9,477,478,503,504,524,525,543,587,
                                                                                                  588,589,617,662,663               
 TSTAMP                     Local  279      R(8)            8     1     1        ALC              369,372,373,405,406,587,686       
 TSTART                     Local  279      R(8)            8     1     1        ALC              369,405,408,588,686               
 UNIT                       Local  275      I(4)            4           scalar                                                      
 UNITS                      Local  282      CHAR            128         scalar                    310,312                           
 USE_COMP_DOMAIN            Dummy  255      L(4)            4           scalar   ARG,IN           303                               
 USE_COMP_DOMAIN1           Local  278      L(4)            4           scalar                    302,303,396,497,518               
 VARIABLE_ATT_EXISTS        Func   407      L(4)            4           scalar   PRIV             66,407                            
 VARIABLE_EXISTS            Func   408      L(4)            4           scalar   PRIV             67,408,409,410,413                
 VERB                       Local  278      L(4)            4           scalar                    304,305,306,542,543,669           
 VERBOSE                    Dummy  254      L(4)            4           scalar   ARG,IN           305                               
 YR                         Local  289      I(4)            4           scalar                    673,675,676,678,679,681           


TYPE COMPONENTS/COMMON VARIABLES

 Name                       Type            Bytes Offset   Dimen Elements Attributes       References                         
                                                                                                                              
 EXT_FIELDTYPE.AXISNAME     CHAR            32    284      1     4                         496,507,528,531,537                
 EXT_FIELDTYPE.CORRECT_LEAP_YEAR_INCONSISTENCY                                                                             ...
                            L(4)            4     2100           scalar                    599,601,862,954                    
 EXT_FIELDTYPE.DATA         R(8)            8     1464     4     1        PTR              552,555,847,854,903,904,911,912,95 
                                                                                           0,987,1046,1101,1112,1113,1116,111 
                                                                                           7,1137,1149,1150,1152,1153,1250,13 
                                                                                           74                                 
 EXT_FIELDTYPE.DOMAIN       DOMAIN2D        752   416            scalar                    451,1244,1376                      
 EXT_FIELDTYPE.DOMAIN_PRESENT                                                                                              ...
                            L(4)            4     2028           scalar                    450,455,1254                       
 EXT_FIELDTYPE.END_TIME     RECORD          16    1312     1     1        PTR              584,589,595,620,637,645,653,679,12 
                                                                                           47,1373                            
 EXT_FIELDTYPE.FILEOBJ      FMSNETCDFFILE_T 872   0              scalar   PTR              437,864,876,956,968,1057,1145,1239 
 EXT_FIELDTYPE.HAVE_MODULO_TIMES                                                                                           ...
                            L(4)            4     2096           scalar                    612,614,860,952                    
 EXT_FIELDTYPE.IBUF         I(4)            4     1752     1     1        PTR              564,565,844,891,892,897,949,982,98 
                                                                                           3,989,1038,1048,1130,1139,1251,137 
                                                                                           4                                  
 EXT_FIELDTYPE.IEC          I(4)            4     2052           scalar                    441,452,491,804,1060,1257          
 EXT_FIELDTYPE.IE_REGION    I(4)            4     2112           scalar                    446,1078,1188                      
 EXT_FIELDTYPE.IE_SRC       I(4)            4     2128           scalar                    569,575,1053,1164,1174             
 EXT_FIELDTYPE.INTERCEPT    R(8)            8     2040           scalar                    563,1117,1153,1256,1379            
 EXT_FIELDTYPE.ISC          I(4)            4     2048           scalar                    440,452,491,804,1060,1257          
 EXT_FIELDTYPE.IS_REGION    I(4)            4     2108           scalar                    445,1078,1187                      
 EXT_FIELDTYPE.IS_SRC       I(4)            4     2124           scalar                    568,574,1053,1164,1173             
 EXT_FIELDTYPE.JEC          I(4)            4     2060           scalar                    443,453,513,805,1061,1258          

Page 20          Source Listing                  INIT_EXTERNAL_FIELD
2021-06-01 08:55 Symbol Table                    time_interp_external2.F90

 Name                       Type            Bytes Offset   Dimen Elements Attributes       References                         
                                                                                                                              
 EXT_FIELDTYPE.JE_REGION    I(4)            4     2120           scalar                    448,1079,1190                      
 EXT_FIELDTYPE.JE_SRC       I(4)            4     2136           scalar                    571,577,1054,1165,1176             
 EXT_FIELDTYPE.JSC          I(4)            4     2056           scalar                    442,453,513,805,1061,1258          
 EXT_FIELDTYPE.JS_REGION    I(4)            4     2116           scalar                    447,1079,1189                      
 EXT_FIELDTYPE.JS_SRC       I(4)            4     2132           scalar                    570,576,1054,1165,1175             
 EXT_FIELDTYPE.MASK         L(4)            4     1608     4     1        PTR              553,554,846,853,858,902,910,917,91 
                                                                                           8,1105,1113,1116,1150,1152,1374    
 EXT_FIELDTYPE.MISSING      R(8)            8     2248           scalar                    467,850,907,1339                   
 EXT_FIELDTYPE.MODULO_TIME  L(4)            4     1456           scalar                    592,667,670,869,961,1249           
 EXT_FIELDTYPE.MODULO_TIME_BEG                                                                                             ...
                            TIME_TYPE       16    2064           scalar                    606,609,861,953                    
 EXT_FIELDTYPE.MODULO_TIME_END                                                                                             ...
                            TIME_TYPE       16    2080           scalar                    607,610,861,953                    
 EXT_FIELDTYPE.NAME         CHAR            128   8              scalar                    438,813,828,835,866,878,958,970,10 
                                                                                           51,1057,1141,1145,1240             
 EXT_FIELDTYPE.NBUF         I(4)            4     2024           scalar                    566,1045,1046,1047,1136,1137,1138, 
                                                                                           1253,1377                          
 EXT_FIELDTYPE.NDIM         I(4)            4     280            scalar                    464,473,1243                       
 EXT_FIELDTYPE.NEED_COMPUTE L(4)            4     2152     2     1        PTR              549,550,1049,1075,1107             
 EXT_FIELDTYPE.NUMWINDOWS   I(4)            4     2144           scalar                    548,807,1063                       
 EXT_FIELDTYPE.PERIOD       RECORD          16    1384     1     1        PTR              582,620,621,622,633,641,649,1248,1 
                                                                                           374                                
 EXT_FIELDTYPE.REGION_TYPE  I(4)            4     2104           scalar                    444,845,901,1082,1086,1109,1146,11 
                                                                                           86                                 
 EXT_FIELDTYPE.SIZ          I(4)            4     264      1     4                         463,498,500,519,521,529,532,536,53 
                                                                                           9,826,841,946,1242,1310,1311,1312, 
                                                                                           1313                               
 EXT_FIELDTYPE.SLOPE        R(8)            8     2032           scalar                    562,1117,1153,1255,1378            
 EXT_FIELDTYPE.SRC_DATA     R(8)            8     1824     4     1        PTR              572,578,1029,1055,1057,1081,1100,1 
                                                                                           101,1112,1143,1145,1149,1167,1169, 
                                                                                           1170,1171,1172,1252,1375           
 EXT_FIELDTYPE.START_TIME   RECORD          16    1240     1     1        PTR              583,588,594,620,625,636,644,652,67 
                                                                                           3,1246,1373                        
 EXT_FIELDTYPE.TDIM         I(4)            4     2140           scalar                    465,533,1056,1144                  
 EXT_FIELDTYPE.TIME         RECORD          16    1168     1     1        PTR              581,587,593,625,629,636,637,639,64 
                                                                                           4,645,647,652,653,660,676,861,874, 
                                                                                           953,966,1245,1354,1356,1373        
 EXT_FIELDTYPE.UNITS        CHAR            128   136            scalar                    439,543,1241                       
 EXT_FIELDTYPE.VALID        VALID_T         56    1968           scalar                    458,1081,1113,1150                 
 FILETYPE.FILENAME          CHAR            128   0              scalar                    323,339,729,1210                   
 FILETYPE.FILEOBJ           FMSNETCDFFILE_T 872   128            scalar   PTR,TGT          340,341,343,346,730,1211,1212,1213 
                                                                                           ,1384,1385                         

Page 21          Source Listing                  INIT_EXTERNAL_FIELD
2021-06-01 08:55                                 time_interp_external2.F90

    691 
    692 !</FUNCTION> NAME="init_external_field"
    693 
    694 
    695     subroutine time_interp_external_2d(index, time, data_in, interp, verbose,horz_interp, mask_out, &
    696                is_in, ie_in, js_in, je_in, window_id)
    697 
    698       integer, intent(in) :: index
    699       type(time_type), intent(in) :: time
    700       real, dimension(:,:), intent(inout) :: data_in
    701       integer, intent(in), optional :: interp
    702       logical, intent(in), optional :: verbose
    703       type(horiz_interp_type),intent(in), optional :: horz_interp
    704       logical, dimension(:,:), intent(out), optional :: mask_out ! set to true where output data is valid
    705       integer,                  intent(in), optional :: is_in, ie_in, js_in, je_in
    706       integer,                  intent(in), optional :: window_id
    707 
    708       real   , dimension(size(data_in,1), size(data_in,2), 1) :: data_out
    709       logical, dimension(size(data_in,1), size(data_in,2), 1) :: mask3d
    710 
    711       data_out(:,:,1) = data_in(:,:) ! fill initial values for the portions of array that are not touched by 3d routine
    712       call time_interp_external_3d(index, time, data_out, interp, verbose, horz_interp, mask3d, &
    713                                    is_in=is_in,ie_in=ie_in,js_in=js_in,je_in=je_in,window_id=window_id)
    714       data_in(:,:) = data_out(:,:,1)
    715       if (PRESENT(mask_out)) mask_out(:,:) = mask3d(:,:,1)
    716 
    717       return
    718     end subroutine time_interp_external_2d

Page 22          Source Listing                  TIME_INTERP_EXTERNAL_2D
2021-06-01 08:55 Entry Points                    time_interp_external2.F90



ENTRY POINTS

  Name                                                             
                                                                   
 time_interp_external2_mod_mp_time_interp_external_2d_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 DATA_IN                    Dummy  695      R(8)            8     2     1        ARG,INOUT        708,709,711,714                   
 DATA_OUT                   Local  708      R(8)            8     3     0                         711,712,714                       
 HORIZ_INTERP_TYPE          Type   703                                  scalar                    64,703,771,1019                   
 HORZ_INTERP                Dummy  695      HORIZ_INTERP_TYPE                                                                       
                                                            2208        scalar   ARG,IN           712                               
 IE_IN                      Dummy  696      I(4)            4           scalar   ARG,IN           713                               
 INDEX                      Dummy  695      I(4)            4           scalar   ARG,IN           712                               
 INTERP                     Dummy  695      I(4)            4           scalar   ARG,IN           712                               
 IS_IN                      Dummy  696      I(4)            4           scalar   ARG,IN           713                               
 JE_IN                      Dummy  696      I(4)            4           scalar   ARG,IN           713                               
 JS_IN                      Dummy  696      I(4)            4           scalar   ARG,IN           713                               
 MASK3D                     Local  709      L(4)            4     3     0                         712,715                           
 MASK_OUT                   Dummy  695      L(4)            4     2     1        ARG,OUT          715                               
 PRESENT                    Func   715                                  scalar                    715                               
 SIZE                       Func   708                                  scalar                    708,709                           
 TIME                       Dummy  695      TIME_TYPE       16          scalar   ARG,IN           712                               
 TIME_INTERP_EXTERNAL_2D    Subr   695                                           PRIV                                               
 VERBOSE                    Dummy  695      L(4)            4           scalar   ARG,IN           712                               
 WINDOW_ID                  Dummy  696      I(4)            4           scalar   ARG,IN           713                               

Page 23          Source Listing                  TIME_INTERP_EXTERNAL_2D
2021-06-01 08:55                                 time_interp_external2.F90

    719 
    720 
    721     function get_external_fileobj(filename, fileobj)
    722        character(len=*),             intent(in) :: filename
    723        type(FmsNetcdfFile_t), intent(out) :: fileobj
    724        logical                                  :: get_external_fileobj
    725        integer :: i
    726 
    727        get_external_fileobj = .false.
    728        do i=1,num_files
    729           if(trim(opened_files(i)%filename) == trim(filename)) then
    730             fileobj = opened_files(i)%fileobj
    731             get_external_fileobj = .true.
    732             exit  ! file is already opened
    733          endif
    734       enddo
    735 
    736     end function get_external_fileobj


ENTRY POINTS

  Name                                                          
                                                                
 time_interp_external2_mod_mp_get_external_fileobj_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 FILENAME                   Dummy  721      CHAR                        scalar   ARG,IN           729                               
 FILEOBJ                    Dummy  721      FMSNETCDFFILE_T 872         scalar   ARG,OUT          730                               
 GET_EXTERNAL_FILEOBJ       Func   721      L(4)            4           scalar                                                      
 I                          Local  725      I(4)            4           scalar                    728,729,730                       
 TRIM                       Func   729                                  scalar                    729                               

Page 24          Source Listing                  GET_EXTERNAL_FILEOBJ
2021-06-01 08:55                                 time_interp_external2.F90

    737 
    738 
    739 !<SUBROUTINE NAME="time_interp_external" >
    740 !
    741 !<DESCRIPTION>
    742 ! Provide data from external file interpolated to current model time.
    743 ! Data may be local to current processor or global, depending on
    744 ! "init_external_field" flags.
    745 !</DESCRIPTION>
    746 !
    747 !<IN NAME="index" TYPE="integer">
    748 ! index of external field from previous call to init_external_field
    749 !</IN>
    750 !<IN NAME="time" TYPE="time_manager_mod:time_type">
    751 ! target time for data
    752 !</IN>
    753 !<INOUT NAME="data" TYPE="real" DIM="(:,:),(:,:,:)">
    754 ! global or local data array
    755 !</INOUT>
    756 !<IN NAME="interp" TYPE="integer">
    757 ! time_interp_external defined interpolation method (optional).  Currently this module only supports
    758 ! LINEAR_TIME_INTERP.
    759 !</IN>
    760 !<IN NAME="verbose" TYPE="logical">
    761 ! verbose flag for debugging (optional).
    762 !</IN>
    763 
    764     subroutine time_interp_external_3d(index, time, data, interp,verbose,horz_interp, mask_out, is_in, ie_in, js_in, je_in, 
    764 window_id)
    765 
    766       integer,                    intent(in)           :: index
    767       type(time_type),            intent(in)           :: time
    768       real, dimension(:,:,:),  intent(inout)           :: data
    769       integer,                    intent(in), optional :: interp
    770       logical,                    intent(in), optional :: verbose
    771       type(horiz_interp_type),    intent(in), optional :: horz_interp
    772       logical, dimension(:,:,:), intent(out), optional :: mask_out ! set to true where output data is valid
    773       integer,                    intent(in), optional :: is_in, ie_in, js_in, je_in
    774       integer,                    intent(in), optional :: window_id
    775 
    776       integer :: nx, ny, nz, interp_method, t1, t2
    777       integer :: i1, i2, isc, iec, jsc, jec, mod_time
    778       integer :: yy, mm, dd, hh, min, ss
    779       character(len=256) :: err_msg, filename
    780 
    781       integer :: isw, iew, jsw, jew, nxw, nyw
    782 ! these are boundaries of the updated portion of the "data" argument
    783 ! they are calculated using sizes of the "data" and isc,iec,jsc,jsc
    784 ! fileds from respective input field, to center the updated portion
    785 ! in the output array
    786 
    787       real :: w1,w2
    788       logical :: verb
    789       character(len=16) :: message1, message2
    790 
    791       nx = size(data,1)
    792       ny = size(data,2)

Page 25          Source Listing                  TIME_INTERP_EXTERNAL_3D
2021-06-01 08:55                                 time_interp_external2.F90

    793       nz = size(data,3)
    794 
    795       interp_method = LINEAR_TIME_INTERP
    796       if (PRESENT(interp)) interp_method = interp
    797       verb=.false.
    798       if (PRESENT(verbose)) verb=verbose
    799       if (debug_this_module) verb = .true.
    800 
    801       if (index < 1.or.index > num_fields) &
    802            call mpp_error(FATAL,'invalid index in call to time_interp_ext -- field was not initialized or failed to initiali
    802 ze')
    803 
    804       isc=field(index)%isc;iec=field(index)%iec
    805       jsc=field(index)%jsc;jec=field(index)%jec
    806 
    807       if( field(index)%numwindows == 1 ) then
    808          nxw = iec-isc+1
    809          nyw = jec-jsc+1
    810       else
    811          if( .not. present(is_in) .or. .not. present(ie_in) .or. .not. present(js_in) .or. .not. present(je_in) ) then
    812             call mpp_error(FATAL, 'time_interp_external: is_in, ie_in, js_in and je_in must be present ' // &
    813                                   'when numwindows > 1, field='//trim(field(index)%name))
    814          endif
    815          nxw = ie_in - is_in + 1
    816          nyw = je_in - js_in + 1
    817          isc = isc + is_in - 1
    818          iec = isc + ie_in - is_in
    819          jsc = jsc + js_in - 1
    820          jec = jsc + je_in - js_in
    821       endif
    822 
    823       isw = (nx-nxw)/2+1; iew = isw+nxw-1
    824       jsw = (ny-nyw)/2+1; jew = jsw+nyw-1
    825 
    826       if (nx < nxw .or. ny < nyw .or. nz < field(index)%siz(3)) then
    827          write(message1,'(i6,2i5)') nx,ny,nz
    828          call mpp_error(FATAL,'field '//trim(field(index)%name)//' Array size mismatch in time_interp_external.'// &
    829          ' Array "data" is too small. shape(data)='//message1)
    830       endif
    831       if(PRESENT(mask_out)) then
    832         if (size(mask_out,1) /= nx .or. size(mask_out,2) /= ny .or. size(mask_out,3) /= nz) then
    833           write(message1,'(i6,2i5)') nx,ny,nz
    834           write(message2,'(i6,2i5)') size(mask_out,1),size(mask_out,2),size(mask_out,3)
    835           call mpp_error(FATAL,'field '//trim(field(index)%name)//' array size mismatch in time_interp_external.'// &
    836           ' Shape of array "mask_out" does not match that of array "data".'// &
    837           ' shape(data)='//message1//' shape(mask_out)='//message2)
    838         endif
    839       endif
    840 
    841       if (field(index)%siz(4) == 1) then
    842 ! only one record in the file => time-independent field
    843          call load_record(field(index),1,horz_interp, is_in, ie_in ,js_in, je_in,window_id)
    844          i1 = find_buf_index(1,field(index)%ibuf)
    845          if( field(index)%region_type == NO_REGION ) then
    846             where(field(index)%mask(isc:iec,jsc:jec,:,i1))
    847                data(isw:iew,jsw:jew,:) = field(index)%data(isc:iec,jsc:jec,:,i1)
    848             elsewhere

Page 26          Source Listing                  TIME_INTERP_EXTERNAL_3D
2021-06-01 08:55                                 time_interp_external2.F90

    849 !               data(isw:iew,jsw:jew,:) = time_interp_missing !field(index)%missing? Balaji
    850                data(isw:iew,jsw:jew,:) = field(index)%missing
    851             end where
    852          else
    853             where(field(index)%mask(isc:iec,jsc:jec,:,i1))
    854                data(isw:iew,jsw:jew,:) = field(index)%data(isc:iec,jsc:jec,:,i1)
    855             end where
    856          endif
    857          if(PRESENT(mask_out)) &
    858               mask_out(isw:iew,jsw:jew,:) = field(index)%mask(isc:iec,jsc:jec,:,i1)
    859       else
    860         if(field(index)%have_modulo_times) then
    861           call time_interp(time,field(index)%modulo_time_beg, field(index)%modulo_time_end, field(index)%time(:), &
    862                           w2, t1, t2, field(index)%correct_leap_year_inconsistency, err_msg=err_msg)
    863           if(err_msg .NE. '') then
    864              filename = trim(field(index)%fileobj%path)
    865              call mpp_error(FATAL,"time_interp_external 1: "//trim(err_msg)//&
    866                     ",file="//trim(filename)//",field="//trim(field(index)%name) )
    867           endif
    868         else
    869           if(field(index)%modulo_time) then
    870             mod_time=1
    871           else
    872             mod_time=0
    873           endif
    874           call time_interp(time,field(index)%time(:),w2,t1,t2,modtime=mod_time, err_msg=err_msg)
    875           if(err_msg .NE. '') then
    876              filename = trim(field(index)%fileobj%path)
    877              call mpp_error(FATAL,"time_interp_external 2: "//trim(err_msg)//&
    878                     ",file="//trim(filename)//",field="//trim(field(index)%name) )
    879           endif
    880         endif
    881          w1 = 1.0-w2
    882          if (verb) then
    883             call get_date(time,yy,mm,dd,hh,min,ss)
    884             write(outunit,'(a,i4,a,i2,a,i2,1x,i2,a,i2,a,i2)') &
    885                  'target time yyyy/mm/dd hh:mm:ss= ',yy,'/',mm,'/',dd,hh,':',min,':',ss
    886             write(outunit,*) 't1, t2, w1, w2= ', t1, t2, w1, w2
    887          endif
    888 
    889          call load_record(field(index),t1,horz_interp, is_in, ie_in ,js_in, je_in, window_id)
    890          call load_record(field(index),t2,horz_interp, is_in, ie_in ,js_in, je_in, window_id)
    891          i1 = find_buf_index(t1,field(index)%ibuf)
    892          i2 = find_buf_index(t2,field(index)%ibuf)
    893          if(i1<0.or.i2<0) &
    894               call mpp_error(FATAL,'time_interp_external : records were not loaded correctly in memory')
    895 
    896          if (verb) then
    897             write(outunit,*) 'ibuf= ',field(index)%ibuf
    898             write(outunit,*) 'i1,i2= ',i1, i2
    899          endif
    900 
    901          if( field(index)%region_type == NO_REGION ) then
    902             where(field(index)%mask(isc:iec,jsc:jec,:,i1).and.field(index)%mask(isc:iec,jsc:jec,:,i2))
    903                data(isw:iew,jsw:jew,:) = field(index)%data(isc:iec,jsc:jec,:,i1)*w1 + &
    904                     field(index)%data(isc:iec,jsc:jec,:,i2)*w2
    905             elsewhere

Page 27          Source Listing                  TIME_INTERP_EXTERNAL_3D
2021-06-01 08:55                                 time_interp_external2.F90

    906 !               data(isw:iew,jsw:jew,:) = time_interp_missing !field(index)%missing? Balaji
    907                data(isw:iew,jsw:jew,:) = field(index)%missing
    908             end where
    909          else
    910             where(field(index)%mask(isc:iec,jsc:jec,:,i1).and.field(index)%mask(isc:iec,jsc:jec,:,i2))
    911                data(isw:iew,jsw:jew,:) = field(index)%data(isc:iec,jsc:jec,:,i1)*w1 + &
    912                     field(index)%data(isc:iec,jsc:jec,:,i2)*w2
    913             end where
    914          endif
    915          if(PRESENT(mask_out)) &
    916               mask_out(isw:iew,jsw:jew,:) = &
    917                                         field(index)%mask(isc:iec,jsc:jec,:,i1).and.&
    918                                         field(index)%mask(isc:iec,jsc:jec,:,i2)
    919       endif
    920 
    921     end subroutine time_interp_external_3d


ENTRY POINTS

  Name                                                             
                                                                   
 time_interp_external2_mod_mp_time_interp_external_3d_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 DATA                       Dummy  764      R(8)            8     3     1        ARG,INOUT        791,792,793,847,850,854,903,907,91
                                                                                                  1                                 
 DD                         Local  778      I(4)            4           scalar                    883,885                           
 ERR_MSG                    Local  779      CHAR            256         scalar                    862,863,865,874,875,877           
 FILENAME                   Local  779      CHAR            256         scalar                    864,866,876,878                   
 FIND_BUF_INDEX             Func   844      I(4)            4           scalar   PRIV             119,844,891,892,949,982,983,1038,1
                                                                                                  130,1278,1282                     
 FIND_BUF_INDEX@0           Local  844      I(4)            4           scalar                                                      
 HH                         Local  778      I(4)            4           scalar                    883,885                           
 HORZ_INTERP                Dummy  764      HORIZ_INTERP_TYPE                                                                       
                                                            2208        scalar   ARG,IN           843,889,890                       
 I1                         Local  777      I(4)            4           scalar                    844,846,847,853,854,858,891,893,89
                                                                                                  8,902,903,910,911,917             
 I2                         Local  777      I(4)            4           scalar                    892,893,898,902,904,910,912,918   
 IEC                        Local  777      I(4)            4           scalar                    804,808,818,846,847,853,854,858,90
                                                                                                  2,903,904,910,911,912,917,918     
 IEW                        Local  781      I(4)            4           scalar                    823,847,850,854,858,903,907,911,91
                                                                                                  6                                 
 IE_IN                      Dummy  764      I(4)            4           scalar   ARG,IN           811,815,818,843,889,890           
 INDEX                      Dummy  764      I(4)            4           scalar   ARG,IN           801,804,805,807,813,826,828,835,84
                                                                                                  1,843,844,845,846,847,850,853,854,
                                                                                                  858,860,861,862,864,866,869,874,87
                                                                                                  6,878,889,890,891,892,897,901,902,
                                                                                                  903,904,907,910,911,912,917,918   
 INTERP                     Dummy  764      I(4)            4           scalar   ARG,IN           796                               
 INTERP_METHOD              Local  776      I(4)            4           scalar                    795,796                           
 ISC                        Local  777      I(4)            4           scalar                    804,808,817,818,846,847,853,854,85
                                                                                                  8,902,903,904,910,911,912,917,918 

Page 28          Source Listing                  TIME_INTERP_EXTERNAL_3D
2021-06-01 08:55 Symbol Table                    time_interp_external2.F90

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 ISW                        Local  781      I(4)            4           scalar                    823,847,850,854,858,903,907,911,91
                                                                                                  6                                 
 IS_IN                      Dummy  764      I(4)            4           scalar   ARG,IN           811,815,817,818,843,889,890       
 JEC                        Local  777      I(4)            4           scalar                    805,809,820,846,847,853,854,858,90
                                                                                                  2,903,904,910,911,912,917,918     
 JEW                        Local  781      I(4)            4           scalar                    824,847,850,854,858,903,907,911,91
                                                                                                  6                                 
 JE_IN                      Dummy  764      I(4)            4           scalar   ARG,IN           811,816,820,843,889,890           
 JSC                        Local  777      I(4)            4           scalar                    805,809,819,820,846,847,853,854,85
                                                                                                  8,902,903,904,910,911,912,917,918 
 JSW                        Local  781      I(4)            4           scalar                    824,847,850,854,858,903,907,911,91
                                                                                                  6                                 
 JS_IN                      Dummy  764      I(4)            4           scalar   ARG,IN           811,816,819,820,843,889,890       
 LINEAR_TIME_INTERP         Param  795      I(4)            4           scalar   PRIV             104,795                           
 MASK_OUT                   Dummy  764      L(4)            4     3     1        ARG,OUT          831,832,834,857,858,915,916       
 MESSAGE1                   Local  789      CHAR            16          scalar                    827,829,833,837                   
 MESSAGE2                   Local  789      CHAR            16          scalar                    834,837                           
 MIN                        Local  778      I(4)            4           scalar                    883,885                           
 MM                         Local  778      I(4)            4           scalar                    883,885                           
 MOD_TIME                   Local  777      I(4)            4           scalar                    870,872,874                       
 NX                         Local  776      I(4)            4           scalar                    791,823,826,827,832,833           
 NXW                        Local  781      I(4)            4           scalar                    808,815,823,826                   
 NY                         Local  776      I(4)            4           scalar                    792,824,826,827,832,833           
 NYW                        Local  781      I(4)            4           scalar                    809,816,824,826                   
 NZ                         Local  776      I(4)            4           scalar                    793,826,827,832,833               
 PRESENT                    Func   796                                  scalar                    796,798,811,831,857,915           
 SIZE                       Func   791                                  scalar                    791,792,793,832,834               
 SS                         Local  778      I(4)            4           scalar                    883,885                           
 T1                         Local  776      I(4)            4           scalar                    862,874,886,889,891               
 T2                         Local  776      I(4)            4           scalar                    862,874,886,890,892               
 TIME                       Dummy  764      TIME_TYPE       16          scalar   ARG,IN           861,874,883                       
 TIME_INTERP                Local  861                                  scalar   PRIV             60,861,874,953,966                
 TIME_INTERP_EXTERNAL_3D    Subr   764                                           PRIV             712                               
 TIME_INTERP_LIST           Subr   874                                           PRIV             874,966                           
 TIME_INTERP_MODULO         Subr   861                                           PRIV             861,953                           
 TRIM                       Func   813                                  scalar                    813,828,835,864,865,866,876,877,87
                                                                                                  8                                 
 VERB                       Local  788      L(4)            4           scalar                    797,798,799,882,896               
 VERBOSE                    Dummy  764      L(4)            4           scalar   ARG,IN           798                               
 W1                         Local  787      R(8)            8           scalar                    881,886,903,911                   
 W2                         Local  787      R(8)            8           scalar                    862,874,881,886,904,912           
 WINDOW_ID                  Dummy  764      I(4)            4           scalar   ARG,IN           843,889,890                       
 YY                         Local  778      I(4)            4           scalar                    883,885                           


TYPE COMPONENTS/COMMON VARIABLES

 Name                       Type            Bytes Offset   Dimen Elements Attributes       References                         
                                                                                                                              
 FMSNETCDFFILE_T.PATH       CHAR            256   0              scalar                    864,876,956,968                    

Page 29          Source Listing                  TIME_INTERP_EXTERNAL_3D
2021-06-01 08:55                                 time_interp_external2.F90

    922 !</SUBROUTINE> NAME="time_interp_external"
    923 
    924     subroutine time_interp_external_0d(index, time, data, verbose)
    925 
    926       integer, intent(in) :: index
    927       type(time_type), intent(in) :: time
    928       real, intent(inout) :: data
    929       logical, intent(in), optional :: verbose
    930 
    931       integer :: t1, t2
    932       integer :: i1, i2, mod_time
    933       integer :: yy, mm, dd, hh, min, ss
    934       character(len=256) :: err_msg, filename
    935 
    936       real :: w1,w2
    937       logical :: verb
    938 
    939       verb=.false.
    940       if (PRESENT(verbose)) verb=verbose
    941       if (debug_this_module) verb = .true.
    942 
    943       if (index < 1.or.index > num_fields) &
    944            call mpp_error(FATAL,'invalid index in call to time_interp_ext -- field was not initialized or failed to initiali
    944 ze')
    945 
    946       if (field(index)%siz(4) == 1) then
    947 ! only one record in the file => time-independent field
    948          call load_record_0d(field(index),1)
    949          i1 = find_buf_index(1,field(index)%ibuf)
    950          data = field(index)%data(1,1,1,i1)
    951       else
    952         if(field(index)%have_modulo_times) then
    953           call time_interp(time,field(index)%modulo_time_beg, field(index)%modulo_time_end, field(index)%time(:), &
    954                           w2, t1, t2, field(index)%correct_leap_year_inconsistency, err_msg=err_msg)
    955           if(err_msg .NE. '') then
    956              filename = trim(field(index)%fileobj%path)
    957              call mpp_error(FATAL,"time_interp_external 3:"//trim(err_msg)//&
    958                     ",file="//trim(filename)//",field="//trim(field(index)%name) )
    959           endif
    960         else
    961           if(field(index)%modulo_time) then
    962             mod_time=1
    963           else
    964             mod_time=0
    965           endif
    966           call time_interp(time,field(index)%time(:),w2,t1,t2,modtime=mod_time, err_msg=err_msg)
    967           if(err_msg .NE. '') then
    968              filename = trim(field(index)%fileobj%path)
    969              call mpp_error(FATAL,"time_interp_external 4:"//trim(err_msg)// &
    970                     ",file="//trim(filename)//",field="//trim(field(index)%name) )
    971           endif
    972         endif
    973          w1 = 1.0-w2
    974          if (verb) then
    975             call get_date(time,yy,mm,dd,hh,min,ss)
    976             write(outunit,'(a,i4,a,i2,a,i2,1x,i2,a,i2,a,i2)') &
    977                  'target time yyyy/mm/dd hh:mm:ss= ',yy,'/',mm,'/',dd,hh,':',min,':',ss

Page 30          Source Listing                  TIME_INTERP_EXTERNAL_0D
2021-06-01 08:55                                 time_interp_external2.F90

    978             write(outunit,*) 't1, t2, w1, w2= ', t1, t2, w1, w2
    979          endif
    980          call load_record_0d(field(index),t1)
    981          call load_record_0d(field(index),t2)
    982          i1 = find_buf_index(t1,field(index)%ibuf)
    983          i2 = find_buf_index(t2,field(index)%ibuf)
    984 
    985          if(i1<0.or.i2<0) &
    986               call mpp_error(FATAL,'time_interp_external : records were not loaded correctly in memory')
    987          data = field(index)%data(1,1,1,i1)*w1 + field(index)%data(1,1,1,i2)*w2
    988          if (verb) then
    989             write(outunit,*) 'ibuf= ',field(index)%ibuf
    990             write(outunit,*) 'i1,i2= ',i1, i2
    991          endif
    992       endif
    993 
    994     end subroutine time_interp_external_0d


ENTRY POINTS

  Name                                                             
                                                                   
 time_interp_external2_mod_mp_time_interp_external_0d_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 DATA                       Dummy  924      R(8)            8           scalar   ARG,INOUT        950,987                           
 DD                         Local  933      I(4)            4           scalar                    975,977                           
 ERR_MSG                    Local  934      CHAR            256         scalar                    954,955,957,966,967,969           
 FILENAME                   Local  934      CHAR            256         scalar                    956,958,968,970                   
 HH                         Local  933      I(4)            4           scalar                    975,977                           
 I1                         Local  932      I(4)            4           scalar                    949,950,982,985,987,990           
 I2                         Local  932      I(4)            4           scalar                    983,985,987,990                   
 INDEX                      Dummy  924      I(4)            4           scalar   ARG,IN           943,946,948,949,950,952,953,954,95
                                                                                                  6,958,961,966,968,970,980,981,982,
                                                                                                  983,987,989                       
 MIN                        Local  933      I(4)            4           scalar                    975,977                           
 MM                         Local  933      I(4)            4           scalar                    975,977                           
 MOD_TIME                   Local  932      I(4)            4           scalar                    962,964,966                       
 PRESENT                    Func   940                                  scalar                    940                               
 SS                         Local  933      I(4)            4           scalar                    975,977                           
 T1                         Local  931      I(4)            4           scalar                    954,966,978,980,982               
 T2                         Local  931      I(4)            4           scalar                    954,966,978,981,983               
 TIME                       Dummy  924      TIME_TYPE       16          scalar   ARG,IN           953,966,975                       
 TIME_INTERP_EXTERNAL_0D    Subr   924                                           PRIV                                               
 TRIM                       Func   956                                  scalar                    956,957,958,968,969,970           
 VERB                       Local  937      L(4)            4           scalar                    939,940,941,974,988               
 VERBOSE                    Dummy  924      L(4)            4           scalar   ARG,IN           940                               
 W1                         Local  936      R(8)            8           scalar                    973,978,987                       
 W2                         Local  936      R(8)            8           scalar                    954,966,973,978,987               
 YY                         Local  933      I(4)            4           scalar                    975,977                           

Page 31          Source Listing                  TIME_INTERP_EXTERNAL_0D
2021-06-01 08:55                                 time_interp_external2.F90

    995 
    996     subroutine set_time_modulo(Time)
    997 
    998       type(time_type), intent(inout), dimension(:) :: Time
    999 
   1000       integer :: ntime, n
   1001       integer :: yr, mon, dy, hr, minu, sec
   1002 
   1003       ntime = size(Time(:))
   1004 
   1005       do n = 1, ntime
   1006          call get_date(Time(n), yr, mon, dy, hr, minu, sec)
   1007          yr = modulo_year
   1008          Time(n) = set_date(yr, mon, dy, hr, minu, sec)
   1009       enddo
   1010 
   1011 
   1012     end subroutine set_time_modulo


ENTRY POINTS

  Name                                                     
                                                           
 time_interp_external2_mod_mp_set_time_modulo_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 DY                         Local  1001     I(4)            4           scalar                    1006,1008                         
 HR                         Local  1001     I(4)            4           scalar                    1006,1008                         
 MINU                       Local  1001     I(4)            4           scalar                    1006,1008                         
 MODULO_YEAR                Param  1007     I(4)            4           scalar   PRIV             103,1007                          
 MON                        Local  1001     I(4)            4           scalar                    1006,1008                         
 N                          Local  1000     I(4)            4           scalar                    1005,1006,1008                    
 NTIME                      Local  1000     I(4)            4           scalar                    1003,1005                         
 SEC                        Local  1001     I(4)            4           scalar                    1006,1008                         
 SET_DATE_I                 Func   1008     RECORD          16          scalar   PRIV             1008                              
 SET_TIME_MODULO            Subr   996                                                                                              
 SIZE                       Func   1003                                 scalar                    1003                              
 TIME                       Dummy  996      RECORD          16    1     1        ARG,INOUT        1003,1006,1008                    
 YR                         Local  1001     I(4)            4           scalar                    1006,1007,1008                    

Page 32          Source Listing                  SET_TIME_MODULO
2021-06-01 08:55                                 time_interp_external2.F90

   1013 
   1014 ! ============================================================================
   1015 ! load specified record from file
   1016 subroutine load_record(field, rec, interp, is_in, ie_in, js_in, je_in, window_id_in)
   1017   type(ext_fieldtype),     intent(inout)        :: field
   1018   integer            ,     intent(in)           :: rec    ! record number
   1019   type(horiz_interp_type), intent(in), optional :: interp
   1020   integer,                 intent(in), optional :: is_in, ie_in, js_in, je_in
   1021   integer,                 intent(in), optional :: window_id_in
   1022 
   1023 ! ---- local vars
   1024   integer :: ib ! index in the array of input buffers
   1025   integer :: isw,iew,jsw,jew ! boundaries of the domain on each window
   1026   integer :: is_region, ie_region, js_region, je_region, i, j, n
   1027   integer :: start(4), nread(4)
   1028   logical :: need_compute
   1029   real    :: mask_in(size(field%src_data,1),size(field%src_data,2),size(field%src_data,3))
   1030   real, allocatable :: mask_out(:,:,:)
   1031   integer :: window_id
   1032 
   1033   window_id = 1
   1034   if( PRESENT(window_id_in) ) window_id = window_id_in
   1035   need_compute = .true.
   1036 
   1037 !$OMP CRITICAL
   1038   ib = find_buf_index(rec,field%ibuf)
   1039 
   1040   if(ib>0) then
   1041 !--- do nothing
   1042      need_compute = .false.
   1043   else
   1044 ! calculate current buffer number in round-robin fasion
   1045      field%nbuf = field%nbuf + 1
   1046      if(field%nbuf > size(field%data,4).or.field%nbuf <= 0) field%nbuf = 1
   1047      ib = field%nbuf
   1048      field%ibuf(ib) = rec
   1049      field%need_compute(ib,:) = .true.
   1050 
   1051      if (debug_this_module) write(outunit,*) 'reading record without domain for field ',trim(field%name)
   1052      start = 1; nread = 1
   1053      start(1) = field%is_src; nread(1) = field%ie_src - field%is_src + 1
   1054      start(2) = field%js_src; nread(2) = field%je_src - field%js_src + 1
   1055      start(3) = 1;            nread(3) = size(field%src_data,3)
   1056      start(field%tdim) = rec; nread(field%tdim) = 1
   1057      call read_data(field%fileobj,field%name,field%src_data(:,:,:,ib),corner=start,edge_lengths=nread)
   1058   endif
   1059 !$OMP END CRITICAL
   1060   isw=field%isc;iew=field%iec
   1061   jsw=field%jsc;jew=field%jec
   1062 
   1063   if( field%numwindows > 1) then
   1064      if( .NOT. PRESENT(is_in) .OR. .NOT. PRESENT(ie_in) .OR. .NOT. PRESENT(js_in) .OR. .NOT. PRESENT(je_in) ) then
   1065         call mpp_error(FATAL, 'time_interp_external(load_record): is_in, ie_in, js_in, je_in must be present when numwindows
   1065 >1')
   1066      endif
   1067      isw = isw + is_in - 1
   1068      iew = isw + ie_in - is_in

Page 33          Source Listing                  LOAD_RECORD
2021-06-01 08:55                                 time_interp_external2.F90

   1069      jsw = jsw + js_in - 1
   1070      jew = jsw + je_in - js_in
   1071   endif
   1072 
   1073 ! interpolate to target grid
   1074 
   1075   need_compute = field%need_compute(ib, window_id)
   1076   if(need_compute) then
   1077      if(PRESENT(interp)) then
   1078         is_region = field%is_region; ie_region = field%ie_region
   1079         js_region = field%js_region; je_region = field%je_region
   1080         mask_in = 0.0
   1081         where (is_valid(field%src_data(:,:,:,ib), field%valid)) mask_in = 1.0
   1082         if ( field%region_type .NE. NO_REGION ) then
   1083            if( ANY(mask_in == 0.0) ) then
   1084               call mpp_error(FATAL, "time_interp_external: mask_in should be all 1 when region_type is not NO_REGION")
   1085            endif
   1086            if( field%region_type == OUTSIDE_REGION) then
   1087               do j = js_region, je_region
   1088                  do i = is_region, ie_region
   1089                     mask_in(i,j,:) = 0.0
   1090                  enddo
   1091               enddo
   1092            else  ! field%region_choice == INSIDE_REGION
   1093               do j = 1, size(mask_in,2)
   1094                  do i = 1, size(mask_in,1)
   1095                     if( j<js_region .OR. j>je_region .OR. i<is_region .OR. i>ie_region ) mask_in(i,j,:) = 0.0
   1096                  enddo
   1097               enddo
   1098            endif
   1099         endif
   1100         allocate(mask_out(isw:iew,jsw:jew, size(field%src_data,3)))
   1101         call horiz_interp(interp,field%src_data(:,:,:,ib),field%data(isw:iew,jsw:jew,:,ib), &
   1102              mask_in=mask_in, &
   1103              mask_out=mask_out)
   1104 
   1105         field%mask(isw:iew,jsw:jew,:,ib) = mask_out(isw:iew,jsw:jew,:) > 0
   1106         deallocate(mask_out)
   1107         field%need_compute(ib, window_id) = .false.
   1108      else
   1109         if ( field%region_type .NE. NO_REGION ) then
   1110            call mpp_error(FATAL, "time_interp_external: region_type should be NO_REGION when interp is not present")
   1111         endif
   1112         field%data(isw:iew,jsw:jew,:,ib) = field%src_data(isw:iew,jsw:jew,:,ib)
   1113         field%mask(isw:iew,jsw:jew,:,ib) = is_valid(field%data(isw:iew,jsw:jew,:,ib),field%valid)
   1114      endif
   1115 ! convert units
   1116      where(field%mask(isw:iew,jsw:jew,:,ib)) field%data(isw:iew,jsw:jew,:,ib) = &
   1117           field%data(isw:iew,jsw:jew,:,ib)*field%slope + field%intercept
   1118   endif
   1119 
   1120 end subroutine load_record

Page 34          Source Listing                  LOAD_RECORD
2021-06-01 08:55 Entry Points                    time_interp_external2.F90



ENTRY POINTS

  Name                                                 
                                                       
 time_interp_external2_mod_mp_load_record_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 ANY                        Func   1083                                 scalar                    1083                              
 COMPRESSED_READ_3D         Subr   1057                                          PRIV             1057,1145                         
 EXT_FIELDTYPE              Type   1017                     2256        scalar   PRIV             150,165,1017,1124,1230            
 FIELD                      Dummy  1016     EXT_FIELDTYPE   2256        scalar   ARG,INOUT        1029,1038,1045,1046,1047,1048,1049
                                                                                                  ,1051,1053,1054,1055,1056,1057,106
                                                                                                  0,1061,1063,1075,1078,1079,1081,10
                                                                                                  82,1086,1100,1101,1105,1107,1109,1
                                                                                                  112,1113,1116,1117                
 HORIZ_INTERP               Local  1101                                 scalar   PRIV             64,1101                           
 HORIZ_INTERP_BASE_3D       Subr   1101                                          PRIV             1101                              
 I                          Local  1026     I(4)            4           scalar                    1088,1089,1094,1095               
 IB                         Local  1024     I(4)            4           scalar                    1038,1040,1047,1048,1049,1057,1075
                                                                                                  ,1081,1101,1105,1107,1112,1113,111
                                                                                                  6,1117                            
 IEW                        Local  1025     I(4)            4           scalar                    1060,1068,1100,1101,1105,1112,1113
                                                                                                  ,1116,1117                        
 IE_IN                      Dummy  1016     I(4)            4           scalar   ARG,IN           1064,1068                         
 IE_REGION                  Local  1026     I(4)            4           scalar                    1078,1088,1095                    
 INTERP                     Dummy  1016     HORIZ_INTERP_TYPE                                                                       
                                                            2208        scalar   ARG,IN           1077,1101                         
 ISW                        Local  1025     I(4)            4           scalar                    1060,1067,1068,1100,1101,1105,1112
                                                                                                  ,1113,1116,1117                   
 IS_IN                      Dummy  1016     I(4)            4           scalar   ARG,IN           1064,1067,1068                    
 IS_REGION                  Local  1026     I(4)            4           scalar                    1078,1088,1095                    
 IS_VALID                   Local  1081                                 scalar   PRIV             68,1081,1113,1150                 
 IS_VALID_R8                Func   1081     L(4)            4           scalar   PRIV             1081,1113,1150                    
 J                          Local  1026     I(4)            4           scalar                    1087,1089,1093,1095               
 JEW                        Local  1025     I(4)            4           scalar                    1061,1070,1100,1101,1105,1112,1113
                                                                                                  ,1116,1117                        
 JE_IN                      Dummy  1016     I(4)            4           scalar   ARG,IN           1064,1070                         
 JE_REGION                  Local  1026     I(4)            4           scalar                    1079,1087,1095                    
 JSW                        Local  1025     I(4)            4           scalar                    1061,1069,1070,1100,1101,1105,1112
                                                                                                  ,1113,1116,1117                   
 JS_IN                      Dummy  1016     I(4)            4           scalar   ARG,IN           1064,1069,1070                    
 JS_REGION                  Local  1026     I(4)            4           scalar                    1079,1087,1095                    
 LOAD_RECORD                Subr   1016                                                           843,889,890                       
 MASK_IN                    Local  1029     R(8)            8     3     0                         1080,1081,1083,1089,1093,1094,1095
                                                                                                  ,1102                             
 MASK_OUT                   Local  1030     R(8)            8     3     1        ALC              1100,1103,1105,1106               
 N                          Local  1026     I(4)            4           scalar                                                      
 NEED_COMPUTE               Local  1028     L(4)            4           scalar                    1035,1042,1075,1076               
 NREAD                      Local  1027     I(4)            4     1     4        TGT              1052,1053,1054,1055,1056,1057     
 OUTSIDE_REGION             Param  1086     I(4)            4           scalar                    102,1086                          
 PRESENT                    Func   1034                                 scalar                    1034,1064,1077                    

Page 35          Source Listing                  LOAD_RECORD
2021-06-01 08:55 Symbol Table                    time_interp_external2.F90

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 REC                        Dummy  1016     I(4)            4           scalar   ARG,IN           1038,1048,1056                    
 SIZE                       Func   1029                                 scalar                    1029,1046,1055,1093,1094,1100     
 START                      Local  1027     I(4)            4     1     4        TGT              1052,1053,1054,1055,1056,1057     
 TRIM                       Func   1051                                 scalar                    1051                              
 WINDOW_ID                  Local  1031     I(4)            4           scalar                    1033,1034,1075,1107               
 WINDOW_ID_IN               Dummy  1016     I(4)            4           scalar   ARG,IN           1034                              

Page 36          Source Listing                  LOAD_RECORD
2021-06-01 08:55                                 time_interp_external2.F90

   1121 
   1122 
   1123 subroutine load_record_0d(field, rec)
   1124   type(ext_fieldtype),     intent(inout)        :: field
   1125   integer            ,     intent(in)           :: rec    ! record number
   1126 ! ---- local vars
   1127   integer :: ib ! index in the array of input buffers
   1128   integer :: start(4), nread(4)
   1129 
   1130   ib = find_buf_index(rec,field%ibuf)
   1131 
   1132   if(ib>0) then
   1133      return
   1134   else
   1135 ! calculate current buffer number in round-robin fasion
   1136      field%nbuf = field%nbuf + 1
   1137      if(field%nbuf > size(field%data,4).or.field%nbuf <= 0) field%nbuf = 1
   1138      ib = field%nbuf
   1139      field%ibuf(ib) = rec
   1140 
   1141      if (debug_this_module) write(outunit,*) 'reading record without domain for field ',trim(field%name)
   1142      start = 1; nread = 1
   1143      start(3) = 1;            nread(3) = size(field%src_data,3)
   1144      start(field%tdim) = rec; nread(field%tdim) = 1
   1145      call read_data(field%fileobj,field%name,field%src_data(:,:,:,ib),corner=start,edge_lengths=nread)
   1146      if ( field%region_type .NE. NO_REGION ) then
   1147         call mpp_error(FATAL, "time_interp_external: region_type should be NO_REGION when field is scalar")
   1148      endif
   1149      field%data(1,1,:,ib) = field%src_data(1,1,:,ib)
   1150      field%mask(1,1,:,ib) = is_valid(field%data(1,1,:,ib),field%valid)
   1151 ! convert units
   1152      where(field%mask(1,1,:,ib)) field%data(1,1,:,ib) = &
   1153           field%data(1,1,:,ib)*field%slope + field%intercept
   1154   endif
   1155 
   1156 end subroutine load_record_0d

Page 37          Source Listing                  LOAD_RECORD_0D
2021-06-01 08:55 Entry Points                    time_interp_external2.F90



ENTRY POINTS

  Name                                                    
                                                          
 time_interp_external2_mod_mp_load_record_0d_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 FIELD                      Dummy  1123     EXT_FIELDTYPE   2256        scalar   ARG,INOUT        1130,1136,1137,1138,1139,1141,1143
                                                                                                  ,1144,1145,1146,1149,1150,1152,115
                                                                                                  3                                 
 IB                         Local  1127     I(4)            4           scalar                    1130,1132,1138,1139,1145,1149,1150
                                                                                                  ,1152,1153                        
 LOAD_RECORD_0D             Subr   1123                                                           948,980,981                       
 NREAD                      Local  1128     I(4)            4     1     4        TGT              1142,1143,1144,1145               
 REC                        Dummy  1123     I(4)            4           scalar   ARG,IN           1130,1139,1144                    
 SIZE                       Func   1137                                 scalar                    1137,1143                         
 START                      Local  1128     I(4)            4     1     4        TGT              1142,1143,1144,1145               
 TRIM                       Func   1141                                 scalar                    1141                              

Page 38          Source Listing                  LOAD_RECORD_0D
2021-06-01 08:55                                 time_interp_external2.F90

   1157 
   1158 ! ============================================================================
   1159 subroutine reset_src_data_region(index, is, ie, js, je)
   1160    integer, intent(in) :: index
   1161    integer, intent(in) :: is, ie, js, je
   1162    integer             :: nk, nbuf
   1163 
   1164    if( is == field(index)%is_src .AND. ie == field(index)%ie_src .AND. &
   1165        js == field(index)%js_src .AND. ie == field(index)%je_src ) return
   1166 
   1167    if( .NOT. ASSOCIATED(field(index)%src_data) ) call mpp_error(FATAL, &
   1168        "time_interp_external: field(index)%src_data is not associated")
   1169    nk = size(field(index)%src_data,3)
   1170    nbuf = size(field(index)%src_data,4)
   1171    deallocate(field(index)%src_data)
   1172    allocate(field(index)%src_data(is:ie,js:je,nk,nbuf))
   1173    field(index)%is_src = is
   1174    field(index)%ie_src = ie
   1175    field(index)%js_src = js
   1176    field(index)%je_src = je
   1177 
   1178 
   1179 end subroutine reset_src_data_region


ENTRY POINTS

  Name                                                           
                                                                 
 time_interp_external2_mod_mp_reset_src_data_region_             

Page 39          Source Listing                  RESET_SRC_DATA_REGION
2021-06-01 08:55 Symbol Table                    time_interp_external2.F90



SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 ASSOCIATED                 Func   1167                                 scalar                    1167                              
 IE                         Dummy  1159     I(4)            4           scalar   ARG,IN           1164,1165,1172,1174               
 INDEX                      Dummy  1159     I(4)            4           scalar   ARG,IN           1164,1165,1167,1169,1170,1171,1172
                                                                                                  ,1173,1174,1175,1176              
 IS                         Dummy  1159     I(4)            4           scalar   ARG,IN           1164,1172,1173                    
 JE                         Dummy  1159     I(4)            4           scalar   ARG,IN           1172,1176                         
 JS                         Dummy  1159     I(4)            4           scalar   ARG,IN           1165,1172,1175                    
 NBUF                       Local  1162     I(4)            4           scalar                    1170,1172                         
 NK                         Local  1162     I(4)            4           scalar                    1169,1172                         
 RESET_SRC_DATA_REGION      Subr   1159                                                                                             
 SIZE                       Func   1169                                 scalar                    1169,1170                         

Page 40          Source Listing                  RESET_SRC_DATA_REGION
2021-06-01 08:55                                 time_interp_external2.F90

   1180 
   1181 ! ============================================================================
   1182 subroutine set_override_region(index, region_type, is_region, ie_region, js_region, je_region)
   1183    integer, intent(in) :: index, region_type
   1184    integer, intent(in) :: is_region, ie_region, js_region, je_region
   1185 
   1186    field(index)%region_type = region_type
   1187    field(index)%is_region   = is_region
   1188    field(index)%ie_region   = ie_region
   1189    field(index)%js_region   = js_region
   1190    field(index)%je_region   = je_region
   1191 
   1192    return
   1193 
   1194 end subroutine set_override_region


ENTRY POINTS

  Name                                                         
                                                               
 time_interp_external2_mod_mp_set_override_region_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 IE_REGION                  Dummy  1182     I(4)            4           scalar   ARG,IN           1188                              
 INDEX                      Dummy  1182     I(4)            4           scalar   ARG,IN           1186,1187,1188,1189,1190          
 IS_REGION                  Dummy  1182     I(4)            4           scalar   ARG,IN           1187                              
 JE_REGION                  Dummy  1182     I(4)            4           scalar   ARG,IN           1190                              
 JS_REGION                  Dummy  1182     I(4)            4           scalar   ARG,IN           1189                              
 REGION_TYPE                Dummy  1182     I(4)            4           scalar   ARG,IN           1186                              
 SET_OVERRIDE_REGION        Subr   1182                                                                                             

Page 41          Source Listing                  SET_OVERRIDE_REGION
2021-06-01 08:55                                 time_interp_external2.F90

   1195 
   1196 ! ============================================================================
   1197 ! reallocates array of fields, increasing its size
   1198 subroutine realloc_files(n)
   1199   integer, intent(in) :: n ! new size
   1200 
   1201   type(filetype), pointer :: ptr(:)
   1202   integer :: i
   1203 
   1204   if (associated(opened_files)) then
   1205      if (n <= size(opened_files)) return ! do nothing, if requested size no more than current
   1206   endif
   1207 
   1208   allocate(ptr(n))
   1209   do i = 1, size(ptr)
   1210      ptr(i)%filename = ''
   1211      if(Associated(ptr(i)%fileobj)) then
   1212         call close_file(ptr(i)%fileobj)
   1213         deallocate(ptr(i)%fileobj)
   1214      endif
   1215   enddo
   1216 
   1217   if (associated(opened_files))then
   1218      ptr(1:size(opened_files)) = opened_files(:)
   1219      deallocate(opened_files)
   1220   endif
   1221   opened_files => ptr
   1222 
   1223 end subroutine realloc_files

Page 42          Source Listing                  REALLOC_FILES
2021-06-01 08:55 Entry Points                    time_interp_external2.F90



ENTRY POINTS

  Name                                                   
                                                         
 time_interp_external2_mod_mp_realloc_files_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 ASSOCIATED                 Func   1204                                 scalar                    1204,1211,1217                    
 CLOSE_FILE                 Local  1212                                 scalar   PRIV             68,1212,1384                      
 FILETYPE                   Type   1201                     136         scalar   PRIV             155,166,1201                      
 I                          Local  1202     I(4)            4           scalar                    1209,1210,1211,1212,1213          
 N                          Dummy  1198     I(4)            4           scalar   ARG,IN           1205,1208                         
 NETCDF_FILE_CLOSE_WRAP     Subr   1212                                          PRIV             1212,1384                         
 PTR                        Local  1201     RECORD          136   1     1        PTR              1208,1209,1210,1211,1212,1213,1218
                                                                                                  ,1221                             
 REALLOC_FILES              Subr   1198                                                           199                               
 SIZE                       Func   1205                                 scalar                    1205,1209,1218                    

Page 43          Source Listing                  REALLOC_FILES
2021-06-01 08:55                                 time_interp_external2.F90

   1224 
   1225 ! ============================================================================
   1226 ! reallocates array of fields,increasing its size
   1227 subroutine realloc_fields(n)
   1228   integer, intent(in) :: n ! new size
   1229 
   1230   type(ext_fieldtype), pointer :: ptr(:)
   1231   integer :: i, ier
   1232 
   1233   if (associated(field)) then
   1234      if (n <= size(field)) return ! do nothing if requested size no more then current
   1235   endif
   1236 
   1237   allocate(ptr(n))
   1238   do i=1,size(ptr)
   1239      ptr(i)%fileobj => NULL()
   1240      ptr(i)%name=''
   1241      ptr(i)%units=''
   1242      ptr(i)%siz=-1
   1243      ptr(i)%ndim=-1
   1244      ptr(i)%domain = NULL_DOMAIN2D
   1245      if (ASSOCIATED(ptr(i)%time))       DEALLOCATE(ptr(i)%time, stat=ier)
   1246      if (ASSOCIATED(ptr(i)%start_time)) DEALLOCATE(ptr(i)%start_time, stat=ier)
   1247      if (ASSOCIATED(ptr(i)%end_time))   DEALLOCATE(ptr(i)%end_time, stat=ier)
   1248      if (ASSOCIATED(ptr(i)%period)) DEALLOCATE(ptr(i)%period, stat=ier)
   1249      ptr(i)%modulo_time=.false.
   1250      if (ASSOCIATED(ptr(i)%data)) DEALLOCATE(ptr(i)%data, stat=ier)
   1251      if (ASSOCIATED(ptr(i)%ibuf)) DEALLOCATE(ptr(i)%ibuf, stat=ier)
   1252      if (ASSOCIATED(ptr(i)%src_data)) DEALLOCATE(ptr(i)%src_data, stat=ier)
   1253      ptr(i)%nbuf=-1
   1254      ptr(i)%domain_present=.false.
   1255      ptr(i)%slope=1.0
   1256      ptr(i)%intercept=0.0
   1257      ptr(i)%isc=-1;ptr(i)%iec=-1
   1258      ptr(i)%jsc=-1;ptr(i)%jec=-1
   1259   enddo
   1260   if (associated(field)) then
   1261      ptr(1:size(field)) = field(:)
   1262      deallocate(field)
   1263   endif
   1264   field=>ptr
   1265 
   1266 end subroutine realloc_fields

Page 44          Source Listing                  REALLOC_FIELDS
2021-06-01 08:55 Entry Points                    time_interp_external2.F90



ENTRY POINTS

  Name                                                    
                                                          
 time_interp_external2_mod_mp_realloc_fields_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 ASSOCIATED                 Func   1233                                 scalar                    1233,1245,1246,1247,1248,1250,1251
                                                                                                  ,1252,1260                        
 I                          Local  1231     I(4)            4           scalar                    1238,1239,1240,1241,1242,1243,1244
                                                                                                  ,1245,1246,1247,1248,1249,1250,125
                                                                                                  1,1252,1253,1254,1255,1256,1257,12
                                                                                                  58                                
 IER                        Local  1231     I(4)            4           scalar                    1245,1246,1247,1248,1250,1251,1252
 N                          Dummy  1227     I(4)            4           scalar   ARG,IN           1234,1237                         
 NULL_DOMAIN2D              Local  1244     DOMAIN2D        752         scalar   PRIV,SAVE        59,1244,1376                      
 PTR                        Local  1230     RECORD          2256  1     1        PTR              1237,1238,1239,1240,1241,1242,1243
                                                                                                  ,1244,1245,1246,1247,1248,1249,125
                                                                                                  0,1251,1252,1253,1254,1255,1256,12
                                                                                                  57,1258,1261,1264                 
 REALLOC_FIELDS             Subr   1227                                                           198                               
 SIZE                       Func   1234                                 scalar                    1234,1238,1261                    

Page 45          Source Listing                  REALLOC_FIELDS
2021-06-01 08:55                                 time_interp_external2.F90

   1267 
   1268 
   1269     function find_buf_index(indx,buf)
   1270       integer :: indx
   1271       integer, dimension(:) :: buf
   1272       integer :: find_buf_index
   1273 
   1274       integer :: nbuf, i
   1275 
   1276       nbuf = size(buf(:))
   1277 
   1278       find_buf_index = -1
   1279 
   1280       do i=1,nbuf
   1281          if (buf(i) == indx) then
   1282             find_buf_index = i
   1283             exit
   1284          endif
   1285       enddo
   1286 
   1287     end function find_buf_index


ENTRY POINTS

  Name                                                    
                                                          
 time_interp_external2_mod_mp_find_buf_index_             

Page 46          Source Listing                  FIND_BUF_INDEX
2021-06-01 08:55 Symbol Table                    time_interp_external2.F90



SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 BUF                        Dummy  1269     I(4)            4     1     1        ARG,INOUT        1276,1281                         
 FIND_BUF_INDEX             Func   1269     I(4)            4           scalar                                                      
 I                          Local  1274     I(4)            4           scalar                    1280,1281,1282                    
 INDX                       Dummy  1269     I(4)            4           scalar   ARG,INOUT        1281                              
 NBUF                       Local  1274     I(4)            4           scalar                    1276,1280                         
 SIZE                       Func   1276                                 scalar                    1276                              

Page 47          Source Listing                  FIND_BUF_INDEX
2021-06-01 08:55                                 time_interp_external2.F90

   1288 
   1289 !<FUNCTION NAME="get_external_field_size" TYPE="integer" DIM="(4)">
   1290 !
   1291 !<DESCRIPTION>
   1292 ! return size of field after call to init_external_field.
   1293 ! Ordering is X/Y/Z/T.
   1294 ! This call only makes sense for non-distributed reads.
   1295 !</DESCRIPTION>
   1296 !
   1297 !<IN NAME="index" TYPE="integer">
   1298 ! returned from previous call to init_external_field.
   1299 !</IN>
   1300 
   1301     function get_external_field_size(index)
   1302 
   1303       integer :: index
   1304       integer :: get_external_field_size(4)
   1305 
   1306       if (index .lt. 1 .or. index .gt. num_fields) &
   1307            call mpp_error(FATAL,'invalid index in call to get_external_field_size')
   1308 
   1309 
   1310       get_external_field_size(1) = field(index)%siz(1)
   1311       get_external_field_size(2) = field(index)%siz(2)
   1312       get_external_field_size(3) = field(index)%siz(3)
   1313       get_external_field_size(4) = field(index)%siz(4)
   1314 
   1315     end function get_external_field_size

Page 48          Source Listing                  GET_EXTERNAL_FIELD_SIZE
2021-06-01 08:55 Entry Points                    time_interp_external2.F90



ENTRY POINTS

  Name                                                             
                                                                   
 time_interp_external2_mod_mp_get_external_field_size_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 GET_EXTERNAL_FIELD_SIZE    Func   1301     I(4)            4     1     4                                                           
 INDEX                      Dummy  1301     I(4)            4           scalar   ARG,INOUT        1306,1310,1311,1312,1313          

Page 49          Source Listing                  GET_EXTERNAL_FIELD_SIZE
2021-06-01 08:55                                 time_interp_external2.F90

   1316 !</FUNCTION> NAME="get_external_field_size"
   1317 
   1318 
   1319 !<FUNCTION NAME="get_external_field_missing" TYPE="real">
   1320 !
   1321 !<DESCRIPTION>
   1322 ! return missing value
   1323 !</DESCRIPTION>
   1324 !
   1325 !<IN NAME="index" TYPE="integer">
   1326 ! returned from previous call to init_external_field.
   1327 !</IN>
   1328 
   1329     function get_external_field_missing(index)
   1330 
   1331       integer :: index
   1332       real :: missing
   1333       real :: get_external_field_missing
   1334 
   1335       if (index .lt. 1 .or. index .gt. num_fields) &
   1336            call mpp_error(FATAL,'invalid index in call to get_external_field_size')
   1337 
   1338 
   1339       get_external_field_missing = field(index)%missing
   1340 
   1341     end function get_external_field_missing


ENTRY POINTS

  Name                                                                
                                                                      
 time_interp_external2_mod_mp_get_external_field_missing_             

Page 50          Source Listing                  GET_EXTERNAL_FIELD_MISSING
2021-06-01 08:55 Symbol Table                    time_interp_external2.F90



SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 GET_EXTERNAL_FIELD_MISSING Func   1329     R(8)            8           scalar                                                      
 INDEX                      Dummy  1329     I(4)            4           scalar   ARG,INOUT        1335,1339                         
 MISSING                    Local  1332     R(8)            8           scalar                                                      

Page 51          Source Listing                  GET_EXTERNAL_FIELD_MISSING
2021-06-01 08:55                                 time_interp_external2.F90

   1342 !</FUNCTION> NAME="get_external_field_missing"
   1343 
   1344 ! ===========================================================================
   1345 subroutine get_time_axis(index, time)
   1346   integer        , intent(in)  :: index   ! field id
   1347   type(time_type), intent(out) :: time(:) ! array of time values to be filled
   1348 
   1349   integer :: n ! size of the data to be assigned
   1350 
   1351   if (index < 1.or.index > num_fields) &
   1352        call mpp_error(FATAL,'invalid index in call to get_time_axis')
   1353 
   1354   n = min(size(time),size(field(index)%time))
   1355 
   1356   time(1:n) = field(index)%time(1:n)
   1357 end subroutine


ENTRY POINTS

  Name                                                   
                                                         
 time_interp_external2_mod_mp_get_time_axis_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 GET_TIME_AXIS              Subr   1345                                                                                             
 INDEX                      Dummy  1345     I(4)            4           scalar   ARG,IN           1351,1354,1356                    
 MIN                        Func   1354                                 scalar                    1354                              
 N                          Local  1349     I(4)            4           scalar                    1354,1356                         
 SIZE                       Func   1354                                 scalar                    1354                              
 TIME                       Dummy  1345     RECORD          16    1     1        ARG,OUT          1354,1356                         

Page 52          Source Listing                  GET_TIME_AXIS
2021-06-01 08:55                                 time_interp_external2.F90

   1358 
   1359 !<SUBROUTINE NAME="time_interp_external_exit">
   1360 !
   1361 !<DESCRIPTION>
   1362 ! exit time_interp_external_mod.  Close all open files and
   1363 ! release storage
   1364 !</DESCRIPTION>
   1365 
   1366     subroutine time_interp_external_exit()
   1367 
   1368       integer :: i,j
   1369 !
   1370 ! release storage arrays
   1371 !
   1372       do i=1,num_fields
   1373          deallocate(field(i)%time,field(i)%start_time,field(i)%end_time,&
   1374               field(i)%period,field(i)%data,field(i)%mask,field(i)%ibuf)
   1375          if (ASSOCIATED(field(i)%src_data)) deallocate(field(i)%src_data)
   1376          field(i)%domain = NULL_DOMAIN2D
   1377          field(i)%nbuf = 0
   1378          field(i)%slope = 0.
   1379          field(i)%intercept = 0.
   1380       enddo
   1381 
   1382 !-- close all the files opended
   1383       do i = 1, num_files
   1384          call close_file(opened_files(i)%fileobj)
   1385          deallocate(opened_files(i)%fileobj)
   1386       enddo
   1387 
   1388       deallocate(field)
   1389       deallocate(opened_files)
   1390 
   1391       num_fields = 0
   1392 
   1393       module_initialized = .false.
   1394 
   1395     end subroutine time_interp_external_exit

Page 53          Source Listing                  TIME_INTERP_EXTERNAL_EXIT
2021-06-01 08:55 Entry Points                    time_interp_external2.F90



ENTRY POINTS

  Name                                                               
                                                                     
 time_interp_external2_mod_mp_time_interp_external_exit_             


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 ASSOCIATED                 Func   1375                                 scalar                    1375                              
 I                          Local  1368     I(4)            4           scalar                    1372,1373,1374,1375,1376,1377,1378
                                                                                                  ,1379,1383,1384,1385              
 J                          Local  1368     I(4)            4           scalar                                                      
 TIME_INTERP_EXTERNAL_EXIT  Subr   1366                                                                                             

Page 54          Source Listing                  TIME_INTERP_EXTERNAL_EXIT
2021-06-01 08:55                                 time_interp_external2.F90

   1396 !</SUBROUTINE> NAME="time_interp_external_exit"
   1397 
   1398 end module time_interp_external2_mod


SYMBOL CROSS REFERENCE

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 AXIS_UTILS2_MOD            Module 61                                                             61                                
 DAYS_IN_MONTH              Func   54       I(4)            4           scalar   PRIV             54                                
 DAYS_IN_YEAR               Func   55       I(4)            4           scalar   PRIV             55                                
 DEFAULT_MISSING_VALUE      Param  106      R(8)            8           scalar   PRIV             106                               
 DK                         Param  168      I(4)            4           scalar   PRIV             168,170                           
 FMS2_IO_MOD                Module 65                                                             65                                
 FMSNETCDFDOMAINFILE_T      Type   65                                   scalar                    65                                
 FMS_MOD                    Module 51                                                             51,62                             
 GET_CAL_TIME_MOD           Module 57                                                             57                                
 GET_EXTERNAL_FIELD_MISSING                                                                                                         
 @0                         Local  1329     R(8)            8           scalar                                                      
 GET_EXTERNAL_FIELD_SIZE@0  Local  1301     I(4)            4     1     4                                                           
 GET_EXTERNAL_FILEOBJ@0     Local  721      L(4)            4           scalar                                                      
 GET_TIME_AXIS              Subr   115                                                            115                               
 HORIZ_INTERP_MOD           Module 64                                                             64                                
 INCREMENT_TIME             Func   55       RECORD          16          scalar   PRIV             55                                
 INIT_EXTERNAL_FIELD@0      Local  253      I(4)            4           scalar                                                      
 INSIDE_REGION              Param  102      I(4)            4           scalar                    102                               
 LOWERCASE                  Func   62       CHAR                        scalar   TGT,PRIV         62                                
 MPP_DOMAINS_MOD            Module 58                                                             58                                
 MPP_MOD                    Module 52                                                             52,53                             
 Operator (>=)                     54                                                                                               
 PLATFORM_MOD               Module 50                                                             50,63                             
 R8_KIND                    Param  63       I(4)            4           scalar   PRIV             63                                
 RESET_SRC_DATA_REGION      Subr   116                                                            116                               
 SET_OVERRIDE_REGION        Subr   116                                                            116                               
 TIME_INTERP_EXTERNAL       Local  157                                  scalar                    114                               
 TIME_INTERP_EXTERNAL2_MOD  Module 22                                                                                               
 TIME_INTERP_EXTERNAL_EXIT  Subr   115                                                            115                               
 TIME_INTERP_EXTERNAL_INIT  Subr   114                                                            114                               
 TIME_INTERP_MISSING        Param  170      R(8)            8           scalar   PRIV             170                               
 TIME_INTERP_MOD            Module 60                                                             60                                
 TIME_MANAGER_MOD           Module 54                                                             54                                
 VALID_T                    Type   65                                   scalar   PRIV             65,136                            
 WARNING                    Param  52       I(4)            4           scalar   PRIV             52                                

Page 55          Source Listing                  TIME_INTERP_EXTERNAL_EXIT
2021-06-01 08:55 Subprograms/Common Blocks       time_interp_external2.F90



SUBPROGRAMS/COMMON BLOCKS

 Name                       Object Declared Type            Bytes Dimen Elements Attributes       References                        
                                                                                                                                    
 FIND_BUF_INDEX             Func   1269     I(4)            4           scalar                                                      
 GET_EXTERNAL_FIELD_MISSING Func   1329     R(8)            8           scalar                                                      
 GET_EXTERNAL_FIELD_SIZE    Func   1301     I(4)            4     1     4                                                           
 GET_EXTERNAL_FILEOBJ       Func   721      L(4)            4           scalar                                                      
 GET_TIME_AXIS              Subr   1345                                                                                             
 INIT_EXTERNAL_FIELD        Func   253      I(4)            4           scalar                                                      
 LOAD_RECORD                Subr   1016                                                           843,889,890                       
 LOAD_RECORD_0D             Subr   1123                                                           948,980,981                       
 REALLOC_FIELDS             Subr   1227                                                           198                               
 REALLOC_FILES              Subr   1198                                                           199                               
 RESET_SRC_DATA_REGION      Subr   1159                                                                                             
 SET_OVERRIDE_REGION        Subr   1182                                                                                             
 SET_TIME_MODULO            Subr   996                                                                                              
 TIME_INTERP_EXTERNAL2_MOD  Module 22                                                                                               
 TIME_INTERP_EXTERNAL_0D    Subr   924                                           PRIV                                               
 TIME_INTERP_EXTERNAL_2D    Subr   695                                           PRIV                                               
 TIME_INTERP_EXTERNAL_3D    Subr   764                                           PRIV             712                               
 TIME_INTERP_EXTERNAL_EXIT  Subr   1366                                                                                             
 TIME_INTERP_EXTERNAL_INIT  Subr   179                                                                                              

COMPILER OPTIONS BEING USED

       -align noall                          -align nonone
       -align nocommons                      -align nodcommons
       -align noqcommons                     -align nozcommons
       -align records                        -align nosequence
       -align norec1byte                     -align norec2byte
       -align norec4byte                     -align norec8byte
       -align norec16byte                    -align norec32byte
       -align norec64byte                    -align noarray8byte
       -align noarray16byte                  -align noarray32byte
       -align noarray64byte                  -align noarray128byte
       -align noarray256byte                 -altparam
       -assume accuracy_sensitive            -assume nobscc
       -assume nobuffered_io                 -assume nobuffered_stdout
       -assume byterecl                      -assume nocontiguous_assumed_shape
       -assume nocontiguous_pointer          -assume cc_omp
       -assume nocstring                     -assume nodummy_aliases
       -assume nofpe_summary                 -assume noieee_fpe_flags
       -assume nominus0                      -assume noold_boz
       -assume old_complex_align             -assume old_unit_star
       -assume old_inquire_recl              -assume old_ldout_format
       -assume old_ldout_zero                -assume noold_logical_assign
       -assume noold_logical_ldio            -assume old_maxminloc
       -assume old_xor                       -assume noprotect_allocates
       -assume protect_constants             -assume noprotect_parens
       -assume split_common                  -assume source_include
       -assume nostd_intent_in               -assume std_minus0_rounding
       -assume nostd_mod_proc_name           -assume std_value
       -assume realloc_lhs                   -assume underscore
       -assume no2underscores                -assume norecursion

Page 56          Source Listing                  TIME_INTERP_EXTERNAL_EXIT
2021-06-01 08:55                                 time_interp_external2.F90

       -auto                            no   -auto_scalar
  no   -bintext                              -ccdefault default
       -check noarg_temp_created             -check noassume
       -check nobounds                       -check nocontiguous
       -check noformat                       -check nooutput_conversion
       -check nooverflow                     -check nopointers
       -check noshape                        -check nostack
       -check nouninitialized                -check noudio_iostat
       -coarray-num-procs 0             no   -coarray-config-file
       -convert native                       -cross_reference
       -D __INTEL_COMPILER=1910              -D __INTEL_COMPILER_UPDATE=0
       -D __unix__                           -D __unix
       -D __linux__                          -D __linux
       -D __gnu_linux__                      -D unix
       -D linux                              -D __ELF__
       -D __x86_64                           -D __x86_64__
       -D __amd64                            -D __amd64__
       -D __INTEL_COMPILER_BUILD_DATE=20191121       -D _OPENMP=201611
       -D __INTEL_OFFLOAD                    -D __MMX__
       -D __SSE__                            -D __SSE_MATH__
       -D __SSE2__                           -D __SSE2_MATH__
       -D __pentium4                         -D __pentium4__
       -D __tune_pentium4__                  -D PACKAGE_NAME='"GFDL FMS Library"'
       -D PACKAGE_TARNAME='"FMS"'            -D PACKAGE_VERSION='"2021.02.0"'
       -D PACKAGE_STRING='"GFDL FMS Library 2021.02.0"'       -D PACKAGE_BUGREPORT='"gfdl.climate.model.info@noaa.gov"'
       -D PACKAGE_URL='"https://www.gfdl.noaa.gov/fms"'       -D PACKAGE='"FMS"'
       -D VERSION='"2021.02.0"'              -D STDC_HEADERS=1
       -D HAVE_SYS_TYPES_H=1                 -D HAVE_SYS_STAT_H=1
       -D HAVE_STDLIB_H=1                    -D HAVE_STRING_H=1
       -D HAVE_MEMORY_H=1                    -D HAVE_STRINGS_H=1
       -D HAVE_INTTYPES_H=1                  -D HAVE_STDINT_H=1
       -D HAVE_UNISTD_H=1                    -D HAVE_DLFCN_H=1
       -D LT_OBJDIR='".libs/"'               -D HAVE_MPI_H=1
       -D HAVE_NETCDF_H=1                    -D HAVE_SCHED_GETAFFINITY=1
       -D HAVE_MOD_MPI=1                     -D HAVE_MOD_NETCDF=1
       -D HAVE_CRAY_POINTER=1                -D HAVE_QUAD_PRECISION=1
       -D HAVE_INTERNAL_NML=1                -D use_netCDF=1
       -D use_libMPI=1                       -D INTERNAL_FILE_NML
       -double_size 64                  no   -d_lines
  no   -Qdyncom                              -error_limit 30
  no   -f66                             no   -f77rtl
  no   -fast                                 -fpscomp nofilesfromcmd
       -fpscomp nogeneral                    -fpscomp noioformat
       -fpscomp noldio_spacing               -fpscomp nologicals
  no   -fpconstant                           -fpe3
       -fprm nearest                         -ftz
       -fp_model noprecise                   -fp_model fast
       -fp_model nostrict                    -fp_model nosource
       -fp_model nodouble                    -fp_model noextended
       -fp_model novery_fast                 -fp_model noexcept
       -fp_model nono_except                 -fp_modbits nofp_contract
       -fp_modbits nono_fp_contract          -fp_modbits nofenv_access
       -fp_modbits nono_fenv_access          -fp_modbits nocx_limited_range
       -fp_modbits nono_cx_limited_range       -fp_modbits noprec_div
       -fp_modbits nono_prec_div             -fp_modbits noprec_sqrt
       -fp_modbits nono_prec_sqrt            -fp_modbits ftz
       -fp_modbits nono_ftz                  -fp_modbits nointrin_limited_range

Page 57          Source Listing                  TIME_INTERP_EXTERNAL_EXIT
2021-06-01 08:55                                 time_interp_external2.F90

       -fp_modbits nono_intrin_limited_range       -fp_modbits notrunc_compares
       -fp_modbits nono_trunc_compares       -fp_modbits noieee_nan_compares
       -fp_modbits nono_ieee_nan_compares       -fp_modbits honor_f32_conversion
       -fp_modbits nono_honor_f32_conversion       -fp_modbits honor_f64_conversion
       -fp_modbits nono_honor_f64_conversion       -fp_modbits nono_x87_copy
       -fp_modbits nono_no_x87_copy          -fp_modbits noexception_semantics
       -fp_modbits nono_exception_semantics       -fp_modbits noprecise_libm_functions
       -fp_modbits nono_precise_libm_functions       -heap_arrays 0
  no   -threadprivate_compat                 -free
       -g2                                   -iface nomixed_str_len_arg
       -iface nono_mixed_str_len_arg         -init noarrays
       -init nohuge                          -init noinfinity
       -init nominus_huge                    -init nominus_infinity
       -init nominus_tiny                    -init nonan
       -init nosnan                          -init notiny
       -init nozero                     no   -intconstant
       -integer_size 32                 no   -mixed_str_len_arg
       -module ../.mods                      -names lowercase
  no   -noinclude                       no   -o
       -offload-build=host                   -openmp
       -openmp-simd                          -openmp-offload
       -O0                              no   -pad_source
       -real_size 64                    no   -recursive
       -reentrancy threaded                  -vec=simd
       -show nofullpath                      -show noinclude
       -show map                             -show options
  no   -syntax_only                     no   -threadcom
  no   -U                               no   -vms
       -w noall                              -w nonone
       -w noalignments                       -w nodeclarations
       -w noexternals                        -w nogeneral
       -w noignore_bounds                    -w noignore_loc
       -w nointerfaces                       -w noshape
       -w notruncated_source                 -w nouncalled
       -w nouninitialized                    -w nounused
       -w nousage                       no   -wrap-margins

       -includepath : /opt/netcdf/4.6.1/INTEL/include/,/opt/intel/2020/compilers_and_libraries/linux/pstl/include/,
           /opt/intel/2020/compilers_and_libraries_2020.0.166/linux/compiler/include/,.f90,./.f90,./.f90,../include/.f90,
           ./.f90,/opt/netcdf/4.6.1/INTEL/include/.f90,/opt/intel/2020/compilers_and_libraries/linux/mpi/intel64/include/.f90,
           /opt/intel/2020/compilers_and_libraries/linux/mpi/intel64/include/.f90,/opt/intel/2020/compilers_and_libraries/linux/ipp/include/.f90,
           /opt/intel/2020/compilers_and_libraries/linux/mkl/include/.f90,/opt/intel/2020/compilers_and_libraries/linux/pstl/include/.f90,
           /opt/intel/2020/compilers_and_libraries/linux/tbb/include/.f90,/opt/intel/2020/compilers_and_libraries/linux/daal/include/.f90,
           /opt/intel/2020/compilers_and_libraries_2020.0.166/linux/compiler/include/intel64/.f90,/opt/intel/2020/compilers_and_libraries_2020.0.166/linux/compiler/include/icc/.f90,
           /opt/intel/2020/compilers_and_libraries_2020.0.166/linux/compiler/include/.f90,/usr/local/include/.f90,
           /usr/lib/gcc/x86_64-redhat-linux/4.8.5/include/.f90,/usr/include/.f90,/usr/include/.f90,/usr/include/.f90
       -list filename : time_interp_external2.lst
  no   -o

COMPILER: Intel(R) Fortran 19.1-1555
